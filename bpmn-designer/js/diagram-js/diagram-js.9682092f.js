import{I as t}from"../didi/didi.8d6822e4.js";import{e}from"../inherits-browser/inherits-browser.a3b97550.js";import{c as n,a as o,b as i,r,d as a,t as s,e as c,f as u,g as h,h as l}from"../tiny-svg/tiny-svg.9f6d78cc.js";import{t as p,a as d,j as f,l as v,e as g,r as y,k as m,q as _,f as x,h as w,z as E,c as b,u as S,A as C,b as k,w as M,i as j,n as R,v as T,s as B,o as P,B as L,C as O,p as $,y as A,m as z,D as I,E as D,F as H,G}from"../min-dash/min-dash.915ecfae.js";import{b as N,f as V,g as U,q as F,d as W,r as K,h as q,a as Z,c as Y,i as X,e as J,m as Q}from"../min-dom/min-dom.04e3f566.js";import{c as tt}from"../clsx/clsx.1adaa6f0.js";import{m as et}from"../htm/htm.623ba719.js";import{F as nt,q as ot,A as it,p as rt,x as at,_ as st,N as ct}from"../preact/preact.73ee5146.js";import{f as ut}from"../path-intersection/path-intersection.fa18f997.js";import{R as ht}from"../object-refs/object-refs.7af026ed.js";function lt(t,e){return t&&e?Math.sqrt(Math.pow(t.x-e.x,2)+Math.pow(t.y-e.y,2)):-1}function pt(t,e,n,o){if(void 0===o&&(o=5),!t||!e||!n)return!1;var i=(e.x-t.x)*(n.y-t.y)-(e.y-t.y)*(n.x-t.x),r=lt(t,e);return Math.abs(i/r)<=o}var dt=2;function ft(t,e){var n=Array.from(arguments).flat();const o={x:"v",y:"h"};for(const[i,r]of Object.entries(o))if(vt(i,n))return r;return!1}function vt(t,e){const n=e[0];return p(e,(function(e){return Math.abs(n[t]-e[t])<=dt}))}function gt(t,e,n){return n=n||0,t.x>e.x-n&&t.y>e.y-n&&t.x<e.x+e.width+n&&t.y<e.y+e.height+n}function yt(t,e){return{x:Math.round(t.x+(e.x-t.x)/2),y:Math.round(t.y+(e.y-t.y)/2)}}function mt(t){return d(t)&&f(t,"waypoints")}function _t(t){return d(t)&&f(t,"labelTarget")}function xt(t){return{x:Math.round(t.x),y:Math.round(t.y),width:Math.round(t.width),height:Math.round(t.height)}}function wt(t){return{x:Math.round(t.x),y:Math.round(t.y)}}function Et(t){return{top:t.y,right:t.x+(t.width||0),bottom:t.y+(t.height||0),left:t.x}}function bt(t){return{x:t.left,y:t.top,width:t.right-t.left,height:t.bottom-t.top}}function St(t){for(var e=t.waypoints,n=e.reduce((function(t,n,o){var i,r,a=e[o-1];if(a){var s=t[t.length-1],c=s&&s.endLength||0,u=(i=a,r=n,Math.sqrt(Math.pow(i.x-r.x,2)+Math.pow(i.y-r.y,2)));t.push({start:a,end:n,startLength:c,endLength:c+u,length:u})}return t}),[]),o=n.reduce((function(t,e){return t+e.length}),0)/2,i=0,r=n[i];r.endLength<o;)r=n[++i];var a=(o-r.startLength)/r.length;return{x:r.start.x+(r.end.x-r.start.x)*a,y:r.start.y+(r.end.y-r.start.y)*a}}function Ct(t){return mt(t)?St(t):wt({x:(e=t).x+(e.width||0)/2,y:e.y+(e.height||0)/2});var e}function kt(t,e,n){d(n=n||0)||(n={x:n,y:n});var o=Et(t),i=Et(e),r=o.bottom+n.y<=i.top,a=o.left-n.x>=i.right,s=o.top-n.y>=i.bottom,c=r?"top":s?"bottom":null,u=o.right+n.x<=i.left?"left":a?"right":null;return u&&c?c+"-"+u:u||c||"intersect"}function Mt(t,e,n){var o=ut(t,e);return 1===o.length||2===o.length&&lt(o[0],o[1])<1?wt(o[0]):o.length>1?wt((o=v(o,(function(t){var e=Math.floor(100*t.t2)||1;return e=((e=100-e)<10?"0":"")+e,t.segment2+"#"+e})))[n?0:o.length-1]):null}var jt=10,Rt=50;function Tt(t,e,n,o){for(var i;i=Pt(t,n,e);)n=o(e,n,i);return n}function Bt(t){return function(e,n,o){var i={x:n.x,y:n.y};return["x","y"].forEach((function(r){var a=t[r];if(a){var s="x"===r?"width":"height",c=a.margin,u=a.minDistance;i[r]=c<0?Math.min(o[r]+c-e[s]/2,n[r]-u+c):Math.max(o[r]+o[s]+c+e[s]/2,n[r]+u+c)}})),i}}function Pt(t,e,n){var o={x:e.x-n.width/2,y:e.y-n.height/2,width:n.width,height:n.height},i=function(t){var e=Ot(t);t.host&&(e=e.concat(Ot(t.host)));t.attachers&&(e=e.concat(t.attachers.reduce((function(t,e){return t.concat(Ot(e))}),[])));return e}(t);return g(i,(function(t){return t!==n&&"intersect"===kt(t,o,jt)}))}function Lt(t,e){e||(e={});var n=e.defaultDistance||Rt,o=e.direction||"e",i=e.filter,r=e.getWeight||function(e){return e.source===t?1:-1},a=e.maxDistance||250,s=e.reference||"start";function c(t,e){return"n"===o?"start"===s?Et(t).top-Et(e).bottom:"center"===s?Et(t).top-Ct(e).y:Et(t).top-Et(e).top:"w"===o?"start"===s?Et(t).left-Et(e).right:"center"===s?Et(t).left-Ct(e).x:Et(t).left-Et(e).left:"s"===o?"start"===s?Et(e).top-Et(t).bottom:"center"===s?Ct(e).y-Et(t).bottom:Et(e).bottom-Et(t).bottom:"start"===s?Et(e).left-Et(t).right:"center"===s?Ct(e).x-Et(t).right:Et(e).right-Et(t).right}i||(i=$t);var u=t.incoming.filter(i).map((function(e){var n=r(e),o=n<0?c(e.source,t):c(t,e.source);return{id:e.source.id,distance:o,weight:n}})),h=t.outgoing.filter(i).map((function(e){var n=r(e),o=n>0?c(t,e.target):c(e.target,t);return{id:e.target.id,distance:o,weight:n}})),l=u.concat(h).reduce((function(t,e){return t[e.id+"__weight_"+e.weight]=e,t}),{});return y(l,(function(t,e){var n=e.distance,o=e.weight;return n<0||n>a||(t[String(n)]||(t[String(n)]=0),t[String(n)]+=1*o,(!t.distance||t[t.distance]<t[String(n)])&&(t.distance=n)),t}),{}).distance||n}function Ot(t){return(e=t,e.outgoing.map((function(t){return t.target}))).concat(function(t){return t.incoming.map((function(t){return t.source}))}(t));var e}function $t(){return!0}var At=1e3;function zt(t,e){var n=this;e=e||At,t.on(["render.shape","render.connection"],e,(function(t,e){var o=t.type,i=e.element,r=e.gfx,a=e.attrs;if(n.canRender(i))return"render.shape"===o?n.drawShape(r,i,a):n.drawConnection(r,i,a)})),t.on(["render.getShapePath","render.getConnectionPath"],e,(function(t,e){if(n.canRender(e))return"render.getShapePath"===t.type?n.getShapePath(e):n.getConnectionPath(e)}))}function It(t){return t.flat().join(",").replace(/,?([A-z]),?/g,"$1")}function Dt(t){return["L",t.x,t.y]}function Ht(t,e){const n=t.length,o=[(i=t[0],["M",i.x,i.y])];var i,r,a,s;for(let c=1;c<n;c++){const n=t[c-1],i=t[c],u=t[c+1];if(!u||!e){o.push(Dt(i));continue}const h=Math.min(e,Nt(i.x-n.x,i.y-n.y),Nt(u.x-i.x,u.y-i.y));if(!h){o.push(Dt(i));continue}const l=Gt(i,n,h),p=Gt(i,n,.5*h),d=Gt(i,u,h),f=Gt(i,u,.5*h);o.push(Dt(l)),o.push((a=f,s=d,["C",(r=p).x,r.y,a.x,a.y,s.x,s.y]))}return o}function Gt(t,e,n){const o=e.x-t.x,i=e.y-t.y,r=n/Nt(o,i);return{x:t.x+o*r,y:t.y+i*r}}function Nt(t,e){return Math.sqrt(Math.pow(t,2)+Math.pow(e,2))}function Vt(t,e,o){m(e)&&(o=e,e=null),e||(e={});const i=n("path",e);return m(o)&&(i.dataset.cornerRadius=String(o)),Ut(i,t)}function Ut(t,e){const n=parseInt(t.dataset.cornerRadius,10)||0;return o(t,{d:It(Ht(e,n))}),t}function Ft(t){return w(t,(function(e){return!g(t,(function(t){return t!==e&&Wt(e,t)}))}))}function Wt(t,e){if(e){if(t===e)return e;if(t.parent)return Wt(t.parent,e)}}function Kt(t,e,n){var o=!n||-1===t.indexOf(e);return o&&t.push(e),o}function qt(t,e,n){n=n||0,_(t)||(t=[t]),x(t,(function(t,o){var i=e(t,o,n);_(i)&&i.length&&qt(i,e,n+1)}))}function Zt(t,e){return function(t,e,n){var o=[],i=[];return qt(t,(function(t,r,a){Kt(o,t,e);var s=t.children;if((-1===n||a<n)&&s&&Kt(i,s,e))return s})),o}(t,!e,-1)}function Yt(t,e){var n,o,i,r;return e=!!e,_(t)||(t=[t]),x(t,(function(t){var a=t;t.waypoints&&!e&&(a=Yt(t.waypoints,!0));var s=a.x,c=a.y,u=a.height||0,h=a.width||0;(s<n||void 0===n)&&(n=s),(c<o||void 0===o)&&(o=c),(s+h>i||void 0===i)&&(i=s+h),(c+u>r||void 0===r)&&(r=c+u)})),{x:n,y:o,height:r-o,width:i-n}}function Xt(t){return"waypoints"in t?"connection":"x"in t?"shape":"root"}function Jt(t){return!(!t||!t.isFrame)}function Qt(t,e){return b({},t||{},e||{})}zt.prototype.canRender=function(t){},zt.prototype.drawShape=function(t,e){},zt.prototype.drawConnection=function(t,e){},zt.prototype.getShapePath=function(t){},zt.prototype.getConnectionPath=function(t){};function te(t,e){zt.call(this,t,1),this.CONNECTION_STYLE=e.style(["no-fill"],{strokeWidth:5,stroke:"fuchsia"}),this.SHAPE_STYLE=e.style({fill:"white",stroke:"fuchsia",strokeWidth:2}),this.FRAME_STYLE=e.style(["no-fill"],{stroke:"fuchsia",strokeDasharray:4,strokeWidth:2})}e(te,zt),te.prototype.canRender=function(){return!0},te.prototype.drawShape=function(t,e,r){var a=n("rect");return o(a,{x:0,y:0,width:e.width||0,height:e.height||0}),Jt(e)?o(a,b({},this.FRAME_STYLE,r||{})):o(a,b({},this.SHAPE_STYLE,r||{})),i(t,a),a},te.prototype.drawConnection=function(t,e,n){var o=Vt(e.waypoints,b({},this.CONNECTION_STYLE,n||{}));return i(t,o),o},te.prototype.getShapePath=function(t){var e=t.x,n=t.y,o=t.width;return It([["M",e,n],["l",o,0],["l",0,t.height],["l",-o,0],["z"]])},te.prototype.getConnectionPath=function(t){var e,n,o=t.waypoints,i=[];for(e=0;n=o[e];e++)n=n.original||n,i.push([0===e?"M":"L",n.x,n.y]);return It(i)},te.$inject=["eventBus","styles"];const ee={__init__:["defaultRenderer"],defaultRenderer:["type",te],styles:["type",function(){var t={"no-fill":{fill:"none"},"no-border":{strokeOpacity:0},"no-events":{pointerEvents:"none"}},e=this;this.cls=function(t,e,n){var o=this.style(e,n);return b(o,{class:t})},this.style=function(e,n){_(e)||n||(n=e,e=[]);var o=y(e,(function(e,n){return b(e,t[n]||{})}),{});return n?b(o,n):o},this.computeStyle=function(t,n,o){return _(n)||(o=n,n=[]),e.style(n||[],b({},o,t||{}))}}]};function ne(t,e){if(!t||!e)return-1;var n=t.indexOf(e);return-1!==n&&t.splice(n,1),n}function oe(t,e,n){if(t&&e){"number"!=typeof n&&(n=-1);var o=t.indexOf(e);if(-1!==o){if(o===n)return;if(-1===n)return;t.splice(o,1)}-1!==n?t.splice(n,0,e):t.push(e)}}function ie(t,e){return t&&e?t.indexOf(e):-1}function re(t,e){return Math.round(t*e)/e}function ae(t){return m(t)?t+"px":t}function se(t,e,o){const i=n("g");a(i).add(e);const r=void 0!==o?o:t.childNodes.length-1;return t.insertBefore(i,t.childNodes[r]||null),i}const ce={shape:["x","y","width","height"],connection:["waypoints"]};function ue(t,e,n,o){this._eventBus=e,this._elementRegistry=o,this._graphicsFactory=n,this._rootsIdx=0,this._layers={},this._planes=[],this._rootElement=null,this._init(t||{})}function he(t,e){const n="matrix("+e.a+","+e.b+","+e.c+","+e.d+","+e.e+","+e.f+")";t.setAttribute("transform",n)}ue.$inject=["config.canvas","eventBus","graphicsFactory","elementRegistry"],ue.prototype._init=function(t){const e=this._eventBus,r=this._container=function(t){const e=(t=b({},{width:"100%",height:"100%"},t)).container||document.body,n=document.createElement("div");return n.setAttribute("class","djs-container djs-parent"),N(n,{position:"relative",overflow:"hidden",width:ae(t.width),height:ae(t.height)}),e.appendChild(n),n}(t),a=this._svg=n("svg");o(a,{width:"100%",height:"100%"}),i(r,a);const s=this._viewport=se(a,"viewport");t.deferUpdate&&(this._viewboxChanged=C(k(this._viewboxChanged,this),300)),e.on("diagram.init",(()=>{e.fire("canvas.init",{svg:a,viewport:s})})),e.on(["shape.added","connection.added","shape.removed","connection.removed","elements.changed","root.set"],(()=>{delete this._cachedViewbox})),e.on("diagram.destroy",500,this._destroy,this),e.on("diagram.clear",500,this._clear,this)},ue.prototype._destroy=function(){this._eventBus.fire("canvas.destroy",{svg:this._svg,viewport:this._viewport});const t=this._container.parentNode;t&&t.removeChild(this._container),delete this._svg,delete this._container,delete this._layers,delete this._planes,delete this._rootElement,delete this._viewport},ue.prototype._clear=function(){this._elementRegistry.getAll().forEach((t=>{const e=Xt(t);"root"===e?this.removeRootElement(t):this._removeElement(t,e)})),this._planes=[],this._rootElement=null,delete this._cachedViewbox},ue.prototype.getDefaultLayer=function(){return this.getLayer("base",0)},ue.prototype.getLayer=function(t,e){if(!t)throw new Error("must specify a name");let n=this._layers[t];if(n||(n=this._layers[t]=this._createLayer(t,e)),void 0!==e&&n.index!==e)throw new Error("layer <"+t+"> already created at index <"+e+">");return n.group},ue.prototype._getChildIndex=function(t){return y(this._layers,(function(e,n){return n.visible&&t>=n.index&&e++,e}),0)},ue.prototype._createLayer=function(t,e){void 0===e&&(e=1);const n=this._getChildIndex(e);return{group:se(this._viewport,"layer-"+t,n),index:e,visible:!0}},ue.prototype.showLayer=function(t){if(!t)throw new Error("must specify a name");const e=this._layers[t];if(!e)throw new Error("layer <"+t+"> does not exist");const n=this._viewport,o=e.group,i=e.index;if(e.visible)return o;const r=this._getChildIndex(i);return n.insertBefore(o,n.childNodes[r]||null),e.visible=!0,o},ue.prototype.hideLayer=function(t){if(!t)throw new Error("must specify a name");const e=this._layers[t];if(!e)throw new Error("layer <"+t+"> does not exist");const n=e.group;return e.visible?(r(n),e.visible=!1,n):n},ue.prototype._removeLayer=function(t){const e=this._layers[t];e&&(delete this._layers[t],r(e.group))},ue.prototype.getActiveLayer=function(){const t=this._findPlaneForRoot(this.getRootElement());return t?t.layer:null},ue.prototype.findRoot=function(t){if("string"==typeof t&&(t=this._elementRegistry.get(t)),!t)return;const e=this._findPlaneForRoot(function(t){for(;t.parent;)t=t.parent;return t}(t))||{};return e.rootElement},ue.prototype.getRootElements=function(){return this._planes.map((function(t){return t.rootElement}))},ue.prototype._findPlaneForRoot=function(t){return g(this._planes,(function(e){return e.rootElement===t}))},ue.prototype.getContainer=function(){return this._container},ue.prototype._updateMarker=function(t,e,n){let o;t.id||(t=this._elementRegistry.get(t)),o=this._elementRegistry._elements[t.id],o&&(x([o.gfx,o.secondaryGfx],(function(t){t&&(n?a(t).add(e):a(t).remove(e))})),this._eventBus.fire("element.marker.update",{element:t,gfx:o.gfx,marker:e,add:!!n}))},ue.prototype.addMarker=function(t,e){this._updateMarker(t,e,!0)},ue.prototype.removeMarker=function(t,e){this._updateMarker(t,e,!1)},ue.prototype.hasMarker=function(t,e){t.id||(t=this._elementRegistry.get(t));const n=this.getGraphics(t);return a(n).has(e)},ue.prototype.toggleMarker=function(t,e){this.hasMarker(t,e)?this.removeMarker(t,e):this.addMarker(t,e)},ue.prototype.getRootElement=function(){const t=this._rootElement;return t||this._planes.length?t:this.setRootElement(this.addRootElement(null))},ue.prototype.addRootElement=function(t){const e=this._rootsIdx++;t||(t={id:"__implicitroot_"+e,children:[],isImplicit:!0});const n=t.layer="root-"+e;this._ensureValid("root",t);const o=this.getLayer(n,0);return this.hideLayer(n),this._addRoot(t,o),this._planes.push({rootElement:t,layer:o}),t},ue.prototype.removeRootElement=function(t){"string"==typeof t&&(t=this._elementRegistry.get(t));if(this._findPlaneForRoot(t))return this._removeRoot(t),this._removeLayer(t.layer),this._planes=this._planes.filter((function(e){return e.rootElement!==t})),this._rootElement===t&&(this._rootElement=null),t},ue.prototype.setRootElement=function(t){if(t===this._rootElement)return t;let e;if(!t)throw new Error("rootElement required");return e=this._findPlaneForRoot(t),e||(t=this.addRootElement(t)),this._setRoot(t),t},ue.prototype._removeRoot=function(t){const e=this._elementRegistry,n=this._eventBus;n.fire("root.remove",{element:t}),n.fire("root.removed",{element:t}),e.remove(t)},ue.prototype._addRoot=function(t,e){const n=this._elementRegistry,o=this._eventBus;o.fire("root.add",{element:t}),n.add(t,e),o.fire("root.added",{element:t,gfx:e})},ue.prototype._setRoot=function(t,e){const n=this._rootElement;n&&(this._elementRegistry.updateGraphics(n,null,!0),this.hideLayer(n.layer)),t&&(e||(e=this._findPlaneForRoot(t).layer),this._elementRegistry.updateGraphics(t,this._svg,!0),this.showLayer(t.layer)),this._rootElement=t,this._eventBus.fire("root.set",{element:t})},ue.prototype._ensureValid=function(t,e){if(!e.id)throw new Error("element must have an id");if(this._elementRegistry.get(e.id))throw new Error("element <"+e.id+"> already exists");const n=ce[t];if(!p(n,(function(t){return void 0!==e[t]})))throw new Error("must supply { "+n.join(", ")+" } with "+t)},ue.prototype._setParent=function(t,e,n){oe(e.children,t,n),t.parent=e},ue.prototype._addElement=function(t,e,n,o){n=n||this.getRootElement();const i=this._eventBus,r=this._graphicsFactory;this._ensureValid(t,e),i.fire(t+".add",{element:e,parent:n}),this._setParent(e,n,o);const a=r.create(t,e,o);return this._elementRegistry.add(e,a),r.update(t,e,a),i.fire(t+".added",{element:e,gfx:a}),e},ue.prototype.addShape=function(t,e,n){return this._addElement("shape",t,e,n)},ue.prototype.addConnection=function(t,e,n){return this._addElement("connection",t,e,n)},ue.prototype._removeElement=function(t,e){const n=this._elementRegistry,o=this._graphicsFactory,i=this._eventBus;if(t=n.get(t.id||t))return i.fire(e+".remove",{element:t}),o.remove(t),ne(t.parent&&t.parent.children,t),t.parent=null,i.fire(e+".removed",{element:t}),n.remove(t),t},ue.prototype.removeShape=function(t){return this._removeElement(t,"shape")},ue.prototype.removeConnection=function(t){return this._removeElement(t,"connection")},ue.prototype.getGraphics=function(t,e){return this._elementRegistry.getGraphics(t,e)},ue.prototype._changeViewbox=function(t){this._eventBus.fire("canvas.viewbox.changing"),t.apply(this),this._cachedViewbox=null,this._viewboxChanged()},ue.prototype._viewboxChanged=function(){this._eventBus.fire("canvas.viewbox.changed",{viewbox:this.viewbox()})},ue.prototype.viewbox=function(t){if(void 0===t&&this._cachedViewbox)return this._cachedViewbox;const e=this._viewport,n=this.getSize();let o,i,r,a,u,h,l;return t?(this._changeViewbox((function(){u=Math.min(n.width/t.width,n.height/t.height);const o=this._svg.createSVGMatrix().scale(u).translate(-t.x,-t.y);s(e,o)})),t):(r=this._rootElement?this.getActiveLayer():null,o=r&&r.getBBox()||{},a=s(e),i=a?a.matrix:c(),u=re(i.a,1e3),h=re(-i.e||0,1e3),l=re(-i.f||0,1e3),t=this._cachedViewbox={x:h?h/u:0,y:l?l/u:0,width:n.width/u,height:n.height/u,scale:u,inner:{width:o.width||0,height:o.height||0,x:o.x||0,y:o.y||0},outer:n})},ue.prototype.scroll=function(t){const e=this._viewport;let n=e.getCTM();return t&&this._changeViewbox((function(){t=b({dx:0,dy:0},t||{}),n=this._svg.createSVGMatrix().translate(t.dx,t.dy).multiply(n),he(e,n)})),{x:n.e,y:n.f}},ue.prototype.scrollToElement=function(t,e){let n=100;"string"==typeof t&&(t=this._elementRegistry.get(t));const o=this.findRoot(t);if(o!==this.getRootElement()&&this.setRootElement(o),o===t)return;e||(e={}),"number"==typeof e&&(n=e),e={top:e.top||n,right:e.right||n,bottom:e.bottom||n,left:e.left||n};const i=Yt(t),r=Et(i),a=this.viewbox(),s=this.zoom();let c,u;a.y+=e.top/s,a.x+=e.left/s,a.width-=(e.right+e.left)/s,a.height-=(e.bottom+e.top)/s;const h=Et(a);if(i.width<a.width&&i.height<a.height){const t=Math.max(0,r.right-h.right),e=Math.min(0,r.left-h.left),n=Math.max(0,r.bottom-h.bottom),o=Math.min(0,r.top-h.top);c=t||e,u=n||o}else c=i.x-a.x,u=i.y-a.y;this.scroll({dx:-c*s,dy:-u*s})},ue.prototype.zoom=function(t,e){if(!t)return this.viewbox(t).scale;if("fit-viewport"===t)return this._fitViewport(e);let n,o;return this._changeViewbox((function(){"object"!=typeof e&&(n=this.viewbox().outer,e={x:n.width/2,y:n.height/2}),o=this._setZoom(t,e)})),re(o.a,1e3)},ue.prototype._fitViewport=function(t){const e=this.viewbox(),n=e.outer,o=e.inner;let i,r;return o.x>=0&&o.y>=0&&o.x+o.width<=n.width&&o.y+o.height<=n.height&&!t?r={x:0,y:0,width:Math.max(o.width+o.x,n.width),height:Math.max(o.height+o.y,n.height)}:(i=Math.min(1,n.width/o.width,n.height/o.height),r={x:o.x+(t?o.width/2-n.width/i/2:0),y:o.y+(t?o.height/2-n.height/i/2:0),width:n.width/i,height:n.height/i}),this.viewbox(r),this.viewbox(!1).scale},ue.prototype._setZoom=function(t,e){const n=this._svg,o=this._viewport,i=n.createSVGMatrix(),r=n.createSVGPoint();let a,s,c,u,h;c=o.getCTM();const l=c.a;return e?(a=b(r,e),s=a.matrixTransform(c.inverse()),u=i.translate(s.x,s.y).scale(1/l*t).translate(-s.x,-s.y),h=c.multiply(u)):h=i.scale(t),he(this._viewport,h),h},ue.prototype.getSize=function(){return{width:this._container.clientWidth,height:this._container.clientHeight}},ue.prototype.getAbsoluteBBox=function(t){const e=this.viewbox();let n;if(t.waypoints){n=this.getGraphics(t).getBBox()}else n=t;return{x:n.x*e.scale-e.x*e.scale,y:n.y*e.scale-e.y*e.scale,width:n.width*e.scale,height:n.height*e.scale}},ue.prototype.resized=function(){delete this._cachedViewbox,this._eventBus.fire("canvas.resized")};var le="data-element-id";function pe(t){this._elements={},this._eventBus=t}pe.$inject=["eventBus"],pe.prototype.add=function(t,e,n){var i=t.id;this._validateId(i),o(e,le,i),n&&o(n,le,i),this._elements[i]={element:t,gfx:e,secondaryGfx:n}},pe.prototype.remove=function(t){var e=this._elements,n=t.id||t,i=n&&e[n];i&&(o(i.gfx,le,""),i.secondaryGfx&&o(i.secondaryGfx,le,""),delete e[n])},pe.prototype.updateId=function(t,e){this._validateId(e),"string"==typeof t&&(t=this.get(t)),this._eventBus.fire("element.updateId",{element:t,newId:e});var n=this.getGraphics(t),o=this.getGraphics(t,!0);this.remove(t),t.id=e,this.add(t,n,o)},pe.prototype.updateGraphics=function(t,e,n){var i=t.id||t,r=this._elements[i];return n?r.secondaryGfx=e:r.gfx=e,e&&o(e,le,i),e},pe.prototype.get=function(t){var e;e="string"==typeof t?t:t&&o(t,le);var n=this._elements[e];return n&&n.element},pe.prototype.filter=function(t){var e=[];return this.forEach((function(n,o){t(n,o)&&e.push(n)})),e},pe.prototype.find=function(t){for(var e=this._elements,n=Object.keys(e),o=0;o<n.length;o++){var i=e[n[o]],r=i.element;if(t(r,i.gfx))return r}},pe.prototype.getAll=function(){return this.filter((function(t){return t}))},pe.prototype.forEach=function(t){var e=this._elements;Object.keys(e).forEach((function(n){var o=e[n],i=o.element,r=o.gfx;return t(i,r)}))},pe.prototype.getGraphics=function(t,e){var n=t.id||t,o=this._elements[n];return o&&(e?o.secondaryGfx:o.gfx)},pe.prototype._validateId=function(t){if(!t)throw new Error("element must have an id");if(this._elements[t])throw new Error("element with id "+t+" already added")};var de=new ht({name:"children",enumerable:!0,collection:!0},{name:"parent"}),fe=new ht({name:"labels",enumerable:!0,collection:!0},{name:"labelTarget"}),ve=new ht({name:"attachers",collection:!0},{name:"host"}),ge=new ht({name:"outgoing",collection:!0},{name:"source"}),ye=new ht({name:"incoming",collection:!0},{name:"target"});function me(){Object.defineProperty(this,"businessObject",{writable:!0}),Object.defineProperty(this,"label",{get:function(){return this.labels[0]},set:function(t){var e=this.label,n=this.labels;!t&&e?n.remove(e):n.add(t,0)}}),de.bind(this,"parent"),fe.bind(this,"labels"),ge.bind(this,"outgoing"),ye.bind(this,"incoming")}function _e(){me.call(this),de.bind(this,"children"),ve.bind(this,"host"),ve.bind(this,"attachers")}function xe(){me.call(this),de.bind(this,"children")}function we(){_e.call(this),fe.bind(this,"labelTarget")}function Ee(){me.call(this),ge.bind(this,"source"),ye.bind(this,"target")}e(_e,me),e(xe,_e),e(we,_e),e(Ee,me);var be={connection:Ee,shape:_e,label:we,root:xe};function Se(){this._uid=12}Se.prototype.createRoot=function(t){return this.create("root",t)},Se.prototype.createLabel=function(t){return this.create("label",t)},Se.prototype.createShape=function(t){return this.create("shape",t)},Se.prototype.createConnection=function(t){return this.create("connection",t)},Se.prototype.create=function(t,e){return(e=b({},e||{})).id||(e.id=t+"_"+this._uid++),function(t,e){var n=be[t];if(!n)throw new Error("unknown type: <"+t+">");return b(new n,e)}(t,e)};var Ce="__fn",ke=Array.prototype.slice;function Me(){this._listeners={},this.on("diagram.destroy",1,this._destroy,this)}function je(){}function Re(t){return t.childNodes[0]}function Te(t,e,n,o,i){var r=u();r.setTranslate(e,n);var a=u();a.setRotate(o||0,0,0);var c=u();c.setScale(i||1,i||1),s(t,[r,a,c])}function Be(t,e,n){var o=u();o.setTranslate(e,n),s(t,o)}function Pe(t,e){var n=u();n.setRotate(e,0,0),s(t,n)}function Le(t,e){this._eventBus=t,this._elementRegistry=e}function Oe(t,e,n){var o=n||e.firstChild;t!==o&&e.insertBefore(t,o)}Me.prototype.on=function(t,e,n,o){if(t=_(t)?t:[t],M(e)&&(o=n,n=e,e=1e3),!m(e))throw new Error("priority must be a number");var i=n;o&&((i=k(n,o))[Ce]=n[Ce]||n);var r=this;t.forEach((function(t){r._addListener(t,{priority:e,callback:i,next:null})}))},Me.prototype.once=function(t,e,n,o){var i=this;if(M(e)&&(o=n,n=e,e=1e3),!m(e))throw new Error("priority must be a number");function r(){r.__isTomb=!0;var e=n.apply(o,arguments);return i.off(t,r),e}r[Ce]=n,this.on(t,e,r)},Me.prototype.off=function(t,e){t=_(t)?t:[t];var n=this;t.forEach((function(t){n._removeListener(t,e)}))},Me.prototype.createEvent=function(t){var e=new je;return e.init(t),e},Me.prototype.fire=function(t,e){var n,o,i,r;if(r=ke.call(arguments),"object"==typeof t&&(t=(e=t).type),!t)throw new Error("no event type specified");if(o=this._listeners[t]){n=e instanceof je?e:this.createEvent(e),r[0]=n;var a=n.type;t!==a&&(n.type=t);try{i=this._invokeListeners(n,r,o)}finally{t!==a&&(n.type=a)}return void 0===i&&n.defaultPrevented&&(i=!1),i}},Me.prototype.handleError=function(t){return!1===this.fire("error",{error:t})},Me.prototype._destroy=function(){this._listeners={}},Me.prototype._invokeListeners=function(t,e,n){for(var o;n&&!t.cancelBubble;)o=this._invokeListener(t,e,n),n=n.next;return o},Me.prototype._invokeListener=function(t,e,n){var o;if(n.callback.__isTomb)return o;try{o=function(t,e){return t.apply(null,e)}(n.callback,e),void 0!==o&&(t.returnValue=o,t.stopPropagation()),!1===o&&t.preventDefault()}catch(i){if(!this.handleError(i))throw i}return o},Me.prototype._addListener=function(t,e){var n,o=this._getListeners(t);if(o){for(;o;){if(o.priority<e.priority)return e.next=o,void(n?n.next=e:this._setListeners(t,e));n=o,o=o.next}n.next=e}else this._setListeners(t,e)},Me.prototype._getListeners=function(t){return this._listeners[t]},Me.prototype._setListeners=function(t,e){this._listeners[t]=e},Me.prototype._removeListener=function(t,e){var n,o,i,r=this._getListeners(t);if(e)for(;r;)n=r.next,(i=r.callback)!==e&&i[Ce]!==e||(o?o.next=n:this._setListeners(t,n)),o=r,r=n;else this._setListeners(t,null)},je.prototype.stopPropagation=function(){this.cancelBubble=!0},je.prototype.preventDefault=function(){this.defaultPrevented=!0},je.prototype.init=function(t){b(this,t||{})},Le.$inject=["eventBus","elementRegistry"],Le.prototype._getChildrenContainer=function(t){var e,o=this._elementRegistry.getGraphics(t);return t.parent?(e=function(t){return t.parentNode.childNodes[1]}(o),e||(e=n("g"),a(e).add("djs-children"),i(o.parentNode,e))):e=o,e},Le.prototype._clear=function(t){var e=Re(t);return V(e),e},Le.prototype._createContainer=function(t,e,o,r){var s=n("g");a(s).add("djs-group"),void 0!==o?Oe(s,e,e.childNodes[o]):i(e,s);var c=n("g");a(c).add("djs-element"),a(c).add("djs-"+t),r&&a(c).add("djs-frame"),i(s,c);var u=n("g");return a(u).add("djs-visual"),i(c,u),c},Le.prototype.create=function(t,e,n){var o=this._getChildrenContainer(e.parent);return this._createContainer(t,o,n,Jt(e))},Le.prototype.updateContainments=function(t){var e,n=this,o=this._elementRegistry;e=y(t,(function(t,e){return e.parent&&(t[e.parent.id]=e.parent),t}),{}),x(e,(function(t){var e=t.children;if(e){var i=n._getChildrenContainer(t);x(e.slice().reverse(),(function(t){Oe(o.getGraphics(t).parentNode,i)}))}}))},Le.prototype.drawShape=function(t,e,n={}){return this._eventBus.fire("render.shape",{gfx:t,element:e,attrs:n})},Le.prototype.getShapePath=function(t){return this._eventBus.fire("render.getShapePath",t)},Le.prototype.drawConnection=function(t,e,n={}){return this._eventBus.fire("render.connection",{gfx:t,element:e,attrs:n})},Le.prototype.getConnectionPath=function(t){return this._eventBus.fire("render.getConnectionPath",t)},Le.prototype.update=function(t,e,n){if(e.parent){var i=this._clear(n);if("shape"===t)this.drawShape(i,e),Be(n,e.x,e.y);else{if("connection"!==t)throw new Error("unknown type: "+t);this.drawConnection(i,e)}e.hidden?o(n,"display","none"):o(n,"display","block")}},Le.prototype.remove=function(t){var e=this._elementRegistry.getGraphics(t);r(e.parentNode)};const $e={__depends__:[ee],__init__:["canvas"],canvas:["type",ue],elementRegistry:["type",pe],elementFactory:["type",Se],eventBus:["type",Me],graphicsFactory:["type",Le]};function Ae(e){return function(e){var n=new t(e);return n.init(),n}([{config:["value",e=e||{}]},$e].concat(e.modules||[]))}function ze(t,e){this._injector=e||Ae(t),this.get("eventBus").fire("diagram.init")}ze.prototype.get=function(t,e){return this._injector.get(t,e)},ze.prototype.invoke=function(t,e,n){return this._injector.invoke(t,e,n)},ze.prototype.destroy=function(){this.get("eventBus").fire("diagram.destroy")},ze.prototype.clear=function(){this.get("eventBus").fire("diagram.clear")};var Ie={width:150,height:50};function De(t,e){var n;e.textContent=t;try{var o,i=""===t;return e.textContent=i?"dummy":t,o={width:(n=e.getBBox()).width+2*n.x,height:n.height},i&&(o.width=0),o}catch(r){return{width:0,height:0}}}function He(t,e,n){for(var o,i=t.shift(),r=i;;){if((o=De(r,n)).width=r?o.width:0," "===r||""===r||o.width<Math.round(e)||r.length<2)return Ge(t,r,i,o);r=Ve(r,o.width,e)}}function Ge(t,e,n,o){if(e.length<n.length){var i=n.slice(e.length).trim();t.unshift(i)}return{width:o.width,height:o.height,text:e}}var Ne="Â­";function Ve(t,e,n){var o=Math.max(t.length*(n/e),1),i=function(t,e){var n,o=t.split(/(\s|-|\u00AD)/g),i=[],r=0;if(o.length>1)for(;n=o.shift();){if(!(n.length+r<e)){"-"!==n&&n!==Ne||i.pop();break}i.push(n),r+=n.length}var a=i[i.length-1];return a&&a===Ne&&(i[i.length-1]="-"),i.join("")}(t,o);return i||(i=t.slice(0,Math.max(Math.round(o-1),1))),i}function Ue(t){this._config=b({},{size:Ie,padding:0,style:{},align:"center-top"},t||{})}Ue.prototype.createText=function(t,e){return this.layoutText(t,e).element},Ue.prototype.getDimensions=function(t,e){return this.layoutText(t,e).dimensions},Ue.prototype.layoutText=function(t,e){var a=b({},this._config.size,e.box),s=b({},this._config.style,e.style),c=function(t){var e=t.split("-");return{horizontal:e[0]||"center",vertical:e[1]||"top"}}(e.align||this._config.align),u=function(t){return d(t)?b({top:0,left:0,right:0,bottom:0},t):{top:t,left:t,right:t,bottom:t}}(void 0!==e.padding?e.padding:this._config.padding),h=e.fitBox||!1,l=function(t){if("fontSize"in t&&"lineHeight"in t)return t.lineHeight*parseInt(t.fontSize,10)}(s),p=t.split(/\u00AD?\r?\n/),f=[],v=a.width-u.left-u.right,g=n("text");o(g,{x:0,y:0}),o(g,s);var m=function(){var t=document.getElementById("helper-svg");return t||(t=n("svg"),o(t,{id:"helper-svg"}),N(t,{visibility:"hidden",position:"fixed",width:0,height:0}),document.body.appendChild(t)),t}();for(i(m,g);p.length;)f.push(He(p,v,g));"middle"===c.vertical&&(u.top=u.bottom=0);var _=y(f,(function(t,e,n){return t+(l||e.height)}),0)+u.top+u.bottom,w=y(f,(function(t,e,n){return e.width>t?e.width:t}),0),E=u.top;"middle"===c.vertical&&(E+=(a.height-_)/2),E-=(l||f[0].height)/4;var S=n("text");return o(S,s),x(f,(function(t){var e;switch(E+=l||t.height,c.horizontal){case"left":e=u.left;break;case"right":e=(h?w:v)-u.right-t.width;break;default:e=Math.max(((h?w:v)-t.width)/2+u.left,0)}var r=n("tspan");o(r,{x:e,y:E}),r.textContent=t.text,i(S,r)})),r(g),{dimensions:{width:w,height:_},element:S}};const Fe={translate:["value",function(t,e){return e=e||{},t.replace(/{([^}]+)}/g,(function(t,n){return e[n]||"{"+n+"}"}))}]};function We(t){t&&"function"==typeof t.stopPropagation&&t.stopPropagation()}function Ke(t){return t.originalEvent||t.srcEvent}function qe(t){We(t),We(Ke(t))}function Ze(t){return t.pointers&&t.pointers.length&&(t=t.pointers[0]),t.touches&&t.touches.length&&(t=t.touches[0]),t?{x:t.clientX,y:t.clientY}:null}function Ye(){return/mac/i.test(navigator.platform)}function Xe(t,e){return(Ke(t)||t).button===e}function Je(t){return Xe(t,0)}function Qe(t){var e=Ke(t)||t;return!!Je(t)&&(Ye()?e.metaKey:e.ctrlKey)}function tn(t){var e=Ke(t)||t;return Je(t)&&e.shiftKey}function en(t){return!0}function nn(t){return Je(t)||function(t){return Xe(t,1)}(t)}function on(t,e,a){var s=this;function c(n,o,i){var r,a;(function(t,e){return!(p[t]||Je)(e)})(n,o)||(i?a=e.getGraphics(i):(r=o.delegateTarget||o.target)&&(a=r,i=e.get(a)),a&&i&&!1===t.fire(n,{element:i,gfx:a,originalEvent:o})&&(o.stopPropagation(),o.preventDefault()))}var u={};function h(t){return u[t]}var l={click:"element.click",contextmenu:"element.contextmenu",dblclick:"element.dblclick",mousedown:"element.mousedown",mousemove:"element.mousemove",mouseover:"element.hover",mouseout:"element.out",mouseup:"element.mouseup"},p={"element.contextmenu":en,"element.mousedown":nn,"element.mouseup":nn,"element.click":nn,"element.dblclick":nn};var d="svg, .djs-element";function f(t,e,n,o){var i=u[n]=function(t){c(n,t)};o&&(p[n]=o),i.$delegate=W.bind(t,d,e,i)}function v(t,e,n){var o=h(n);o&&W.unbind(t,e,o.$delegate)}t.on("canvas.destroy",(function(t){var e;e=t.svg,x(l,(function(t,n){v(e,n,t)}))})),t.on("canvas.init",(function(t){var e;e=t.svg,x(l,(function(t,n){f(e,n,t)}))})),t.on(["shape.added","connection.added"],(function(e){var n=e.element,o=e.gfx;t.fire("interactionEvents.createHit",{element:n,gfx:o})})),t.on(["shape.changed","connection.changed"],500,(function(e){var n=e.element,o=e.gfx;t.fire("interactionEvents.updateHit",{element:n,gfx:o})})),t.on("interactionEvents.createHit",500,(function(t){var e=t.element,n=t.gfx;s.createDefaultHit(e,n)})),t.on("interactionEvents.updateHit",(function(t){var e=t.element,n=t.gfx;s.updateDefaultHit(e,n)}));var g=_("djs-hit djs-hit-stroke"),y=_("djs-hit djs-hit-click-stroke"),m={all:_("djs-hit djs-hit-all"),"click-stroke":y,stroke:g,"no-move":_("djs-hit djs-hit-no-move")};function _(t,e){return e=b({stroke:"white",strokeWidth:15},e||{}),a.cls(t,["no-fill","no-border"],e)}function w(t,e){var n=m[e];if(!n)throw new Error("invalid hit type <"+e+">");return o(t,n),t}function E(t,e){i(t,e)}this.removeHits=function(t){var e=U(".djs-hit",t);x(e,r)},this.createDefaultHit=function(t,e){var n,o=t.waypoints,i=t.isFrame;return o?this.createWaypointsHit(e,o):(n=i?"stroke":"all",this.createBoxHit(e,n,{width:t.width,height:t.height}))},this.createWaypointsHit=function(t,e){var n=Vt(e);return w(n,"stroke"),E(t,n),n},this.createBoxHit=function(t,e,i){i=b({x:0,y:0},i);var r=n("rect");return w(r,e),o(r,i),E(t,r),r},this.updateDefaultHit=function(t,e){var n=F(".djs-hit",e);if(n)return t.waypoints?Ut(n,t.waypoints):o(n,{width:t.width,height:t.height}),n},this.fire=c,this.triggerMouseEvent=function(t,e,n){var o=l[t];if(!o)throw new Error("unmapped DOM event name <"+t+">");return c(o,e,n)},this.mouseHandler=h,this.registerEvent=f,this.unregisterEvent=v}on.$inject=["eventBus","elementRegistry","styles"];const rn={__init__:["interactionEvents"],interactionEvents:["type",on]};function an(t,e){this._eventBus=t,this.offset=5;var r=e.cls("djs-outline",["no-fill"]),a=this;function s(t){var e=n("rect");return o(e,b({x:0,y:0,rx:4,width:100,height:100},r)),e}t.on(["shape.added","shape.changed"],500,(function(t){var e=t.element,n=t.gfx,o=F(".djs-outline",n);o||(o=a.getOutline(e)||s(),i(n,o)),a.updateShapeOutline(o,e)})),t.on(["connection.added","connection.changed"],(function(t){var e=t.element,n=t.gfx,o=F(".djs-outline",n);o||(o=s(),i(n,o)),a.updateConnectionOutline(o,e)}))}an.prototype.updateShapeOutline=function(t,e){var n=!1,i=this._getProviders();i.length&&x(i,(function(o){n=n||o.updateOutline(e,t)})),n||o(t,{x:-this.offset,y:-this.offset,width:e.width+2*this.offset,height:e.height+2*this.offset})},an.prototype.updateConnectionOutline=function(t,e){var n=Yt(e);o(t,{x:n.x-this.offset,y:n.y-this.offset,width:n.width+2*this.offset,height:n.height+2*this.offset})},an.prototype.registerProvider=function(t,e){e||(e=t,t=1e3),this._eventBus.on("outline.getProviders",t,(function(t){t.providers.push(e)}))},an.prototype._getProviders=function(){var t=this._eventBus.createEvent({type:"outline.getProviders",providers:[]});return this._eventBus.fire(t),t.providers},an.prototype.getOutline=function(t){var e,n=this._getProviders();return x(n,(function(n){M(n.getOutline)&&(e=e||n.getOutline(t))})),e},an.$inject=["eventBus","styles","elementRegistry"];const sn={__init__:["outline"],outline:["type",an]};function cn(t,e){this._eventBus=t,this._canvas=e,this._selectedElements=[];var n=this;t.on(["shape.remove","connection.remove"],(function(t){var e=t.element;n.deselect(e)})),t.on(["diagram.clear","root.set"],(function(t){n.select(null)}))}cn.$inject=["eventBus","canvas"],cn.prototype.deselect=function(t){var e=this._selectedElements,n=e.indexOf(t);if(-1!==n){var o=e.slice();e.splice(n,1),this._eventBus.fire("selection.changed",{oldSelection:o,newSelection:e})}},cn.prototype.get=function(){return this._selectedElements},cn.prototype.isSelected=function(t){return-1!==this._selectedElements.indexOf(t)},cn.prototype.select=function(t,e){var n=this._selectedElements,o=n.slice();_(t)||(t=t?[t]:[]);var i=this._canvas,r=i.getRootElement();t=t.filter((function(t){var e=i.findRoot(t);return r===e})),e?x(t,(function(t){-1===n.indexOf(t)&&n.push(t)})):this._selectedElements=n=t.slice(),this._eventBus.fire("selection.changed",{oldSelection:o,newSelection:n})};var un="hover",hn="selected";function ln(t,e,n){this._canvas=t;var o=this;function i(e,n){t.addMarker(e,n)}function r(e,n){t.removeMarker(e,n)}this._multiSelectionBox=null,e.on("element.hover",(function(t){i(t.element,un)})),e.on("element.out",(function(t){r(t.element,un)})),e.on("selection.changed",(function(t){var e=t.oldSelection,n=t.newSelection;x(e,(function(t){-1===n.indexOf(t)&&r(t,hn)})),x(n,(function(t){-1===e.indexOf(t)&&i(t,hn)})),o._updateSelectionOutline(n)})),e.on("element.changed",(function(t){n.isSelected(t.element)&&o._updateSelectionOutline(n.get())}))}function pn(t,e,n,o){t.on("create.end",500,(function(t){var n=t.context,o=n.canExecute,i=n.elements,r=(n.hints||{}).autoSelect;if(o){if(!1===r)return;_(r)?e.select(r):e.select(i.filter(dn))}})),t.on("connect.end",500,(function(t){var n=t.context.connection;n&&e.select(n)})),t.on("shape.move.end",500,(function(t){var n=t.previousSelection||[],i=o.get(t.context.shape.id);g(n,(function(t){return i.id===t.id}))||e.select(i)})),t.on("element.click",(function(t){if(Je(t)){var o=t.element;o===n.getRootElement()&&(o=null);var i=e.isSelected(o),r=e.get().length>1,a=tn(t);if(i&&r)return a?e.deselect(o):e.select(o);i?e.deselect(o):e.select(o,a)}}))}function dn(t){return!t.hidden}ln.$inject=["canvas","eventBus","selection"],ln.prototype._updateSelectionOutline=function(t){var e=this._canvas.getLayer("selectionOutline");h(e);var r=t.length>1,s=this._canvas.getContainer();if(a(s)[r?"add":"remove"]("djs-multi-select"),r){var c=function(t){return{x:t.x-6,y:t.y-6,width:t.width+12,height:t.height+12}}(Yt(t)),u=n("rect");o(u,b({rx:3},c)),a(u).add("djs-selection-outline"),i(e,u)}},pn.$inject=["eventBus","selection","canvas","elementRegistry"];const fn={__init__:["selectionVisuals","selectionBehavior"],__depends__:[rn,sn],selection:["type",cn],selectionVisuals:["type",ln],selectionBehavior:["type",pn]};function vn(t){this._counter=0,this._prefix=(t?t+"-":"")+Math.floor(1e9*Math.random())+"-"}vn.prototype.next=function(){return this._prefix+ ++this._counter};var gn=new vn("ov");function yn(t,e,n,o){var i,r;this._eventBus=e,this._canvas=n,this._elementRegistry=o,this._ids=gn,this._overlayDefaults=b({show:null,scale:!0},t&&t.defaults),this._overlays={},this._overlayContainers=[],this._overlayRoot=(i=n.getContainer(),r=Z('<div class="djs-overlay-container" />'),N(r,{position:"absolute",width:0,height:0}),i.insertBefore(r,i.firstChild),r),this._init()}function mn(t,e,n){N(t,{left:e+"px",top:n+"px"})}function _n(t,e){t.style.display=!1===e?"none":""}function xn(t,e){t.style["transform-origin"]="top left",["","-ms-","-webkit-"].forEach((function(n){t.style[n+"transform"]=e}))}yn.$inject=["config.overlays","eventBus","canvas","elementRegistry"],yn.prototype.get=function(t){if(j(t)&&(t={id:t}),j(t.element)&&(t.element=this._elementRegistry.get(t.element)),t.element){var e=this._getOverlayContainer(t.element,!0);return e?t.type?w(e.overlays,R({type:t.type})):e.overlays.slice():[]}return t.type?w(this._overlays,R({type:t.type})):t.id?this._overlays[t.id]:null},yn.prototype.add=function(t,e,n){if(d(e)&&(n=e,e=null),t.id||(t=this._elementRegistry.get(t)),!n.position)throw new Error("must specifiy overlay position");if(!n.html)throw new Error("must specifiy overlay html");if(!t)throw new Error("invalid element specified");var o=this._ids.next();return n=b({},this._overlayDefaults,n,{id:o,type:e,element:t,html:n.html}),this._addOverlay(n),o},yn.prototype.remove=function(t){var e=this.get(t)||[];_(e)||(e=[e]);var n=this;x(e,(function(t){var e=n._getOverlayContainer(t.element,!0);if(t&&(K(t.html),K(t.htmlContainer),delete t.htmlContainer,delete t.element,delete n._overlays[t.id]),e){var o=e.overlays.indexOf(t);-1!==o&&e.overlays.splice(o,1)}}))},yn.prototype.isShown=function(){return"none"!==this._overlayRoot.style.display},yn.prototype.show=function(){_n(this._overlayRoot)},yn.prototype.hide=function(){_n(this._overlayRoot,!1)},yn.prototype.clear=function(){this._overlays={},this._overlayContainers=[],V(this._overlayRoot)},yn.prototype._updateOverlayContainer=function(t){var e=t.element,n=t.html,o=e.x,i=e.y;if(e.waypoints){var r=Yt(e);o=r.x,i=r.y}mn(n,o,i),q(t.html,"data-container-id",e.id)},yn.prototype._updateOverlay=function(t){var e,n,o=t.position,i=t.htmlContainer,r=t.element,a=o.left,s=o.top;void 0!==o.right&&(e=r.waypoints?Yt(r).width:r.width,a=-1*o.right+e);void 0!==o.bottom&&(n=r.waypoints?Yt(r).height:r.height,s=-1*o.bottom+n);mn(i,a||0,s||0),this._updateOverlayVisibilty(t,this._canvas.viewbox())},yn.prototype._createOverlayContainer=function(t){var e=Z('<div class="djs-overlays" />');N(e,{position:"absolute"}),this._overlayRoot.appendChild(e);var n={html:e,element:t,overlays:[]};return this._updateOverlayContainer(n),this._overlayContainers.push(n),n},yn.prototype._updateRoot=function(t){var e=t.scale||1,n="matrix("+[e,0,0,e,-1*t.x*e,-1*t.y*e].join(",")+")";xn(this._overlayRoot,n)},yn.prototype._getOverlayContainer=function(t,e){var n=g(this._overlayContainers,(function(e){return e.element===t}));return n||e?n:this._createOverlayContainer(t)},yn.prototype._addOverlay=function(t){var e,n,o=t.id,i=t.element,r=t.html;r.get&&r.constructor.prototype.jquery&&(r=r.get(0)),j(r)&&(r=Z(r)),n=this._getOverlayContainer(i),e=Z('<div class="djs-overlay" data-overlay-id="'+o+'">'),N(e,{position:"absolute"}),e.appendChild(r),t.type&&Y(e).add("djs-overlay-"+t.type),_n(e,this._canvas.findRoot(i)===this._canvas.getRootElement()),t.htmlContainer=e,n.overlays.push(t),n.html.appendChild(e),this._overlays[o]=t,this._updateOverlay(t),this._updateOverlayVisibilty(t,this._canvas.viewbox())},yn.prototype._updateOverlayVisibilty=function(t,e){var n=t.show,o=this._canvas.findRoot(t.element),i=n&&n.minZoom,r=n&&n.maxZoom,a=t.htmlContainer,s=!0;(o!==this._canvas.getRootElement()||n&&(T(i)&&i>e.scale||T(r)&&r<e.scale))&&(s=!1),_n(a,s),this._updateOverlayScale(t,e)},yn.prototype._updateOverlayScale=function(t,e){var n,o,i,r=t.scale,a=t.htmlContainer,s="";!0!==r&&(!1===r?(n=1,o=1):(n=r.min,o=r.max),T(n)&&e.scale<n&&(i=(1/e.scale||1)*n),T(o)&&e.scale>o&&(i=(1/e.scale||1)*o)),T(i)&&(s="scale("+i+","+i+")"),xn(a,s)},yn.prototype._updateOverlaysVisibilty=function(t){var e=this;x(this._overlays,(function(n){e._updateOverlayVisibilty(n,t)}))},yn.prototype._init=function(){var t=this._eventBus,e=this;t.on("canvas.viewbox.changing",(function(t){e.hide()})),t.on("canvas.viewbox.changed",(function(t){var n;n=t.viewbox,e._updateRoot(n),e._updateOverlaysVisibilty(n),e.show()})),t.on(["shape.remove","connection.remove"],(function(t){var n=t.element,o=e.get({element:n});x(o,(function(t){e.remove(t.id)}));var i=e._getOverlayContainer(n);if(i){K(i.html);var r=e._overlayContainers.indexOf(i);-1!==r&&e._overlayContainers.splice(r,1)}})),t.on("element.changed",500,(function(t){var n=t.element,o=e._getOverlayContainer(n,!0);o&&(x(o.overlays,(function(t){e._updateOverlay(t)})),e._updateOverlayContainer(o))})),t.on("element.marker.update",(function(t){var n=e._getOverlayContainer(t.element,!0);n&&Y(n.html)[t.add?"add":"remove"](t.marker)})),t.on("root.set",(function(){e._updateOverlaysVisibilty(e._canvas.viewbox())})),t.on("diagram.clear",this.clear,this)};const wn={__init__:["overlays"],overlays:["type",yn]};function En(t,e,n,o){t.on("element.changed",(function(o){var i=o.element;(i.parent||i===e.getRootElement())&&(o.gfx=n.getGraphics(i)),o.gfx&&t.fire(Xt(i)+".changed",o)})),t.on("elements.changed",(function(e){var n=e.elements;n.forEach((function(e){t.fire("element.changed",{element:e})})),o.updateContainments(n)})),t.on("shape.changed",(function(t){o.update("shape",t.element,t.gfx)})),t.on("connection.changed",(function(t){o.update("connection",t.element,t.gfx)}))}En.$inject=["eventBus","canvas","elementRegistry","graphicsFactory"];const bn={__init__:["changeSupport"],changeSupport:["type",En]};function Sn(t){this._eventBus=t}function Cn(t){return function(e,n,o,i,r){(M(e)||m(e))&&(r=i,i=o,o=n,n=e,e=null),this.on(e,t,n,o,i,r)}}function kn(t,e){e.invoke(Sn,this),this.executed((function(e){var n=e.context;n.rootElement?t.setRootElement(n.rootElement):n.rootElement=t.getRootElement()})),this.revert((function(e){var n=e.context;n.rootElement&&t.setRootElement(n.rootElement)}))}Sn.$inject=["eventBus"],Sn.prototype.on=function(t,e,n,o,i,r){if((M(e)||m(e))&&(r=i,i=o,o=n,n=e,e=null),M(n)&&(r=i,i=o,o=n,n=1e3),d(i)&&(r=i,i=!1),!M(o))throw new Error("handlerFn must be a function");_(t)||(t=[t]);var a=this._eventBus;x(t,(function(t){var s=["commandStack",t,e].filter((function(t){return t})).join(".");a.on(s,n,i?function(t,e){return function(n){return t.call(e||null,n.context,n.command,n)}}(o,r):o,r)}))},Sn.prototype.canExecute=Cn("canExecute"),Sn.prototype.preExecute=Cn("preExecute"),Sn.prototype.preExecuted=Cn("preExecuted"),Sn.prototype.execute=Cn("execute"),Sn.prototype.executed=Cn("executed"),Sn.prototype.postExecute=Cn("postExecute"),Sn.prototype.postExecuted=Cn("postExecuted"),Sn.prototype.revert=Cn("revert"),Sn.prototype.reverted=Cn("reverted"),e(kn,Sn),kn.$inject=["canvas","injector"];const Mn={__init__:["rootElementsBehavior"],rootElementsBehavior:["type",kn]};function jn(t){return CSS.escape(t)}var Rn={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;"};function Tn(t){return(t=""+t)&&t.replace(/[&<>"']/g,(function(t){return Rn[t]}))}var Bn=["c","C"],Pn=["v","V"],Ln=["y","Y"],On=["z","Z"];function $n(t){return!t.altKey&&(t.ctrlKey||t.metaKey)}function An(t,e){return-1!==(t=_(t)?t:[t]).indexOf(e.key)||-1!==t.indexOf(e.code)}function zn(t){return t.shiftKey}var In="keyboard.keydown",Dn="input-handle-modified-keys";function Hn(t,e){var n=this;this._config=t||{},this._eventBus=e,this._keydownHandler=this._keydownHandler.bind(this),this._keyupHandler=this._keyupHandler.bind(this),e.on("diagram.destroy",(function(){n._fire("destroy"),n.unbind()})),e.on("diagram.init",(function(){n._fire("init")})),e.on("attach",(function(){t&&t.bindTo&&n.bind(t.bindTo)})),e.on("detach",(function(){n.unbind()}))}Hn.$inject=["config.keyboard","eventBus"],Hn.prototype._keydownHandler=function(t){this._keyHandler(t,In)},Hn.prototype._keyupHandler=function(t){this._keyHandler(t,"keyboard.keyup")},Hn.prototype._keyHandler=function(t,e){if(!this._isEventIgnored(t)){var n={keyEvent:t};this._eventBus.fire(e||In,n)&&t.preventDefault()}},Hn.prototype._isEventIgnored=function(t){return!!t.defaultPrevented||((e=t.target)&&(Q(e,"input, textarea")||"true"===e.contentEditable)||function(t){return t&&Q(t,"button, input[type=submit], input[type=button], a[href], [aria-role=button]")}(t.target)&&An([" ","Enter"],t))&&this._isModifiedKeyIgnored(t);var e},Hn.prototype._isModifiedKeyIgnored=function(t){return!$n(t)||-1===this._getAllowedModifiers(t.target).indexOf(t.key)},Hn.prototype._getAllowedModifiers=function(t){var e=X(t,"["+Dn+"]",!0);return!e||this._node&&!this._node.contains(e)?[]:e.getAttribute(Dn).split(",")},Hn.prototype.bind=function(t){this.unbind(),this._node=t,J.bind(t,"keydown",this._keydownHandler),J.bind(t,"keyup",this._keyupHandler),this._fire("bind")},Hn.prototype.getBinding=function(){return this._node},Hn.prototype.unbind=function(){var t=this._node;t&&(this._fire("unbind"),J.unbind(t,"keydown",this._keydownHandler),J.unbind(t,"keyup",this._keyupHandler)),this._node=null},Hn.prototype._fire=function(t){this._eventBus.fire("keyboard."+t,{node:this._node})},Hn.prototype.addListener=function(t,e,n){M(t)&&(n=e,e=t,t=1e3),this._eventBus.on(n||In,t,e)},Hn.prototype.removeListener=function(t,e){this._eventBus.off(e||In,t)},Hn.prototype.hasModifier=function(t){return t.ctrlKey||t.metaKey||t.shiftKey||t.altKey},Hn.prototype.isCmd=$n,Hn.prototype.isShift=zn,Hn.prototype.isKey=An;function Gn(t,e){var n=this;t.on("editorActions.init",500,(function(t){var o=t.editorActions;n.registerBindings(e,o)}))}Gn.$inject=["eventBus","keyboard"],Gn.prototype.registerBindings=function(t,e){function n(n,o){e.isRegistered(n)&&t.addListener(o)}n("undo",(function(t){if(function(t){return $n(t)&&!zn(t)&&An(On,t)}(t.keyEvent))return e.trigger("undo"),!0})),n("redo",(function(t){if(function(t){return $n(t)&&(An(Ln,t)||An(On,t)&&zn(t))}(t.keyEvent))return e.trigger("redo"),!0})),n("copy",(function(t){if(function(t){return $n(t)&&An(Bn,t)}(t.keyEvent))return e.trigger("copy"),!0})),n("paste",(function(t){if(function(t){return $n(t)&&An(Pn,t)}(t.keyEvent))return e.trigger("paste"),!0})),n("stepZoom",(function(t){var n=t.keyEvent;if(An(["+","Add","="],n)&&$n(n))return e.trigger("stepZoom",{value:1}),!0})),n("stepZoom",(function(t){var n=t.keyEvent;if(An(["-","Subtract"],n)&&$n(n))return e.trigger("stepZoom",{value:-1}),!0})),n("zoom",(function(t){var n=t.keyEvent;if(An("0",n)&&$n(n))return e.trigger("zoom",{value:1}),!0})),n("removeSelection",(function(t){if(An(["Backspace","Delete","Del"],t.keyEvent))return e.trigger("removeSelection"),!0}))};const Nn={__init__:["keyboard","keyboardBindings"],keyboard:["type",Hn],keyboardBindings:["type",Gn]};var Vn={moveSpeed:50,moveSpeedAccelerated:200};function Un(t,e,n){var o=this;this._config=b({},Vn,t||{}),e.addListener((function(t){var n=t.keyEvent,i=o._config;if(!e.isCmd(n))return;if(e.isKey(["ArrowLeft","Left","ArrowUp","Up","ArrowDown","Down","ArrowRight","Right"],n)){var r,a=e.isShift(n)?i.moveSpeedAccelerated:i.moveSpeed;switch(n.key){case"ArrowLeft":case"Left":r="left";break;case"ArrowUp":case"Up":r="up";break;case"ArrowRight":case"Right":r="right";break;case"ArrowDown":case"Down":r="down"}return o.moveCanvas({speed:a,direction:r}),!0}})),this.moveCanvas=function(t){var e=0,o=0,i=t.speed/Math.min(Math.sqrt(n.viewbox().scale),1);switch(t.direction){case"left":e=i;break;case"up":o=i;break;case"right":e=-i;break;case"down":o=-i}n.scroll({dx:e,dy:o})}}Un.$inject=["config.keyboardMove","keyboard","canvas"];const Fn={__depends__:[Nn],__init__:["keyboardMove"],keyboardMove:["type",Un]};var Wn=/^djs-cursor-.*$/;function Kn(t){var e=Y(document.body);e.removeMatching(Wn),t&&e.add("djs-cursor-"+t)}function qn(){Kn(null)}var Zn=5e3;function Yn(t,e){function n(){return!1}return e=e||"element.click",t.once(e,Zn,n),function(){t.off(e,n)}}function Xn(t){return{x:t.x+t.width/2,y:t.y+t.height/2}}function Jn(t,e){return{x:t.x-e.x,y:t.y-e.y}}function Qn(t,e){var n;function o(o){var i,r=n.start,a=n.button,s=Ze(o),c=Jn(s,r);(!n.dragging&&(i=c,Math.sqrt(Math.pow(i.x,2)+Math.pow(i.y,2))>15)&&(n.dragging=!0,0===a&&Yn(t),Kn("grab")),n.dragging)&&(c=Jn(s,n.last||n.start),e.scroll({dx:c.x,dy:c.y}),n.last=s);o.preventDefault()}function i(t){J.unbind(document,"mousemove",o),J.unbind(document,"mouseup",i),n=null,qn()}t.on("element.mousedown",500,(function(t){return function(t){if(X(t.target,".djs-draggable"))return;var e=t.button;if(e>=2||t.ctrlKey||t.shiftKey||t.altKey)return;return n={button:e,start:Ze(t)},J.bind(document,"mousemove",o),J.bind(document,"mouseup",i),!0}(t.originalEvent)})),this.isActive=function(){return!!n}}Qn.$inject=["eventBus","canvas"];const to={__init__:["moveCanvas"],moveCanvas:["type",Qn]};function eo(t){return Math.log(t)/Math.log(10)}function no(t,e){var n=eo(t.min),o=eo(t.max);return(Math.abs(n)+Math.abs(o))/e}var oo=Math.sign||function(t){return t>=0?1:-1},io={min:.2,max:4};function ro(t,e,n){t=t||{},this._enabled=!1,this._canvas=n,this._container=n._container,this._handleWheel=k(this._handleWheel,this),this._totalDelta=0,this._scale=t.scale||.75;var o=this;e.on("canvas.init",(function(e){o._init(!1!==t.enabled)}))}ro.$inject=["config.zoomScroll","eventBus","canvas"],ro.prototype.scroll=function(t){this._canvas.scroll(t)},ro.prototype.reset=function(){this._canvas.zoom("fit-viewport")},ro.prototype.zoom=function(t,e){var n=no(io,20);this._totalDelta+=t,Math.abs(this._totalDelta)>.1&&(this._zoom(t,e,n),this._totalDelta=0)},ro.prototype._handleWheel=function(t){if(!X(t.target,".djs-scrollable",!0)){var e=this._container;t.preventDefault();var n,o=t.ctrlKey||Ye()&&t.metaKey,i=t.shiftKey,r=-1*this._scale;if(r*=o?0===t.deltaMode?.02:.32:0===t.deltaMode?1:16,o){var a=e.getBoundingClientRect(),s={x:t.clientX-a.left,y:t.clientY-a.top};n=Math.sqrt(Math.pow(t.deltaY,2)+Math.pow(t.deltaX,2))*oo(t.deltaY)*r,this.zoom(n,s)}else n=i?{dx:r*t.deltaY,dy:0}:{dx:r*t.deltaX,dy:r*t.deltaY},this.scroll(n)}},ro.prototype.stepZoom=function(t,e){var n=no(io,10);this._zoom(t,e,n)},ro.prototype._zoom=function(t,e,n){var o=this._canvas,i=t>0?1:-1,r=eo(o.zoom()),a=Math.round(r/n)*n;a+=n*i;var s,c,u=Math.pow(10,a);o.zoom((s=io,c=u,Math.max(s.min,Math.min(s.max,c))),e)},ro.prototype.toggle=function(t){var e=this._container,n=this._handleWheel,o=this._enabled;return void 0===t&&(t=!o),o!==t&&J[t?"bind":"unbind"](e,"wheel",n,!1),this._enabled=t,t},ro.prototype._init=function(t){this.toggle(t)};const ao={__init__:["zoomScroll"],zoomScroll:["type",ro]};function so(t){return t&&t[t.length-1]}function co(t){return t.y}function uo(t){return t.x}var ho={left:uo,center:uo,right:function(t){return t.x+t.width},top:co,middle:co,bottom:function(t){return t.y+t.height}};function lo(t,e){this._modeling=t,this._rules=e}lo.$inject=["modeling","rules"],lo.prototype._getOrientationDetails=function(t){var e="x",n="width";return-1!==["top","bottom","middle"].indexOf(t)&&(e="y",n="height"),{axis:e,dimension:n}},lo.prototype._isType=function(t,e){return-1!==e.indexOf(t)},lo.prototype._alignmentPosition=function(t,e){var n,o,i,r,a,s=this._getOrientationDetails(t),c=s.axis,u=s.dimension,h={},l={},p=!1;if(this._isType(t,["left","top"]))h[t]=e[0][c];else if(this._isType(t,["right","bottom"]))i=so(e),h[t]=i[c]+i[u];else if(this._isType(t,["center","middle"])){if(x(e,(function(t){var e=t[c]+Math.round(t[u]/2);l[e]?l[e].elements.push(t):l[e]={elements:[t],center:e}})),n=v(l,(function(t){return t.elements.length>1&&(p=!0),t.elements.length})),p)return h[t]=so(n).center,h;o=e[0],i=so(e=v(e,(function(t){return t[c]+t[u]}))),h[t]=(r=o,a=i,Math.round((r[c]+a[c]+a[u])/2))}return h},lo.prototype.trigger=function(t,e){var n,o=this._modeling,i=w(t,(function(t){return!(t.waypoints||t.host||t.labelTarget)}));if(n=this._rules.allowed("elements.align",{elements:i}),_(n)&&(i=n),!(i.length<2)&&n){var r=v(i,ho[e]),a=this._alignmentPosition(e,r);o.alignElements(r,a)}};const po={__init__:["alignElements"],alignElements:["type",lo]};var fo=".entry";function vo(t,e,n,o){this._canvas=t,this._eventBus=n,this._overlays=o;var i=T(e&&e.scale)?e.scale:{min:1,max:1.5};this._overlaysConfig={scale:i},this._current=null,this._init()}function go(t,e){return-1!==t.indexOf(e)}vo.$inject=["canvas","config.contextPad","eventBus","overlays"],vo.prototype._init=function(){var t=this;this._eventBus.on("selection.changed",(function(e){var n=e.newSelection,o=n.length?1===n.length?n[0]:n:null;o?t.open(o,!0):t.close()})),this._eventBus.on("elements.changed",(function(e){var n=e.elements,o=t._current;if(o){var i=o.target;B(_(i)?i:[i],(function(t){return go(n,t)}))&&t.open(i,!0)}}))},vo.prototype.registerProvider=function(t,e){e||(e=t,t=1e3),this._eventBus.on("contextPad.getProviders",t,(function(t){t.providers.push(e)}))},vo.prototype.getEntries=function(t){var e=this._getProviders(),n=_(t)?"getMultiElementContextPadEntries":"getContextPadEntries",o={};return x(e,(function(e){if(M(e[n])){var i=e[n](t);M(i)?o=i(o):x(i,(function(t,e){o[e]=t}))}})),o},vo.prototype.trigger=function(t,e,n){var o,i,r=e.delegateTarget||e.target;return r?(o=q(r,"data-action"),i=e.originalEvent||e,"mouseover"===t?this._timeout=setTimeout((()=>{this._mouseout=this.triggerEntry(o,"hover",i,n)}),300):"mouseout"===t&&(clearTimeout(this._timeout),this._mouseout&&(this._mouseout(),this._mouseout=null)),this.triggerEntry(o,t,i,n)):e.preventDefault()},vo.prototype.triggerEntry=function(t,e,n,o){if(this.isShown()){var i=this._current.target,r=this._current.entries[t];if(r){var a=r.action;if(!1!==this._eventBus.fire("contextPad.trigger",{entry:r,event:n})){if(M(a)){if("click"===e)return a(n,i,o)}else if(a[e])return a[e](n,i,o);n.preventDefault()}}}},vo.prototype.open=function(t,e){!e&&this.isOpen(t)||(this.close(),this._updateAndOpen(t))},vo.prototype._getProviders=function(){var t=this._eventBus.createEvent({type:"contextPad.getProviders",providers:[]});return this._eventBus.fire(t),t.providers},vo.prototype._updateAndOpen=function(t){var e,n=this.getEntries(t),o=this.getPad(t),i=o.html;x(n,(function(t,n){var o,r,a,s,c=t.group||"default",u=Z(t.html||'<div class="entry" draggable="true"></div>');q(u,"data-action",n),(o=F("[data-group="+jn(c)+"]",i))||(o=Z('<div class="group"></div>'),q(o,"data-group",c),i.appendChild(o)),o.appendChild(u),t.className&&(r=u,a=t.className,s=Y(r),(a=_(a)?a:a.split(/\s+/g)).forEach((function(t){s.add(t)}))),t.title&&q(u,"title",t.title),t.imageUrl&&(e=Z("<img>"),q(e,"src",t.imageUrl),e.style.width="100%",e.style.height="100%",u.appendChild(e))})),Y(i).add("open"),this._current={target:t,entries:n,pad:o},this._eventBus.fire("contextPad.open",{current:this._current})},vo.prototype.getPad=function(t){if(this.isOpen())return this._current.pad;var e=this,n=this._overlays,o=Z('<div class="djs-context-pad"></div>'),i=this._getPosition(t),r=b({html:o},this._overlaysConfig,i);W.bind(o,fo,"click",(function(t){e.trigger("click",t)})),W.bind(o,fo,"dragstart",(function(t){e.trigger("dragstart",t)})),W.bind(o,fo,"mouseover",(function(t){e.trigger("mouseover",t)})),W.bind(o,fo,"mouseout",(function(t){e.trigger("mouseout",t)})),J.bind(o,"mousedown",(function(t){t.stopPropagation()}));var a=this._canvas.getRootElement();this._overlayId=n.add(a,"context-pad",r);var s=n.get(this._overlayId);return this._eventBus.fire("contextPad.create",{target:t,pad:s}),s},vo.prototype.close=function(){this.isOpen()&&(clearTimeout(this._timeout),this._overlays.remove(this._overlayId),this._overlayId=null,this._eventBus.fire("contextPad.close",{current:this._current}),this._current=null)},vo.prototype.isOpen=function(t){var e=this._current;if(!e)return!1;if(!t)return!0;var n=e.target;return _(t)===_(n)&&(_(t)?t.length===n.length&&p(t,(function(t){return go(n,t)})):n===t)},vo.prototype.isShown=function(){return this.isOpen()&&this._overlays.isShown()},vo.prototype._getPosition=function(t){var e;t=mt(t)?(e=t).waypoints[e.waypoints.length-1]:t;var n=Yt(_(t)?t:[t]);return{position:{left:n.x+n.width+12,top:n.y-6}}};const yo={__depends__:[rn,wn],contextPad:["type",vo]};function mo(t){const{entry:e,selected:n,onMouseEnter:o,onMouseLeave:i,onAction:r}=t;return et`
    <li
      class=${tt("entry",{selected:n})}
      data-id=${e.id}
      title=${e.title||e.label}
      tabIndex="0"
      onClick=${r}
      onFocus=${o}
      onBlur=${i}
      onMouseEnter=${o}
      onMouseLeave=${i}
      onDragStart=${t=>r(t,e,"dragstart")}
      aria-role="button"
      draggable=${!0}
    >
      <div class="djs-popup-entry-content">
        <span
          class=${tt("djs-popup-entry-name",e.className)}
        >
          ${e.imageUrl&&et`<img class="djs-popup-entry-icon" src=${e.imageUrl} alt="" />`||e.imageHtml&&et`<div class="djs-popup-entry-icon" dangerouslySetInnerHTML=${{__html:e.imageHtml}} />`}

          ${e.label?et`
            <span class="djs-popup-label">
              ${e.label}
            </span>
          `:null}
        </span>
        ${e.description&&et`
          <span
            class="djs-popup-entry-description"
            title=${e.description}
          >
            ${e.description}
          </span>
        `}
      </div>
      ${e.documentationRef&&et`
        <div class="djs-popup-entry-docs">
          <a
            href="${e.documentationRef}"
            onClick=${t=>t.stopPropagation()}
            title="Open element documentation"
            target="_blank"
            rel="noopener"
          >
            <svg width="12" height="12" viewBox="0 0 12 12" fill="none" xmlns="http://www.w3.org/2000/svg">
              <path fill-rule="evenodd" clip-rule="evenodd" d="M10.6368 10.6375V5.91761H11.9995V10.6382C11.9995 10.9973 11.8623 11.3141 11.5878 11.5885C11.3134 11.863 10.9966 12.0002 10.6375 12.0002H1.36266C0.982345 12.0002 0.660159 11.8681 0.396102 11.6041C0.132044 11.34 1.52588e-05 11.0178 1.52588e-05 10.6375V1.36267C1.52588e-05 0.98236 0.132044 0.660173 0.396102 0.396116C0.660159 0.132058 0.982345 2.95639e-05 1.36266 2.95639e-05H5.91624V1.36267H1.36266V10.6375H10.6368ZM12 0H7.2794L7.27873 1.36197H9.68701L3.06507 7.98391L4.01541 8.93425L10.6373 2.31231V4.72059H12V0Z" fill="#818798"/>
            </svg>
          </a>
        </div>
      `}
    </li>
  `}function _o(t){const{selectedEntry:e,setSelectedEntry:n,entries:o,...i}=t,r=nt(),a=ot((()=>function(t){const e=[],n=t=>e.find((e=>t.id===e.id)),o=t=>!!n(t),i=t=>"string"==typeof t?{id:t}:t;return t.forEach((t=>{const r=t.group?i(t.group):{id:"default"};o(r)?n(r).entries.push(t):e.push({...r,entries:[t]})})),e}(o)),[o]);return it((()=>{const t=r.current;if(!t)return;const e=t.querySelector(".selected");var n;e&&("function"==typeof(n=e).scrollIntoViewIfNeeded?n.scrollIntoViewIfNeeded():n.scrollIntoView({scrollMode:"if-needed",block:"nearest"}))}),[e]),et`
    <div class="djs-popup-results" ref=${r}>
      ${a.map((t=>et`
        ${t.name&&et`
          <div key=${t.id} class="entry-header" title=${t.name}>
            ${t.name}
          </div>
        `}
        <ul class="djs-popup-group" data-group=${t.id}>
          ${t.entries.map((t=>et`
            <${mo}
              key=${t.id}
              entry=${t}
              selected=${t===e}
              onMouseEnter=${()=>n(t)}
              onMouseLeave=${()=>n(null)}
              ...${i}
            />
          `))}
        </ul>
      `))}
    </div>
  `}function xo(t){const{onClose:e,onSelect:n,className:o,headerEntries:i,position:r,title:a,width:s,scale:c,search:u,emptyPlaceholder:h,entries:l,onOpened:p,onClosed:d}=t,f=ot((()=>!!T(u)&&l.length>5),[u,l]),[v,g]=rt(""),y=at(((t,e)=>{if(!f)return t;return t.filter((t=>{if(!e)return(t.rank||0)>=0;if(!1===t.searchable)return!1;const n=[t.description||"",t.label||"",t.search||""].map((t=>t.toLowerCase()));return e.toLowerCase().split(/\s/g).every((t=>n.some((e=>e.includes(t)))))}))}),[f]),[m,_]=rt(y(l,v)),[x,w]=rt(m[0]),E=at((t=>{x&&t.includes(x)||w(t[0]),_(t)}),[x,_,w]);st((()=>{E(y(l,v))}),[v,l]);const b=at((t=>{let e=m.indexOf(x)+t;e<0&&(e=m.length-1),e>=m.length&&(e=0),w(m[e])}),[m,x,w]),S=at((t=>"Enter"===t.key&&x?n(t,x):"ArrowUp"===t.key?(b(-1),t.preventDefault()):"ArrowDown"===t.key?(b(1),t.preventDefault()):void 0),[n,x,b]),C=at((t=>{Q(t.target,"input")&&g((()=>t.target.value))}),[g]);st((()=>(p(),()=>{d()})),[]);const k=ot((()=>a||i.length>0),[a,i]);return et`
    <${wo}
      onClose=${e}
      onKeyup=${C}
      onKeydown=${S}
      className=${o}
      position=${r}
      width=${s}
      scale=${c}
    >
      ${k&&et`
        <div class="djs-popup-header">
          <h3 class="djs-popup-title" title=${a}>${a}</h3>
          ${i.map((t=>et`
            <${t.action?"button":"span"}
              class=${function(t,e){return tt("entry",t.className,t.active?"active":"",t.disabled?"disabled":"",e?"selected":"")}(t,t===x)}
              onClick=${e=>n(e,t)}
              title=${t.title||t.label}
              data-id=${t.id}
              onMouseEnter=${()=>w(t)}
              onMouseLeave=${()=>w(null)}
              onFocus=${()=>w(t)}
              onBlur=${()=>w(null)}
            >
            ${t.imageUrl&&et`<img class="djs-popup-entry-icon" src=${t.imageUrl} alt="" />`||t.imageHtml&&et`<div class="djs-popup-entry-icon" dangerouslySetInnerHTML=${{__html:t.imageHtml}} />`}

              ${t.label?et`
                <span class="djs-popup-label">${t.label}</span>
              `:null}
            </${t.action?"button":"span"}>
          `))}
        </div>
      `}
      ${l.length>0&&et`
        <div class="djs-popup-body">

          ${f&&et`
          <div class="djs-popup-search">
            <svg class="djs-popup-search-icon" width="14" height="14" viewBox="0 0 14 14" fill="none" xmlns="http://www.w3.org/2000/svg">
              <path fill-rule="evenodd" clip-rule="evenodd" d="M9.0325 8.5H9.625L13.3675 12.25L12.25 13.3675L8.5 9.625V9.0325L8.2975 8.8225C7.4425 9.5575 6.3325 10 5.125 10C2.4325 10 0.25 7.8175 0.25 5.125C0.25 2.4325 2.4325 0.25 5.125 0.25C7.8175 0.25 10 2.4325 10 5.125C10 6.3325 9.5575 7.4425 8.8225 8.2975L9.0325 8.5ZM1.75 5.125C1.75 6.9925 3.2575 8.5 5.125 8.5C6.9925 8.5 8.5 6.9925 8.5 5.125C8.5 3.2575 6.9925 1.75 5.125 1.75C3.2575 1.75 1.75 3.2575 1.75 5.125Z" fill="#22242A"/>
            </svg>
            <input type="text" aria-label="${a}" />
          </div>
          `}

          <${_o}
            entries=${m}
            selectedEntry=${x}
            setSelectedEntry=${w}
            onAction=${n}
          />
        </div>
      `}
    ${h&&0===m.length&&et`
      <div class="djs-popup-no-results">${M(h)?h(v):h}</div>
    `}
    </${wo}>
  `}function wo(t){const{onClose:e,onKeydown:n,onKeyup:o,className:i,children:r,position:a}=t,s=nt();return it((()=>{if("function"!=typeof a)return;const t=s.current,e=a(t);t.style.left=`${e.x}px`,t.style.top=`${e.y}px`}),[s.current,a]),it((()=>{const t=s.current;if(!t)return;(t.querySelector("input")||t).focus()}),[]),st((()=>{const t=t=>{if("Escape"===t.key)return t.preventDefault(),e()},n=t=>{if(!X(t.target,".djs-popup",!0))return e()};return document.documentElement.addEventListener("keydown",t),document.body.addEventListener("click",n),()=>{document.documentElement.removeEventListener("keydown",t),document.body.removeEventListener("click",n)}}),[]),et`
    <div
      class=${tt("djs-popup",i)}
      style=${function(t){return{transform:`scale(${t.scale})`,width:`${t.width}px`}}(t)}
      onKeydown=${n}
      onKeyup=${o}
      ref=${s}
      tabIndex="-1"
    >
      ${r}
    </div>
  `}var Eo=["contextPad.close","canvas.viewbox.changing","commandStack.changed"];function bo(t,e,n){this._eventBus=e,this._canvas=n,this._current=null;var o=T(t&&t.scale)?t.scale:{min:1,max:1.5};this._config={scale:o},e.on("diagram.destroy",(()=>{this.close()})),e.on("element.changed",(t=>{const e=this.isOpen()&&this._current.target;t.element===e&&this.refresh()}))}bo.$inject=["config.popupMenu","eventBus","canvas"],bo.prototype._render=function(){const{position:t,providerId:e,entries:n,headerEntries:o,emptyPlaceholder:i,options:r}=this._current,a=Object.entries(n).map((([t,e])=>({id:t,...e}))),s=Object.entries(o).map((([t,e])=>({id:t,...e}))),c=t&&(e=>this._ensureVisible(e,t)),u=this._updateScale(this._current.container);ct(et`
      <${xo}
        onClose=${t=>this.close(t)}
        onSelect=${(t,e,n)=>this.trigger(t,e,n)}
        position=${c}
        className=${e}
        entries=${a}
        headerEntries=${s}
        emptyPlaceholder=${i}
        scale=${u}
        onOpened=${this._onOpened.bind(this)}
        onClosed=${this._onClosed.bind(this)}
        ...${{...r}}
      />
    `,this._current.container)},bo.prototype.open=function(t,e,n,o){if(!t)throw new Error("target is missing");if(!e)throw new Error("providers for <"+e+"> not found");if(!n)throw new Error("position is missing");this.isOpen()&&this.close();const{entries:i,headerEntries:r,emptyPlaceholder:a}=this._getContext(t,e);this._current={position:n,providerId:e,target:t,entries:i,headerEntries:r,emptyPlaceholder:a,container:this._createContainer({provider:e}),options:o},this._emit("open"),this._bindAutoClose(),this._render()},bo.prototype.refresh=function(){if(!this.isOpen())return;const{target:t,providerId:e}=this._current,{entries:n,headerEntries:o,emptyPlaceholder:i}=this._getContext(t,e);this._current={...this._current,entries:n,headerEntries:o,emptyPlaceholder:i},this._emit("refresh"),this._render()},bo.prototype._getContext=function(t,e){const n=this._getProviders(e);if(!n||!n.length)throw new Error("provider for <"+e+"> not found");const o=this._getEntries(t,n),i=this._getHeaderEntries(t,n);return{entries:o,headerEntries:i,emptyPlaceholder:this._getEmptyPlaceholder(n),empty:!(Object.keys(o).length||Object.keys(i).length)}},bo.prototype.close=function(){this.isOpen()&&(this._emit("close"),this.reset(),this._current=null)},bo.prototype.reset=function(){const t=this._current.container;ct(null,t),K(t)},bo.prototype._emit=function(t,e){this._eventBus.fire(`popupMenu.${t}`,e)},bo.prototype._onOpened=function(){this._emit("opened")},bo.prototype._onClosed=function(){this._emit("closed")},bo.prototype._createContainer=function(t){var e=this._canvas.getContainer();const n=Z(`<div class="djs-popup-parent djs-scrollable" data-popup=${t.provider}></div>`);return e.appendChild(n),n},bo.prototype._bindAutoClose=function(){this._eventBus.once(Eo,this.close,this)},bo.prototype._unbindAutoClose=function(){this._eventBus.off(Eo,this.close,this)},bo.prototype._updateScale=function(){var t,e,n=this._canvas.zoom(),o=this._config.scale,i=n;return!0!==o&&(!1===o?(t=1,e=1):(t=o.min,e=o.max),T(t)&&n<t&&(i=t),T(e)&&n>e&&(i=e)),i},bo.prototype._ensureVisible=function(t,e){var n=document.documentElement.getBoundingClientRect(),o=t.getBoundingClientRect(),i={},r=e.x,a=e.y;return e.x+o.width>n.width&&(i.x=!0),e.y+o.height>n.height&&(i.y=!0),i.x&&i.y?(r=e.x-o.width,a=e.y-o.height):i.x?(r=e.x-o.width,a=e.y):i.y&&e.y<o.height?(r=e.x,a=10):i.y&&(r=e.x,a=e.y-o.height),e.y<n.top&&(a=e.y+o.height),{x:r,y:a}},bo.prototype.isEmpty=function(t,e){if(!t)throw new Error("target is missing");if(!e)throw new Error("provider ID is missing");const n=this._getProviders(e);return!n||!n.length||this._getContext(t,e).empty},bo.prototype.registerProvider=function(t,e,n){n||(n=e,e=1e3),this._eventBus.on("popupMenu.getProviders."+t,e,(function(t){t.providers.push(n)}))},bo.prototype._getProviders=function(t){var e=this._eventBus.createEvent({type:"popupMenu.getProviders."+t,providers:[]});return this._eventBus.fire(e),e.providers},bo.prototype._getEntries=function(t,e){var n={};return x(e,(function(e){if(e.getPopupMenuEntries){var o=e.getPopupMenuEntries(t);M(o)?n=o(n):x(o,(function(t,e){n[e]=t}))}else x(e.getEntries(t),(function(t){var e=t.id;if(!e)throw new Error("entry ID is missing");n[e]=P(t,["id"])}))})),n},bo.prototype._getHeaderEntries=function(t,e){var n={};return x(e,(function(e){if(e.getPopupMenuHeaderEntries){var o=e.getPopupMenuHeaderEntries(t);M(o)?n=o(n):x(o,(function(t,e){n[e]=t}))}else{if(!e.getHeaderEntries)return;x(e.getHeaderEntries(t),(function(t){var e=t.id;if(!e)throw new Error("entry ID is missing");n[e]=P(t,["id"])}))}})),n},bo.prototype._getEmptyPlaceholder=function(t){const e=t.find((t=>M(t.getEmptyPlaceholder)));return e&&e.getEmptyPlaceholder()},bo.prototype.isOpen=function(){return!!this._current},bo.prototype.trigger=function(t,e,n="click"){if(t.preventDefault(),!e){let n=X(t.delegateTarget||t.target,".entry",!0),o=q(n,"data-id");e={id:o,...this._getEntry(o)}}const o=e.action;if(!1!==this._emit("trigger",{entry:e,event:t}))if(M(o)){if("click"===n)return o(t,e)}else if(o[n])return o[n](t,e)},bo.prototype._getEntry=function(t){var e=this._current.entries[t]||this._current.headerEntries[t];if(!e)throw new Error("entry not found");return e};const So={__init__:["popupMenu"],popupMenu:["type",bo]};function Co(t){Sn.call(this,t),this.init()}Co.$inject=["eventBus"],e(Co,Sn),Co.prototype.addRule=function(t,e,n){var o=this;"string"==typeof t&&(t=[t]),t.forEach((function(t){o.canExecute(t,e,(function(t,e,o){return n(t)}),!0)}))},Co.prototype.init=function(){};function ko(t,e,n){t.on("autoPlace",100,(function(t){var e=t.shape;return function(t,e,n){n||(n={});var o=n.defaultDistance||Rt,i=Ct(t),r=Et(t);return{x:r.right+o+e.width/2,y:i.y}}(t.source,e)})),t.on("autoPlace.end",(function(t){n.scrollToElement(t.shape)})),this.append=function(n,o,i){t.fire("autoPlace.start",{source:n,shape:o});var r=t.fire("autoPlace",{source:n,shape:o}),a=e.appendShape(n,o,r,n.parent,i);return t.fire("autoPlace.end",{source:n,shape:a}),a}}function Mo(t,e){t.on("autoPlace.end",500,(function(t){e.select(t.shape)}))}ko.$inject=["eventBus","modeling","canvas"],Mo.$inject=["eventBus","selection"];const jo={__init__:["autoPlaceSelectionBehavior"],autoPlace:["type",ko],autoPlaceSelectionBehavior:["type",Mo]};function Ro(t,e,n,o){Sn.call(this,t),this._elementRegistry=e,this._modeling=n,this._rules=o;var i=this;this.postExecuted(["shape.create"],(function(t){var e=t.context,n=e.hints||{},o=e.shape,r=e.parent||e.newParent;!1!==n.autoResize&&i._expand([o],r)})),this.postExecuted(["elements.move"],(function(t){var e=t.context,n=L(O(e.closure.topLevel)),o=e.hints,r=!o||o.autoResize;if(!1!==r){var a=E(n,(function(t){return t.parent.id}));x(a,(function(t,e){_(r)&&(t=t.filter((function(t){return g(r,R({id:t.id}))}))),i._expand(t,e)}))}})),this.postExecuted(["shape.toggleCollapse"],(function(t){var e=t.context,n=e.hints,o=e.shape;n&&!1===n.autoResize||o.collapsed||i._expand(o.children||[],o)})),this.postExecuted(["shape.resize"],(function(t){var e=t.context,n=e.hints,o=e.shape,r=o.parent;n&&!1===n.autoResize||r&&i._expand([o],r)}))}function To(t){Co.call(this,t);var e=this;this.addRule("element.autoResize",(function(t){return e.canResize(t.elements,t.target)}))}Ro.$inject=["eventBus","elementRegistry","modeling","rules"],e(Ro,Sn),Ro.prototype._getOptimalBounds=function(t,e){var n=this.getOffset(e),o=this.getPadding(e),i=Et(Yt(t)),r=Et(e),a={};return i.top-r.top<o.top&&(a.top=i.top-n.top),i.left-r.left<o.left&&(a.left=i.left-n.left),r.right-i.right<o.right&&(a.right=i.right+n.right),r.bottom-i.bottom<o.bottom&&(a.bottom=i.bottom+n.bottom),bt(b({},r,a))},Ro.prototype._expand=function(t,e){if("string"==typeof e&&(e=this._elementRegistry.get(e)),this._rules.allowed("element.autoResize",{elements:t,target:e})){var n=this._getOptimalBounds(t,e);if(function(t,e){return t.x!==e.x||t.y!==e.y||t.width!==e.width||t.height!==e.height}(n,e)){var o=function(t,e){var n="";t=Et(t),e=Et(e),t.top>e.top&&(n=n.concat("n"));t.right<e.right&&(n=n.concat("w"));t.bottom<e.bottom&&(n=n.concat("s"));t.left>e.left&&(n=n.concat("e"));return n}($(e,["x","y","width","height"]),n);this.resize(e,n,{autoResize:o});var i=e.parent;i&&this._expand([e],i)}}},Ro.prototype.getOffset=function(t){return{top:60,bottom:60,left:100,right:100}},Ro.prototype.getPadding=function(t){return{top:2,bottom:2,left:15,right:15}},Ro.prototype.resize=function(t,e,n){this._modeling.resizeShape(t,e,null,n)},To.$inject=["eventBus"],e(To,Co),To.prototype.canResize=function(t,e){return!1};function Bo(t,e,n){var o,i,r=this,a=n.get("dragging",!1);a&&e.on("drag.start",(function(n){e.once("drag.move",1500,(function(e){!function(e){if(!e.hover){var n=e.originalEvent,o=r._findTargetGfx(n),i=o&&t.get(o);o&&i&&(e.stopPropagation(),a.hover({element:i,gfx:o}),a.move(n))}}(e)}))})),e.on("element.hover",(function(t){o=t.gfx,i=t.element})),e.on("element.hover",1500,(function(t){i&&e.fire("element.out",{element:i,gfx:o})})),e.on("element.out",(function(){o=null,i=null})),this._findTargetGfx=function(t){var e;if(t instanceof MouseEvent)return e=Ze(t),function(t){return X(t,"svg, .djs-element",!0)}(document.elementFromPoint(e.x,e.y))}}Bo.$inject=["elementRegistry","eventBus","injector"];const Po={__init__:["hoverFix"],hoverFix:["type",Bo]};var Lo=Math.round,Oo="djs-drag-active";function $o(t){t.preventDefault()}function Ao(t,e,n,o){var i,r={threshold:5,trapClick:!0};function a(t){var n=e.viewbox(),o=e._container.getBoundingClientRect();return{x:n.x+(t.x-o.left)/n.scale,y:n.y+(t.y-o.top)/n.scale}}function s(e,n){n=n||i;var o=t.createEvent(b({},n.payload,n.data,{isTouch:n.isTouch}));return!1!==t.fire("drag."+e,o)&&t.fire(n.prefix+"."+e,o)}function c(t,o){var r,c=i.payload,u=i.displacement,h=i.globalStart,l=Ze(t),p=Jn(l,h),d=i.localStart,f=a(l),g=Jn(f,d);if(!i.active&&(o||(r=p,Math.sqrt(Math.pow(r.x,2)+Math.pow(r.y,2))>i.threshold))){if(b(c,{x:Lo(d.x+u.x),y:Lo(d.y+u.y),dx:0,dy:0},{originalEvent:t}),!1===s("start"))return v();i.active=!0,i.keepSelection||(c.previousSelection=n.get(),n.select(null)),i.cursor&&Kn(i.cursor),e.addMarker(e.getRootElement(),Oo)}qe(t),i.active&&(b(c,{x:Lo(f.x+u.x),y:Lo(f.y+u.y),dx:Lo(g.x),dy:Lo(g.y)},{originalEvent:t}),s("move"))}function u(t){var e=!0;i.active&&(t&&(i.payload.originalEvent=t,qe(t)),e=s("end")),!1===e&&s("rejected"),s("ended",g(!0!==e))}function h(t){An("Escape",t)&&($o(t),v())}function l(e){var n;i.active&&(n=Yn(t),setTimeout(n,400),$o(e)),u(e)}function p(t){c(t)}function d(t){var e=i.payload;e.hoverGfx=t.gfx,e.hover=t.element,s("hover")}function f(t){s("out");var e=i.payload;e.hoverGfx=null,e.hover=null}function v(t){var e;if(i){var n=i.active;n&&s("cancel"),e=g(t),n&&s("canceled",e)}}function g(r){var a,g;s("cleanup"),qn(),g=i.trapClick?l:u,J.unbind(document,"mousemove",c),J.unbind(document,"dragstart",$o),J.unbind(document,"selectstart",$o),J.unbind(document,"mousedown",g,!0),J.unbind(document,"mouseup",g,!0),J.unbind(document,"keyup",h),J.unbind(document,"touchstart",p,!0),J.unbind(document,"touchcancel",v,!0),J.unbind(document,"touchmove",c,!0),J.unbind(document,"touchend",u,!0),t.off("element.hover",d),t.off("element.out",f),e.removeMarker(e.getRootElement(),Oo);var y=i.payload.previousSelection;return!1!==r&&y&&!n.get().length&&function(t){var e=t.filter((function(t){return o.get(t.id)}));e.length&&n.select(e)}(y),a=i,i=null,a}t.on("diagram.destroy",v),this.init=function(e,n,o,g){i&&v(!1),"string"==typeof n&&(g=o,o=n,n=null);var y,m,_,x,w,E,S=(g=b({},r,g||{})).data||{};x=g.trapClick?l:u,e?(y=Ke(e)||e,m=Ze(e),qe(e),"dragstart"===y.type&&$o(y)):(y=null,m={x:0,y:0}),_=a(m),n||(n=_),E=y,w="undefined"!=typeof TouchEvent&&E instanceof TouchEvent,i=b({prefix:o,data:S,payload:{},globalStart:m,displacement:Jn(n,_),localStart:_,isTouch:w},g),g.manual||(w?(J.bind(document,"touchstart",p,!0),J.bind(document,"touchcancel",v,!0),J.bind(document,"touchmove",c,!0),J.bind(document,"touchend",u,!0)):(J.bind(document,"mousemove",c),J.bind(document,"dragstart",$o),J.bind(document,"selectstart",$o),J.bind(document,"mousedown",x,!0),J.bind(document,"mouseup",x,!0)),J.bind(document,"keyup",h),t.on("element.hover",d),t.on("element.out",f)),s("init"),g.autoActivate&&c(e,!0)},this.move=c,this.hover=d,this.out=f,this.end=u,this.cancel=v,this.context=function(){return i},this.setOptions=function(t){b(r,t)}}Ao.$inject=["eventBus","canvas","selection","elementRegistry"];const zo={__depends__:[Po,fn],dragging:["type",Ao]};function Io(t,e,n){this._canvas=n,this._opts=b({scrollThresholdIn:[20,20,20,20],scrollThresholdOut:[0,0,0,0],scrollRepeatTimeout:15,scrollStep:10},t);var o=this;e.on("drag.move",(function(t){var e=o._toBorderPoint(t);o.startScroll(e)})),e.on(["drag.cleanup"],(function(){o.stopScroll()}))}function Do(t,e,n){return e<t&&t<n}Io.$inject=["config.autoScroll","eventBus","canvas"],Io.prototype.startScroll=function(t){var e=this._canvas,n=this._opts,o=this,i=e.getContainer().getBoundingClientRect(),r=[t.x,t.y,i.width-t.x,i.height-t.y];this.stopScroll();for(var a=0,s=0,c=0;c<4;c++)Do(r[c],n.scrollThresholdOut[c],n.scrollThresholdIn[c])&&(0===c?a=n.scrollStep:1==c?s=n.scrollStep:2==c?a=-n.scrollStep:3==c&&(s=-n.scrollStep));0===a&&0===s||(e.scroll({dx:a,dy:s}),this._scrolling=setTimeout((function(){o.startScroll(t)}),n.scrollRepeatTimeout))},Io.prototype.stopScroll=function(){clearTimeout(this._scrolling)},Io.prototype.setOptions=function(t){this._opts=b({},this._opts,t)},Io.prototype._toBorderPoint=function(t){var e=this._canvas._container.getBoundingClientRect(),n=Ze(t.originalEvent);return{x:n.x-e.left,y:n.y-e.top}};const Ho={__depends__:[zo],__init__:["autoScroll"],autoScroll:["type",Io]};function Go(t){this._commandStack=t.get("commandStack",!1)}Go.$inject=["injector"],Go.prototype.allowed=function(t,e){var n=!0,o=this._commandStack;return o&&(n=o.canExecute(t,e)),void 0===n||n};const No={__init__:["rules"],rules:["type",Go]};var Vo=Math.round,Uo=Math.max;var Fo=10;function Wo(t,e){return function(t,e){var n,o;for(n=0;o=t[n];n++)if(lt(o,e)<=Fo)return{point:t[n],bendpoint:!0,index:n};return null}(t,e)||function(t,e){var n,o,i,r,a=ut((i=Fo,[["M",(o=e).x,o.y],["m",0,-i],["a",i,i,0,1,1,0,2*i],["a",i,i,0,1,1,0,-2*i],["z"]]),(n=[],t.forEach((function(t,e){n.push([0===e?"M":"L",t.x,t.y])})),n)),s=a[0],c=a[a.length-1];return s?s!==c?s.segment2!==c.segment2?{point:t[r=Uo(s.segment2,c.segment2)-1],bendpoint:!0,index:r}:{point:{x:Vo(s.x+c.x)/2,y:Vo(s.y+c.y)/2},index:s.segment2}:{point:{x:Vo(s.x),y:Vo(s.y)},index:s.segment2}:null}(t,e)}function Ko(t){return Math.sqrt(Math.pow(t.x,2)+Math.pow(t.y,2))}function qo(t){return Math.atan((t[1].y-t[0].y)/(t[1].x-t[0].x))}function Zo(t,e){return e?{x:Math.cos(e)*t.x-Math.sin(e)*t.y,y:Math.sin(e)*t.x+Math.cos(e)*t.y}:t}function Yo(t,e){var n=e[0],o=e[1],i={x:o.x-n.x,y:o.y-n.y},r=function(t,e,n){var o=[{n:t[0]-n[0],lambda:e[0]},{n:t[1]-n[1],lambda:e[1]}];return-(o[0].n*e[0]+o[1].n*e[1])/(o[0].lambda*e[0]+o[1].lambda*e[1])}([n.x,n.y],[i.x,i.y],[t.x,t.y]);return{x:n.x+r*i.x,y:n.y+r*i.y}}function Xo(t,e){var n=Yo(t,e);return Ko({x:n.x-t.x,y:n.y-t.y})}function Jo(t,e){return Ko({x:t.x-e.x,y:t.y-e.y})}var Qo="djs-bendpoint",ti="djs-segment-dragger";function ei(t,e,n){var o=function(t,e){var n,o=Ze(e),i=t._container.getBoundingClientRect();n={x:i.left,y:i.top};var r=t.viewbox();return{x:r.x+(o.x-n.x)/r.scale,y:r.y+(o.y-n.y)/r.scale}}(t,n);return Wo(e,o)}function ni(t,e){var r=n("g");a(r).add(Qo),i(t,r);var s=n("circle");o(s,{cx:0,cy:0,r:4}),a(s).add("djs-visual"),i(r,s);var c=n("circle");return o(c,{cx:0,cy:0,r:10}),a(c).add("djs-hit"),i(r,c),e&&a(r).add(e),r}function oi(t,e,r,s){var c=n("g");i(t,c);var u=function(t,e,n){var o=e.x-t.x,i=e.y-t.y;return ri("h"===n?o:i)}(e,r,s),h=n("rect");o(h,{x:-9,y:-3,width:18,height:6}),a(h).add("djs-visual"),i(c,h);var l=n("rect");return o(l,{x:-u/2,y:-8.5,width:u,height:17}),a(l).add("djs-hit"),i(c,l),Pe(c,"v"===s?90:0),c}function ii(t,e,o){var r=n("g"),s=yt(e,o),c=ft(e,o);return i(t,r),oi(r,e,o,c),a(r).add(ti),a(r).add("h"===c?"horizontal":"vertical"),Be(r,s.x,s.y),r}function ri(t){return Math.abs(Math.round(2*t/3))}function ai(t,e){var n=function(t,e){for(var n,o=e.waypoints,i=1/0,r=0;r<o.length-1;r++){var a=Xo(t,[o[r],o[r+1]]);a<i&&(i=a,n=r)}return[o[n],o[n+1]]}(t,e);return Yo(t,n)}function si(t,e,s,c,u){function h(t,n){var o,i=n.waypoints,r=ei(e,i,t);if(r)return o=function(t,e){var n,o,i=t.waypoints;return e.index<=0||e.bendpoint?null:(o=ft((n={start:i[e.index-1],end:i[e.index]}).start,n.end))?ri("h"===o?n.end.x-n.start.x:n.end.y-n.start.y)/2:null}(n,r),!function(t,e,n){var o,i,r,a,s,c,u=t.index,h=t.point;return!(u<=0||t.bendpoint)&&(r=yt(o=e[u-1],i=e[u]),a=ft(o,i),s=Math.abs(h.x-r.x),c=Math.abs(h.y-r.y),a&&s<=n&&c<=n)}(r,i,o)?c.start(t,n,r.index,!r.bendpoint):u.start(t,n,r.index),!0}function l(t,e,n){J.bind(t,e,(function(t){s.triggerMouseEvent(e,t,n),t.stopPropagation()}))}function p(t,r){var s=e.getLayer("overlays"),c=F('.djs-bendpoints[data-element-id="'+jn(t.id)+'"]',s);return!c&&r&&(c=n("g"),o(c,{"data-element-id":t.id}),a(c).add("djs-bendpoints"),i(s,c),l(c,"mousedown",t),l(c,"click",t),l(c,"dblclick",t)),c}function d(t,e){return F('.djs-segment-dragger[data-segment-idx="'+t+'"]',e)}function f(t,e){e.waypoints.forEach((function(e,n){var o=ni(t);i(t,o),Be(o,e.x,e.y)})),ni(t,"floating")}function v(t,e){for(var n,i,r,a=e.waypoints,s=1;s<a.length;s++)ft(n=a[s-1],i=a[s])&&(r=ii(t,n,i),o(r,{"data-segment-idx":s}),l(r,"mousemove",e))}function g(t){var e=p(t);return e||(f(e=p(t,!0),t),v(e,t)),e}function y(t){var e=p(t);e&&(!function(t){x(U("."+ti,t),(function(t){r(t)}))}(e),function(t){x(U("."+Qo,t),(function(t){r(t)}))}(e),v(e,t),f(e,t))}function m(t,e,n){var o,i,r=d(e.index,t),a=n[e.index-1],s=n[e.index],c=e.point,u=yt(a,s),h=ft(a,s);r&&(o=function(t){return F(".djs-visual",t)}(r),i={x:c.x-u.x,y:c.y-u.y},"v"===h&&(i={x:i.y,y:i.x}),Be(o,i.x,i.y))}t.on("connection.changed",(function(t){y(t.element)})),t.on("connection.remove",(function(t){var e=p(t.element);e&&r(e)})),t.on("element.marker.update",(function(t){var e,n=t.element;n.waypoints&&(e=g(n),t.add?a(e).add(t.marker):a(e).remove(t.marker))})),t.on("element.mousemove",(function(t){var n,o,i=t.element,r=i.waypoints;if(r){if(n=p(i,!0),!(o=ei(e,r,t.originalEvent)))return;!function(t,e){var n=F(".floating",t),o=e.point;n&&Be(n,o.x,o.y)}(n,o),o.bendpoint||m(n,o,r)}})),t.on("element.mousedown",(function(t){if(Je(t)){var e=t.originalEvent,n=t.element;if(n.waypoints)return h(e,n)}})),t.on("selection.changed",(function(t){var e=t.newSelection[0];e&&e.waypoints&&g(e)})),t.on("element.hover",(function(t){var e=t.element;e.waypoints&&(g(e),s.registerEvent(t.gfx,"mousemove","element.mousemove"))})),t.on("element.out",(function(t){s.unregisterEvent(t.gfx,"mousemove","element.mousemove")})),t.on("element.updateId",(function(t){var e=t.element,n=t.newId;if(e.waypoints){var i=p(e);i&&o(i,{"data-element-id":n})}})),this.addHandles=g,this.updateHandles=y,this.getBendpointsContainer=p,this.getSegmentDragger=d}si.$inject=["eventBus","canvas","interactionEvents","bendpointMove","connectionSegmentMove"];var ci=Math.round,ui="reconnectStart",hi="reconnectEnd",li="updateWaypoints";function pi(t,e,n,o,i,r){this._injector=t,this.start=function(t,e,r,a){var s,c=n.getGraphics(e),u=e.source,h=e.target,l=e.waypoints,p=(s=a||0!==r?a||r!==l.length-1?li:hi:ui)===li?"connection.updateWaypoints":"connection.reconnect",d=i.allowed(p,{connection:e,source:u,target:h});!1===d&&(d=i.allowed(p,{connection:e,source:h,target:u})),!1!==d&&o.init(t,"bendpoint.move",{data:{connection:e,connectionGfx:c,context:{allowed:d,bendpointIndex:r,connection:e,source:u,target:h,insert:a,type:s}}})},e.on("bendpoint.move.hover",(function(t){var e,n=t.context,o=n.connection,r=o.source,a=o.target,s=t.hover,c=n.type;if(n.hover=s,s){var u=c===li?"connection.updateWaypoints":"connection.reconnect";if(e=n.allowed=i.allowed(u,{connection:o,source:c===ui?s:r,target:c===hi?s:a}))return n.source=c===ui?s:r,void(n.target=c===hi?s:a);!1===e&&(e=n.allowed=i.allowed(u,{connection:o,source:c===hi?s:a,target:c===ui?s:r})),e&&(n.source=c===hi?s:a,n.target=c===ui?s:r)}})),e.on(["bendpoint.move.out","bendpoint.move.cleanup"],(function(t){var e=t.context,n=e.type;e.hover=null,e.source=null,e.target=null,n!==li&&(e.allowed=!1)})),e.on("bendpoint.move.end",(function(t){var e=t.context,n=e.allowed,o=e.bendpointIndex,i=e.connection,a=e.insert,s=i.waypoints.slice(),c=e.source,u=e.target,h=e.type,l=e.hints||{},p={x:ci(t.x),y:ci(t.y)};if(!n)return!1;h===li?(a?s.splice(o,0,p):s[o]=p,l.bendpointMove={insert:a,bendpointIndex:o},s=this.cropWaypoints(i,s),r.updateWaypoints(i,function(t){t=t.slice();for(var e,n,o,i=0;t[i];)e=t[i],n=t[i-1],0===lt(e,o=t[i+1])||pt(n,o,e)?t.splice(i,1):i++;return t}(s),l)):(h===ui?(l.docking="source",di(e)&&(l.docking="target",l.newWaypoints=s.reverse())):h===hi&&(l.docking="target",di(e)&&(l.docking="source",l.newWaypoints=s.reverse())),r.reconnect(i,c,u,p,l))}),this)}function di(t){var e=t.hover,n=t.source,o=t.target,i=t.type;return i===ui?e&&o&&e===o&&n!==o:i===hi?e&&n&&e===n&&n!==o:void 0}pi.$inject=["injector","eventBus","canvas","dragging","rules","modeling"],pi.prototype.cropWaypoints=function(t,e){var n=this._injector.get("connectionDocking",!1);if(!n)return e;var o=t.waypoints;return t.waypoints=e,t.waypoints=n.getCroppedWaypoints(t),e=t.waypoints,t.waypoints=o,e};var fi="updateWaypoints",vi="connect-ok",gi="connect-not-ok",yi="connect-hover",mi="djs-updating",_i="djs-dragging";function xi(t,e,n,o){this._injector=e;var i=e.get("connectionPreview",!1);n.on("bendpoint.move.start",(function(t){var e=t.context,n=e.bendpointIndex,i=e.connection,r=e.insert,s=i.waypoints,c=s.slice();e.waypoints=s,r&&c.splice(n,0,{x:t.x,y:t.y}),i.waypoints=c;var u=e.draggerGfx=ni(o.getLayer("overlays"));a(u).add("djs-dragging"),o.addMarker(i,_i),o.addMarker(i,mi)})),n.on("bendpoint.move.hover",(function(t){var e=t.context,n=e.allowed,i=e.hover,r=e.type;if(i){if(o.addMarker(i,yi),r===fi)return;n?(o.removeMarker(i,gi),o.addMarker(i,vi)):!1===n&&(o.removeMarker(i,vi),o.addMarker(i,gi))}})),n.on(["bendpoint.move.out","bendpoint.move.cleanup"],1100,(function(t){var e=t.context,n=e.hover,i=e.target;n&&(o.removeMarker(n,yi),o.removeMarker(n,i?vi:gi))})),n.on("bendpoint.move.move",(function(e){var n=e.context,o=n.allowed,r=n.bendpointIndex,a=n.draggerGfx,s=n.hover,c=n.type,u=n.connection,h=u.source,l=u.target,p=u.waypoints.slice(),d={x:e.x,y:e.y},f=n.hints||{},v={};i&&(f.connectionStart&&(v.connectionStart=f.connectionStart),f.connectionEnd&&(v.connectionEnd=f.connectionEnd),"reconnectStart"===c?di(n)?(v.connectionEnd=v.connectionEnd||d,v.source=l,v.target=s||h,p=p.reverse()):(v.connectionStart=v.connectionStart||d,v.source=s||h,v.target=l):"reconnectEnd"===c?di(n)?(v.connectionStart=v.connectionStart||d,v.source=s||l,v.target=h,p=p.reverse()):(v.connectionEnd=v.connectionEnd||d,v.source=h,v.target=s||l):(v.noCropping=!0,v.noLayout=!0,p[r]=d),c===fi&&(p=t.cropWaypoints(u,p)),v.waypoints=p,i.drawPreview(n,o,v)),Be(a,e.x,e.y)}),this),n.on(["bendpoint.move.end","bendpoint.move.cancel"],1100,(function(t){var e=t.context,n=e.connection,a=e.draggerGfx,s=e.hover,c=e.target,u=e.waypoints;n.waypoints=u,r(a),o.removeMarker(n,mi),o.removeMarker(n,_i),s&&(o.removeMarker(s,vi),o.removeMarker(s,c?vi:gi)),i&&i.cleanUp(e)}))}xi.$inject=["bendpointMove","injector","eventBus","canvas"];var wi="connect-hover",Ei="djs-updating";function bi(t,e,n){return Si(t,e,t[e]+n)}function Si(t,e,n){return{x:"x"===e?n:t.x,y:"y"===e?n:t.y}}function Ci(t){return"x"===t?"y":"x"}function ki(t,e,n){var o,i;return t.original?t.original:(o=Ct(e),Si(t,i=Ci(n),o[i]))}function Mi(t,e,n,o,i,s){var c=t.get("connectionDocking",!1);function u(t,e){if(!c)return e;var n,o=t.waypoints;return t.waypoints=e,n=c.getCroppedWaypoints(t),t.waypoints=o,n}function h(t){i.update("connection",t.connection,t.connectionGfx)}function l(t,e,n){var o=t.newWaypoints,i=function(t,e,n,o){var i=Math.max(e[o],n[o]),r=Math.min(e[o],n[o]);return Si(e,o,Math.min(Math.max(r+20,t[o]),i-20))}(n,o[t.segmentStartIndex+e],o[t.segmentEndIndex+e],Ci(t.axis));Be(t.draggerGfx,i.x,i.y)}this.start=function(t,e,i){var r,a,s,c,u=n.getGraphics(e),h=i-1,l=i,p=e.waypoints,d=p[h],f=p[l],v=ei(n,p,t);(a=ft(d,f))&&(s="v"===a?"x":"y",0===h&&(d=ki(d,e.source,s)),l===p.length-1&&(f=ki(f,e.target,s)),r={connection:e,segmentStartIndex:h,segmentEndIndex:l,segmentStart:d,segmentEnd:f,axis:s,dragPosition:c=v?v.point:{x:(d.x+f.x)/2,y:(d.y+f.y)/2}},o.init(t,c,"connectionSegment.move",{cursor:"x"===s?"resize-ew":"resize-ns",data:{connection:e,connectionGfx:u,context:r}}))},e.on("connectionSegment.move.start",(function(t){var e=t.context,o=t.connection,i=n.getLayer("overlays");e.originalWaypoints=o.waypoints.slice(),e.draggerGfx=ii(i,e.segmentStart,e.segmentEnd),a(e.draggerGfx).add("djs-dragging"),n.addMarker(o,Ei)})),e.on("connectionSegment.move.move",(function(t){var e,n,o=t.context,i=o.connection,r=o.segmentStartIndex,a=o.segmentEndIndex,s=o.segmentStart,c=o.segmentEnd,p=o.axis,d=o.originalWaypoints.slice(),f=bi(s,p,t["d"+p]),v=bi(c,p,t["d"+p]),g=d.length,y=0;d[r]=f,d[a]=v,r<2&&(e=kt(i.source,f),1===r?"intersect"===e&&(d.shift(),d[0]=f,y--):"intersect"!==e&&(d.unshift(s),y++)),a>g-3&&(n=kt(i.target,v),a===g-2?"intersect"===n&&(d.pop(),d[d.length-1]=v):"intersect"!==n&&d.push(c)),o.newWaypoints=i.waypoints=u(i,d),l(o,y,t),o.newSegmentStartIndex=r+y,h(t)})),e.on("connectionSegment.move.hover",(function(t){t.context.hover=t.hover,n.addMarker(t.hover,wi)})),e.on(["connectionSegment.move.out","connectionSegment.move.cleanup"],(function(t){var e=t.context.hover;e&&n.removeMarker(e,wi)})),e.on("connectionSegment.move.cleanup",(function(t){var e=t.context,o=e.connection;e.draggerGfx&&r(e.draggerGfx),n.removeMarker(o,Ei)})),e.on(["connectionSegment.move.cancel","connectionSegment.move.end"],(function(t){var e=t.context;e.connection.waypoints=e.originalWaypoints,h(t)})),e.on("connectionSegment.move.end",(function(t){var e=t.context,n=e.connection,o=e.newWaypoints,i=e.newSegmentStartIndex,r=function(t,e){var n=0;return{waypoints:t.filter((function(o,i){return!pt(t[i-1],t[i+1],o)||(n=i<=e?n-1:n,!1)})),segmentOffset:n}}(o=o.map((function(t){return{original:t.original,x:Math.round(t.x),y:Math.round(t.y)}})),i),a=u(n,r.waypoints),c=r.segmentOffset,h={segmentMove:{segmentStartIndex:e.segmentStartIndex,newSegmentStartIndex:i+c}};s.updateWaypoints(n,a,h)}))}Mi.$inject=["injector","eventBus","canvas","dragging","graphicsFactory","modeling"];var ji=Math.abs,Ri=Math.round;function Ti(t){return{x:t.x,y:t.y}}function Bi(t){return{x:t.x+t.width,y:t.y+t.height}}function Pi(t,e){return!t||isNaN(t.x)||isNaN(t.y)?e:{x:Ri(t.x+t.width/2),y:Ri(t.y+t.height/2)}}function Li(t,e){var n=t.snapped;return!!n&&("string"==typeof e?n[e]:n.x&&n.y)}function Oi(t,e,n){if("string"!=typeof e)throw new Error("axis must be in [x, y]");if("number"!=typeof n&&!1!==n)throw new Error("value must be Number or false");var o,i=t[e],r=t.snapped=t.snapped||{};return!1===n?r[e]=!1:(r[e]=!0,o=n-i,t[e]+=o,t["d"+e]+=o),i}function $i(t){return t.children||[]}var Ai=Math.abs,zi=Math.round;function Ii(t){function e(t,e){if(_(t)){for(var n=t.length;n--;)if(Ai(t[n]-e)<=10)return t[n]}else{var o=e%(t=+t);if(o<10)return e-o;if(o>t-10)return e-o+t}return e}function n(t,e){return t.waypoints?ai(e,t):t.width?{x:zi(t.width/2+t.x),y:zi(t.height/2+t.y)}:void 0}t.on("connectionSegment.move.move",1500,(function(t){var o,i,r=function(t){var e=t.context,o=e.snapPoints,i=e.connection,r=i.waypoints,a=e.segmentStart,s=e.segmentStartIndex,c=e.segmentEnd,u=e.segmentEndIndex,h=e.axis;if(o)return o;var l=[r[s-1],a,c,r[u+1]];return s<2&&l.unshift(n(i.source,t)),u>r.length-3&&l.unshift(n(i.target,t)),e.snapPoints=o={horizontal:[],vertical:[]},x(l,(function(t){t&&(t=t.original||t,"y"===h&&o.horizontal.push(t.y),"x"===h&&o.vertical.push(t.x))})),o}(t),a=t.x,s=t.y;if(r){var c=a-(o=e(r.vertical,a)),u=s-(i=e(r.horizontal,s));b(t,{dx:t.dx-c,dy:t.dy-u,x:o,y:i}),(c||-1!==r.vertical.indexOf(a))&&Oi(t,"x",o),(u||-1!==r.horizontal.indexOf(s))&&Oi(t,"y",i)}})),t.on(["connect.hover","connect.move","connect.end"],1500,(function(t){var e=t.context.hover,o=e&&n(e,t);mt(e)&&o&&o.x&&o.y&&(Oi(t,"x",o.x),Oi(t,"y",o.y))})),t.on(["bendpoint.move.move","bendpoint.move.end"],1500,(function(t){var o,i,r=t.context,a=function(t){var e=t.snapPoints,n=t.connection.waypoints,o=t.bendpointIndex;if(e)return e;var i=[n[o-1],n[o+1]];return t.snapPoints=e={horizontal:[],vertical:[]},x(i,(function(t){t&&(t=t.original||t,e.horizontal.push(t.y),e.vertical.push(t.x))})),e}(r),s=r.hover,c=s&&n(s,t),u=t.x,h=t.y;if(a){var l=u-(o=e(c?a.vertical.concat([c.x]):a.vertical,u)),p=h-(i=e(c?a.horizontal.concat([c.y]):a.horizontal,h));b(t,{dx:t.dx-l,dy:t.dy-p,x:t.x-l,y:t.y-p}),(l||-1!==a.vertical.indexOf(u))&&Oi(t,"x",o),(p||-1!==a.horizontal.indexOf(h))&&Oi(t,"y",i)}}))}Ii.$inject=["eventBus"];const Di={__depends__:[zo,No],__init__:["bendpoints","bendpointSnapping","bendpointMovePreview"],bendpoints:["type",si],bendpointMove:["type",pi],bendpointMovePreview:["type",xi],connectionSegmentMove:["type",Mi],bendpointSnapping:["type",Ii]};function Hi(t,e,n,o){function i(t,e){return o.allowed("connection.create",{source:t,target:e})}t.on("connect.hover",(function(t){var e,n=t.context,o=n.start,r=t.hover;if(n.hover=r,e=n.canExecute=i(o,r),!A(e)){if(!1!==e)return n.source=o,void(n.target=r);e=n.canExecute=i(r,o),A(e)||!1!==e&&(n.source=r,n.target=o)}})),t.on(["connect.out","connect.cleanup"],(function(t){var e=t.context;e.hover=null,e.source=null,e.target=null,e.canExecute=!1})),t.on("connect.end",(function(t){var e=t.context,o=e.canExecute,i=e.connectionStart,r={x:t.x,y:t.y},a=e.source,s=e.target;if(!o)return!1;var c=null,u={connectionStart:Gi(e)?r:i,connectionEnd:Gi(e)?i:r};d(o)&&(c=o),e.connection=n.connect(a,s,c,u)})),this.start=function(t,n,o,i){d(o)||(i=o,o=Ct(n)),e.init(t,"connect",{autoActivate:i,data:{shape:n,context:{start:n,connectionStart:o}}})}}function Gi(t){var e=t.hover,n=t.source,o=t.target;return e&&n&&e===n&&n!==o}Hi.$inject=["eventBus","dragging","modeling","rules"];var Ni="connect-ok",Vi="connect-not-ok";function Ui(t,e,n){var o=t.get("connectionPreview",!1);o&&e.on("connect.move",(function(t){var e=t.context,n=e.canExecute,i=e.hover,r=e.source,a=e.start,s=e.startPosition,c=e.target,u=e.connectionStart||s,h=e.connectionEnd||{x:t.x,y:t.y},l=u,p=h;Gi(e)&&(l=h,p=u),o.drawPreview(e,n,{source:r||a,target:c||i,connectionStart:l,connectionEnd:p})})),e.on("connect.hover",900,(function(t){var e=t.context,o=t.hover,i=e.canExecute;null!==i&&n.addMarker(o,i?Ni:Vi)})),e.on(["connect.out","connect.cleanup"],1100,(function(t){var e=t.hover;e&&(n.removeMarker(e,Ni),n.removeMarker(e,Vi))})),o&&e.on("connect.cleanup",(function(t){o.cleanUp(t.context)}))}Ui.$inject=["injector","eventBus","canvas"];const Fi={__depends__:[fn,No,zo],__init__:["connectPreview"],connect:["type",Hi],connectPreview:["type",Ui]};function Wi(t,e,n,o){this._canvas=e,this._graphicsFactory=n,this._elementFactory=o,this._connectionDocking=t.get("connectionDocking",!1),this._layouter=t.get("layouter",!1)}Wi.$inject=["injector","canvas","graphicsFactory","elementFactory"],Wi.prototype.drawPreview=function(t,e,n){n=n||{};var o,i,r,a=t.connectionPreviewGfx,s=t.getConnection,c=n.source,u=n.target,l=n.waypoints,p=n.connectionStart,d=n.connectionEnd,f=n.noLayout,v=n.noCropping,g=n.noNoop,y=this;a||(a=t.connectionPreviewGfx=this.createConnectionPreviewGfx()),h(a),s||(s=t.getConnection=(i=function(t,e,n){return y.getConnection(t,e,n)},r={},function(t){var e=JSON.stringify(t),n=r[e];return n||(n=r[e]=i.apply(null,arguments)),n})),e&&(o=s(e,c,u)),o?(o.waypoints=l||[],this._layouter&&!f&&(o.waypoints=this._layouter.layoutConnection(o,{source:c,target:u,connectionStart:p,connectionEnd:d,waypoints:n.waypoints||o.waypoints})),o.waypoints&&o.waypoints.length||(o.waypoints=[c?Ct(c):p,u?Ct(u):d]),this._connectionDocking&&(c||u)&&!v&&(o.waypoints=this._connectionDocking.getCroppedWaypoints(o,c,u)),this._graphicsFactory.drawConnection(a,o,{stroke:"var(--element-dragger-color)"})):!g&&this.drawNoopPreview(a,n)},Wi.prototype.drawNoopPreview=function(t,e){var n=e.source,o=e.target,r=e.connectionStart||Ct(n),a=e.connectionEnd||Ct(o),s=this.cropWaypoints(r,a,n,o),c=this.createNoopConnection(s[0],s[1]);i(t,c)},Wi.prototype.cropWaypoints=function(t,e,n,o){var i=this._graphicsFactory,r=n&&i.getShapePath(n),a=o&&i.getShapePath(o),s=i.getConnectionPath({waypoints:[t,e]});return[t=n&&Mt(r,s,!0)||t,e=o&&Mt(a,s,!1)||e]},Wi.prototype.cleanUp=function(t){t&&t.connectionPreviewGfx&&r(t.connectionPreviewGfx)},Wi.prototype.getConnection=function(t){var e=function(t){return d(t)?t:{}}(t);return this._elementFactory.createConnection(e)},Wi.prototype.createConnectionPreviewGfx=function(){var t=n("g");return o(t,{pointerEvents:"none"}),a(t).add("djs-dragger"),i(this._canvas.getActiveLayer(),t),t},Wi.prototype.createNoopConnection=function(t,e){return Vt([t,e],{stroke:"#333",strokeDasharray:[1],strokeWidth:2,"pointer-events":"none"})};const Ki={__init__:["connectionPreview"],connectionPreview:["type",Wi]};var qi=["marker-start","marker-mid","marker-end"],Zi=["circle","ellipse","line","path","polygon","polyline","path","rect"];function Yi(t,e,n,o){this._elementRegistry=t,this._canvas=n,this._styles=o,this._clonedMarkers={};var i=this;e.on("drag.cleanup",(function(){i.cleanUp()}))}Yi.$inject=["elementRegistry","eventBus","canvas","styles"],Yi.prototype.cleanUp=function(){x(this._clonedMarkers,(function(t){r(t)})),this._clonedMarkers={}},Yi.prototype.getGfx=function(t){return this._elementRegistry.getGraphics(t)},Yi.prototype.addDragger=function(t,e,n,r="djs-dragger"){n=n||this.getGfx(t);var a=l(n),s=n.getBoundingClientRect();return this._cloneMarkers(Re(a),r),o(a,this._styles.cls(r,[],{x:s.top,y:s.left})),i(e,a),o(a,"data-preview-support-element-id",t.id),a},Yi.prototype.addFrame=function(t,e){var r=n("rect",{class:"djs-resize-overlay",width:t.width,height:t.height,x:t.x,y:t.y});return i(e,r),o(r,"data-preview-support-element-id",t.id),r},Yi.prototype._cloneMarkers=function(t,e="djs-dragger"){var n,i=this;if(t.childNodes)for(var r=0;r<t.childNodes.length;r++)i._cloneMarkers(t.childNodes[r],e);(n=t,-1!==Zi.indexOf(n.nodeName))&&qi.forEach((function(n){if(o(t,n)){var r=function(t,e,n){var i=(r=o(t,e),r.match(/url\(['"]?#([^'"]*)['"]?\)/)[1]);var r;return F("marker#"+i,n||document)}(t,n,i._canvas.getContainer());i._cloneMarker(t,r,n,e)}}))},Yi.prototype._cloneMarker=function(t,e,r,s="djs-dragger"){var c=e.id+"-"+s,u=this._clonedMarkers[c];if(!u){var h=c+"-clone";(u=l(e)).id=h,a(u).add(s),this._clonedMarkers[c]=u;var p=F("defs",this._canvas._svg);p||(p=n("defs"),i(this._canvas._svg,p)),i(p,u)}var d="url(#"+this._clonedMarkers[c].id+")";o(t,r,d)};const Xi={__init__:["previewSupport"],previewSupport:["type",Yi]},Ji="complex-preview";class Qi{constructor(t,e,n){this._canvas=t,this._graphicsFactory=e,this._previewSupport=n,this._markers=[]}create(t){this.cleanUp();const{created:e=[],moved:o=[],removed:i=[],resized:r=[]}=t,a=this._canvas.getLayer(Ji);e.filter((t=>!function(t){return t.hidden}(t))).forEach((t=>{let e;mt(t)?(e=this._graphicsFactory._createContainer("connection",n("g")),this._graphicsFactory.drawConnection(Re(e),t)):(e=this._graphicsFactory._createContainer("shape",n("g")),this._graphicsFactory.drawShape(Re(e),t),Be(e,t.x,t.y)),this._previewSupport.addDragger(t,a,e)})),o.forEach((({element:t,delta:e})=>{this._previewSupport.addDragger(t,a,void 0,"djs-dragging"),this._canvas.addMarker(t,"djs-element-hidden"),this._markers.push([t,"djs-element-hidden"]);const n=this._previewSupport.addDragger(t,a);mt(t)?Be(n,e.x,e.y):Be(n,t.x+e.x,t.y+e.y)})),i.forEach((t=>{this._previewSupport.addDragger(t,a,void 0,"djs-dragging"),this._canvas.addMarker(t,"djs-element-hidden"),this._markers.push([t,"djs-element-hidden"])})),r.forEach((({shape:t,bounds:e})=>{this._canvas.addMarker(t,"djs-hidden"),this._markers.push([t,"djs-hidden"]),this._previewSupport.addDragger(t,a,void 0,"djs-dragging");const o=this._graphicsFactory._createContainer("shape",n("g"));this._graphicsFactory.drawShape(Re(o),t,{width:e.width,height:e.height}),Be(o,e.x,e.y),this._previewSupport.addDragger(t,a,o)}))}cleanUp(){h(this._canvas.getLayer(Ji)),this._markers.forEach((([t,e])=>this._canvas.removeMarker(t,e))),this._markers=[],this._previewSupport.cleanUp()}show(){this._canvas.showLayer(Ji)}hide(){this._canvas.hideLayer(Ji)}}Qi.$inject=["canvas","graphicsFactory","previewSupport"];const tr={__depends__:[Xi],__init__:["complexPreview"],complexPreview:["type",Qi]};var er=Math.max,nr=Math.min,or=20;function ir(t,e){return{top:t.top-e.top,right:t.right-e.right,bottom:t.bottom-e.bottom,left:t.left-e.left}}function rr(t,e){return{x:t.x+(e.left||0),y:t.y+(e.top||0),width:t.width-(e.left||0)+(e.right||0),height:t.height-(e.top||0)+(e.bottom||0)}}function ar(t,e,n){var o=e[t],i=n.min&&n.min[t],r=n.max&&n.max[t];return m(i)&&(o=(/top|left/.test(t)?nr:er)(o,i)),m(r)&&(o=(/top|left/.test(t)?er:nr)(o,r)),o}function sr(t,e){return void 0!==t?t:or}function cr(t){return!t.waypoints&&"label"!==t.type}function ur(t,e){var n;if((n=void 0===t.length?w(t.children,cr):t).length)return function(t,e){var n,o,i,r;return"object"==typeof e?(n=sr(e.left),o=sr(e.right),i=sr(e.top),r=sr(e.bottom)):n=o=i=r=sr(e),{x:t.x-n,y:t.y-i,width:t.width+n+o,height:t.height+i+r}}(Yt(n),e)}function hr(t,e,n){var o=Xn(e),i=Xn(n),r=Jn(t,o),a=r.x*(n.width/e.width),s=r.y*(n.height/e.height);return wt({x:i.x+a,y:i.y+s})}function lr(t,e,n){var o=Xn(t),i=Xn(e),r=Xn(n),a=Jn(t,o),s=Jn(o,i),c=function(t,e,n){var o=Et(e),i=Et(n);if(function(t,e){return function(t,e){return t.right!==e.right&&t.left!==e.left}(t,e)||function(t,e){return t.top!==e.top&&t.bottom!==e.bottom}(t,e)}(o,i))return null;var r,a,s,c=kt(e,t);if("top"===c)r={x:0,y:i.bottom-o.bottom};else if("bottom"===c)r={x:0,y:i.top-o.top};else if("right"===c)r={x:i.left-o.left,y:0};else{if("left"!==c)return null;r={x:i.right-o.right,y:0}}if(a={x:t.x+r.x,y:t.y+r.y},s=kt(n,a),s!==c)return null;return r}(o,e,n);if(c)return c;var u=s.x*(n.width/e.width),h=s.y*(n.height/e.height),l=r.x+u,p=r.y+h;return wt({x:l+a.x-t.x,y:p+a.y-t.y})}function pr(t,e,n){var o=yr(t),i=mr(o,e),r=o[0];return i.length?i[i.length-1]:hr(r.original||r,n,e)}function dr(t,e,n){var o=yr(t),i=mr(o,e),r=o[o.length-1];return i.length?i[0]:hr(r.original||r,n,e)}function fr(t,e,n){var o=yr(t),i=gr(e,n),r=o[0];return hr(r.original||r,i,e)}function vr(t,e,n){var o=yr(t),i=gr(e,n),r=o[o.length-1];return hr(r.original||r,i,e)}function gr(t,e){return{x:t.x-e.x,y:t.y-e.y,width:t.width,height:t.height}}function yr(t){var e=t.waypoints;if(!e.length)throw new Error("connection#"+t.id+": no waypoints");return e}function mr(t,e){var n=z(t,_r);return w(n,(function(t){return function(t,e){return"intersect"===kt(e,t,1)}(t,e)}))}function _r(t){return t.original||t}function xr(t){Sn.call(this,t);var e=this;this.preExecute(["shape.create","connection.create"],(function(t){var n=t.context,o=n.shape||n.connection,i=n.parent,r=e.getOrdering(o,i);r&&(void 0!==r.parent&&(n.parent=r.parent),n.parentIndex=r.index)})),this.preExecute(["shape.move","connection.move"],(function(t){var n=t.context,o=n.shape||n.connection,i=n.newParent||o.parent,r=e.getOrdering(o,i);r&&(void 0!==r.parent&&(n.newParent=r.parent),n.newParentIndex=r.index)}))}function wr(){}xr.prototype.getOrdering=function(t,e){return null},e(xr,Sn),wr.prototype.get=function(){return this._data},wr.prototype.set=function(t){this._data=t},wr.prototype.clear=function(){var t=this._data;return delete this._data,t},wr.prototype.isEmpty=function(){return!this._data};const Er={clipboard:["type",wr]};var br="drop-ok",Sr="drop-not-ok",Cr="attach-ok",kr="new-parent",Mr="create";function jr(t,e,n,o,i){function r(e,n){[Cr,br,Sr,kr].forEach((function(o){o===n?t.addMarker(e,o):t.removeMarker(e,o)}))}function a(){var t=e.context();t&&t.prefix===Mr&&e.cancel()}n.on(["create.move","create.hover"],(function(t){var e=t.context,n=e.elements,o=t.hover,a=e.source,s=e.hints||{};if(!o)return e.canExecute=!1,void(e.target=null);Rr(t);var c={x:t.x,y:t.y},u=e.canExecute=o&&function(t,e,n,o,r){if(!e)return!1;t=w(t,(function(e){var n=e.labelTarget;return!(e.parent||_t(e)&&-1!==t.indexOf(n))}));var a=g(t,(function(t){return!mt(t)})),s=!1,c=!1,u=!1;Tr(t)&&(s=i.allowed("shape.attach",{position:n,shape:a,target:e})),s||(u=Tr(t)?i.allowed("shape.create",{position:n,shape:a,source:o,target:e}):i.allowed("elements.create",{elements:t,position:n,target:e}));var h=r.connectionTarget;return u||s?(a&&o&&(c=i.allowed("connection.create",{source:h===o?a:o,target:h===o?o:a,hints:{targetParent:e,targetAttach:s}})),{attach:s,connect:c}):(null===u||null===s)&&null}(n,o,c,a,s);o&&null!==u&&(e.target=o,u&&u.attach?r(o,Cr):r(o,u?kr:Sr))})),n.on(["create.end","create.out","create.cleanup"],(function(t){var e=t.hover;e&&r(e,null)})),n.on("create.end",(function(t){var e=t.context,n=e.source,i=e.shape,r=e.elements,a=e.target,s=e.canExecute,c=s&&s.attach,u=s&&s.connect,h=e.hints||{};if(!1===s||!a)return!1;Rr(t);var l={x:t.x,y:t.y};u?i=o.appendShape(n,i,l,a,{attach:c,connection:!0===u?{}:u,connectionTarget:h.connectionTarget}):(r=o.createElements(r,l,a,b({},h,{attach:c})),i=g(r,(function(t){return!mt(t)}))),b(e,{elements:r,shape:i}),b(t,{elements:r,shape:i})})),n.on("create.init",(function(){n.on("elements.changed",a),n.once(["create.cancel","create.end"],2e3,(function(){n.off("elements.changed",a)}))})),this.start=function(t,n,o){_(n)||(n=[n]);var i=g(n,(function(t){return!mt(t)}));if(i){o=b({elements:n,hints:{},shape:i},o||{}),x(n,(function(t){m(t.x)||(t.x=0),m(t.y)||(t.y=0)}));var r=Yt(w(n,(function(t){return!t.hidden})));x(n,(function(t){mt(t)&&(t.waypoints=z(t.waypoints,(function(t){return{x:t.x-r.x-r.width/2,y:t.y-r.y-r.height/2}}))),b(t,{x:t.x-r.x-r.width/2,y:t.y-r.y-r.height/2})})),e.init(t,Mr,{cursor:"grabbing",autoActivate:!0,data:{shape:i,elements:n,context:o}})}}}function Rr(t){var e=t.context.createConstraints;e&&(e.left&&(t.x=Math.max(t.x,e.left)),e.right&&(t.x=Math.min(t.x,e.right)),e.top&&(t.y=Math.max(t.y,e.top)),e.bottom&&(t.y=Math.min(t.y,e.bottom)))}function Tr(t){return t&&1===t.length&&!mt(t[0])}jr.$inject=["canvas","dragging","eventBus","modeling","rules"];function Br(t,e,a,s,c){e.on("create.move",750,(function(e){var u,h=e.hover,l=e.context,p=l.elements,d=l.dragGroup;d||(d=l.dragGroup=function(t){var e=n("g");o(e,c.cls("djs-drag-group",["no-events"]));var i=n("g");return t.forEach((function(t){var n;t.hidden||(t.waypoints?(n=a._createContainer("connection",i),a.drawConnection(Re(n),t)):(n=a._createContainer("shape",i),a.drawShape(Re(n),t),Be(n,t.x,t.y)),s.addDragger(t,e,n))})),e}(p)),h?(d.parentNode||(u=t.getActiveLayer(),i(u,d)),Be(d,e.x,e.y)):r(d)})),e.on("create.cleanup",(function(t){var e=t.context.dragGroup;e&&r(e)}))}Br.$inject=["canvas","eventBus","graphicsFactory","previewSupport","styles"];const Pr={__depends__:[zo,Xi,No,fn],__init__:["create","createPreview"],create:["type",jr],createPreview:["type",Br]};function Lr(t){var e=this;function n(t){e._lastMoveEvent=t}this._lastMoveEvent=null,t.on("canvas.init",(function(t){(e._svg=t.svg).addEventListener("mousemove",n)})),t.on("canvas.destroy",(function(){e._lastMouseEvent=null,e._svg.removeEventListener("mousemove",n)}))}Lr.$inject=["eventBus"],Lr.prototype.getLastMoveEvent=function(){return this._lastMoveEvent||function(t,e){var n=document.createEvent("MouseEvent"),o=t,i=e,r=t,a=e;n.initMouseEvent&&n.initMouseEvent("mousemove",!0,!0,window,0,o,i,r,a,!1,!1,!1,!1,0,null);return n}(0,0)};const Or={__init__:["mouse"],mouse:["type",Lr]};function $r(t,e,n,o,i,r,a,s){this._canvas=t,this._create=e,this._clipboard=n,this._elementFactory=o,this._eventBus=i,this._modeling=r,this._mouse=a,this._rules=s,i.on("copyPaste.copyElement",(function(t){var e=t.descriptor,n=t.element,o=t.elements;e.priority=1,e.id=n.id,g(o,(function(t){return t===n.parent}))&&(e.parent=n.parent.id),function(t){return!!t.host}(n)&&(e.priority=2,e.host=n.host.id),mt(n)&&(e.priority=3,e.source=n.source.id,e.target=n.target.id,e.waypoints=function(t){return z(t.waypoints,(function(t){return(t=Ar(t)).original&&(t.original=Ar(t.original)),t}))}(n)),_t(n)&&(e.priority=4,e.labelTarget=n.labelTarget.id),x(["x","y","width","height"],(function(t){m(n[t])&&(e[t]=n[t])})),e.hidden=n.hidden,e.collapsed=n.collapsed})),i.on("copyPaste.pasteElements",(function(t){var e=t.hints;b(e,{createElementsBehavior:!1})}))}function Ar(t){return b({},t)}function zr(t,e){var n=e.indexOf(t);return-1===n?e:e.splice(n,1)}$r.$inject=["canvas","create","clipboard","elementFactory","eventBus","modeling","mouse","rules"],$r.prototype.copy=function(t){var e,n;return _(t)||(t=t?[t]:[]),n=!1===(e=this._eventBus.fire("copyPaste.canCopyElements",{elements:t}))?{}:this.createTree(_(e)?e:t),this._clipboard.set(n),this._eventBus.fire("copyPaste.elementsCopied",{elements:t,tree:n}),n},$r.prototype.paste=function(t){var e=this._clipboard.get();if(!this._clipboard.isEmpty()){var n=t&&t.hints||{};this._eventBus.fire("copyPaste.pasteElements",{hints:n});var o=this._createElements(e);if(t&&t.element&&t.point)return this._paste(o,t.element,t.point,n);this._create.start(this._mouse.getLastMoveEvent(),o,{hints:n||{}})}},$r.prototype._paste=function(t,e,n,o){x(t,(function(t){m(t.x)||(t.x=0),m(t.y)||(t.y=0)}));var i=Yt(t);return x(t,(function(t){mt(t)&&(t.waypoints=z(t.waypoints,(function(t){return{x:t.x-i.x-i.width/2,y:t.y-i.y-i.height/2}}))),b(t,{x:t.x-i.x-i.width/2,y:t.y-i.y-i.height/2})})),this._modeling.createElements(t,n,e,b({},o))},$r.prototype._createElements=function(t){var e=this,n=this._eventBus,o={},i=[];return x(t,(function(t,r){t=v(t,"priority"),x(t,(function(t){var r,a=b({},P(t,["priority"]));return o[t.parent]?a.parent=o[t.parent]:delete a.parent,n.fire("copyPaste.pasteElement",{cache:o,descriptor:a}),mt(a)?(a.source=o[t.source],a.target=o[t.target],r=o[t.id]=e.createConnection(a),void i.push(r)):_t(a)?(a.labelTarget=o[a.labelTarget],r=o[t.id]=e.createLabel(a),void i.push(r)):(a.host&&(a.host=o[a.host]),r=o[t.id]=e.createShape(a),void i.push(r))}))})),i},$r.prototype.createConnection=function(t){return this._elementFactory.createConnection(P(t,["id"]))},$r.prototype.createLabel=function(t){return this._elementFactory.createLabel(P(t,["id"]))},$r.prototype.createShape=function(t){return this._elementFactory.createShape(P(t,["id"]))},$r.prototype.hasRelations=function(t,e){var n,o;return!(mt(t)&&(n=g(e,R({id:t.source.id})),o=g(e,R({id:t.target.id})),!n||!o))&&!(_t(t)&&!g(e,R({id:t.labelTarget.id})))},$r.prototype.createTree=function(t){var e=this._rules,n=this,o={},i=[];function r(t,e){var n=g(i,(function(e){return t===e.element}));n?n.depth<e&&(i=function(t,e){var n=e.indexOf(t);-1!==n&&e.splice(n,1);return e}(n,i)).push({element:n.element,depth:e}):i.push({element:t,depth:e})}return qt(Ft(t),(function(t,e,o){if(!_t(t)){x(t.labels,(function(t){r(t,o)})),x([t.attachers,t.incoming,t.outgoing],(function(t){t&&t.length&&x(t,(function(t){x(t.labels,(function(t){r(t,o)})),r(t,o)}))})),r(t,o);var i=[];return t.children&&(i=t.children.slice()),n._eventBus.fire("copyPaste.createTree",{element:t,children:i}),i}})),t=z(i,(function(t){return t.element})),i=z(i,(function(e){return e.descriptor={},n._eventBus.fire("copyPaste.copyElement",{descriptor:e.descriptor,element:e.element,elements:t}),e})),i=v(i,(function(t){return t.descriptor.priority})),t=z(i,(function(t){return t.element})),x(i,(function(i){var r,a,s=i.depth;n.hasRelations(i.element,t)?(r=i.element,a=t,e.allowed("element.copy",{element:r,elements:a})?(o[s]||(o[s]=[]),o[s].push(i.descriptor)):zr(i.element,t)):zr(i.element,t)})),o};const Ir={__depends__:[Er,Pr,Or,No],__init__:["copyPaste"],copyPaste:["type",$r]};var Dr=Math.round;function Hr(t,e){this._modeling=t,this._eventBus=e}function Gr(t,e){e.on("replace.end",500,(function(e){const{newElement:n,hints:o={}}=e;!1!==o.select&&t.select(n)}))}Hr.$inject=["modeling","eventBus"],Hr.prototype.replaceElement=function(t,e,n){if(t.waypoints)return null;var o=this._modeling,i=this._eventBus;i.fire("replace.start",{element:t,attrs:e,hints:n});var r=e.width||t.width,a=e.height||t.height,s=e.x||t.x,c=e.y||t.y,u=Dr(s+r/2),h=Dr(c+a/2),l=o.replaceShape(t,b({},e,{x:u,y:h,width:r,height:a}),n);return i.fire("replace.end",{element:t,newElement:l,hints:n}),l},Gr.$inject=["selection","eventBus"];const Nr={__init__:["replace","replaceSelectionBehavior"],replaceSelectionBehavior:["type",Gr],replace:["type",Hr]};function Vr(t,e){this._eventBus=t,this._dragging=e,this._tools=[],this._active=null}Vr.$inject=["eventBus","dragging"],Vr.prototype.registerTool=function(t,e){var n=this._tools;if(!e)throw new Error('A tool has to be registered with it\'s "events"');n.push(t),this.bindEvents(t,e)},Vr.prototype.isActive=function(t){return t&&this._active===t},Vr.prototype.length=function(t){return this._tools.length},Vr.prototype.setActive=function(t){var e=this._eventBus;this._active!==t&&(this._active=t,e.fire("tool-manager.update",{tool:t}))},Vr.prototype.bindEvents=function(t,e){var n=this._eventBus,o=this._dragging,i=[];n.on(e.tool+".init",(function(e){if(!e.context.reactivate&&this.isActive(t))return this.setActive(null),void o.cancel();this.setActive(t)}),this),x(e,(function(t){i.push(t+".ended"),i.push(t+".canceled")})),n.on(i,250,(function(t){this._active&&(function(t){var e=t.originalEvent&&t.originalEvent.target;return e&&X(e,'.group[data-group="tools"]')}(t)||this.setActive(null))}),this)};const Ur={__depends__:[zo],__init__:["toolManager"],toolManager:["type",Vr]};function Fr(t,e){return-1!==t.indexOf(e)}var Wr=Math.abs,Kr=Math.round,qr={x:"width",y:"height"},Zr="crosshair",Yr={n:"top",w:"left",s:"bottom",e:"right"},Xr={n:"s",w:"e",s:"n",e:"w"},Jr=20;function Qr(t,e,n,o,i,r,a){this._canvas=t,this._dragging=e,this._eventBus=n,this._modeling=o,this._rules=i,this._toolManager=r,this._mouse=a;var s=this;r.registerTool("space",{tool:"spaceTool.selection",dragging:"spaceTool"}),n.on("spaceTool.selection.end",(function(t){n.once("spaceTool.selection.ended",(function(){s.activateMakeSpace(t.originalEvent)}))})),n.on("spaceTool.move",1500,(function(t){var e=t.context,n=e.initialized;n||(n=e.initialized=s.init(t,e)),n&&ea(t)})),n.on("spaceTool.end",(function(t){var e=t.context,o=e.axis,i=e.direction,r=e.movingShapes,a=e.resizingShapes,c=e.start;if(e.initialized){ea(t);var u={x:0,y:0};u[o]=Kr(t["d"+o]),s.makeSpace(r,a,u,i,c),n.once("spaceTool.ended",(function(t){s.activateSelection(t.originalEvent,!0,!0)}))}}))}function ta(t){return{top:t.top-Jr,right:t.right+Jr,bottom:t.bottom+Jr,left:t.left-Jr}}function ea(t){var e,n,o=t.context.spaceToolConstraints;o&&(m(o.left)&&(e=Math.max(t.x,o.left),t.dx=t.dx+e-t.x,t.x=e),m(o.right)&&(e=Math.min(t.x,o.right),t.dx=t.dx+e-t.x,t.x=e),m(o.top)&&(n=Math.max(t.y,o.top),t.dy=t.dy+n-t.y,t.y=n),m(o.bottom)&&(n=Math.min(t.y,o.bottom),t.dy=t.dy+n-t.y,t.y=n))}function na(t,e){return-1!==t.indexOf(e)}Qr.$inject=["canvas","dragging","eventBus","modeling","rules","toolManager","mouse"],Qr.prototype.activateSelection=function(t,e,n){this._dragging.init(t,"spaceTool.selection",{autoActivate:e,cursor:Zr,data:{context:{reactivate:n}},trapClick:!1})},Qr.prototype.activateMakeSpace=function(t){this._dragging.init(t,"spaceTool",{autoActivate:!0,cursor:Zr,data:{context:{}}})},Qr.prototype.makeSpace=function(t,e,n,o,i){return this._modeling.createSpace(t,e,n,o,i)},Qr.prototype.init=function(t,e){var n=Wr(t.dx)>Wr(t.dy)?"x":"y",o=t["d"+n],i=t[n]-o;if(Wr(o)<5)return!1;o<0&&(o*=-1),Qe(t)&&(o*=-1);var r=function(t,e){if("x"===t){if(e>0)return"e";if(e<0)return"w"}if("y"===t){if(e>0)return"s";if(e<0)return"n"}return null}(n,o),a=this._canvas.getRootElement();!tn(t)&&t.hover&&(a=t.hover);var s=[...Zt(a,!0),...a.attachers||[]],c=this.calculateAdjustments(s,n,o,i),u=function(t,e,n,o,i){var r=t.movingShapes,a=t.resizingShapes;if(!a.length)return;var s,c,u={};return x(a,(function(t){var h,l,p,d,f,v,g=t.attachers,y=t.children,_=Et(t),x=w(y,(function(t){return!(mt(t)||_t(t)||na(r,t)||na(a,t))})),E=w(y,(function(t){return!mt(t)&&!_t(t)&&na(r,t)})),b=[],S=[];x.length&&(l=ta(Et(Yt(x))),h=o-_[Yr[n]]+l[Yr[n]],"n"===n?u.bottom=c=m(c)?Math.min(c,h):h:"w"===n?u.right=c=m(c)?Math.min(c,h):h:"s"===n?u.top=s=m(s)?Math.max(s,h):h:"e"===n&&(u.left=s=m(s)?Math.max(s,h):h)),E.length&&(p=ta(Et(Yt(E))),h=o-p[Yr[Xr[n]]]+_[Yr[Xr[n]]],"n"===n?u.bottom=c=m(c)?Math.min(c,h):h:"w"===n?u.right=c=m(c)?Math.min(c,h):h:"s"===n?u.top=s=m(s)?Math.max(s,h):h:"e"===n&&(u.left=s=m(s)?Math.max(s,h):h)),g&&g.length&&(g.forEach((function(t){na(r,t)?b.push(t):S.push(t)})),b.length&&(d=Et(Yt(b.map(Ct))),f=_[Yr[Xr[n]]]-(d[Yr[Xr[n]]]-o)),S.length&&(v=Et(Yt(S.map(Ct)))[Yr[n]]-(_[Yr[n]]-o)),"n"===n?(h=Math.min(f||1/0,v||1/0),u.bottom=c=m(c)?Math.min(c,h):h):"w"===n?(h=Math.min(f||1/0,v||1/0),u.right=c=m(c)?Math.min(c,h):h):"s"===n?(h=Math.max(f||-1/0,v||-1/0),u.top=s=m(s)?Math.max(s,h):h):"e"===n&&(h=Math.max(f||-1/0,v||-1/0),u.left=s=m(s)?Math.max(s,h):h));var C=i&&i[t.id];C&&("n"===n?(h=o+t[qr[e]]-C[qr[e]],u.bottom=c=m(c)?Math.min(c,h):h):"w"===n?(h=o+t[qr[e]]-C[qr[e]],u.right=c=m(c)?Math.min(c,h):h):"s"===n?(h=o-t[qr[e]]+C[qr[e]],u.top=s=m(s)?Math.max(s,h):h):"e"===n&&(h=o-t[qr[e]]+C[qr[e]],u.left=s=m(s)?Math.max(s,h):h))})),u}(c,n,r,i,this._eventBus.fire("spaceTool.getMinDimensions",{axis:n,direction:r,shapes:c.resizingShapes,start:i}));return b(e,c,{axis:n,direction:r,spaceToolConstraints:u,start:i}),Kn("resize-"+("x"===n?"ew":"ns")),!0},Qr.prototype.calculateAdjustments=function(t,e,n,o){var i=this._rules,r=[],a=[],s=[],c=[];function u(t){r.includes(t)||r.push(t);var e=t.label;e&&!r.includes(e)&&r.push(e)}x(t,(function(t){if(t.parent&&!_t(t))if(mt(t))c.push(t);else{var r=t[e],h=r+t[qr[e]];if(function(t){return!!t.host}(t)&&(n>0&&Ct(t)[e]>o||n<0&&Ct(t)[e]<o))s.push(t);else{var l;if(!(n>0&&r>o||n<0&&h<o))return r<o&&h>o&&i.allowed("shape.resize",{shape:t})?(l=t,void(a.includes(l)||a.push(l))):void 0;u(t)}}})),x(r,(function(t){var e=t.attachers;e&&x(e,(function(t){u(t)}))}));var h=r.concat(a);return x(s,(function(t){var e=t.host;na(h,e)&&u(t)})),h=r.concat(a),x(c,(function(t){var e=t.source,n=t.target,o=t.label;na(h,e)&&na(h,n)&&o&&u(o)})),{movingShapes:r,resizingShapes:a}},Qr.prototype.toggle=function(){if(this.isActive())return this._dragging.cancel();var t=this._mouse.getLastMoveEvent();this.activateSelection(t,!!t)},Qr.prototype.isActive=function(){var t=this._dragging.context();return!!t&&/^spaceTool/.test(t.prefix)};var oa="djs-dragging",ia="djs-resizing",ra=Math.max;function aa(t,e,s,c,u){function h(t,e){x(t,(function(t){u.addDragger(t,e),s.addMarker(t,oa)}))}t.on("spaceTool.selection.start",(function(t){var e=s.getLayer("space"),r=t.context,u="M 0,-10000 L 0,10000",h="M -10000,0 L 10000,0",l=n("g");o(l,c.cls("djs-crosshair-group",["no-events"])),i(e,l);var p=n("path");o(p,"d",u),a(p).add("djs-crosshair"),i(l,p);var d=n("path");o(d,"d",h),a(d).add("djs-crosshair"),i(l,d),r.crosshairGroup=l})),t.on("spaceTool.selection.move",(function(t){Be(t.context.crosshairGroup,t.x,t.y)})),t.on("spaceTool.selection.cleanup",(function(t){var e=t.context.crosshairGroup;e&&r(e)})),t.on("spaceTool.move",250,(function(t){var r=t.context,l=r.line,p=r.axis,d=r.movingShapes,f=r.resizingShapes;if(r.initialized){if(!r.dragGroup){var v=s.getLayer("space");l=n("path"),o(l,"d","M0,0 L0,0"),a(l).add("djs-crosshair"),i(v,l),r.line=l;var g=n("g");o(g,c.cls("djs-drag-group",["no-events"])),i(s.getActiveLayer(),g),h(d,g),h(r.movingConnections=e.filter((function(t){var e=!1;x(d,(function(n){x(n.outgoing,(function(n){t===n&&(e=!0)}))}));var n=!1;x(d,(function(e){x(e.incoming,(function(e){t===e&&(n=!0)}))}));var o=!1;x(f,(function(e){x(e.outgoing,(function(e){t===e&&(o=!0)}))}));var i=!1;return x(f,(function(e){x(e.incoming,(function(e){t===e&&(i=!0)}))})),mt(t)&&(e||o)&&(n||i)})),g),r.dragGroup=g}if(!r.frameGroup){var y=n("g");o(y,c.cls("djs-frame-group",["no-events"])),i(s.getActiveLayer(),y);var m=[];x(f,(function(t){var e=u.addFrame(t,y),n=e.getBBox();m.push({element:e,initialBounds:n}),s.addMarker(t,ia)})),r.frameGroup=y,r.frames=m}var _={x:"M"+t.x+", -10000 L"+t.x+", 10000",y:"M -10000, "+t.y+" L 10000, "+t.y};o(l,{d:_[p]});var w={x:t.dx,y:t.dy};w[{x:"y",y:"x"}[r.axis]]=0,Be(r.dragGroup,w.x,w.y),x(r.frames,(function(t){var e,n,i=t.element,a=t.initialBounds;"e"===r.direction?o(i,{width:ra(a.width+w.x,5)}):(e=ra(a.width-w.x,5),o(i,{width:e,x:a.x+a.width-e})),"s"===r.direction?o(i,{height:ra(a.height+w.y,5)}):(n=ra(a.height-w.y,5),o(i,{height:n,y:a.y+a.height-n}))}))}})),t.on("spaceTool.cleanup",(function(t){var e=t.context,n=e.movingShapes,o=e.movingConnections,i=e.resizingShapes,a=e.line,c=e.dragGroup,u=e.frameGroup;x(n,(function(t){s.removeMarker(t,oa)})),x(o,(function(t){s.removeMarker(t,oa)})),c&&(r(a),r(c)),x(i,(function(t){s.removeMarker(t,ia)})),u&&r(u)}))}aa.$inject=["eventBus","elementRegistry","canvas","styles","previewSupport"];const sa={__init__:["spaceToolPreview"],__depends__:[zo,No,Ur,Xi,Or],spaceTool:["type",Qr],spaceToolPreview:["type",aa]};function ca(t,e){this._handlerMap={},this._stack=[],this._stackIdx=-1,this._currentExecution={actions:[],dirty:[],trigger:null},this._injector=e,this._eventBus=t,this._uid=1,t.on(["diagram.destroy","diagram.clear"],(function(){this.clear(!1)}),this)}ca.$inject=["eventBus","injector"],ca.prototype.execute=function(t,e){if(!t)throw new Error("command required");this._currentExecution.trigger="execute";const n={command:t,context:e};this._pushAction(n),this._internalExecute(n),this._popAction()},ca.prototype.canExecute=function(t,e){const n={command:t,context:e},o=this._getHandler(t);let i=this._fire(t,"canExecute",n);if(void 0===i){if(!o)return!1;o.canExecute&&(i=o.canExecute(e))}return i},ca.prototype.clear=function(t){this._stack.length=0,this._stackIdx=-1,!1!==t&&this._fire("changed",{trigger:"clear"})},ca.prototype.undo=function(){let t,e=this._getUndoAction();if(e){for(this._currentExecution.trigger="undo",this._pushAction(e);e&&(this._internalUndo(e),t=this._getUndoAction(),t&&t.id===e.id);)e=t;this._popAction()}},ca.prototype.redo=function(){let t,e=this._getRedoAction();if(e){for(this._currentExecution.trigger="redo",this._pushAction(e);e&&(this._internalExecute(e,!0),t=this._getRedoAction(),t&&t.id===e.id);)e=t;this._popAction()}},ca.prototype.register=function(t,e){this._setHandler(t,e)},ca.prototype.registerHandler=function(t,e){if(!t||!e)throw new Error("command and handlerCls must be defined");const n=this._injector.instantiate(e);this.register(t,n)},ca.prototype.canUndo=function(){return!!this._getUndoAction()},ca.prototype.canRedo=function(){return!!this._getRedoAction()},ca.prototype._getRedoAction=function(){return this._stack[this._stackIdx+1]},ca.prototype._getUndoAction=function(){return this._stack[this._stackIdx]},ca.prototype._internalUndo=function(t){const e=t.command,n=t.context,o=this._getHandler(e);this._atomicDo((()=>{this._fire(e,"revert",t),o.revert&&this._markDirty(o.revert(n)),this._revertedAction(t),this._fire(e,"reverted",t)}))},ca.prototype._fire=function(t,e,n){arguments.length<3&&(n=e,e=null);const o=e?[t+"."+e,e]:[t];let i;n=this._eventBus.createEvent(n);for(const r of o)if(i=this._eventBus.fire("commandStack."+r,n),n.cancelBubble)break;return i},ca.prototype._createId=function(){return this._uid++},ca.prototype._atomicDo=function(t){const e=this._currentExecution;e.atomic=!0;try{t()}finally{e.atomic=!1}},ca.prototype._internalExecute=function(t,e){const n=t.command,o=t.context,i=this._getHandler(n);if(!i)throw new Error("no command handler registered for <"+n+">");this._pushAction(t),e||(this._fire(n,"preExecute",t),i.preExecute&&i.preExecute(o),this._fire(n,"preExecuted",t)),this._atomicDo((()=>{this._fire(n,"execute",t),i.execute&&this._markDirty(i.execute(o)),this._executedAction(t,e),this._fire(n,"executed",t)})),e||(this._fire(n,"postExecute",t),i.postExecute&&i.postExecute(o),this._fire(n,"postExecuted",t)),this._popAction()},ca.prototype._pushAction=function(t){const e=this._currentExecution,n=e.actions,o=n[0];if(e.atomic)throw new Error("illegal invocation in <execute> or <revert> phase (action: "+t.command+")");t.id||(t.id=o&&o.id||this._createId()),n.push(t)},ca.prototype._popAction=function(){const t=this._currentExecution,e=t.trigger,n=t.actions,o=t.dirty;n.pop(),n.length||(this._eventBus.fire("elements.changed",{elements:I("id",o.reverse())}),o.length=0,this._fire("changed",{trigger:e}),t.trigger=null)},ca.prototype._markDirty=function(t){const e=this._currentExecution;t&&(t=_(t)?t:[t],e.dirty=e.dirty.concat(t))},ca.prototype._executedAction=function(t,e){const n=++this._stackIdx;e||this._stack.splice(n,this._stack.length,t)},ca.prototype._revertedAction=function(t){this._stackIdx--},ca.prototype._getHandler=function(t){return this._handlerMap[t]},ca.prototype._setHandler=function(t,e){if(!t||!e)throw new Error("command and handler required");if(this._handlerMap[t])throw new Error("overriding handler for command <"+t+">");this._handlerMap[t]=e};const ua={commandStack:["type",ca]};function ha(t,e){if("function"!=typeof e)throw new Error("removeFn iterator must be a function");if(t){for(var n;n=t[0];)e(n);return t}}function la(t,e,n){Sn.call(this,e);var o=t.get("movePreview",!1);e.on("shape.move.start",1400,(function(t){var e=t.context,n=e.shapes,o=e.validatedShapes;e.shapes=pa(n),e.validatedShapes=pa(o)})),o&&e.on("shape.move.start",250,(function(t){var e=t.context,n=e.shapes,i=[];x(n,(function(t){x(t.labels,(function(n){n.hidden||-1!==e.shapes.indexOf(n)||i.push(n),t.labelTarget&&i.push(t)}))})),x(i,(function(t){o.makeDraggable(e,t,!0)}))})),this.preExecuted("elements.move",1400,(function(t){var e=t.context.closure,n=e.enclosedElements,o=[];x(n,(function(t){x(t.labels,(function(t){n[t.id]||o.push(t)}))})),e.addAll(o)})),this.preExecute(["connection.delete","shape.delete"],(function(t){var e=t.context;ha((e.connection||e.shape).labels,(function(t){n.removeShape(t,{nested:!0})}))})),this.execute("shape.delete",(function(t){var e=t.context,n=e.shape,o=n.labelTarget;o&&(e.labelTargetIndex=ie(o.labels,n),e.labelTarget=o,n.labelTarget=null)})),this.revert("shape.delete",(function(t){var e=t.context,n=e.shape,o=e.labelTarget,i=e.labelTargetIndex;o&&(oe(o.labels,n,i),n.labelTarget=o)}))}function pa(t){return w(t,(function(e){return-1===t.indexOf(e.labelTarget)}))}e(la,Sn),la.$inject=["injector","eventBus","modeling"];const da={__init__:["labelSupport"],labelSupport:["type",la]};var fa="attach-ok";function va(t,e,n,o,i){Sn.call(this,e);var r=t.get("movePreview",!1);e.on("shape.move.start",1401,(function(t){var e,n,o=t.context,i=o.shapes,r=o.validatedShapes;o.shapes=(n=ga(e=i),D("id",e,n)),o.validatedShapes=function(t){var e=E(t,"id");return w(t,(function(t){for(;t;){if(t.host&&e[t.host.id])return!1;t=t.parent}return!0}))}(r)})),r&&e.on("shape.move.start",251,(function(t){var e=t.context,n=ga(e.shapes);x(n,(function(t){r.makeDraggable(e,t,!0),x(t.labels,(function(t){r.makeDraggable(e,t,!0)}))}))})),r&&e.on("shape.move.start",(function(t){var o=t.context.shapes;if(1===o.length){var i=o[0].host;i&&(n.addMarker(i,fa),e.once(["shape.move.out","shape.move.cleanup"],(function(){n.removeMarker(i,fa)})))}})),this.preExecuted("elements.move",1401,(function(t){var e=t.context,n=e.closure,o=ga(e.shapes);x(o,(function(t){n.add(t,n.topLevel[t.host.id])}))})),this.postExecuted("elements.move",(function(t){var e,n=t.context,o=n.shapes,r=n.newHost;r&&1!==o.length||(e=r?o:w(o,(function(t){var e,n=t.host;return function(t){return!!t.host}(t)&&(e=n,!(-1!==o.indexOf(e)))})),x(e,(function(t){i.updateAttachment(t,r)})))})),this.postExecuted("elements.move",(function(t){var e=t.context.shapes;x(e,(function(t){x(t.attachers,(function(t){x(t.outgoing.slice(),(function(t){o.allowed("connection.reconnect",{connection:t,source:t.source,target:t.target})||i.removeConnection(t)})),x(t.incoming.slice(),(function(t){o.allowed("connection.reconnect",{connection:t,source:t.source,target:t.target})||i.removeConnection(t)}))}))}))})),this.postExecute("shape.create",(function(t){var e=t.context,n=e.shape,o=e.host;o&&i.updateAttachment(n,o)})),this.postExecute("shape.replace",(function(t){var e=t.context,n=e.oldShape,r=e.newShape;ha(n.attachers,(function(t){"attach"===o.allowed("elements.move",{target:r,shapes:[t]})?i.updateAttachment(t,r):i.removeShape(t)})),r.attachers.length&&x(r.attachers,(function(t){var e=lr(t,n,r);i.moveShape(t,e,t.parent)}))})),this.postExecute("shape.resize",(function(t){var e=t.context,n=e.shape,o=e.oldBounds,r=e.newBounds,a=n.attachers;!1!==(e.hints||{}).attachSupport&&x(a,(function(t){var e=lr(t,o,r);i.moveShape(t,e,t.parent),x(t.labels,(function(t){i.moveShape(t,e,t.parent)}))}))})),this.preExecute("shape.delete",(function(t){var e=t.context.shape;ha(e.attachers,(function(t){i.removeShape(t)})),e.host&&i.updateAttachment(e,null)}))}function ga(t){return L(z(t,(function(t){return t.attachers||[]})))}e(va,Sn),va.$inject=["injector","eventBus","canvas","rules","modeling"];const ya={__depends__:[No],__init__:["attachSupport"],attachSupport:["type",va]};function ma(t,e){this._modeling=t,this._canvas=e}function _a(t){this._modeling=t}function xa(t,e){this._canvas=t,this._layouter=e}ma.$inject=["modeling","canvas"],ma.prototype.preExecute=function(t){var e=this._modeling,n=t.elements,o=t.alignment;x(n,(function(t){var n={x:0,y:0};T(o.left)?n.x=o.left-t.x:T(o.right)?n.x=o.right-t.width-t.x:T(o.center)?n.x=o.center-Math.round(t.width/2)-t.x:T(o.top)?n.y=o.top-t.y:T(o.bottom)?n.y=o.bottom-t.height-t.y:T(o.middle)&&(n.y=o.middle-Math.round(t.height/2)-t.y),e.moveElements([t],n,t.parent)}))},ma.prototype.postExecute=function(t){},_a.$inject=["modeling"],_a.prototype.preExecute=function(t){var e=t.source;if(!e)throw new Error("source required");var n=t.target||e.parent,o=t.shape,i=t.hints||{};o=t.shape=this._modeling.createShape(o,t.position,n,{attach:i.attach}),t.shape=o},_a.prototype.postExecute=function(t){var e,n,o=t.hints||{};e=t.source,n=t.shape,B(e.outgoing,(function(t){return t.target===n}))||(o.connectionTarget===t.source?this._modeling.connect(t.shape,t.source,t.connection):this._modeling.connect(t.source,t.shape,t.connection))},xa.$inject=["canvas","layouter"],xa.prototype.execute=function(t){var e=t.connection,n=t.source,o=t.target,i=t.parent,r=t.parentIndex,a=t.hints;if(!n||!o)throw new Error("source and target required");if(!i)throw new Error("parent required");return e.source=n,e.target=o,e.waypoints||(e.waypoints=this._layouter.layoutConnection(e,a)),this._canvas.addConnection(e,i,r),e},xa.prototype.revert=function(t){var e=t.connection;return this._canvas.removeConnection(e),e.source=null,e.target=null,e};var wa=Math.round;function Ea(t){this._modeling=t}Ea.$inject=["modeling"],Ea.prototype.preExecute=function(t){var e=t.elements,n=t.parent,o=t.parentIndex,i=t.position,r=t.hints,a=this._modeling;x(e,(function(t){m(t.x)||(t.x=0),m(t.y)||(t.y=0)}));var s=Yt(w(e,(function(t){return!t.hidden})));x(e,(function(t){mt(t)&&(t.waypoints=z(t.waypoints,(function(t){return{x:wa(t.x-s.x-s.width/2+i.x),y:wa(t.y-s.y-s.height/2+i.y)}}))),b(t,{x:wa(t.x-s.x-s.width/2+i.x),y:wa(t.y-s.y-s.height/2+i.y)})}));var c=Ft(e),u={};x(e,(function(t){if(mt(t))u[t.id]=m(o)?a.createConnection(u[t.source.id],u[t.target.id],o,t,t.parent||n,r):a.createConnection(u[t.source.id],u[t.target.id],t,t.parent||n,r);else{var e=b({},r);-1===c.indexOf(t)&&(e.autoResize=!1),_t(t)&&(e=P(e,["attach"])),u[t.id]=m(o)?a.createShape(t,$(t,["x","y","width","height"]),t.parent||n,o,e):a.createShape(t,$(t,["x","y","width","height"]),t.parent||n,e)}})),t.elements=O(u)};var ba=Math.round;function Sa(t){this._canvas=t}function Ca(t){Sa.call(this,t)}Sa.$inject=["canvas"],Sa.prototype.execute=function(t){var e=t.shape,n=t.position,o=t.parent,i=t.parentIndex;if(!o)throw new Error("parent required");if(!n)throw new Error("position required");return void 0!==n.width?b(e,n):b(e,{x:n.x-ba(e.width/2),y:n.y-ba(e.height/2)}),this._canvas.addShape(e,o,i),e},Sa.prototype.revert=function(t){var e=t.shape;return this._canvas.removeShape(e),e},e(Ca,Sa),Ca.$inject=["canvas"];var ka=Sa.prototype.execute;Ca.prototype.execute=function(t){var e=t.shape;return function(t){["width","height"].forEach((function(e){void 0===t[e]&&(t[e]=0)}))}(e),e.labelTarget=t.labelTarget,ka.call(this,t)};var Ma=Sa.prototype.revert;function ja(t,e){this._canvas=t,this._modeling=e}function Ra(t,e){this._modeling=t,this._elementRegistry=e}function Ta(t,e){this._canvas=t,this._modeling=e}function Ba(t){this._modeling=t}Ca.prototype.revert=function(t){return t.shape.labelTarget=null,Ma.call(this,t)},ja.$inject=["canvas","modeling"],ja.prototype.preExecute=function(t){var e=this._modeling,n=t.connection;ha(n.incoming,(function(t){e.removeConnection(t,{nested:!0})})),ha(n.outgoing,(function(t){e.removeConnection(t,{nested:!0})}))},ja.prototype.execute=function(t){var e=t.connection,n=e.parent;return t.parent=n,t.parentIndex=ie(n.children,e),t.source=e.source,t.target=e.target,this._canvas.removeConnection(e),e.source=null,e.target=null,e},ja.prototype.revert=function(t){var e=t.connection,n=t.parent,o=t.parentIndex;return e.source=t.source,e.target=t.target,oe(n.children,e,o),this._canvas.addConnection(e,n),e},Ra.$inject=["modeling","elementRegistry"],Ra.prototype.postExecute=function(t){var e=this._modeling,n=this._elementRegistry,o=t.elements;x(o,(function(t){n.get(t.id)&&(t.waypoints?e.removeConnection(t):e.removeShape(t))}))},Ta.$inject=["canvas","modeling"],Ta.prototype.preExecute=function(t){var e=this._modeling,n=t.shape;ha(n.incoming,(function(t){e.removeConnection(t,{nested:!0})})),ha(n.outgoing,(function(t){e.removeConnection(t,{nested:!0})})),ha(n.children,(function(t){mt(t)?e.removeConnection(t,{nested:!0}):e.removeShape(t,{nested:!0})}))},Ta.prototype.execute=function(t){var e=this._canvas,n=t.shape,o=n.parent;return t.oldParent=o,t.oldParentIndex=ie(o.children,n),e.removeShape(n),n},Ta.prototype.revert=function(t){var e=this._canvas,n=t.shape,o=t.oldParent,i=t.oldParentIndex;return oe(o.children,n,i),e.addShape(n,o),n},Ba.$inject=["modeling"];var Pa={x:"y",y:"x"};function La(t,e){this._layouter=t,this._canvas=e}function Oa(){}function $a(){this.allShapes={},this.allConnections={},this.enclosedElements={},this.enclosedConnections={},this.topLevel={}}function Aa(t){this._modeling=t}function za(t){this._helper=new Aa(t)}function Ia(t){this._modeling=t,this._helper=new Aa(t)}function Da(t){this._modeling=t}function Ha(t){return t.original||t}function Ga(t,e){this._modeling=t,this._rules=e}function Na(t){this._modeling=t}function Va(t){this._modeling=t}function Ua(t){return b({},t)}function Fa(t){switch(t){case"n":case"s":return"y";case"w":case"e":return"x"}}function Wa(t,e,n){var o=Fa(n);return/e|s/.test(n)?t[o]>e:/n|w/.test(n)?t[o]<e:void 0}function Ka(t,e){return-1!==t.indexOf(e)}function qa(t){this._modeling=t}function Za(t){var e={};return x(t,(function(t){e[t.id]=t.hidden,t.children&&(e=b({},e,Za(t.children)))})),e}function Ya(t,e){var n=[];return x(t,(function(t){t.hidden=e,n=n.concat(t),t.children&&(n=n.concat(Ya(t.children,t.collapsed||e)))})),n}function Xa(t,e){var n=[];return x(t,(function(t){t.hidden=e[t.id],n=n.concat(t),t.children&&(n=n.concat(Xa(t.children,e)))})),n}function Ja(t){this._modeling=t}function Qa(t,e){return ne(t&&t.attachers,e)}function ts(t,e,n){if(t){var o=t.attachers;o||(t.attachers=o=[]),oe(o,e,n)}}function es(){}function ns(t,e,n){this._eventBus=t,this._elementFactory=e,this._commandStack=n;var o=this;t.on("diagram.init",(function(){o.registerHandlers(n)}))}function os(){}Ba.prototype.preExecute=function(t){var e=this._modeling,n=t.groups,o=t.axis,i=t.dimension;function r(t,e){t.range.min=Math.min(e[o],t.range.min),t.range.max=Math.max(e[o]+e[i],t.range.max)}function a(t){return t[o]+t[i]/2}function s(t){return t.length-1}function c(t){return t.max-t.min}var u,h,l=n[0],p=s(n),d=n[p],f=0;x(n,(function(t,u){var h,l,d;t.elements.length<2?u&&u!==n.length-1&&(r(t,t.elements[0]),f+=c(t.range)):(l=(h=v(t.elements,o))[0],u===p&&(l=h[s(h)]),d=a(l),t.range=null,x(h,(function(n){!function(t,n){var i={y:0};i[o]=t-a(n),i[o]&&(i[Pa[o]]=0,e.moveElements([n],i,n.parent))}(d,n),null!==t.range?r(t,n):t.range={min:n[o],max:n[o]+n[i]}})),u&&u!==n.length-1&&(f+=c(t.range)))})),h=Math.abs(d.range.min-l.range.max),(u=Math.round((h-f)/(n.length-1)))<n.length-1||x(n,(function(t,r){var a,s={};t!==l&&t!==d&&(a=n[r-1],t.range.max=0,x(t.elements,(function(n,r){s[Pa[o]]=0,s[o]=a.range.max-n[o]+u,t.range.min!==n[o]&&(s[o]+=n[o]-t.range.min),s[o]&&e.moveElements([n],s,n.parent),t.range.max=Math.max(n[o]+n[i],r?t.range.max:0)})))}))},Ba.prototype.postExecute=function(t){},La.$inject=["layouter","canvas"],La.prototype.execute=function(t){var e=t.connection,n=e.waypoints;return b(t,{oldWaypoints:n}),e.waypoints=this._layouter.layoutConnection(e,t.hints),e},La.prototype.revert=function(t){var e=t.connection;return e.waypoints=t.oldWaypoints,e},Oa.prototype.execute=function(t){var e=t.connection,n=t.delta,o=t.newParent||e.parent,i=t.newParentIndex,r=e.parent;return t.oldParent=r,t.oldParentIndex=ne(r.children,e),oe(o.children,e,i),e.parent=o,x(e.waypoints,(function(t){t.x+=n.x,t.y+=n.y,t.original&&(t.original.x+=n.x,t.original.y+=n.y)})),e},Oa.prototype.revert=function(t){var e=t.connection,n=e.parent,o=t.oldParent,i=t.oldParentIndex,r=t.delta;return ne(n.children,e),oe(o.children,e,i),e.parent=o,x(e.waypoints,(function(t){t.x-=r.x,t.y-=r.y,t.original&&(t.original.x-=r.x,t.original.y-=r.y)})),e},$a.prototype.add=function(t,e){return this.addAll([t],e)},$a.prototype.addAll=function(t,e){var n=function(t,e,n){S(e)&&(e=!0),d(e)&&(n=e,e=!0);var o=Qt((n=n||{}).allShapes),i=Qt(n.allConnections),r=Qt(n.enclosedElements),a=Qt(n.enclosedConnections),s=Qt(n.topLevel,e&&E(t,(function(t){return t.id})));function c(t){s[t.source.id]&&s[t.target.id]&&(s[t.id]=[t]),o[t.source.id]&&o[t.target.id]&&(a[t.id]=r[t.id]=t),i[t.id]=t}return qt(t,(function(t){if(r[t.id]=t,!t.waypoints)return o[t.id]=t,x(t.incoming,c),x(t.outgoing,c),t.children;a[t.id]=i[t.id]=t})),{allShapes:o,allConnections:i,topLevel:s,enclosedConnections:a,enclosedElements:r}}(t,!!e,this);return b(this,n),this},Aa.prototype.moveRecursive=function(t,e,n){return t?this.moveClosure(this.getClosure(t),e,n):[]},Aa.prototype.moveClosure=function(t,e,n,o,i){var r=this._modeling,a=t.allShapes,s=t.allConnections,c=t.enclosedConnections,u=t.topLevel,h=!1;i&&i.parent===n&&(h=!0),x(a,(function(t){r.moveShape(t,e,u[t.id]&&!h&&n,{recurse:!1,layout:!1})})),x(s,(function(t){var o=!!a[t.source.id],i=!!a[t.target.id];c[t.id]&&o&&i?r.moveConnection(t,e,u[t.id]&&!h&&n):r.layoutConnection(t,{connectionStart:o&&fr(t,t.source,e),connectionEnd:i&&vr(t,t.target,e)})}))},Aa.prototype.getClosure=function(t){return(new $a).addAll(t,!0)},za.$inject=["modeling"],za.prototype.preExecute=function(t){t.closure=this._helper.getClosure(t.shapes)},za.prototype.postExecute=function(t){var e,n=t.hints;n&&n.primaryShape&&(e=n.primaryShape,n.oldParent=e.parent),this._helper.moveClosure(t.closure,t.delta,t.newParent,t.newHost,e)},Ia.$inject=["modeling"],Ia.prototype.execute=function(t){var e=t.shape,n=t.delta,o=t.newParent||e.parent,i=t.newParentIndex,r=e.parent;return t.oldBounds=$(e,["x","y","width","height"]),t.oldParent=r,t.oldParentIndex=ne(r.children,e),oe(o.children,e,i),b(e,{parent:o,x:e.x+n.x,y:e.y+n.y}),e},Ia.prototype.postExecute=function(t){var e=t.shape,n=t.delta,o=t.hints,i=this._modeling;!1!==o.layout&&(x(e.incoming,(function(t){i.layoutConnection(t,{connectionEnd:vr(t,e,n)})})),x(e.outgoing,(function(t){i.layoutConnection(t,{connectionStart:fr(t,e,n)})}))),!1!==o.recurse&&this.moveChildren(t)},Ia.prototype.revert=function(t){var e=t.shape,n=t.oldParent,o=t.oldParentIndex,i=t.delta;return oe(n.children,e,o),b(e,{parent:n,x:e.x-i.x,y:e.y-i.y}),e},Ia.prototype.moveChildren=function(t){var e=t.delta,n=t.shape;this._helper.moveRecursive(n.children,e,null)},Ia.prototype.getNewParent=function(t){return t.newParent||t.shape.parent},Da.$inject=["modeling"],Da.prototype.execute=function(t){var e=t.newSource,n=t.newTarget,o=t.connection,i=t.dockingOrPoints;if(!e&&!n)throw new Error("newSource or newTarget required");return _(i)&&(t.oldWaypoints=o.waypoints,o.waypoints=i),e&&(t.oldSource=o.source,o.source=e),n&&(t.oldTarget=o.target,o.target=n),o},Da.prototype.postExecute=function(t){var e=t.connection,n=t.newSource,o=t.newTarget,i=t.dockingOrPoints,r=t.hints||{},a={};r.connectionStart&&(a.connectionStart=r.connectionStart),r.connectionEnd&&(a.connectionEnd=r.connectionEnd),!1!==r.layoutConnection&&(!n||o&&"source"!==r.docking||(a.connectionStart=a.connectionStart||Ha(_(i)?i[0]:i)),!o||n&&"target"!==r.docking||(a.connectionEnd=a.connectionEnd||Ha(_(i)?i[i.length-1]:i)),r.newWaypoints&&(a.waypoints=r.newWaypoints),this._modeling.layoutConnection(e,a))},Da.prototype.revert=function(t){var e=t.oldSource,n=t.oldTarget,o=t.oldWaypoints,i=t.connection;return e&&(i.source=e),n&&(i.target=n),o&&(i.waypoints=o),i},Ga.$inject=["modeling","rules"],Ga.prototype.preExecute=function(t){var e,n=this,o=this._modeling,i=this._rules,r=t.oldShape,a=t.newData,s=t.hints||{};function c(t,e,n){return i.allowed("connection.reconnect",{connection:n,source:t,target:e})}var u,h={x:a.x,y:a.y},l={x:r.x,y:r.y,width:r.width,height:r.height};e=t.newShape=t.newShape||n.createShape(a,h,r.parent,s),r.host&&o.updateAttachment(e,r.host),!1!==s.moveChildren&&(u=r.children.slice(),o.moveElements(u,{x:0,y:0},e,s));var p=r.incoming.slice(),d=r.outgoing.slice();x(p,(function(t){c(t.source,e,t)&&n.reconnectEnd(t,e,dr(t,e,l),s)})),x(d,(function(t){var o=t.target;c(e,o,t)&&n.reconnectStart(t,e,pr(t,e,l),s)}))},Ga.prototype.postExecute=function(t){var e=t.oldShape;this._modeling.removeShape(e)},Ga.prototype.execute=function(t){},Ga.prototype.revert=function(t){},Ga.prototype.createShape=function(t,e,n,o){return this._modeling.createShape(t,e,n,o)},Ga.prototype.reconnectStart=function(t,e,n,o){this._modeling.reconnectStart(t,e,n,o)},Ga.prototype.reconnectEnd=function(t,e,n,o){this._modeling.reconnectEnd(t,e,n,o)},Na.$inject=["modeling"],Na.prototype.execute=function(t){var e=t.shape,n=t.newBounds,o=t.minBounds;if(void 0===n.x||void 0===n.y||void 0===n.width||void 0===n.height)throw new Error("newBounds must have {x, y, width, height} properties");if(o&&(n.width<o.width||n.height<o.height))throw new Error("width and height cannot be less than minimum height and width");if(!o&&n.width<10||n.height<10)throw new Error("width and height cannot be less than 10px");return t.oldBounds={width:e.width,height:e.height,x:e.x,y:e.y},b(e,{width:n.width,height:n.height,x:n.x,y:n.y}),e},Na.prototype.postExecute=function(t){var e=this._modeling,n=t.shape,o=t.oldBounds;!1!==(t.hints||{}).layout&&(x(n.incoming,(function(t){e.layoutConnection(t,{connectionEnd:dr(t,n,o)})})),x(n.outgoing,(function(t){e.layoutConnection(t,{connectionStart:pr(t,n,o)})})))},Na.prototype.revert=function(t){var e=t.shape,n=t.oldBounds;return b(e,{width:n.width,height:n.height,x:n.x,y:n.y}),e},Va.$inject=["modeling"],Va.prototype.preExecute=function(t){var e=t.delta,n=t.direction,o=t.movingShapes,i=t.resizingShapes,r=t.start,a={};this.moveShapes(o,e),x(i,(function(t){a[t.id]=function(t){return{x:t.x,y:t.y,height:t.height,width:t.width}}(t)})),this.resizeShapes(i,e,n),this.updateConnectionWaypoints(function(t,e){var n=[];return x(t.concat(e),(function(o){var i=o.incoming,r=o.outgoing;x(i.concat(r),(function(o){var i=o.source,r=o.target;(Fr(t,i)||Fr(t,r)||Fr(e,i)||Fr(e,r))&&(Fr(n,o)||n.push(o))}))})),n}(o,i),e,n,r,o,i,a)},Va.prototype.execute=function(){},Va.prototype.revert=function(){},Va.prototype.moveShapes=function(t,e){var n=this;x(t,(function(t){n._modeling.moveShape(t,e,null,{autoResize:!1,layout:!1,recurse:!1})}))},Va.prototype.resizeShapes=function(t,e,n){var o=this;x(t,(function(t){var i=function(t,e,n){var o=t.x,i=t.y,r=t.width,a=t.height,s=n.x,c=n.y;switch(e){case"n":return{x:o,y:i+c,width:r,height:a-c};case"s":return{x:o,y:i,width:r,height:a+c};case"w":return{x:o+s,y:i,width:r-s,height:a};case"e":return{x:o,y:i,width:r+s,height:a};default:throw new Error("unknown direction: "+e)}}(t,n,e);o._modeling.resizeShape(t,i,null,{attachSupport:!1,autoResize:!1,layout:!1})}))},Va.prototype.updateConnectionWaypoints=function(t,e,n,o,i,r,a){var s=this,c=i.concat(r);x(t,(function(t){var u=t.source,h=t.target,l=function(t){return z(t.waypoints,(function(t){return(t=Ua(t)).original&&(t.original=Ua(t.original)),t}))}(t),p=Fa(n),d={};Ka(c,u)&&Ka(c,h)?(l=z(l,(function(t){return Wa(t,o,n)&&(t[p]=t[p]+e[p]),t.original&&Wa(t.original,o,n)&&(t.original[p]=t.original[p]+e[p]),t})),s._modeling.updateWaypoints(t,l,{labelBehavior:!1})):(Ka(c,u)||Ka(c,h))&&(Ka(i,u)?d.connectionStart=fr(t,u,e):Ka(i,h)?d.connectionEnd=vr(t,h,e):Ka(r,u)?d.connectionStart=pr(t,u,a[u.id]):Ka(r,h)&&(d.connectionEnd=dr(t,h,a[h.id])),s._modeling.layoutConnection(t,d))}))},qa.$inject=["modeling"],qa.prototype.execute=function(t){var e=t.shape,n=e.children;t.oldChildrenVisibility=Za(n),e.collapsed=!e.collapsed;var o=Ya(n,e.collapsed);return[e].concat(o)},qa.prototype.revert=function(t){var e=t.shape,n=t.oldChildrenVisibility,o=Xa(e.children,n);return e.collapsed=!e.collapsed,[e].concat(o)},Ja.$inject=["modeling"],Ja.prototype.execute=function(t){var e=t.shape,n=t.newHost,o=e.host;return t.oldHost=o,t.attacherIdx=Qa(o,e),ts(n,e),e.host=n,e},Ja.prototype.revert=function(t){var e=t.shape,n=t.newHost,o=t.oldHost,i=t.attacherIdx;return e.host=o,Qa(n,e),ts(o,e,i),e},es.prototype.execute=function(t){var e=t.connection,n=t.newWaypoints;return t.oldWaypoints=e.waypoints,e.waypoints=n,e},es.prototype.revert=function(t){var e=t.connection,n=t.oldWaypoints;return e.waypoints=n,e},ns.$inject=["eventBus","elementFactory","commandStack"],ns.prototype.getHandlers=function(){return{"shape.append":_a,"shape.create":Sa,"shape.delete":Ta,"shape.move":Ia,"shape.resize":Na,"shape.replace":Ga,"shape.toggleCollapse":qa,spaceTool:Va,"label.create":Ca,"connection.create":xa,"connection.delete":ja,"connection.move":Oa,"connection.layout":La,"connection.updateWaypoints":es,"connection.reconnect":Da,"elements.create":Ea,"elements.move":za,"elements.delete":Ra,"elements.distribute":Ba,"elements.align":ma,"element.updateAttachment":Ja}},ns.prototype.registerHandlers=function(t){x(this.getHandlers(),(function(e,n){t.registerHandler(n,e)}))},ns.prototype.moveShape=function(t,e,n,o,i){"object"==typeof o&&(i=o,o=null);var r={shape:t,delta:e,newParent:n,newParentIndex:o,hints:i||{}};this._commandStack.execute("shape.move",r)},ns.prototype.updateAttachment=function(t,e){var n={shape:t,newHost:e};this._commandStack.execute("element.updateAttachment",n)},ns.prototype.moveElements=function(t,e,n,o){var i,r=(o=o||{}).attach,a=n;!0===r?(i=n,a=n.parent):!1===r&&(i=null);var s={shapes:t,delta:e,newParent:a,newHost:i,hints:o};this._commandStack.execute("elements.move",s)},ns.prototype.moveConnection=function(t,e,n,o,i){"object"==typeof o&&(i=o,o=void 0);var r={connection:t,delta:e,newParent:n,newParentIndex:o,hints:i||{}};this._commandStack.execute("connection.move",r)},ns.prototype.layoutConnection=function(t,e){var n={connection:t,hints:e||{}};this._commandStack.execute("connection.layout",n)},ns.prototype.createConnection=function(t,e,n,o,i,r){"object"==typeof n&&(r=i,i=o,o=n,n=void 0);var a={source:t,target:e,parent:i,parentIndex:n,connection:o=this._create("connection",o),hints:r};return this._commandStack.execute("connection.create",a),a.connection},ns.prototype.createShape=function(t,e,n,o,i){"number"!=typeof o&&(i=o,o=void 0);var r,a,s=(i=i||{}).attach;t=this._create("shape",t),s?(r=n.parent,a=n):r=n;var c={position:e,shape:t,parent:r,parentIndex:o,host:a,hints:i};return this._commandStack.execute("shape.create",c),c.shape},ns.prototype.createElements=function(t,e,n,o,i){_(t)||(t=[t]),"number"!=typeof o&&(i=o,o=void 0);var r={position:e,elements:t,parent:n,parentIndex:o,hints:i=i||{}};return this._commandStack.execute("elements.create",r),r.elements},ns.prototype.createLabel=function(t,e,n,o){n=this._create("label",n);var i={labelTarget:t,position:e,parent:o||t.parent,shape:n};return this._commandStack.execute("label.create",i),i.shape},ns.prototype.appendShape=function(t,e,n,o,i){i=i||{};var r={source:t,position:n,target:o,shape:e=this._create("shape",e),connection:i.connection,connectionParent:i.connectionParent,hints:i};return this._commandStack.execute("shape.append",r),r.shape},ns.prototype.removeElements=function(t){var e={elements:t};this._commandStack.execute("elements.delete",e)},ns.prototype.distributeElements=function(t,e,n){var o={groups:t,axis:e,dimension:n};this._commandStack.execute("elements.distribute",o)},ns.prototype.removeShape=function(t,e){var n={shape:t,hints:e||{}};this._commandStack.execute("shape.delete",n)},ns.prototype.removeConnection=function(t,e){var n={connection:t,hints:e||{}};this._commandStack.execute("connection.delete",n)},ns.prototype.replaceShape=function(t,e,n){var o={oldShape:t,newData:e,hints:n||{}};return this._commandStack.execute("shape.replace",o),o.newShape},ns.prototype.alignElements=function(t,e){var n={elements:t,alignment:e};this._commandStack.execute("elements.align",n)},ns.prototype.resizeShape=function(t,e,n,o){var i={shape:t,newBounds:e,minBounds:n,hints:o};this._commandStack.execute("shape.resize",i)},ns.prototype.createSpace=function(t,e,n,o,i){var r={delta:n,direction:o,movingShapes:t,resizingShapes:e,start:i};this._commandStack.execute("spaceTool",r)},ns.prototype.updateWaypoints=function(t,e,n){var o={connection:t,newWaypoints:e,hints:n||{}};this._commandStack.execute("connection.updateWaypoints",o)},ns.prototype.reconnect=function(t,e,n,o,i){var r={connection:t,newSource:e,newTarget:n,dockingOrPoints:o,hints:i||{}};this._commandStack.execute("connection.reconnect",r)},ns.prototype.reconnectStart=function(t,e,n,o){o||(o={}),this.reconnect(t,e,t.target,n,b(o,{docking:"source"}))},ns.prototype.reconnectEnd=function(t,e,n,o){o||(o={}),this.reconnect(t,t.source,e,n,b(o,{docking:"target"}))},ns.prototype.connect=function(t,e,n,o){return this.createConnection(t,e,n||{},t.parent,o)},ns.prototype._create=function(t,e){return e instanceof me?e:this._elementFactory.create(t,e)},ns.prototype.toggleCollapse=function(t,e){var n={shape:t,hints:e||{}};this._commandStack.execute("shape.toggleCollapse",n)},os.prototype.layoutConnection=function(t,e){return[(e=e||{}).connectionStart||Ct(e.source||t.source),e.connectionEnd||Ct(e.target||t.target)]};var is=20,rs=5,as=Math.round,ss=20,cs={"h:h":20,"v:v":20,"h:v":-10,"v:h":-10};function us(t,e,n){var o,i,r,a=kt(e,t,rs),s=n.split(":")[0],c=as((e.x-t.x)/2+t.x),u=as((e.y-t.y)/2+t.y),h=(r=a,{t:/top/,r:/right/,b:/bottom/,l:/left/,h:/left|right/,v:/top|bottom/}[s].test(r)),l=/h|r|l/.test(s),p=!1,d=!1;return h?(o=l?{x:c,y:t.y}:{x:t.x,y:u},i=l?"h:h":"v:v"):(p=function(t,e){return!{t:/top/,r:/right/,b:/bottom/,l:/left/,h:/./,v:/./}[e].test(t)}(a,s),i=l?"h:v":"v:h",p?l?(d=u===t.y,o={x:t.x+is*(/l/.test(s)?-1:1),y:d?u+is:u}):o={x:(d=c===t.x)?c+is:c,y:t.y+is*(/t/.test(s)?-1:1)}:o={x:c,y:u}),{waypoints:ls(t,o,i).concat(o),directions:i,turnNextDirections:d}}function hs(t){return t.split(":").reverse().join(":")}function ls(t,e,n){if(!function(t){return t&&/^h|v|t|r|b|l:h|v|t|r|b|l$/.test(t)}(n=n||"h:h"))throw new Error("unknown directions: <"+n+">: must be specified as <start>:<end> with start/end in { h,v,t,r,b,l }");if(gs(n)){var o=function(t,e,n){return us(t,e,n)}(t,e,n),i=function(t,e,n){var o=us(e,t,hs(n));return{waypoints:o.waypoints.slice().reverse(),directions:hs(o.directions),turnNextDirections:o.turnNextDirections}}(t,e,n),r=function(t,e){var n=t.directions.split(":")[1],o=e.directions.split(":")[0];t.turnNextDirections&&(n="h"==n?"v":"h"),e.turnNextDirections&&(o="h"==o?"v":"h");var i=n+":"+o;return{waypoints:ls(t.waypoints[t.waypoints.length-1],e.waypoints[0],i),directions:i}}(o,i);return[].concat(o.waypoints,r.waypoints,i.waypoints)}return function(t,e,n){var o=as((e.x-t.x)/2+t.x),i=as((e.y-t.y)/2+t.y);if("h:v"===n)return[{x:e.x,y:t.y}];if("v:h"===n)return[{x:t.x,y:e.y}];if("h:h"===n)return[{x:o,y:t.y},{x:o,y:e.y}];if("v:v"===n)return[{x:t.x,y:i},{x:e.x,y:i}];throw new Error("invalid directions: can only handle varians of [hv]:[hv]")}(t,e,n)}function ps(t,e,n,o,i){var r=i&&i.preferredLayouts||[],a=H(r,"straight")[0]||"h:h",s=kt(t,e,cs[a]||0),c=function(t,e){if(gs(e))return e;switch(t){case"intersect":return"t:t";case"top":case"bottom":return"v:v";case"left":case"right":return"h:h";default:return e}}(s,a);n=n||Ct(t),o=o||Ct(e);var u=c.split(":"),h=ys(n,t,u[0],function(t){return{top:"bottom",bottom:"top",left:"right",right:"left","top-left":"bottom-right","bottom-right":"top-left","top-right":"bottom-left","bottom-left":"top-right"}[t]}(s));return function(t,e,n){var o=ls(t,e,n);return o.unshift(t),o.push(e),ms(o)}(h,ys(o,e,u[1],s),c)}function ds(t,e,n,o,i,r){var a;return _(n)&&(i=n,r=o,n=Ct(t),o=Ct(e)),i=i||[],a=-1!==(r=b({preferredLayouts:[]},r)).preferredLayouts.indexOf("straight")&&function(t,e,n,o,i){var r,a,s={};if(a=kt(t,e),!/^(top|bottom|left|right)$/.test(a))return null;/top|bottom/.test(a)&&(r="x");/left|right/.test(a)&&(r="y");return"target"===i.preserveDocking?fs(r,o,t)?(s[r]=o[r],[{x:void 0!==s.x?s.x:n.x,y:void 0!==s.y?s.y:n.y,original:{x:void 0!==s.x?s.x:n.x,y:void 0!==s.y?s.y:n.y}},{x:o.x,y:o.y}]):null:fs(r,n,e)?(s[r]=n[r],[{x:n.x,y:n.y},{x:void 0!==s.x?s.x:o.x,y:void 0!==s.y?s.y:o.y,original:{x:void 0!==s.x?s.x:o.x,y:void 0!==s.y?s.y:o.y}}]):null}(t,e,n,o,r),a||(a=r.connectionEnd&&function(t,e,n,o){var i=o.slice().reverse();return i=vs(t,e,n,i),i?i.reverse():null}(e,t,o,i),a||((a=r.connectionStart&&vs(t,e,n,i))||(!r.connectionStart&&!r.connectionEnd&&i&&i.length?i:ps(t,e,n,o,r))))}function fs(t,e,n){return function(t,e,n){return t>=e&&t<=n}(e[t],n[t],n[t]+n[{x:"width",y:"height"}[t]])}function vs(t,e,n,o){if((i=o).length<3||!(i.length>4)&&g(i,(function(t,e){var n=i[e-1];return n&&lt(t,n)<3})))return null;var i,r,a=o[0],s=o.slice();return s[0]=n,s[1]=function(t,e,n){switch(ft(e,t)){case"v":return{x:n.x,y:t.y};case"h":return{x:t.x,y:n.y}}return{x:t.x,y:t.y}}(s[1],a,n),r=function(t,e,n){var o;for(o=t.length-2;0!==o;o--)if(gt(t[o],e,ss)||gt(t[o],n,ss))return t.slice(o);return t}(s,t,e),r!==s&&(s=vs(t,e,n,r)),s&&ft(s)?null:s}function gs(t){return t&&/t|r|b|l/.test(t)}function ys(t,e,n,o){if("h"===n&&(n=/left/.test(o)?"l":"r"),"v"===n&&(n=/top/.test(o)?"t":"b"),"t"===n)return{original:t,x:t.x,y:e.y};if("r"===n)return{original:t,x:e.x+e.width,y:t.y};if("b"===n)return{original:t,x:t.x,y:e.y+e.height};if("l"===n)return{original:t,x:e.x,y:t.y};throw new Error("unexpected dockingDirection: <"+n+">")}function ms(t){return t.reduce((function(e,n,o){return pt(e[e.length-1],t[o+1],n,0)||e.push(n),e}),[])}function _s(t){return b({original:t.point.original||t.point},t.actual)}function xs(t,e){this._elementRegistry=t,this._graphicsFactory=e}xs.$inject=["elementRegistry","graphicsFactory"],xs.prototype.getCroppedWaypoints=function(t,e,n){e=e||t.source,n=n||t.target;var o=this.getDockingPoint(t,e,!0),i=this.getDockingPoint(t,n),r=t.waypoints.slice(o.idx+1,i.idx);return r.unshift(_s(o)),r.push(_s(i)),r},xs.prototype.getDockingPoint=function(t,e,n){var o,i,r=t.waypoints;return{point:i=r[o=n?0:r.length-1],actual:this._getIntersection(e,t,n)||i,idx:o}},xs.prototype._getIntersection=function(t,e,n){return Mt(this._getShapePath(t),this._getConnectionPath(e),n)},xs.prototype._getConnectionPath=function(t){return this._graphicsFactory.getConnectionPath(t)},xs.prototype._getShapePath=function(t){return this._graphicsFactory.getShapePath(t)},xs.prototype._getGfx=function(t){return this._elementRegistry.getGraphics(t)};var ws={horizontal:["x","width"],vertical:["y","height"]};function Es(t,e){this._modeling=t,this._filters=[],this.registerFilter((function(t){var n=e.allowed("elements.distribute",{elements:t});return _(n)?n:n?t:[]}))}Es.$inject=["modeling","rules"],Es.prototype.registerFilter=function(t){if("function"!=typeof t)throw new Error("the filter has to be a function");this._filters.push(t)},Es.prototype.trigger=function(t,e){var n,o,i=this._modeling;if(!(t.length<3||(this._setOrientation(e),o=this._filterElements(t),(n=this._createGroups(o)).length<=2)))return i.distributeElements(n,this._axis,this._dimension),n},Es.prototype._filterElements=function(t){var e=this._filters,n=this._axis,o=this._dimension,i=[].concat(t);return e.length?(x(e,(function(t){i=t(i,n,o)})),i):t},Es.prototype._createGroups=function(t){var e=[],n=this,o=this._axis,i=this._dimension;if(!o)throw new Error('must have a defined "axis" and "dimension"');var r=v(t,o);return x(r,(function(t,r){var a,s=n._findRange(t,o,i),c=e[e.length-1];c&&n._hasIntersection(c.range,s)?e[e.length-1].elements.push(t):(a={range:s,elements:[t]},e.push(a))})),e},Es.prototype._setOrientation=function(t){var e=ws[t];this._axis=e[0],this._dimension=e[1]},Es.prototype._hasIntersection=function(t,e){return Math.max(t.min,t.max)>=Math.min(e.min,e.max)&&Math.min(t.min,t.max)<=Math.max(e.min,e.max)},Es.prototype._findRange=function(t){var e=t[this._axis];return{min:e+5,max:e+t[this._dimension]-5}};const bs={__init__:["distributeElements"],distributeElements:["type",Es]};var Ss="is not a registered action";function Cs(t,e){this._actions={};var n=this;t.on("diagram.init",(function(){n._registerDefaultActions(e),t.fire("editorActions.init",{editorActions:n})}))}function ks(t,e){return new Error(t+" "+e)}Cs.$inject=["eventBus","injector"],Cs.prototype._registerDefaultActions=function(t){var e=t.get("commandStack",!1),n=t.get("modeling",!1),o=t.get("selection",!1),i=t.get("zoomScroll",!1),r=t.get("copyPaste",!1),a=t.get("canvas",!1),s=t.get("rules",!1),c=t.get("keyboardMove",!1),u=t.get("keyboardMoveSelection",!1);e&&(this.register("undo",(function(){e.undo()})),this.register("redo",(function(){e.redo()}))),r&&o&&this.register("copy",(function(){var t=o.get();if(t.length)return r.copy(t)})),r&&this.register("paste",(function(){r.paste()})),i&&this.register("stepZoom",(function(t){i.stepZoom(t.value)})),a&&this.register("zoom",(function(t){a.zoom(t.value)})),n&&o&&s&&this.register("removeSelection",(function(){var t=o.get();if(t.length){var e,i=s.allowed("elements.delete",{elements:t});!1!==i&&(e=_(i)?i:t).length&&n.removeElements(e.slice())}})),c&&this.register("moveCanvas",(function(t){c.moveCanvas(t)})),u&&this.register("moveSelection",(function(t){u.moveSelection(t.direction,t.accelerated)}))},Cs.prototype.trigger=function(t,e){if(!this._actions[t])throw ks(t,Ss);return this._actions[t](e)},Cs.prototype.register=function(t,e){var n=this;if("string"==typeof t)return this._registerAction(t,e);x(t,(function(t,e){n._registerAction(e,t)}))},Cs.prototype._registerAction=function(t,e){if(this.isRegistered(t))throw ks(t,"is already registered");this._actions[t]=e},Cs.prototype.unregister=function(t){if(!this.isRegistered(t))throw ks(t,Ss);this._actions[t]=void 0},Cs.prototype.getActions=function(){return Object.keys(this._actions)},Cs.prototype.isRegistered=function(t){return!!this._actions[t]};const Ms={__init__:["editorActions"],editorActions:["type",Cs]};var js=10;function Rs(t,e,n){return n||(n="round"),Math[n](t/e)*e}function Ts(t,e,n){var o=!n||!1!==n.active;this._eventBus=e;var i=this;e.on("diagram.init",800,(function(){i.setActive(o)})),e.on(["create.move","create.end","bendpoint.move.move","bendpoint.move.end","connect.move","connect.end","connectionSegment.move.move","connectionSegment.move.end","resize.move","resize.end","shape.move.move","shape.move.end"],1200,(function(e){var n=e.originalEvent;if(!(!i.active||n&&$n(n))){var o=e.context,r=o.gridSnappingContext;r||(r=o.gridSnappingContext={}),["x","y"].forEach((function(n){var o={},r=function(t,e,n){var o=t.context,i=t.shape,r=o.gridSnappingContext,a=r.snapLocation,s=r.snapOffset;if(s&&m(s[e]))return s[e];s||(s=r.snapOffset={});m(s[e])||(s[e]=0);if(!i)return s[e];n.get(i.id)||(Bs(e)?s[e]+=i[e]+i.width/2:s[e]+=i[e]+i.height/2);if(!a)return s[e];"x"===e?/left/.test(a)?s[e]-=i.width/2:/right/.test(a)&&(s[e]+=i.width/2):/top/.test(a)?s[e]-=i.height/2:/bottom/.test(a)&&(s[e]+=i.height/2);return s[e]}(e,n,t);r&&(o.offset=r);var a=function(t,e){var n=t.context,o=n.createConstraints,i=n.resizeConstraints||{},r=n.gridSnappingContext,a=r.snapConstraints;if(a&&a[e])return a[e];a||(a=r.snapConstraints={});a[e]||(a[e]={});var s=n.direction;o&&(Bs(e)?(a.x.min=o.left,a.x.max=o.right):(a.y.min=o.top,a.y.max=o.bottom));var c=i.min,u=i.max;c&&(Bs(e)?Ls(s)?a.x.max=c.left:a.x.min=c.right:Ps(s)?a.y.max=c.top:a.y.min=c.bottom);u&&(Bs(e)?Ls(s)?a.x.min=u.left:a.x.max=u.right:Ps(s)?a.y.min=u.top:a.y.max=u.bottom);return a[e]}(e,n);a&&b(o,a),Li(e,n)||i.snapEvent(e,n,o)}))}}))}function Bs(t){return"x"===t}function Ps(t){return-1!==t.indexOf("n")}function Ls(t){return-1!==t.indexOf("w")}function Os(t,e){Sn.call(this,t),this._gridSnapping=e;var n=this;this.preExecute("shape.resize",(function(t){var e=t.context,o=(e.hints||{}).autoResize;if(o){var i=e.shape,r=e.newBounds;j(o)?e.newBounds=n.snapComplex(r,o):e.newBounds=n.snapSimple(i,r)}}))}Ts.prototype.snapEvent=function(t,e,n){Oi(t,e,this.snapValue(t[e],n))},Ts.prototype.getGridSpacing=function(){return 10},Ts.prototype.snapValue=function(t,e){var n,o,i=0;return e&&e.offset&&(i=e.offset),t=Rs(t+=i,10),e&&e.min&&(n=e.min,m(n)&&(n=Rs(n+i,10,"ceil"),t=Math.max(t,n))),e&&e.max&&(o=e.max,m(o)&&(o=Rs(o+i,10,"floor"),t=Math.min(t,o))),t-=i},Ts.prototype.isActive=function(){return this.active},Ts.prototype.setActive=function(t){this.active=t,this._eventBus.fire("gridSnapping.toggle",{active:t})},Ts.prototype.toggleActive=function(){this.setActive(!this.active)},Ts.$inject=["elementRegistry","eventBus","config.gridSnapping"],Os.$inject=["eventBus","gridSnapping","modeling"],e(Os,Sn),Os.prototype.snapSimple=function(t,e){var n=this._gridSnapping;return e.width=n.snapValue(e.width,{min:e.width}),e.height=n.snapValue(e.height,{min:e.height}),e.x=t.x+t.width/2-e.width/2,e.y=t.y+t.height/2-e.height/2,e},Os.prototype.snapComplex=function(t,e){return/w|e/.test(e)&&(t=this.snapHorizontally(t,e)),/n|s/.test(e)&&(t=this.snapVertically(t,e)),t},Os.prototype.snapHorizontally=function(t,e){var n=this._gridSnapping,o=/w/.test(e),i=/e/.test(e),r={};return r.width=n.snapValue(t.width,{min:t.width}),i&&(o?(r.x=n.snapValue(t.x,{max:t.x}),r.width+=n.snapValue(t.x-r.x,{min:t.x-r.x})):t.x=t.x+t.width-r.width),b(t,r),t},Os.prototype.snapVertically=function(t,e){var n=this._gridSnapping,o=/n/.test(e),i=/s/.test(e),r={};return r.height=n.snapValue(t.height,{min:t.height}),o&&(i?(r.y=n.snapValue(t.y,{max:t.y}),r.height+=n.snapValue(t.y-r.y,{min:t.y-r.y})):t.y=t.y+t.height-r.height),b(t,r),t};function $s(t,e){t.on(["spaceTool.move","spaceTool.end"],2e3,(function(t){var n,o=t.context;o.initialized&&("x"===o.axis?(n=e.snapValue(t.dx),t.x=t.x+n-t.dx,t.dx=n):(n=e.snapValue(t.dy),t.y=t.y+n-t.dy,t.dy=n))}))}$s.$inject=["eventBus","gridSnapping"];const As={__depends__:[{__init__:["gridSnappingResizeBehavior","gridSnappingSpaceToolBehavior"],gridSnappingResizeBehavior:["type",Os],gridSnappingSpaceToolBehavior:["type",$s]}],__init__:["gridSnapping"],gridSnapping:["type",Ts]};var zs={moveSpeed:1,moveSpeedAccelerated:10},Is="left",Ds="right",Hs="down",Gs={ArrowLeft:Is,Left:Is,ArrowUp:"up",Up:"up",ArrowRight:Ds,Right:Ds,ArrowDown:Hs,Down:Hs},Ns={left:function(t){return{x:-t,y:0}},up:function(t){return{x:0,y:-t}},right:function(t){return{x:t,y:0}},down:function(t){return{x:0,y:t}}};function Vs(t,e,n,o,i){var r=this;this._config=b({},zs,t||{}),e.addListener(1500,(function(t){var n=t.keyEvent,o=Gs[n.key];if(o&&!e.isCmd(n)){var i=e.isShift(n);return r.moveSelection(o,i),!0}})),this.moveSelection=function(t,e){var r=i.get();if(r.length){var a=this._config[e?"moveSpeedAccelerated":"moveSpeed"],s=Ns[t](a);o.allowed("elements.move",{shapes:r})&&n.moveElements(r,s)}}}Vs.$inject=["config.keyboardMoveSelection","keyboard","modeling","rules","selection"];const Us={__depends__:[Nn,fn],__init__:["keyboardMoveSelection"],keyboardMoveSelection:["type",Vs]};function Fs(t,e,n,o){this._dragging=o,this._rules=e;var i=this;function r(t,e){var n,o=t.shape,r=t.direction,a=t.resizeConstraints;t.delta=e,n=function(t,e,n){var o=n.x,i=n.y,r={x:t.x,y:t.y,width:t.width,height:t.height};return-1!==e.indexOf("n")?(r.y=t.y+i,r.height=t.height-i):-1!==e.indexOf("s")&&(r.height=t.height+i),-1!==e.indexOf("e")?r.width=t.width+o:-1!==e.indexOf("w")&&(r.x=t.x+o,r.width=t.width-o),r}(o,r,e),t.newBounds=function(t,e){if(!e)return t;var n=Et(t);return bt({top:ar("top",n,e),right:ar("right",n,e),bottom:ar("bottom",n,e),left:ar("left",n,e)})}(n,a),t.canExecute=i.canResize(t)}t.on("resize.start",(function(t){var e,n,o;e=t.context,n=e.resizeConstraints,o=e.minBounds,void 0===n&&(void 0===o&&(o=i.computeMinResizeBox(e)),e.resizeConstraints={min:Et(o)})})),t.on("resize.move",(function(t){var e={x:t.dx,y:t.dy};r(t.context,e)})),t.on("resize.end",(function(t){!function(t){var e=t.shape,o=t.canExecute,i=t.newBounds;if(o){if(!function(t,e){return t.x!==e.x||t.y!==e.y||t.width!==e.width||t.height!==e.height}(e,i=xt(i)))return;n.resizeShape(e,i)}}(t.context)}))}function Ws(t,e){var n=Ct(t),o=Et(t),i={x:n.x,y:n.y};return-1!==e.indexOf("n")?i.y=o.top:-1!==e.indexOf("s")&&(i.y=o.bottom),-1!==e.indexOf("e")?i.x=o.right:-1!==e.indexOf("w")&&(i.x=o.left),i}function Ks(t){var e="resize-";return"n"===t||"s"===t?e+"ns":"e"===t||"w"===t?e+"ew":"nw"===t||"se"===t?e+"nwse":e+"nesw"}Fs.prototype.canResize=function(t){var e=this._rules,n=$(t,["newBounds","shape","delta","direction"]);return e.allowed("shape.resize",n)},Fs.prototype.activate=function(t,e,n){var o,i,r=this._dragging;if("string"==typeof n&&(n={direction:n}),!(i=(o=b({shape:e},n)).direction))throw new Error("must provide a direction (n|w|s|e|nw|se|ne|sw)");r.init(t,Ws(e,i),"resize",{autoActivate:!0,cursor:Ks(i),data:{shape:e,context:o}})},Fs.prototype.computeMinResizeBox=function(t){var e=t.shape;return function(t,e,n,o){var i=Et(e),r={top:/n/.test(t)?i.bottom-n.height:i.top,left:/w/.test(t)?i.right-n.width:i.left,bottom:/s/.test(t)?i.top+n.height:i.bottom,right:/e/.test(t)?i.left+n.width:i.right},a=o?Et(o):r;return bt({top:nr(r.top,a.top),left:nr(r.left,a.left),bottom:er(r.bottom,a.bottom),right:er(r.right,a.right)})}(t.direction,e,t.minDimensions||{width:10,height:10},ur(e,t.childrenBoxPadding))},Fs.$inject=["eventBus","rules","modeling","dragging"];var qs="djs-resizing",Zs="resize-not-ok";function Ys(t,e,n){t.on("resize.move",500,(function(t){var i,r,s,c;i=t.context,r=i.shape,s=i.newBounds,(c=i.frame)||(c=i.frame=n.addFrame(r,e.getActiveLayer()),e.addMarker(r,qs)),s.width>5&&o(c,{x:s.x,width:s.width}),s.height>5&&o(c,{y:s.y,height:s.height}),i.canExecute?a(c).remove(Zs):a(c).add(Zs)})),t.on("resize.cleanup",(function(t){var n,o;n=t.context,o=n.shape,n.frame&&r(n.frame),e.removeMarker(o,qs)}))}Ys.$inject=["eventBus","canvas","previewSupport"];var Xs=-6,Js="djs-resizer",Qs=["n","w","s","e","nw","ne","se","sw"];function tc(t,e,n,o){this._resize=o,this._canvas=e;var i=this;t.on("selection.changed",(function(t){var e=t.newSelection;i.removeResizers(),1===e.length&&x(e,k(i.addResizer,i))})),t.on("shape.changed",(function(t){var e=t.element;n.isSelected(e)&&(i.removeResizers(),i.addResizer(e))}))}tc.prototype.makeDraggable=function(t,e,n){var o=this._resize;function i(e){Je(e)&&o.activate(e,t,n)}J.bind(e,"mousedown",i),J.bind(e,"touchstart",i)},tc.prototype._createResizer=function(t,e,r,s){var c=this._getResizersParent(),u=function(t){var e={x:0,y:0};-1!==t.indexOf("e")?e.x=6:-1!==t.indexOf("w")&&(e.x=Xs);-1!==t.indexOf("s")?e.y=6:-1!==t.indexOf("n")&&(e.y=Xs);return e}(s),h=n("g");a(h).add(Js),a(h).add(Js+"-"+t.id),a(h).add(Js+"-"+s),i(c,h);var l=n("rect");o(l,{x:-4+u.x,y:-4+u.y,width:8,height:8}),a(l).add(Js+"-visual"),i(h,l);var p=n("rect");return o(p,{x:-10+u.x,y:-10+u.y,width:20,height:20}),a(p).add(Js+"-hit"),i(h,p),Te(h,e,r),h},tc.prototype.createResizer=function(t,e){var n=Ws(t,e),o=this._createResizer(t,n.x,n.y,e);this.makeDraggable(t,o,e)},tc.prototype.addResizer=function(t){var e=this;!mt(t)&&this._resize.canResize({shape:t})&&x(Qs,(function(n){e.createResizer(t,n)}))},tc.prototype.removeResizers=function(){var t=this._getResizersParent();h(t)},tc.prototype._getResizersParent=function(){return this._canvas.getLayer("resizers")},tc.$inject=["eventBus","canvas","selection","resize"];const ec={__depends__:[No,zo,Xi],__init__:["resize","resizePreview","resizeHandles"],resize:["type",Fs],resizePreview:["type",Ys],resizeHandles:["type",tc]};var nc=new vn("tt");function oc(t,e){t.style.display=!1===e?"none":""}var ic="djs-tooltip",rc="."+ic;function ac(t,e){var n,o;this._eventBus=t,this._canvas=e,this._ids=nc,this._tooltipDefaults={show:{minZoom:.7,maxZoom:5}},this._tooltips={},this._tooltipRoot=(n=e.getContainer(),o=Z('<div class="djs-tooltip-container" />'),N(o,{position:"absolute",width:"0",height:"0"}),n.insertBefore(o,n.firstChild),o);var i=this;W.bind(this._tooltipRoot,rc,"mousedown",(function(t){t.stopPropagation()})),W.bind(this._tooltipRoot,rc,"mouseover",(function(t){i.trigger("mouseover",t)})),W.bind(this._tooltipRoot,rc,"mouseout",(function(t){i.trigger("mouseout",t)})),this._init()}ac.$inject=["eventBus","canvas"],ac.prototype.add=function(t){if(!t.position)throw new Error("must specifiy tooltip position");if(!t.html)throw new Error("must specifiy tooltip html");var e=this._ids.next();return t=b({},this._tooltipDefaults,t,{id:e}),this._addTooltip(t),t.timeout&&this.setTimeout(t),e},ac.prototype.trigger=function(t,e){var n=e.delegateTarget||e.target,o=this.get(q(n,"data-tooltip-id"));o&&("mouseover"===t&&o.timeout&&this.clearTimeout(o),"mouseout"===t&&o.timeout&&(o.timeout=1e3,this.setTimeout(o)))},ac.prototype.get=function(t){return"string"!=typeof t&&(t=t.id),this._tooltips[t]},ac.prototype.clearTimeout=function(t){if(t=this.get(t)){var e=t.removeTimer;e&&(clearTimeout(e),t.removeTimer=null)}},ac.prototype.setTimeout=function(t){if(t=this.get(t)){this.clearTimeout(t);var e=this;t.removeTimer=setTimeout((function(){e.remove(t)}),t.timeout)}},ac.prototype.remove=function(t){var e=this.get(t);e&&(K(e.html),K(e.htmlContainer),delete e.htmlContainer,delete this._tooltips[e.id])},ac.prototype.show=function(){oc(this._tooltipRoot)},ac.prototype.hide=function(){oc(this._tooltipRoot,!1)},ac.prototype._updateRoot=function(t){var e=t.scale||1,n=t.scale||1,o="matrix("+e+",0,0,"+n+","+-1*t.x*e+","+-1*t.y*n+")";this._tooltipRoot.style.transform=o,this._tooltipRoot.style["-ms-transform"]=o},ac.prototype._addTooltip=function(t){var e,n=t.id,o=t.html,i=this._tooltipRoot;o.get&&o.constructor.prototype.jquery&&(o=o.get(0)),j(o)&&(o=Z(o)),e=Z('<div data-tooltip-id="'+n+'" class="'+ic+'">'),N(e,{position:"absolute"}),e.appendChild(o),t.type&&Y(e).add("djs-tooltip-"+t.type),t.className&&Y(e).add(t.className),t.htmlContainer=e,i.appendChild(e),this._tooltips[n]=t,this._updateTooltip(t)},ac.prototype._updateTooltip=function(t){var e,n,o,i=t.position,r=t.htmlContainer;e=r,n=i.x,o=i.y,N(e,{left:n+"px",top:o+"px"})},ac.prototype._updateTooltipVisibilty=function(t){x(this._tooltips,(function(e){var n=e.show,o=e.htmlContainer,i=!0;n&&((n.minZoom>t.scale||n.maxZoom<t.scale)&&(i=!1),oc(o,i))}))},ac.prototype._init=function(){var t=this;this._eventBus.on("canvas.viewbox.changing",(function(e){t.hide()})),this._eventBus.on("canvas.viewbox.changed",(function(e){var n;n=e.viewbox,t._updateRoot(n),t._updateTooltipVisibilty(n),t.show()}))};const sc={__init__:["tooltips"],tooltips:["type",ac]};var cc=Math.round;function uc(t,e,n,o,i){function r(t,e,n,o){return i.allowed("elements.move",{shapes:t,delta:e,position:n,target:o})}function s(t,n,o,i){if(d(o)&&(i=o,o=!1),!n.waypoints&&n.parent&&!a(t.target).has("djs-hit-no-move")){var r=function(t){return{x:t.x+cc(t.width/2),y:t.y+cc(t.height/2)}}(n);return e.init(t,r,"shape.move",{cursor:"grabbing",autoActivate:o,data:{shape:n,context:i||{}}}),!0}}t.on("shape.move.start",1500,(function(t){var e,n,i=t.context,r=t.shape,a=o.get().slice();-1===a.indexOf(r)&&(a=[r]),n=E(e=a,"id"),a=w(e,(function(t){for(;t=t.parent;)if(n[t.id])return!1;return!0})),b(i,{shapes:a,validatedShapes:a,shape:r})})),t.on("shape.move.start",1250,(function(t){var e=t.context,n=e.validatedShapes;if(!(e.canExecute=r(n)))return!1})),t.on("shape.move.move",500,(function(t){var e,n=t.context,o=n.validatedShapes,i=t.hover,a={x:t.dx,y:t.dy};e=r(o,a,{x:t.x,y:t.y},i),n.delta=a,n.canExecute=e,n.target=null!==e?i:null})),t.on("shape.move.end",(function(t){var e=t.context,o=e.delta,i=e.canExecute,r="attach"===i,a=e.shapes;if(!1===i)return!1;o.x=cc(o.x),o.y=cc(o.y),0===o.x&&0===o.y||n.moveElements(a,o,e.target,{primaryShape:e.shape,attach:r})})),t.on("element.mousedown",(function(t){if(Je(t)){var e=Ke(t);if(!e)throw new Error("must supply DOM mousedown event");return s(e,t.element)}})),this.start=s}uc.$inject=["eventBus","dragging","modeling","selection","rules"];var hc="djs-dragging",lc="drop-ok",pc="drop-not-ok",dc="new-parent",fc="attach-ok";function vc(t,e,a,s){function c(t){var e=function(t){var e=w(t,(function(e){return!mt(e)||g(t,R({id:e.source.id}))&&g(t,R({id:e.target.id}))}));return e}(u(t));return e}function u(t){var e=Zt(t,!0),n=z(e,(function(t){return(t.incoming||[]).concat(t.outgoing||[])}));return L(e.concat(n))}function h(t,n){[fc,lc,pc,dc].forEach((function(o){o===n?e.addMarker(t,o):e.removeMarker(t,o)}))}t.on("shape.move.start",499,(function(t){var r=t.context,h=r.shapes,l=r.allDraggedElements,p=c(h);if(!r.dragGroup){var d=n("g");o(d,a.cls("djs-drag-group",["no-events"]));var f=e.getActiveLayer();i(f,d),r.dragGroup=d}p.forEach((function(t){s.addDragger(t,r.dragGroup)})),l=l?L([l,u(h)]):u(h),x(l,(function(t){e.addMarker(t,hc)})),r.allDraggedElements=l,r.differentParents=1!==G(E(h,(function(t){return t.parent&&t.parent.id})))})),t.on("shape.move.move",499,(function(t){var e=t.context,n=e.dragGroup,o=e.target,i=e.shape.parent,r=e.canExecute;o&&("attach"===r?h(o,fc):e.canExecute&&o&&o.id!==i.id?h(o,dc):h(o,e.canExecute?lc:pc)),Be(n,t.dx,t.dy)})),t.on(["shape.move.out","shape.move.cleanup"],(function(t){var e=t.context.target;e&&h(e,null)})),t.on("shape.move.cleanup",(function(t){var n=t.context,o=n.allDraggedElements,i=n.dragGroup;x(o,(function(t){e.removeMarker(t,hc)})),i&&r(i)})),this.makeDraggable=function(t,n,o){s.addDragger(n,t.dragGroup),o&&e.addMarker(n,hc),t.allDraggedElements?t.allDraggedElements.push(n):t.allDraggedElements=[n]}}vc.$inject=["eventBus","canvas","styles","previewSupport"];const gc={__depends__:[rn,fn,sn,No,zo,Xi],__init__:["move","movePreview"],move:["type",uc],movePreview:["type",vc]};var yc=".djs-palette-toggle",mc=".entry",_c=yc+", "+mc,xc="djs-palette-",wc="open",Ec="two-column";function bc(t,e){this._eventBus=t,this._canvas=e;var n=this;t.on("tool-manager.update",(function(t){var e=t.tool;n.updateToolHighlight(e)})),t.on("i18n.changed",(function(){n._update()})),t.on("diagram.init",(function(){n._diagramInitialized=!0,n._rebuild()}))}function Sc(t,e){var n=e.getPaletteEntries();return M(n)?n(t):(x(n,(function(e,n){t[n]=e})),t)}bc.$inject=["eventBus","canvas"],bc.prototype.registerProvider=function(t,e){e||(e=t,t=1e3),this._eventBus.on("palette.getProviders",t,(function(t){t.providers.push(e)})),this._rebuild()},bc.prototype.getEntries=function(){return this._getProviders().reduce(Sc,{})},bc.prototype._rebuild=function(){this._diagramInitialized&&(this._getProviders().length&&(this._container||this._init(),this._update()))},bc.prototype._init=function(){var t=this,e=this._eventBus,n=this._getParentContainer(),o=this._container=Z(bc.HTML_MARKUP);n.appendChild(o),Y(n).add(xc+"shown"),W.bind(o,_c,"click",(function(e){var n=e.delegateTarget;if(Q(n,yc))return t.toggle();t.trigger("click",e)})),J.bind(o,"mousedown",(function(t){t.stopPropagation()})),W.bind(o,mc,"dragstart",(function(e){t.trigger("dragstart",e)})),e.on("canvas.resized",this._layoutChanged,this),e.fire("palette.create",{container:o})},bc.prototype._getProviders=function(t){var e=this._eventBus.createEvent({type:"palette.getProviders",providers:[]});return this._eventBus.fire(e),e.providers},bc.prototype._toggleState=function(t){t=t||{};var e,n=this._getParentContainer(),o=this._container,i=this._eventBus,r=Y(o),a=Y(n);e="twoColumn"in t?t.twoColumn:this._needsCollapse(n.clientHeight,this._entries||{}),r.toggle(Ec,e),a.toggle(xc+Ec,e),"open"in t&&(r.toggle(wc,t.open),a.toggle(xc+wc,t.open)),i.fire("palette.changed",{twoColumn:e,open:this.isOpen()})},bc.prototype._update=function(){var t=F(".djs-palette-entries",this._container),e=this._entries=this.getEntries();V(t),x(e,(function(e,n){var o=e.group||"default",i=F("[data-group="+jn(o)+"]",t);i||(i=Z('<div class="group"></div>'),q(i,"data-group",o),t.appendChild(i));var r,a,s,c=e.html||(e.separator?'<hr class="separator" />':'<div class="entry" draggable="true"></div>'),u=Z(c);if(i.appendChild(u),!e.separator&&(q(u,"data-action",n),e.title&&q(u,"title",e.title),e.className&&(r=u,a=e.className,s=Y(r),(_(a)?a:a.split(/\s+/g)).forEach((function(t){s.add(t)}))),e.imageUrl)){var h=Z("<img>");q(h,"src",e.imageUrl),u.appendChild(h)}})),this.open()},bc.prototype.trigger=function(t,e,n){var o,i,r=e.delegateTarget||e.target;return r?(o=q(r,"data-action"),i=e.originalEvent||e,this.triggerEntry(o,t,i,n)):e.preventDefault()},bc.prototype.triggerEntry=function(t,e,n,o){var i,r;if((i=this._entries[t])&&(r=i.action,!1!==this._eventBus.fire("palette.trigger",{entry:i,event:n}))){if(M(r)){if("click"===e)return r(n,o)}else if(r[e])return r[e](n,o);n.preventDefault()}},bc.prototype._layoutChanged=function(){this._toggleState({})},bc.prototype._needsCollapse=function(t,e){return t<46*Object.keys(e).length+50},bc.prototype.close=function(){this._toggleState({open:!1,twoColumn:!1})},bc.prototype.open=function(){this._toggleState({open:!0})},bc.prototype.toggle=function(){this.isOpen()?this.close():this.open()},bc.prototype.isActiveTool=function(t){return t&&this._activeTool===t},bc.prototype.updateToolHighlight=function(t){var e,n;this._toolsContainer||(e=F(".djs-palette-entries",this._container),this._toolsContainer=F("[data-group=tools]",e)),n=this._toolsContainer,x(n.children,(function(e){var n=e.getAttribute("data-action");if(n){var o=Y(e);n=n.replace("-tool",""),o.contains("entry")&&n===t?o.add("highlighted-entry"):o.remove("highlighted-entry")}}))},bc.prototype.isOpen=function(){return Y(this._container).has(wc)},bc.prototype._getParentContainer=function(){return this._canvas.getContainer()},bc.HTML_MARKUP='<div class="djs-palette"><div class="djs-palette-entries"></div><div class="djs-palette-toggle"></div></div>';const Cc={__init__:["palette"],palette:["type",bc]};var kc="crosshair";function Mc(t,e,a,s,c,u,h){this._selection=c,this._dragging=a,this._mouse=h;var l=this,p=function(t){var r,a=e.getActiveLayer();r=t.frame=n("rect"),o(r,{class:"djs-lasso-overlay",width:1,height:1,x:0,y:0}),i(a,r)},d=function(t){var e=t.frame,n=t.bbox;o(e,{x:n.x,y:n.y,width:n.width,height:n.height})},f=function(t){t.frame&&r(t.frame)};u.registerTool("lasso",{tool:"lasso.selection",dragging:"lasso"}),t.on("lasso.selection.end",(function(e){var n=e.originalEvent.target;(e.hover||n instanceof SVGElement)&&t.once("lasso.selection.ended",(function(){l.activateLasso(e.originalEvent,!0)}))})),t.on("lasso.end",0,(function(t){var e=t.context,n=jc(t),o=s.filter((function(t){return t})),i=tn(t);l.select(o,n,i?e.selection:[])})),t.on("lasso.start",(function(t){var e=t.context;e.bbox=jc(t),p(e),e.selection=c.get()})),t.on("lasso.move",(function(t){var e=t.context;e.bbox=jc(t),d(e)})),t.on("lasso.cleanup",(function(t){var e=t.context;f(e)})),t.on("element.mousedown",1500,(function(t){if(tn(t))return l.activateLasso(t.originalEvent),!0}))}function jc(t){var e={x:t.x-t.dx,y:t.y-t.dy},n={x:t.x,y:t.y};return e.x<=n.x&&e.y<n.y||e.x<n.x&&e.y<=n.y?{x:e.x,y:e.y,width:n.x-e.x,height:n.y-e.y}:e.x>=n.x&&e.y<n.y||e.x>n.x&&e.y<=n.y?{x:n.x,y:e.y,width:e.x-n.x,height:n.y-e.y}:e.x<=n.x&&e.y>n.y||e.x<n.x&&e.y>=n.y?{x:e.x,y:n.y,width:n.x-e.x,height:e.y-n.y}:e.x>=n.x&&e.y>n.y||e.x>n.x&&e.y>=n.y?{x:n.x,y:n.y,width:e.x-n.x,height:e.y-n.y}:{x:n.x,y:n.y,width:0,height:0}}Mc.$inject=["eventBus","canvas","dragging","elementRegistry","selection","toolManager","mouse"],Mc.prototype.activateLasso=function(t,e){this._dragging.init(t,"lasso",{autoActivate:e,cursor:kc,data:{context:{}}})},Mc.prototype.activateSelection=function(t,e){this._dragging.init(t,"lasso.selection",{trapClick:!1,autoActivate:e,cursor:kc,data:{context:{}},keepSelection:!0})},Mc.prototype.select=function(t,e,n=[]){var o=function(t,e){var n={};return x(t,(function(t){var o=t;o.waypoints&&(o=Yt(o)),!m(e.y)&&o.x>e.x&&(n[t.id]=t),!m(e.x)&&o.y>e.y&&(n[t.id]=t),o.x>e.x&&o.y>e.y&&(m(e.width)&&m(e.height)&&o.width+o.x<e.width+e.x&&o.height+o.y<e.height+e.y?n[t.id]=t:m(e.width)&&m(e.height)||(n[t.id]=t))})),n}(t,e);this._selection.select([...n,...O(o)])},Mc.prototype.toggle=function(){if(this.isActive())return this._dragging.cancel();var t=this._mouse.getLastMoveEvent();this.activateSelection(t,!!t)},Mc.prototype.isActive=function(){var t=this._dragging.context();return t&&/^lasso/.test(t.prefix)};const Rc={__depends__:[Ur,Or],__init__:["lassoTool"],lassoTool:["type",Mc]};var Tc=1500,Bc="grab";function Pc(t,e,n,o,i,r){this._dragging=n,this._mouse=r;var a=this,s=o.get("keyboard",!1);i.registerTool("hand",{tool:"hand",dragging:"hand.move"}),t.on("element.mousedown",Tc,(function(t){if(Qe(t))return a.activateMove(t.originalEvent,!0),!1})),s&&s.addListener(Tc,(function(t){if(Lc(t.keyEvent)&&!a.isActive()){var e=a._mouse.getLastMoveEvent();a.activateMove(e,!!e)}}),"keyboard.keydown"),s&&s.addListener(Tc,(function(t){Lc(t.keyEvent)&&a.isActive()&&a.toggle()}),"keyboard.keyup"),t.on("hand.end",(function(e){var n=e.originalEvent.target;if(!(e.hover||n instanceof SVGElement))return!1;t.once("hand.ended",(function(){a.activateMove(e.originalEvent,{reactivate:!0})}))})),t.on("hand.move.move",(function(t){var n=e.viewbox().scale;e.scroll({dx:t.dx*n,dy:t.dy*n})})),t.on("hand.move.end",(function(e){var n=e.context.reactivate;return!Qe(e)&&n&&t.once("hand.move.ended",(function(t){a.activateHand(t.originalEvent,!0,!0)})),!1}))}function Lc(t){return An("Space",t)}Pc.$inject=["eventBus","canvas","dragging","injector","toolManager","mouse"],Pc.prototype.activateMove=function(t,e,n){"object"==typeof e&&(n=e,e=!1),this._dragging.init(t,"hand.move",{autoActivate:e,cursor:Bc,data:{context:n||{}}})},Pc.prototype.activateHand=function(t,e,n){this._dragging.init(t,"hand",{trapClick:!1,autoActivate:e,cursor:Bc,data:{context:{reactivate:n}}})},Pc.prototype.toggle=function(){if(this.isActive())return this._dragging.cancel();var t=this._mouse.getLastMoveEvent();this.activateHand(t,!!t)},Pc.prototype.isActive=function(){var t=this._dragging.context();return!!t&&/^(hand|hand\.move)$/.test(t.prefix)};const Oc={__depends__:[Ur,Or],__init__:["handTool"],handTool:["type",Pc]};var $c="connect-ok",Ac="connect-not-ok";function zc(t,e,n,o,i,r,a){var s=this;this._dragging=e,this._rules=r,this._mouse=a,i.registerTool("global-connect",{tool:"global-connect",dragging:"global-connect.drag"}),t.on("global-connect.hover",(function(t){var e=t.context,n=t.hover,i=e.canStartConnect=s.canStartConnect(n);null!==i&&(e.startTarget=n,o.addMarker(n,i?$c:Ac))})),t.on(["global-connect.out","global-connect.cleanup"],(function(t){var e=t.context.startTarget,n=t.context.canStartConnect;e&&o.removeMarker(e,n?$c:Ac)})),t.on(["global-connect.ended"],(function(e){var o=e.context.startTarget,i={x:e.x,y:e.y};if(s.canStartConnect(o))return t.once("element.out",(function(){t.once(["connect.ended","connect.canceled"],(function(){t.fire("global-connect.drag.ended")})),n.start(null,o,i)})),!1}))}zc.$inject=["eventBus","dragging","connect","canvas","toolManager","rules","mouse"],zc.prototype.start=function(t,e){this._dragging.init(t,"global-connect",{autoActivate:e,trapClick:!1,data:{context:{}}})},zc.prototype.toggle=function(){if(this.isActive())return this._dragging.cancel();var t=this._mouse.getLastMoveEvent();return this.start(t,!!t)},zc.prototype.isActive=function(){var t=this._dragging.context();return t&&/^global-connect/.test(t.prefix)},zc.prototype.canStartConnect=function(t){return this._rules.allowed("connection.start",{source:t})};const Ic={__depends__:[Fi,No,zo,Ur,Or],globalConnect:["type",zc]};function Dc(){this._targets={},this._snapOrigins={},this._snapLocations=[],this._defaultSnaps={}}function Hc(){this._snapValues={}}Dc.prototype.getSnapOrigin=function(t){return this._snapOrigins[t]},Dc.prototype.setSnapOrigin=function(t,e){this._snapOrigins[t]=e,-1===this._snapLocations.indexOf(t)&&this._snapLocations.push(t)},Dc.prototype.addDefaultSnap=function(t,e){var n=this._defaultSnaps[t];n||(n=this._defaultSnaps[t]=[]),n.push(e)},Dc.prototype.getSnapLocations=function(){return this._snapLocations},Dc.prototype.setSnapLocations=function(t){this._snapLocations=t},Dc.prototype.pointsForTarget=function(t){var e=t.id||t,n=this._targets[e];return n||(n=this._targets[e]=new Hc).initDefaults(this._defaultSnaps),n},Hc.prototype.add=function(t,e){var n=this._snapValues[t];n||(n=this._snapValues[t]={x:[],y:[]}),-1===n.x.indexOf(e.x)&&n.x.push(e.x),-1===n.y.indexOf(e.y)&&n.y.push(e.y)},Hc.prototype.snap=function(t,e,n,o){var i=this._snapValues[e];return i&&function(t,e,n){var o,i;for(n=void 0===n?10:n,o=0;o<e.length;o++)if(i=e[o],ji(i-t)<=n)return i}(t[n],i[n],o)},Hc.prototype.initDefaults=function(t){var e=this;x(t||{},(function(t,n){x(t,(function(t){e.add(n,t)}))}))};function Gc(t,e,n){var o=this;this._elementRegistry=t,e.on(["create.start","shape.move.start"],(function(t){o.initSnap(t)})),e.on(["create.move","create.end","shape.move.move","shape.move.end"],1250,(function(t){var e=t.context,i=e.shape,r=e.snapContext,a=e.target;if((!t.originalEvent||!$n(t.originalEvent))&&!Li(t)&&a){var s=r.pointsForTarget(a);s.initialized||((s=o.addSnapTargetPoints(s,i,a)).initialized=!0),n.snap(t,s)}})),e.on(["create.cleanup","shape.move.cleanup"],(function(){n.hide()}))}Gc.$inject=["elementRegistry","eventBus","snapping"],Gc.prototype.initSnap=function(t){var e,n=this._elementRegistry,o=t.context,i=o.shape,r=o.snapContext;r||(r=o.snapContext=new Dc);var a=(e=n.get(i.id)?Pi(i,t):{x:t.x+Pi(i).x,y:t.y+Pi(i).y}).x-i.width/2,s=e.y-i.height/2,c=e.x+i.width/2,u=e.y+i.height/2;return r.setSnapOrigin("mid",{x:e.x-t.x,y:e.y-t.y}),_t(i)||(r.setSnapOrigin("top-left",{x:a-t.x,y:s-t.y}),r.setSnapOrigin("bottom-right",{x:c-t.x,y:u-t.y})),r},Gc.prototype.addSnapTargetPoints=function(t,e,n){var o=this.getSnapTargets(e,n);return x(o,(function(n){if(_t(n))_t(e)&&t.add("mid",Pi(n));else if(mt(n)){if(n.waypoints.length<3)return;var o=n.waypoints.slice(1,-1);x(o,(function(e){t.add("mid",e)}))}else t.add("mid",Pi(n))})),m(e.x)&&m(e.y)?(this._elementRegistry.get(e.id)&&t.add("mid",Pi(e)),t):t},Gc.prototype.getSnapTargets=function(t,e){return $i(e).filter((function(t){return!t.hidden}))};function Nc(t,e){var n=this;t.on(["resize.start"],(function(t){n.initSnap(t)})),t.on(["resize.move","resize.end"],1250,(function(t){var o=t.context,i=o.shape,r=i.parent,a=o.direction,s=o.snapContext;if(!(t.originalEvent&&$n(t.originalEvent)||Li(t))){var c=s.pointsForTarget(r);c.initialized||((c=n.addSnapTargetPoints(c,i,r,a)).initialized=!0),function(t){return"n"===t||"s"===t}(a)&&Oi(t,"x",t.x),function(t){return"e"===t||"w"===t}(a)&&Oi(t,"y",t.y),e.snap(t,c)}})),t.on(["resize.cleanup"],(function(){e.hide()}))}function Vc(t,e){var n=Ct(t),o=Et(t),i={x:n.x,y:n.y};return-1!==e.indexOf("n")?i.y=o.top:-1!==e.indexOf("s")&&(i.y=o.bottom),-1!==e.indexOf("e")?i.x=o.right:-1!==e.indexOf("w")&&(i.x=o.left),i}Nc.prototype.initSnap=function(t){var e=t.context,n=e.shape,o=e.direction,i=e.snapContext;i||(i=e.snapContext=new Dc);var r=Vc(n,o);return i.setSnapOrigin("corner",{x:r.x-t.x,y:r.y-t.y}),i},Nc.prototype.addSnapTargetPoints=function(t,e,n,o){var i=this.getSnapTargets(e,n);return x(i,(function(e){t.add("corner",Bi(e)),t.add("corner",Ti(e))})),t.add("corner",Vc(e,o)),t},Nc.$inject=["eventBus","snapping"],Nc.prototype.getSnapTargets=function(t,e){return $i(e).filter((function(e){return!(n=e,o=t,n.host===o||mt(e)||function(t){return!!t.hidden}(e)||_t(e));var n,o}))};function Uc(t){this._canvas=t,this._asyncHide=C(k(this.hide,this),1e3)}Uc.$inject=["canvas"],Uc.prototype.snap=function(t,e){var n=t.context.snapContext,o=n.getSnapLocations(),i={x:Li(t,"x"),y:Li(t,"y")};x(o,(function(o){var r=n.getSnapOrigin(o),a={x:t.x+r.x,y:t.y+r.y};if(x(["x","y"],(function(t){var n;i[t]||void 0!==(n=e.snap(a,o,t,7))&&(i[t]={value:n,originValue:n-r[t]})})),i.x&&i.y)return!1})),this.showSnapLine("vertical",i.x&&i.x.value),this.showSnapLine("horizontal",i.y&&i.y.value),x(["x","y"],(function(e){var n=i[e];d(n)&&Oi(t,e,n.originValue)}))},Uc.prototype._createLine=function(t){var e=this._canvas.getLayer("snap"),r=n("path");return o(r,{d:"M0,0 L0,0"}),a(r).add("djs-snap-line"),i(e,r),{update:function(e){m(e)?o(r,"horizontal"===t?{d:"M-100000,"+e+" L+100000,"+e,display:""}:{d:"M "+e+",-100000 L "+e+", +100000",display:""}):o(r,{display:"none"})}}},Uc.prototype._createSnapLines=function(){this._snapLines={horizontal:this._createLine("horizontal"),vertical:this._createLine("vertical")}},Uc.prototype.showSnapLine=function(t,e){var n=this.getSnapLine(t);n&&n.update(e),this._asyncHide()},Uc.prototype.getSnapLine=function(t){return this._snapLines||this._createSnapLines(),this._snapLines[t]},Uc.prototype.hide=function(){x(this._snapLines,(function(t){t.update()}))};const Fc={__init__:["createMoveSnapping","resizeSnapping","snapping"],createMoveSnapping:["type",Gc],resizeSnapping:["type",Nc],snapping:["type",Uc]};function Wc(t,e,n,o,i){this._open=!1,this._results=[],this._eventMaps=[],this._canvas=t,this._eventBus=e,this._overlays=n,this._selection=o,this._translate=i,this._container=this._getBoxHtml(),this._searchInput=F(Wc.INPUT_SELECTOR,this._container),this._resultsContainer=F(Wc.RESULTS_CONTAINER_SELECTOR,this._container),this._canvas.getContainer().appendChild(this._container),e.on(["canvas.destroy","diagram.destroy"],this.close,this)}function Kc(t,e,n){var o=function(t){var e="";return t.forEach((function(t){t.matched?e+='<strong class="'+Wc.RESULT_HIGHLIGHT_CLASS+'">'+Tn(t.matched)+"</strong>":e+=Tn(t.normal)})),""!==e?e:null}(e),i=Z(n);i.innerHTML=o,t.appendChild(i)}Wc.$inject=["canvas","eventBus","overlays","selection","translate"],Wc.prototype._bindEvents=function(){var t=this;function e(e,n,o,i){t._eventMaps.push({el:e,type:o,listener:W.bind(e,n,o,i)})}e(document,"html","click",(function(e){t.close()})),e(this._container,Wc.INPUT_SELECTOR,"click",(function(t){t.stopPropagation(),t.delegateTarget.focus()})),e(this._container,Wc.RESULT_SELECTOR,"mouseover",(function(e){e.stopPropagation(),t._scrollToNode(e.delegateTarget),t._preselect(e.delegateTarget)})),e(this._container,Wc.RESULT_SELECTOR,"click",(function(e){e.stopPropagation(),t._select(e.delegateTarget)})),e(this._container,Wc.INPUT_SELECTOR,"keydown",(function(t){An("ArrowUp",t)&&t.preventDefault(),An("ArrowDown",t)&&t.preventDefault()})),e(this._container,Wc.INPUT_SELECTOR,"keyup",(function(e){if(An("Escape",e))return t.close();if(An("Enter",e)){var n=t._getCurrentResult();return n?t._select(n):t.close()}return An("ArrowUp",e)?t._scrollToDirection(!0):An("ArrowDown",e)?t._scrollToDirection():void(An(["ArrowLeft","ArrowRight"],e)||t._search(e.delegateTarget.value))}))},Wc.prototype._unbindEvents=function(){this._eventMaps.forEach((function(t){W.unbind(t.el,t.type,t.listener)}))},Wc.prototype._search=function(t){var e=this;if(this._clearResults(),t&&""!==t){var n=this._searchProvider.find(t);if(n.length){n.forEach((function(t){var n=t.element.id,o=e._createResultNode(t,n);e._results[n]={element:t.element,node:o}}));var o=F(Wc.RESULT_SELECTOR,this._resultsContainer);this._scrollToNode(o),this._preselect(o)}}},Wc.prototype._scrollToDirection=function(t){var e=this._getCurrentResult();if(e){var n=t?e.previousElementSibling:e.nextElementSibling;n&&(this._scrollToNode(n),this._preselect(n))}},Wc.prototype._scrollToNode=function(t){if(t&&t!==this._getCurrentResult()){var e=t.offsetTop,n=this._resultsContainer.scrollTop,o=e-this._resultsContainer.clientHeight+t.clientHeight;e<n?this._resultsContainer.scrollTop=e:n<o&&(this._resultsContainer.scrollTop=o)}},Wc.prototype._clearResults=function(){V(this._resultsContainer),this._results=[],this._resetOverlay(),this._eventBus.fire("searchPad.cleared")},Wc.prototype._getCurrentResult=function(){return F(Wc.RESULT_SELECTED_SELECTOR,this._resultsContainer)},Wc.prototype._createResultNode=function(t,e){var n=Z(Wc.RESULT_HTML);return t.primaryTokens.length>0&&Kc(n,t.primaryTokens,Wc.RESULT_PRIMARY_HTML),Kc(n,t.secondaryTokens,Wc.RESULT_SECONDARY_HTML),q(n,Wc.RESULT_ID_ATTRIBUTE,e),this._resultsContainer.appendChild(n),n},Wc.prototype.registerProvider=function(t){this._searchProvider=t},Wc.prototype.open=function(){if(!this._searchProvider)throw new Error("no search provider registered");this.isOpen()||(this._bindEvents(),this._open=!0,Y(this._container).add("open"),this._searchInput.focus(),this._eventBus.fire("searchPad.opened"))},Wc.prototype.close=function(){this.isOpen()&&(this._unbindEvents(),this._open=!1,Y(this._container).remove("open"),this._clearResults(),this._searchInput.value="",this._searchInput.blur(),this._resetOverlay(),this._eventBus.fire("searchPad.closed"))},Wc.prototype.toggle=function(){this.isOpen()?this.close():this.open()},Wc.prototype.isOpen=function(){return this._open},Wc.prototype._preselect=function(t){var e=this._getCurrentResult();if(t!==e){e&&Y(e).remove(Wc.RESULT_SELECTED_CLASS);var n=q(t,Wc.RESULT_ID_ATTRIBUTE),o=this._results[n].element;Y(t).add(Wc.RESULT_SELECTED_CLASS),this._resetOverlay(o),this._canvas.scrollToElement(o,{top:400}),this._selection.select(o),this._eventBus.fire("searchPad.preselected",o)}},Wc.prototype._select=function(t){var e=q(t,Wc.RESULT_ID_ATTRIBUTE),n=this._results[e].element;this.close(),this._resetOverlay(),this._canvas.scrollToElement(n,{top:400}),this._selection.select(n),this._eventBus.fire("searchPad.selected",n)},Wc.prototype._resetOverlay=function(t){if(this._overlayId&&this._overlays.remove(this._overlayId),t){var e=function(t){var e=6,n=t.width+2*e,o=t.height+2*e,i={width:n+"px",height:o+"px"},r=Z('<div class="'+Wc.OVERLAY_CLASS+'"></div>');return N(r,i),{position:{bottom:o-e,right:n-e},show:!0,html:r}}(Yt(t));this._overlayId=this._overlays.add(t,e)}},Wc.prototype._getBoxHtml=function(){const t=Z(Wc.BOX_HTML),e=F(Wc.INPUT_SELECTOR,t);return e&&e.setAttribute("aria-label",this._translate("Search in diagram")),t},Wc.CONTAINER_SELECTOR=".djs-search-container",Wc.INPUT_SELECTOR=".djs-search-input input",Wc.RESULTS_CONTAINER_SELECTOR=".djs-search-results",Wc.RESULT_SELECTOR=".djs-search-result",Wc.RESULT_SELECTED_CLASS="djs-search-result-selected",Wc.RESULT_SELECTED_SELECTOR="."+Wc.RESULT_SELECTED_CLASS,Wc.RESULT_ID_ATTRIBUTE="data-result-id",Wc.RESULT_HIGHLIGHT_CLASS="djs-search-highlight",Wc.OVERLAY_CLASS="djs-search-overlay",Wc.BOX_HTML='<div class="djs-search-container djs-draggable djs-scrollable"><div class="djs-search-input"><input type="text"/></div><div class="djs-search-results"></div></div>',Wc.RESULT_HTML='<div class="djs-search-result"></div>',Wc.RESULT_PRIMARY_HTML='<div class="djs-search-result-primary"></div>',Wc.RESULT_SECONDARY_HTML='<p class="djs-search-result-secondary"></p>';const qc={__depends__:[Fe,wn,fn],searchPad:["type",Wc]};export{Qe as $,po as A,zt as B,Sn as C,ze as D,ne as E,rr as F,ir as G,qt as H,Wo as I,Zo as J,Fn as K,wt as L,to as M,qo as N,wn as O,So as P,Jo as Q,Mn as R,fn as S,Ue as T,hr as U,Yo as V,Xo as W,dr as X,pr as Y,ao as Z,Zt as _,Vt as a,xt as a0,ur as a1,No as a2,xr as a3,Ir as a4,Nr as a5,Qr as a6,sa as a7,Se as a8,ns as a9,$n as aA,Pi as aB,Oi as aC,Gc as aD,Li as aE,Ti as aF,Bi as aG,Fc as aH,qc as aI,Ho as aJ,Di as aK,Ki as aL,Us as aM,gc as aN,vo as aO,rn as aP,Rs as aQ,js as aR,Re as aS,Rt as aT,an as aU,os as aa,ms as ab,ds as ac,ua as ad,da as ae,ya as af,xs as ag,tr as ah,Fi as ai,Pr as aj,bs as ak,Cs as al,Ms as am,ft as an,As as ao,Gn as ap,Nn as aq,ec as ar,sc as as,sn as at,Cc as au,Rc as av,Oc as aw,Ic as ax,jn as ay,Xi as az,Be as b,It as c,Fe as d,Tn as e,Et as f,Ct as g,bt as h,_t as i,bn as j,Co as k,Ft as l,yo as m,Lt as n,kt as o,Tt as p,mt as q,Pe as r,Bt as s,Te as t,jo as u,Ro as v,To as w,Jn as x,Yt as y,oe as z};
