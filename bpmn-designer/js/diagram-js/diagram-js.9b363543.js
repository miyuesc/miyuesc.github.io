import{I as t}from"../didi/didi.f65e5563.js";import{e}from"../inherits-browser/inherits-browser.a3b97550.js";import{c as n,a as o,b as i,r,d as a,t as s,e as c,f as u,g as h,h as l}from"../tiny-svg/tiny-svg.9f6d78cc.js";import{d as p,j as d,a as f,f as v,b as g,e as y,w as m,c as _,k as x,r as w,t as E,h as b,l as S,x as C,y as k,i as M,g as j,p as R,n as T,s as B,o as P,z as L,A as O,q as $,B as A,m as z,C as I,D,E as H,F as G}from"../min-dash/min-dash.1b936205.js";import{b as N,f as V,g as U,q as F,d as W,r as K,h as q,a as Y,c as Z,i as X,e as J,m as Q}from"../min-dom/min-dom.04e3f566.js";import{H as tt}from"../hammerjs/hammerjs.908d0c92.js";import{c as et}from"../clsx/clsx.c92f17f5.js";import{m as nt}from"../htm/htm.cede0866.js";import{_ as ot,F as it,y as rt,h as at,T as st,p as ct,D as ut}from"../preact/preact.798d8b40.js";import{i as ht}from"../path-intersection/path-intersection.267136de.js";import{R as lt}from"../object-refs/object-refs.03ace6b7.js";var pt=1e3;function dt(t,e){var n=this;e=e||pt,t.on(["render.shape","render.connection"],e,(function(t,e){var o=t.type,i=e.element,r=e.gfx,a=e.attrs;if(n.canRender(i))return"render.shape"===o?n.drawShape(r,i,a):n.drawConnection(r,i,a)})),t.on(["render.getShapePath","render.getConnectionPath"],e,(function(t,e){if(n.canRender(e))return"render.getShapePath"===t.type?n.getShapePath(e):n.getConnectionPath(e)}))}function ft(t){return t.flat().join(",").replace(/,?([A-z]),?/g,"$1")}function vt(t){return["L",t.x,t.y]}function gt(t,e){const n=t.length,o=[(i=t[0],["M",i.x,i.y])];var i,r,a,s;for(let c=1;c<n;c++){const n=t[c-1],i=t[c],u=t[c+1];if(!u||!e){o.push(vt(i));continue}const h=Math.min(e,mt(i.x-n.x,i.y-n.y),mt(u.x-i.x,u.y-i.y));if(!h){o.push(vt(i));continue}const l=yt(i,n,h),p=yt(i,n,.5*h),d=yt(i,u,h),f=yt(i,u,.5*h);o.push(vt(l)),o.push((a=f,s=d,["C",(r=p).x,r.y,a.x,a.y,s.x,s.y]))}return o}function yt(t,e,n){const o=e.x-t.x,i=e.y-t.y,r=n/mt(o,i);return{x:t.x+o*r,y:t.y+i*r}}function mt(t,e){return Math.sqrt(Math.pow(t,2)+Math.pow(e,2))}function _t(t,e,o){p(e)&&(o=e,e=null),e||(e={});const i=n("path",e);return p(o)&&(i.dataset.cornerRadius=String(o)),xt(i,t)}function xt(t,e){const n=parseInt(t.dataset.cornerRadius,10)||0;return o(t,{d:ft(gt(e,n))}),t}function wt(t){return v(t,(function(e){return!g(t,(function(t){return t!==e&&Et(e,t)}))}))}function Et(t,e){if(e){if(t===e)return e;if(t.parent)return Et(t.parent,e)}}function bt(t,e,n){var o=!n||-1===t.indexOf(e);return o&&t.push(e),o}function St(t,e,n){n=n||0,d(t)||(t=[t]),f(t,(function(t,o){var i=e(t,o,n);d(i)&&i.length&&St(i,e,n+1)}))}function Ct(t,e){return function(t,e,n){var o=[],i=[];return St(t,(function(t,r,a){bt(o,t,e);var s=t.children;if((-1===n||a<n)&&s&&bt(i,s,e))return s})),o}(t,!e,-1)}function kt(t,e){var n,o,i,r;return e=!!e,d(t)||(t=[t]),f(t,(function(t){var a=t;t.waypoints&&!e&&(a=kt(t.waypoints,!0));var s=a.x,c=a.y,u=a.height||0,h=a.width||0;(s<n||void 0===n)&&(n=s),(c<o||void 0===o)&&(o=c),(s+h>i||void 0===i)&&(i=s+h),(c+u>r||void 0===r)&&(r=c+u)})),{x:n,y:o,height:r-o,width:i-n}}function Mt(t){return"waypoints"in t?"connection":"x"in t?"shape":"root"}function jt(t){return!(!t||!t.isFrame)}function Rt(t,e){return _({},t||{},e||{})}dt.prototype.canRender=function(t){},dt.prototype.drawShape=function(t,e){},dt.prototype.drawConnection=function(t,e){},dt.prototype.getShapePath=function(t){},dt.prototype.getConnectionPath=function(t){};function Tt(t,e){dt.call(this,t,1),this.CONNECTION_STYLE=e.style(["no-fill"],{strokeWidth:5,stroke:"fuchsia"}),this.SHAPE_STYLE=e.style({fill:"white",stroke:"fuchsia",strokeWidth:2}),this.FRAME_STYLE=e.style(["no-fill"],{stroke:"fuchsia",strokeDasharray:4,strokeWidth:2})}e(Tt,dt),Tt.prototype.canRender=function(){return!0},Tt.prototype.drawShape=function(t,e,r){var a=n("rect");return o(a,{x:0,y:0,width:e.width||0,height:e.height||0}),jt(e)?o(a,_({},this.FRAME_STYLE,r||{})):o(a,_({},this.SHAPE_STYLE,r||{})),i(t,a),a},Tt.prototype.drawConnection=function(t,e,n){var o=_t(e.waypoints,_({},this.CONNECTION_STYLE,n||{}));return i(t,o),o},Tt.prototype.getShapePath=function(t){var e=t.x,n=t.y,o=t.width;return ft([["M",e,n],["l",o,0],["l",0,t.height],["l",-o,0],["z"]])},Tt.prototype.getConnectionPath=function(t){var e,n,o=t.waypoints,i=[];for(e=0;n=o[e];e++)n=n.original||n,i.push([0===e?"M":"L",n.x,n.y]);return ft(i)},Tt.$inject=["eventBus","styles"];const Bt={__init__:["defaultRenderer"],defaultRenderer:["type",Tt],styles:["type",function(){var t={"no-fill":{fill:"none"},"no-border":{strokeOpacity:0},"no-events":{pointerEvents:"none"}},e=this;this.cls=function(t,e,n){var o=this.style(e,n);return _(o,{class:t})},this.style=function(e,n){d(e)||n||(n=e,e=[]);var o=w(e,(function(e,n){return _(e,t[n]||{})}),{});return n?_(o,n):o},this.computeStyle=function(t,n,o){return d(n)||(o=n,n=[]),e.style(n||[],_({},o,t||{}))}}]};function Pt(t,e){if(!t||!e)return-1;var n=t.indexOf(e);return-1!==n&&t.splice(n,1),n}function Lt(t,e,n){if(t&&e){"number"!=typeof n&&(n=-1);var o=t.indexOf(e);if(-1!==o){if(o===n)return;if(-1===n)return;t.splice(o,1)}-1!==n?t.splice(n,0,e):t.push(e)}}function Ot(t,e){return t&&e?t.indexOf(e):-1}function $t(t,e){return t&&e?Math.sqrt(Math.pow(t.x-e.x,2)+Math.pow(t.y-e.y,2)):-1}function At(t,e,n,o){if(void 0===o&&(o=5),!t||!e||!n)return!1;var i=(e.x-t.x)*(n.y-t.y)-(e.y-t.y)*(n.x-t.x),r=$t(t,e);return Math.abs(i/r)<=o}var zt=2;function It(t,e){var n=Array.from(arguments).flat();const o={x:"v",y:"h"};for(const[i,r]of Object.entries(o))if(Dt(i,n))return r;return!1}function Dt(t,e){const n=e[0];return E(e,(function(e){return Math.abs(n[t]-e[t])<=zt}))}function Ht(t,e,n){return n=n||0,t.x>e.x-n&&t.y>e.y-n&&t.x<e.x+e.width+n&&t.y<e.y+e.height+n}function Gt(t,e){return{x:Math.round(t.x+(e.x-t.x)/2),y:Math.round(t.y+(e.y-t.y)/2)}}function Nt(t){return y(t)&&b(t,"waypoints")}function Vt(t){return y(t)&&b(t,"labelTarget")}function Ut(t){return{x:Math.round(t.x),y:Math.round(t.y),width:Math.round(t.width),height:Math.round(t.height)}}function Ft(t){return{x:Math.round(t.x),y:Math.round(t.y)}}function Wt(t){return{top:t.y,right:t.x+(t.width||0),bottom:t.y+(t.height||0),left:t.x}}function Kt(t){return{x:t.left,y:t.top,width:t.right-t.left,height:t.bottom-t.top}}function qt(t){for(var e=t.waypoints,n=e.reduce((function(t,n,o){var i,r,a=e[o-1];if(a){var s=t[t.length-1],c=s&&s.endLength||0,u=(i=a,r=n,Math.sqrt(Math.pow(i.x-r.x,2)+Math.pow(i.y-r.y,2)));t.push({start:a,end:n,startLength:c,endLength:c+u,length:u})}return t}),[]),o=n.reduce((function(t,e){return t+e.length}),0)/2,i=0,r=n[i];r.endLength<o;)r=n[++i];var a=(o-r.startLength)/r.length;return{x:r.start.x+(r.end.x-r.start.x)*a,y:r.start.y+(r.end.y-r.start.y)*a}}function Yt(t){return Nt(t)?qt(t):Ft({x:(e=t).x+(e.width||0)/2,y:e.y+(e.height||0)/2});var e}function Zt(t,e,n){y(n=n||0)||(n={x:n,y:n});var o=Wt(t),i=Wt(e),r=o.bottom+n.y<=i.top,a=o.left-n.x>=i.right,s=o.top-n.y>=i.bottom,c=r?"top":s?"bottom":null,u=o.right+n.x<=i.left?"left":a?"right":null;return u&&c?c+"-"+u:u||c||"intersect"}function Xt(t,e,n){var o=ht(t,e);return 1===o.length||2===o.length&&$t(o[0],o[1])<1?Ft(o[0]):o.length>1?Ft((o=S(o,(function(t){var e=Math.floor(100*t.t2)||1;return e=((e=100-e)<10?"0":"")+e,t.segment2+"#"+e})))[n?0:o.length-1]):null}function Jt(t,e){return Math.round(t*e)/e}function Qt(t){return p(t)?t+"px":t}function te(t,e,o){const i=n("g");a(i).add(e);const r=void 0!==o?o:t.childNodes.length-1;return t.insertBefore(i,t.childNodes[r]||null),i}const ee={shape:["x","y","width","height"],connection:["waypoints"]};function ne(t,e,n,o){this._eventBus=e,this._elementRegistry=o,this._graphicsFactory=n,this._rootsIdx=0,this._layers={},this._planes=[],this._rootElement=null,this._init(t||{})}function oe(t,e){const n="matrix("+e.a+","+e.b+","+e.c+","+e.d+","+e.e+","+e.f+")";t.setAttribute("transform",n)}ne.$inject=["config.canvas","eventBus","graphicsFactory","elementRegistry"],ne.prototype._init=function(t){const e=this._eventBus,r=this._container=function(t){const e=(t=_({},{width:"100%",height:"100%"},t)).container||document.body,n=document.createElement("div");return n.setAttribute("class","djs-container djs-parent"),N(n,{position:"relative",overflow:"hidden",width:Qt(t.width),height:Qt(t.height)}),e.appendChild(n),n}(t),a=this._svg=n("svg");o(a,{width:"100%",height:"100%"}),i(r,a);const s=this._viewport=te(a,"viewport");!1!==t.deferUpdate&&(this._viewboxChanged=C(k(this._viewboxChanged,this),300)),e.on("diagram.init",(()=>{e.fire("canvas.init",{svg:a,viewport:s})})),e.on(["shape.added","connection.added","shape.removed","connection.removed","elements.changed","root.set"],(()=>{delete this._cachedViewbox})),e.on("diagram.destroy",500,this._destroy,this),e.on("diagram.clear",500,this._clear,this)},ne.prototype._destroy=function(){this._eventBus.fire("canvas.destroy",{svg:this._svg,viewport:this._viewport});const t=this._container.parentNode;t&&t.removeChild(this._container),delete this._svg,delete this._container,delete this._layers,delete this._planes,delete this._rootElement,delete this._viewport},ne.prototype._clear=function(){this._elementRegistry.getAll().forEach((t=>{const e=Mt(t);"root"===e?this.removeRootElement(t):this._removeElement(t,e)})),this._planes=[],this._rootElement=null,delete this._cachedViewbox},ne.prototype.getDefaultLayer=function(){return this.getLayer("base",0)},ne.prototype.getLayer=function(t,e){if(!t)throw new Error("must specify a name");let n=this._layers[t];if(n||(n=this._layers[t]=this._createLayer(t,e)),void 0!==e&&n.index!==e)throw new Error("layer <"+t+"> already created at index <"+e+">");return n.group},ne.prototype._getChildIndex=function(t){return w(this._layers,(function(e,n){return n.visible&&t>=n.index&&e++,e}),0)},ne.prototype._createLayer=function(t,e){void 0===e&&(e=1);const n=this._getChildIndex(e);return{group:te(this._viewport,"layer-"+t,n),index:e,visible:!0}},ne.prototype.showLayer=function(t){if(!t)throw new Error("must specify a name");const e=this._layers[t];if(!e)throw new Error("layer <"+t+"> does not exist");const n=this._viewport,o=e.group,i=e.index;if(e.visible)return o;const r=this._getChildIndex(i);return n.insertBefore(o,n.childNodes[r]||null),e.visible=!0,o},ne.prototype.hideLayer=function(t){if(!t)throw new Error("must specify a name");const e=this._layers[t];if(!e)throw new Error("layer <"+t+"> does not exist");const n=e.group;return e.visible?(r(n),e.visible=!1,n):n},ne.prototype._removeLayer=function(t){const e=this._layers[t];e&&(delete this._layers[t],r(e.group))},ne.prototype.getActiveLayer=function(){const t=this._findPlaneForRoot(this.getRootElement());return t?t.layer:null},ne.prototype.findRoot=function(t){if("string"==typeof t&&(t=this._elementRegistry.get(t)),!t)return;const e=this._findPlaneForRoot(function(t){for(;t.parent;)t=t.parent;return t}(t))||{};return e.rootElement},ne.prototype.getRootElements=function(){return this._planes.map((function(t){return t.rootElement}))},ne.prototype._findPlaneForRoot=function(t){return g(this._planes,(function(e){return e.rootElement===t}))},ne.prototype.getContainer=function(){return this._container},ne.prototype._updateMarker=function(t,e,n){let o;t.id||(t=this._elementRegistry.get(t)),o=this._elementRegistry._elements[t.id],o&&(f([o.gfx,o.secondaryGfx],(function(t){t&&(n?a(t).add(e):a(t).remove(e))})),this._eventBus.fire("element.marker.update",{element:t,gfx:o.gfx,marker:e,add:!!n}))},ne.prototype.addMarker=function(t,e){this._updateMarker(t,e,!0)},ne.prototype.removeMarker=function(t,e){this._updateMarker(t,e,!1)},ne.prototype.hasMarker=function(t,e){t.id||(t=this._elementRegistry.get(t));const n=this.getGraphics(t);return a(n).has(e)},ne.prototype.toggleMarker=function(t,e){this.hasMarker(t,e)?this.removeMarker(t,e):this.addMarker(t,e)},ne.prototype.getRootElement=function(){const t=this._rootElement;return t||this._planes.length?t:this.setRootElement(this.addRootElement(null))},ne.prototype.addRootElement=function(t){const e=this._rootsIdx++;t||(t={id:"__implicitroot_"+e,children:[],isImplicit:!0});const n=t.layer="root-"+e;this._ensureValid("root",t);const o=this.getLayer(n,0);return this.hideLayer(n),this._addRoot(t,o),this._planes.push({rootElement:t,layer:o}),t},ne.prototype.removeRootElement=function(t){"string"==typeof t&&(t=this._elementRegistry.get(t));if(this._findPlaneForRoot(t))return this._removeRoot(t),this._removeLayer(t.layer),this._planes=this._planes.filter((function(e){return e.rootElement!==t})),this._rootElement===t&&(this._rootElement=null),t},ne.prototype.setRootElement=function(t){if(t===this._rootElement)return;let e;if(!t)throw new Error("rootElement required");return e=this._findPlaneForRoot(t),e||(t=this.addRootElement(t)),this._setRoot(t),t},ne.prototype._removeRoot=function(t){const e=this._elementRegistry,n=this._eventBus;n.fire("root.remove",{element:t}),n.fire("root.removed",{element:t}),e.remove(t)},ne.prototype._addRoot=function(t,e){const n=this._elementRegistry,o=this._eventBus;o.fire("root.add",{element:t}),n.add(t,e),o.fire("root.added",{element:t,gfx:e})},ne.prototype._setRoot=function(t,e){const n=this._rootElement;n&&(this._elementRegistry.updateGraphics(n,null,!0),this.hideLayer(n.layer)),t&&(e||(e=this._findPlaneForRoot(t).layer),this._elementRegistry.updateGraphics(t,this._svg,!0),this.showLayer(t.layer)),this._rootElement=t,this._eventBus.fire("root.set",{element:t})},ne.prototype._ensureValid=function(t,e){if(!e.id)throw new Error("element must have an id");if(this._elementRegistry.get(e.id))throw new Error("element <"+e.id+"> already exists");const n=ee[t];if(!E(n,(function(t){return void 0!==e[t]})))throw new Error("must supply { "+n.join(", ")+" } with "+t)},ne.prototype._setParent=function(t,e,n){Lt(e.children,t,n),t.parent=e},ne.prototype._addElement=function(t,e,n,o){n=n||this.getRootElement();const i=this._eventBus,r=this._graphicsFactory;this._ensureValid(t,e),i.fire(t+".add",{element:e,parent:n}),this._setParent(e,n,o);const a=r.create(t,e,o);return this._elementRegistry.add(e,a),r.update(t,e,a),i.fire(t+".added",{element:e,gfx:a}),e},ne.prototype.addShape=function(t,e,n){return this._addElement("shape",t,e,n)},ne.prototype.addConnection=function(t,e,n){return this._addElement("connection",t,e,n)},ne.prototype._removeElement=function(t,e){const n=this._elementRegistry,o=this._graphicsFactory,i=this._eventBus;if(t=n.get(t.id||t))return i.fire(e+".remove",{element:t}),o.remove(t),Pt(t.parent&&t.parent.children,t),t.parent=null,i.fire(e+".removed",{element:t}),n.remove(t),t},ne.prototype.removeShape=function(t){return this._removeElement(t,"shape")},ne.prototype.removeConnection=function(t){return this._removeElement(t,"connection")},ne.prototype.getGraphics=function(t,e){return this._elementRegistry.getGraphics(t,e)},ne.prototype._changeViewbox=function(t){this._eventBus.fire("canvas.viewbox.changing"),t.apply(this),this._cachedViewbox=null,this._viewboxChanged()},ne.prototype._viewboxChanged=function(){this._eventBus.fire("canvas.viewbox.changed",{viewbox:this.viewbox()})},ne.prototype.viewbox=function(t){if(void 0===t&&this._cachedViewbox)return this._cachedViewbox;const e=this._viewport,n=this.getSize();let o,i,r,a,u,h,l;return t?(this._changeViewbox((function(){u=Math.min(n.width/t.width,n.height/t.height);const o=this._svg.createSVGMatrix().scale(u).translate(-t.x,-t.y);s(e,o)})),t):(r=this._rootElement?this.getActiveLayer():null,o=r&&r.getBBox()||{},a=s(e),i=a?a.matrix:c(),u=Jt(i.a,1e3),h=Jt(-i.e||0,1e3),l=Jt(-i.f||0,1e3),t=this._cachedViewbox={x:h?h/u:0,y:l?l/u:0,width:n.width/u,height:n.height/u,scale:u,inner:{width:o.width||0,height:o.height||0,x:o.x||0,y:o.y||0},outer:n})},ne.prototype.scroll=function(t){const e=this._viewport;let n=e.getCTM();return t&&this._changeViewbox((function(){t=_({dx:0,dy:0},t||{}),n=this._svg.createSVGMatrix().translate(t.dx,t.dy).multiply(n),oe(e,n)})),{x:n.e,y:n.f}},ne.prototype.scrollToElement=function(t,e){let n=100;"string"==typeof t&&(t=this._elementRegistry.get(t));const o=this.findRoot(t);o!==this.getRootElement()&&this.setRootElement(o),e||(e={}),"number"==typeof e&&(n=e),e={top:e.top||n,right:e.right||n,bottom:e.bottom||n,left:e.left||n};const i=kt(t),r=Wt(i),a=this.viewbox(),s=this.zoom();let c,u;a.y+=e.top/s,a.x+=e.left/s,a.width-=(e.right+e.left)/s,a.height-=(e.bottom+e.top)/s;const h=Wt(a);if(i.width<a.width&&i.height<a.height){const t=Math.max(0,r.right-h.right),e=Math.min(0,r.left-h.left),n=Math.max(0,r.bottom-h.bottom),o=Math.min(0,r.top-h.top);c=t||e,u=n||o}else c=i.x-a.x,u=i.y-a.y;this.scroll({dx:-c*s,dy:-u*s})},ne.prototype.zoom=function(t,e){if(!t)return this.viewbox(t).scale;if("fit-viewport"===t)return this._fitViewport(e);let n,o;return this._changeViewbox((function(){"object"!=typeof e&&(n=this.viewbox().outer,e={x:n.width/2,y:n.height/2}),o=this._setZoom(t,e)})),Jt(o.a,1e3)},ne.prototype._fitViewport=function(t){const e=this.viewbox(),n=e.outer,o=e.inner;let i,r;return o.x>=0&&o.y>=0&&o.x+o.width<=n.width&&o.y+o.height<=n.height&&!t?r={x:0,y:0,width:Math.max(o.width+o.x,n.width),height:Math.max(o.height+o.y,n.height)}:(i=Math.min(1,n.width/o.width,n.height/o.height),r={x:o.x+(t?o.width/2-n.width/i/2:0),y:o.y+(t?o.height/2-n.height/i/2:0),width:n.width/i,height:n.height/i}),this.viewbox(r),this.viewbox(!1).scale},ne.prototype._setZoom=function(t,e){const n=this._svg,o=this._viewport,i=n.createSVGMatrix(),r=n.createSVGPoint();let a,s,c,u,h;c=o.getCTM();const l=c.a;return e?(a=_(r,e),s=a.matrixTransform(c.inverse()),u=i.translate(s.x,s.y).scale(1/l*t).translate(-s.x,-s.y),h=c.multiply(u)):h=i.scale(t),oe(this._viewport,h),h},ne.prototype.getSize=function(){return{width:this._container.clientWidth,height:this._container.clientHeight}},ne.prototype.getAbsoluteBBox=function(t){const e=this.viewbox();let n;if(t.waypoints){n=this.getGraphics(t).getBBox()}else n=t;return{x:n.x*e.scale-e.x*e.scale,y:n.y*e.scale-e.y*e.scale,width:n.width*e.scale,height:n.height*e.scale}},ne.prototype.resized=function(){delete this._cachedViewbox,this._eventBus.fire("canvas.resized")};var ie="data-element-id";function re(t){this._elements={},this._eventBus=t}re.$inject=["eventBus"],re.prototype.add=function(t,e,n){var i=t.id;this._validateId(i),o(e,ie,i),n&&o(n,ie,i),this._elements[i]={element:t,gfx:e,secondaryGfx:n}},re.prototype.remove=function(t){var e=this._elements,n=t.id||t,i=n&&e[n];i&&(o(i.gfx,ie,""),i.secondaryGfx&&o(i.secondaryGfx,ie,""),delete e[n])},re.prototype.updateId=function(t,e){this._validateId(e),"string"==typeof t&&(t=this.get(t)),this._eventBus.fire("element.updateId",{element:t,newId:e});var n=this.getGraphics(t),o=this.getGraphics(t,!0);this.remove(t),t.id=e,this.add(t,n,o)},re.prototype.updateGraphics=function(t,e,n){var i=t.id||t,r=this._elements[i];return n?r.secondaryGfx=e:r.gfx=e,e&&o(e,ie,i),e},re.prototype.get=function(t){var e;e="string"==typeof t?t:t&&o(t,ie);var n=this._elements[e];return n&&n.element},re.prototype.filter=function(t){var e=[];return this.forEach((function(n,o){t(n,o)&&e.push(n)})),e},re.prototype.find=function(t){for(var e=this._elements,n=Object.keys(e),o=0;o<n.length;o++){var i=e[n[o]],r=i.element;if(t(r,i.gfx))return r}},re.prototype.getAll=function(){return this.filter((function(t){return t}))},re.prototype.forEach=function(t){var e=this._elements;Object.keys(e).forEach((function(n){var o=e[n],i=o.element,r=o.gfx;return t(i,r)}))},re.prototype.getGraphics=function(t,e){var n=t.id||t,o=this._elements[n];return o&&(e?o.secondaryGfx:o.gfx)},re.prototype._validateId=function(t){if(!t)throw new Error("element must have an id");if(this._elements[t])throw new Error("element with id "+t+" already added")};var ae=new lt({name:"children",enumerable:!0,collection:!0},{name:"parent"}),se=new lt({name:"labels",enumerable:!0,collection:!0},{name:"labelTarget"}),ce=new lt({name:"attachers",collection:!0},{name:"host"}),ue=new lt({name:"outgoing",collection:!0},{name:"source"}),he=new lt({name:"incoming",collection:!0},{name:"target"});function le(){Object.defineProperty(this,"businessObject",{writable:!0}),Object.defineProperty(this,"label",{get:function(){return this.labels[0]},set:function(t){var e=this.label,n=this.labels;!t&&e?n.remove(e):n.add(t,0)}}),ae.bind(this,"parent"),se.bind(this,"labels"),ue.bind(this,"outgoing"),he.bind(this,"incoming")}function pe(){le.call(this),ae.bind(this,"children"),ce.bind(this,"host"),ce.bind(this,"attachers")}function de(){le.call(this),ae.bind(this,"children")}function fe(){pe.call(this),se.bind(this,"labelTarget")}function ve(){le.call(this),ue.bind(this,"source"),he.bind(this,"target")}e(pe,le),e(de,pe),e(fe,pe),e(ve,le);var ge={connection:ve,shape:pe,label:fe,root:de};function ye(){this._uid=12}ye.prototype.createRoot=function(t){return this.create("root",t)},ye.prototype.createLabel=function(t){return this.create("label",t)},ye.prototype.createShape=function(t){return this.create("shape",t)},ye.prototype.createConnection=function(t){return this.create("connection",t)},ye.prototype.create=function(t,e){return(e=_({},e||{})).id||(e.id=t+"_"+this._uid++),function(t,e){var n=ge[t];if(!n)throw new Error("unknown type: <"+t+">");return _(new n,e)}(t,e)};var me="__fn",_e=Array.prototype.slice;function xe(){this._listeners={},this.on("diagram.destroy",1,this._destroy,this)}function we(){}function Ee(t){return t.childNodes[0]}function be(t,e,n,o,i){var r=u();r.setTranslate(e,n);var a=u();a.setRotate(o||0,0,0);var c=u();c.setScale(i||1,i||1),s(t,[r,a,c])}function Se(t,e,n){var o=u();o.setTranslate(e,n),s(t,o)}function Ce(t,e){var n=u();n.setRotate(e,0,0),s(t,n)}function ke(t,e){this._eventBus=t,this._elementRegistry=e}function Me(t,e,n){var o=n||e.firstChild;t!==o&&e.insertBefore(t,o)}xe.prototype.on=function(t,e,n,o){if(t=d(t)?t:[t],M(e)&&(o=n,n=e,e=1e3),!p(e))throw new Error("priority must be a number");var i=n;o&&((i=k(n,o))[me]=n[me]||n);var r=this;t.forEach((function(t){r._addListener(t,{priority:e,callback:i,next:null})}))},xe.prototype.once=function(t,e,n,o){var i=this;if(M(e)&&(o=n,n=e,e=1e3),!p(e))throw new Error("priority must be a number");function r(){r.__isTomb=!0;var e=n.apply(o,arguments);return i.off(t,r),e}r[me]=n,this.on(t,e,r)},xe.prototype.off=function(t,e){t=d(t)?t:[t];var n=this;t.forEach((function(t){n._removeListener(t,e)}))},xe.prototype.createEvent=function(t){var e=new we;return e.init(t),e},xe.prototype.fire=function(t,e){var n,o,i,r;if(r=_e.call(arguments),"object"==typeof t&&(t=(e=t).type),!t)throw new Error("no event type specified");if(o=this._listeners[t]){n=e instanceof we?e:this.createEvent(e),r[0]=n;var a=n.type;t!==a&&(n.type=t);try{i=this._invokeListeners(n,r,o)}finally{t!==a&&(n.type=a)}return void 0===i&&n.defaultPrevented&&(i=!1),i}},xe.prototype.handleError=function(t){return!1===this.fire("error",{error:t})},xe.prototype._destroy=function(){this._listeners={}},xe.prototype._invokeListeners=function(t,e,n){for(var o;n&&!t.cancelBubble;)o=this._invokeListener(t,e,n),n=n.next;return o},xe.prototype._invokeListener=function(t,e,n){var o;if(n.callback.__isTomb)return o;try{o=function(t,e){return t.apply(null,e)}(n.callback,e),void 0!==o&&(t.returnValue=o,t.stopPropagation()),!1===o&&t.preventDefault()}catch(i){if(!this.handleError(i))throw i}return o},xe.prototype._addListener=function(t,e){var n,o=this._getListeners(t);if(o){for(;o;){if(o.priority<e.priority)return e.next=o,void(n?n.next=e:this._setListeners(t,e));n=o,o=o.next}n.next=e}else this._setListeners(t,e)},xe.prototype._getListeners=function(t){return this._listeners[t]},xe.prototype._setListeners=function(t,e){this._listeners[t]=e},xe.prototype._removeListener=function(t,e){var n,o,i,r=this._getListeners(t);if(e)for(;r;)n=r.next,(i=r.callback)!==e&&i[me]!==e||(o?o.next=n:this._setListeners(t,n)),o=r,r=n;else this._setListeners(t,null)},we.prototype.stopPropagation=function(){this.cancelBubble=!0},we.prototype.preventDefault=function(){this.defaultPrevented=!0},we.prototype.init=function(t){_(this,t||{})},ke.$inject=["eventBus","elementRegistry"],ke.prototype._getChildrenContainer=function(t){var e,o=this._elementRegistry.getGraphics(t);return t.parent?(e=function(t){return t.parentNode.childNodes[1]}(o),e||(e=n("g"),a(e).add("djs-children"),i(o.parentNode,e))):e=o,e},ke.prototype._clear=function(t){var e=Ee(t);return V(e),e},ke.prototype._createContainer=function(t,e,o,r){var s=n("g");a(s).add("djs-group"),void 0!==o?Me(s,e,e.childNodes[o]):i(e,s);var c=n("g");a(c).add("djs-element"),a(c).add("djs-"+t),r&&a(c).add("djs-frame"),i(s,c);var u=n("g");return a(u).add("djs-visual"),i(c,u),c},ke.prototype.create=function(t,e,n){var o=this._getChildrenContainer(e.parent);return this._createContainer(t,o,n,jt(e))},ke.prototype.updateContainments=function(t){var e,n=this,o=this._elementRegistry;e=w(t,(function(t,e){return e.parent&&(t[e.parent.id]=e.parent),t}),{}),f(e,(function(t){var e=t.children;if(e){var i=n._getChildrenContainer(t);f(e.slice().reverse(),(function(t){Me(o.getGraphics(t).parentNode,i)}))}}))},ke.prototype.drawShape=function(t,e){return this._eventBus.fire("render.shape",{gfx:t,element:e})},ke.prototype.getShapePath=function(t){return this._eventBus.fire("render.getShapePath",t)},ke.prototype.drawConnection=function(t,e){return this._eventBus.fire("render.connection",{gfx:t,element:e})},ke.prototype.getConnectionPath=function(t){return this._eventBus.fire("render.getConnectionPath",t)},ke.prototype.update=function(t,e,n){if(e.parent){var i=this._clear(n);if("shape"===t)this.drawShape(i,e),Se(n,e.x,e.y);else{if("connection"!==t)throw new Error("unknown type: "+t);this.drawConnection(i,e)}e.hidden?o(n,"display","none"):o(n,"display","block")}},ke.prototype.remove=function(t){var e=this._elementRegistry.getGraphics(t);r(e.parentNode)};const je={__depends__:[Bt],__init__:["canvas"],canvas:["type",ne],elementRegistry:["type",re],elementFactory:["type",ye],eventBus:["type",xe],graphicsFactory:["type",ke]};function Re(e){return function(e){var n=new t(e);return n.init(),n}([{config:["value",e=e||{}]},je].concat(e.modules||[]))}function Te(t,e){this._injector=e=e||Re(t),this.get=e.get,this.invoke=e.invoke,this.get("eventBus").fire("diagram.init")}Te.prototype.destroy=function(){this.get("eventBus").fire("diagram.destroy")},Te.prototype.clear=function(){this.get("eventBus").fire("diagram.clear")};var Be={width:150,height:50};function Pe(t,e){var n;e.textContent=t;try{var o,i=""===t;return e.textContent=i?"dummy":t,o={width:(n=e.getBBox()).width+2*n.x,height:n.height},i&&(o.width=0),o}catch(r){return{width:0,height:0}}}function Le(t,e,n){for(var o,i=t.shift(),r=i;;){if((o=Pe(r,n)).width=r?o.width:0," "===r||""===r||o.width<Math.round(e)||r.length<2)return Oe(t,r,i,o);r=Ae(r,o.width,e)}}function Oe(t,e,n,o){if(e.length<n.length){var i=n.slice(e.length).trim();t.unshift(i)}return{width:o.width,height:o.height,text:e}}var $e="­";function Ae(t,e,n){var o=Math.max(t.length*(n/e),1),i=function(t,e){var n,o=t.split(/(\s|-|\u00AD)/g),i=[],r=0;if(o.length>1)for(;n=o.shift();){if(!(n.length+r<e)){"-"!==n&&n!==$e||i.pop();break}i.push(n),r+=n.length}var a=i[i.length-1];return a&&a===$e&&(i[i.length-1]="-"),i.join("")}(t,o);return i||(i=t.slice(0,Math.max(Math.round(o-1),1))),i}function ze(t){this._config=_({},{size:Be,padding:0,style:{},align:"center-top"},t||{})}ze.prototype.createText=function(t,e){return this.layoutText(t,e).element},ze.prototype.getDimensions=function(t,e){return this.layoutText(t,e).dimensions},ze.prototype.layoutText=function(t,e){var a=_({},this._config.size,e.box),s=_({},this._config.style,e.style),c=function(t){var e=t.split("-");return{horizontal:e[0]||"center",vertical:e[1]||"top"}}(e.align||this._config.align),u=function(t){return y(t)?_({top:0,left:0,right:0,bottom:0},t):{top:t,left:t,right:t,bottom:t}}(void 0!==e.padding?e.padding:this._config.padding),h=e.fitBox||!1,l=function(t){if("fontSize"in t&&"lineHeight"in t)return t.lineHeight*parseInt(t.fontSize,10)}(s),p=t.split(/\u00AD?\r?\n/),d=[],v=a.width-u.left-u.right,g=n("text");o(g,{x:0,y:0}),o(g,s);var m=function(){var t=document.getElementById("helper-svg");return t||(t=n("svg"),o(t,{id:"helper-svg"}),N(t,{visibility:"hidden",position:"fixed",width:0,height:0}),document.body.appendChild(t)),t}();for(i(m,g);p.length;)d.push(Le(p,v,g));"middle"===c.vertical&&(u.top=u.bottom=0);var x=w(d,(function(t,e,n){return t+(l||e.height)}),0)+u.top+u.bottom,E=w(d,(function(t,e,n){return e.width>t?e.width:t}),0),b=u.top;"middle"===c.vertical&&(b+=(a.height-x)/2),b-=(l||d[0].height)/4;var S=n("text");return o(S,s),f(d,(function(t){var e;switch(b+=l||t.height,c.horizontal){case"left":e=u.left;break;case"right":e=(h?E:v)-u.right-t.width;break;default:e=Math.max(((h?E:v)-t.width)/2+u.left,0)}var r=n("tspan");o(r,{x:e,y:b}),r.textContent=t.text,i(S,r)})),r(g),{dimensions:{width:E,height:x},element:S}};const Ie={translate:["value",function(t,e){return e=e||{},t.replace(/{([^}]+)}/g,(function(t,n){return e[n]||"{"+n+"}"}))}]};function De(t){t&&"function"==typeof t.stopPropagation&&t.stopPropagation()}function He(t){return t.originalEvent||t.srcEvent}function Ge(t){De(t),De(He(t))}function Ne(t){return t.pointers&&t.pointers.length&&(t=t.pointers[0]),t.touches&&t.touches.length&&(t=t.touches[0]),t?{x:t.clientX,y:t.clientY}:null}function Ve(t,e){return(He(t)||t).button===e}function Ue(t){return Ve(t,0)}function Fe(t){var e=He(t)||t;return!!Ue(t)&&(/mac/i.test(navigator.platform)?e.metaKey:e.ctrlKey)}function We(t){var e=He(t)||t;return Ue(t)&&e.shiftKey}function Ke(t){return!0}function qe(t){return Ue(t)||function(t){return Ve(t,1)}(t)}function Ye(t,e,a){var s=this;function c(n,o,i){var r,a;(function(t,e){return!(p[t]||Ue)(e)})(n,o)||(i?a=e.getGraphics(i):(r=o.delegateTarget||o.target)&&(a=r,i=e.get(a)),a&&i&&!1===t.fire(n,{element:i,gfx:a,originalEvent:o})&&(o.stopPropagation(),o.preventDefault()))}var u={};function h(t){return u[t]}var l={click:"element.click",contextmenu:"element.contextmenu",dblclick:"element.dblclick",mousedown:"element.mousedown",mousemove:"element.mousemove",mouseover:"element.hover",mouseout:"element.out",mouseup:"element.mouseup"},p={"element.contextmenu":Ke,"element.mousedown":qe,"element.mouseup":qe,"element.click":qe,"element.dblclick":qe};var d="svg, .djs-element";function v(t,e,n,o){var i=u[n]=function(t){c(n,t)};o&&(p[n]=o),i.$delegate=W.bind(t,d,e,i)}function g(t,e,n){var o=h(n);o&&W.unbind(t,e,o.$delegate)}t.on("canvas.destroy",(function(t){var e;e=t.svg,f(l,(function(t,n){g(e,n,t)}))})),t.on("canvas.init",(function(t){var e;e=t.svg,f(l,(function(t,n){v(e,n,t)}))})),t.on(["shape.added","connection.added"],(function(e){var n=e.element,o=e.gfx;t.fire("interactionEvents.createHit",{element:n,gfx:o})})),t.on(["shape.changed","connection.changed"],500,(function(e){var n=e.element,o=e.gfx;t.fire("interactionEvents.updateHit",{element:n,gfx:o})})),t.on("interactionEvents.createHit",500,(function(t){var e=t.element,n=t.gfx;s.createDefaultHit(e,n)})),t.on("interactionEvents.updateHit",(function(t){var e=t.element,n=t.gfx;s.updateDefaultHit(e,n)}));var y=w("djs-hit djs-hit-stroke"),m=w("djs-hit djs-hit-click-stroke"),x={all:w("djs-hit djs-hit-all"),"click-stroke":m,stroke:y,"no-move":w("djs-hit djs-hit-no-move")};function w(t,e){return e=_({stroke:"white",strokeWidth:15},e||{}),a.cls(t,["no-fill","no-border"],e)}function E(t,e){var n=x[e];if(!n)throw new Error("invalid hit type <"+e+">");return o(t,n),t}function b(t,e){i(t,e)}this.removeHits=function(t){var e=U(".djs-hit",t);f(e,r)},this.createDefaultHit=function(t,e){var n,o=t.waypoints,i=t.isFrame;return o?this.createWaypointsHit(e,o):(n=i?"stroke":"all",this.createBoxHit(e,n,{width:t.width,height:t.height}))},this.createWaypointsHit=function(t,e){var n=_t(e);return E(n,"stroke"),b(t,n),n},this.createBoxHit=function(t,e,i){i=_({x:0,y:0},i);var r=n("rect");return E(r,e),o(r,i),b(t,r),r},this.updateDefaultHit=function(t,e){var n=F(".djs-hit",e);if(n)return t.waypoints?xt(n,t.waypoints):o(n,{width:t.width,height:t.height}),n},this.fire=c,this.triggerMouseEvent=function(t,e,n){var o=l[t];if(!o)throw new Error("unmapped DOM event name <"+t+">");return c(o,e,n)},this.mouseHandler=h,this.registerEvent=v,this.unregisterEvent=g}Ye.$inject=["eventBus","elementRegistry","styles"];const Ze={__init__:["interactionEvents"],interactionEvents:["type",Ye]};function Xe(t,e){this.offset=6;var r=e.cls("djs-outline",["no-fill"]),a=this;function s(t,e){var a=n("rect");return o(a,_({x:10,y:10,rx:4,width:100,height:100},r)),i(t,a),a}t.on(["shape.added","shape.changed"],500,(function(t){var e=t.element,n=t.gfx,o=F(".djs-outline",n);o||(o=s(n)),a.updateShapeOutline(o,e)})),t.on(["connection.added","connection.changed"],(function(t){var e=t.element,n=t.gfx,o=F(".djs-outline",n);o||(o=s(n)),a.updateConnectionOutline(o,e)}))}Xe.prototype.updateShapeOutline=function(t,e){o(t,{x:-this.offset,y:-this.offset,width:e.width+2*this.offset,height:e.height+2*this.offset})},Xe.prototype.updateConnectionOutline=function(t,e){var n=kt(e);o(t,{x:n.x-this.offset,y:n.y-this.offset,width:n.width+2*this.offset,height:n.height+2*this.offset})},Xe.$inject=["eventBus","styles","elementRegistry"];const Je={__init__:["outline"],outline:["type",Xe]};function Qe(t,e){this._eventBus=t,this._canvas=e,this._selectedElements=[];var n=this;t.on(["shape.remove","connection.remove"],(function(t){var e=t.element;n.deselect(e)})),t.on(["diagram.clear","root.set"],(function(t){n.select(null)}))}Qe.$inject=["eventBus","canvas"],Qe.prototype.deselect=function(t){var e=this._selectedElements,n=e.indexOf(t);if(-1!==n){var o=e.slice();e.splice(n,1),this._eventBus.fire("selection.changed",{oldSelection:o,newSelection:e})}},Qe.prototype.get=function(){return this._selectedElements},Qe.prototype.isSelected=function(t){return-1!==this._selectedElements.indexOf(t)},Qe.prototype.select=function(t,e){var n=this._selectedElements,o=n.slice();d(t)||(t=t?[t]:[]);var i=this._canvas,r=i.getRootElement();t=t.filter((function(t){var e=i.findRoot(t);return r===e})),e?f(t,(function(t){-1===n.indexOf(t)&&n.push(t)})):this._selectedElements=n=t.slice(),this._eventBus.fire("selection.changed",{oldSelection:o,newSelection:n})};var tn="hover",en="selected";function nn(t,e,n){this._canvas=t;var o=this;function i(e,n){t.addMarker(e,n)}function r(e,n){t.removeMarker(e,n)}this._multiSelectionBox=null,e.on("element.hover",(function(t){i(t.element,tn)})),e.on("element.out",(function(t){r(t.element,tn)})),e.on("selection.changed",(function(t){var e=t.oldSelection,n=t.newSelection;f(e,(function(t){-1===n.indexOf(t)&&r(t,en)})),f(n,(function(t){-1===e.indexOf(t)&&i(t,en)})),o._updateSelectionOutline(n)})),e.on("element.changed",(function(t){n.isSelected(t.element)&&o._updateSelectionOutline(n.get())}))}function on(t,e,n,o){t.on("create.end",500,(function(t){var n=t.context,o=n.canExecute,i=n.elements,r=(n.hints||{}).autoSelect;if(o){if(!1===r)return;d(r)?e.select(r):e.select(i.filter(rn))}})),t.on("connect.end",500,(function(t){var n=t.context.connection;n&&e.select(n)})),t.on("shape.move.end",500,(function(t){var n=t.previousSelection||[],i=o.get(t.context.shape.id);g(n,(function(t){return i.id===t.id}))||e.select(i)})),t.on("element.click",(function(t){if(Ue(t)){var o=t.element;o===n.getRootElement()&&(o=null);var i=e.isSelected(o),r=e.get().length>1,a=Fe(t)||We(t);if(i&&r)return a?e.deselect(o):e.select(o);i?e.deselect(o):e.select(o,a)}}))}function rn(t){return!t.hidden}nn.$inject=["canvas","eventBus","selection"],nn.prototype._updateSelectionOutline=function(t){var e=this._canvas.getLayer("selectionOutline");h(e);var r=t.length>1,s=this._canvas.getContainer();if(a(s)[r?"add":"remove"]("djs-multi-select"),r){var c=function(t){return{x:t.x-6,y:t.y-6,width:t.width+12,height:t.height+12}}(kt(t)),u=n("rect");o(u,_({rx:3},c)),a(u).add("djs-selection-outline"),i(e,u)}},on.$inject=["eventBus","selection","canvas","elementRegistry"];const an={__init__:["selectionVisuals","selectionBehavior"],__depends__:[Ze,Je],selection:["type",Qe],selectionVisuals:["type",nn],selectionBehavior:["type",on]};function sn(t){this._counter=0,this._prefix=(t?t+"-":"")+Math.floor(1e9*Math.random())+"-"}sn.prototype.next=function(){return this._prefix+ ++this._counter};var cn=new sn("ov");function un(t,e,n,o){var i,r;this._eventBus=e,this._canvas=n,this._elementRegistry=o,this._ids=cn,this._overlayDefaults=_({show:null,scale:!0},t&&t.defaults),this._overlays={},this._overlayContainers=[],this._overlayRoot=(i=n.getContainer(),r=Y('<div class="djs-overlay-container" />'),N(r,{position:"absolute",width:0,height:0}),i.insertBefore(r,i.firstChild),r),this._init()}function hn(t,e,n){N(t,{left:e+"px",top:n+"px"})}function ln(t,e){t.style.display=!1===e?"none":""}function pn(t,e){t.style["transform-origin"]="top left",["","-ms-","-webkit-"].forEach((function(n){t.style[n+"transform"]=e}))}un.$inject=["config.overlays","eventBus","canvas","elementRegistry"],un.prototype.get=function(t){if(j(t)&&(t={id:t}),j(t.element)&&(t.element=this._elementRegistry.get(t.element)),t.element){var e=this._getOverlayContainer(t.element,!0);return e?t.type?v(e.overlays,R({type:t.type})):e.overlays.slice():[]}return t.type?v(this._overlays,R({type:t.type})):t.id?this._overlays[t.id]:null},un.prototype.add=function(t,e,n){if(y(e)&&(n=e,e=null),t.id||(t=this._elementRegistry.get(t)),!n.position)throw new Error("must specifiy overlay position");if(!n.html)throw new Error("must specifiy overlay html");if(!t)throw new Error("invalid element specified");var o=this._ids.next();return n=_({},this._overlayDefaults,n,{id:o,type:e,element:t,html:n.html}),this._addOverlay(n),o},un.prototype.remove=function(t){var e=this.get(t)||[];d(e)||(e=[e]);var n=this;f(e,(function(t){var e=n._getOverlayContainer(t.element,!0);if(t&&(K(t.html),K(t.htmlContainer),delete t.htmlContainer,delete t.element,delete n._overlays[t.id]),e){var o=e.overlays.indexOf(t);-1!==o&&e.overlays.splice(o,1)}}))},un.prototype.isShown=function(){return"none"!==this._overlayRoot.style.display},un.prototype.show=function(){ln(this._overlayRoot)},un.prototype.hide=function(){ln(this._overlayRoot,!1)},un.prototype.clear=function(){this._overlays={},this._overlayContainers=[],V(this._overlayRoot)},un.prototype._updateOverlayContainer=function(t){var e=t.element,n=t.html,o=e.x,i=e.y;if(e.waypoints){var r=kt(e);o=r.x,i=r.y}hn(n,o,i),q(t.html,"data-container-id",e.id)},un.prototype._updateOverlay=function(t){var e,n,o=t.position,i=t.htmlContainer,r=t.element,a=o.left,s=o.top;void 0!==o.right&&(e=r.waypoints?kt(r).width:r.width,a=-1*o.right+e);void 0!==o.bottom&&(n=r.waypoints?kt(r).height:r.height,s=-1*o.bottom+n);hn(i,a||0,s||0),this._updateOverlayVisibilty(t,this._canvas.viewbox())},un.prototype._createOverlayContainer=function(t){var e=Y('<div class="djs-overlays" />');N(e,{position:"absolute"}),this._overlayRoot.appendChild(e);var n={html:e,element:t,overlays:[]};return this._updateOverlayContainer(n),this._overlayContainers.push(n),n},un.prototype._updateRoot=function(t){var e=t.scale||1,n="matrix("+[e,0,0,e,-1*t.x*e,-1*t.y*e].join(",")+")";pn(this._overlayRoot,n)},un.prototype._getOverlayContainer=function(t,e){var n=g(this._overlayContainers,(function(e){return e.element===t}));return n||e?n:this._createOverlayContainer(t)},un.prototype._addOverlay=function(t){var e,n,o=t.id,i=t.element,r=t.html;r.get&&r.constructor.prototype.jquery&&(r=r.get(0)),j(r)&&(r=Y(r)),n=this._getOverlayContainer(i),e=Y('<div class="djs-overlay" data-overlay-id="'+o+'">'),N(e,{position:"absolute"}),e.appendChild(r),t.type&&Z(e).add("djs-overlay-"+t.type),ln(e,this._canvas.findRoot(i)===this._canvas.getRootElement()),t.htmlContainer=e,n.overlays.push(t),n.html.appendChild(e),this._overlays[o]=t,this._updateOverlay(t),this._updateOverlayVisibilty(t,this._canvas.viewbox())},un.prototype._updateOverlayVisibilty=function(t,e){var n=t.show,o=this._canvas.findRoot(t.element),i=n&&n.minZoom,r=n&&n.maxZoom,a=t.htmlContainer,s=!0;(o!==this._canvas.getRootElement()||n&&(T(i)&&i>e.scale||T(r)&&r<e.scale))&&(s=!1),ln(a,s),this._updateOverlayScale(t,e)},un.prototype._updateOverlayScale=function(t,e){var n,o,i,r=t.scale,a=t.htmlContainer,s="";!0!==r&&(!1===r?(n=1,o=1):(n=r.min,o=r.max),T(n)&&e.scale<n&&(i=(1/e.scale||1)*n),T(o)&&e.scale>o&&(i=(1/e.scale||1)*o)),T(i)&&(s="scale("+i+","+i+")"),pn(a,s)},un.prototype._updateOverlaysVisibilty=function(t){var e=this;f(this._overlays,(function(n){e._updateOverlayVisibilty(n,t)}))},un.prototype._init=function(){var t=this._eventBus,e=this;t.on("canvas.viewbox.changing",(function(t){e.hide()})),t.on("canvas.viewbox.changed",(function(t){var n;n=t.viewbox,e._updateRoot(n),e._updateOverlaysVisibilty(n),e.show()})),t.on(["shape.remove","connection.remove"],(function(t){var n=t.element,o=e.get({element:n});f(o,(function(t){e.remove(t.id)}));var i=e._getOverlayContainer(n);if(i){K(i.html);var r=e._overlayContainers.indexOf(i);-1!==r&&e._overlayContainers.splice(r,1)}})),t.on("element.changed",500,(function(t){var n=t.element,o=e._getOverlayContainer(n,!0);o&&(f(o.overlays,(function(t){e._updateOverlay(t)})),e._updateOverlayContainer(o))})),t.on("element.marker.update",(function(t){var n=e._getOverlayContainer(t.element,!0);n&&Z(n.html)[t.add?"add":"remove"](t.marker)})),t.on("root.set",(function(){e._updateOverlaysVisibilty(e._canvas.viewbox())})),t.on("diagram.clear",this.clear,this)};const dn={__init__:["overlays"],overlays:["type",un]};function fn(t,e,n,o){t.on("element.changed",(function(o){var i=o.element;(i.parent||i===e.getRootElement())&&(o.gfx=n.getGraphics(i)),o.gfx&&t.fire(Mt(i)+".changed",o)})),t.on("elements.changed",(function(e){var n=e.elements;n.forEach((function(e){t.fire("element.changed",{element:e})})),o.updateContainments(n)})),t.on("shape.changed",(function(t){o.update("shape",t.element,t.gfx)})),t.on("connection.changed",(function(t){o.update("connection",t.element,t.gfx)}))}fn.$inject=["eventBus","canvas","elementRegistry","graphicsFactory"];const vn={__init__:["changeSupport"],changeSupport:["type",fn]};function gn(t){this._eventBus=t}function yn(t){return function(e,n,o,i,r){(M(e)||p(e))&&(r=i,i=o,o=n,n=e,e=null),this.on(e,t,n,o,i,r)}}function mn(t,e){e.invoke(gn,this),this.executed((function(e){var n=e.context;n.rootElement?t.setRootElement(n.rootElement):n.rootElement=t.getRootElement()})),this.revert((function(e){var n=e.context;n.rootElement&&t.setRootElement(n.rootElement)}))}gn.$inject=["eventBus"],gn.prototype.on=function(t,e,n,o,i,r){if((M(e)||p(e))&&(r=i,i=o,o=n,n=e,e=null),M(n)&&(r=i,i=o,o=n,n=1e3),y(i)&&(r=i,i=!1),!M(o))throw new Error("handlerFn must be a function");d(t)||(t=[t]);var a=this._eventBus;f(t,(function(t){var s=["commandStack",t,e].filter((function(t){return t})).join(".");a.on(s,n,i?function(t,e){return function(n){return t.call(e||null,n.context,n.command,n)}}(o,r):o,r)}))},gn.prototype.canExecute=yn("canExecute"),gn.prototype.preExecute=yn("preExecute"),gn.prototype.preExecuted=yn("preExecuted"),gn.prototype.execute=yn("execute"),gn.prototype.executed=yn("executed"),gn.prototype.postExecute=yn("postExecute"),gn.prototype.postExecuted=yn("postExecuted"),gn.prototype.revert=yn("revert"),gn.prototype.reverted=yn("reverted"),e(mn,gn),mn.$inject=["canvas","injector"];const _n={__init__:["rootElementsBehavior"],rootElementsBehavior:["type",mn]};function xn(t){return CSS.escape(t)}var wn={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;"};function En(t){return(t=""+t)&&t.replace(/[&<>"']/g,(function(t){return wn[t]}))}var bn=["c","C"],Sn=["v","V"],Cn=["y","Y"],kn=["z","Z"];function Mn(t){return!t.altKey&&(t.ctrlKey||t.metaKey)}function jn(t,e){return-1!==(t=d(t)?t:[t]).indexOf(e.key)||-1!==t.indexOf(e.code)}function Rn(t){return t.shiftKey}var Tn="keyboard.keydown",Bn="input-handle-modified-keys";function Pn(t,e){var n=this;this._config=t||{},this._eventBus=e,this._keydownHandler=this._keydownHandler.bind(this),this._keyupHandler=this._keyupHandler.bind(this),e.on("diagram.destroy",(function(){n._fire("destroy"),n.unbind()})),e.on("diagram.init",(function(){n._fire("init")})),e.on("attach",(function(){t&&t.bindTo&&n.bind(t.bindTo)})),e.on("detach",(function(){n.unbind()}))}Pn.$inject=["config.keyboard","eventBus"],Pn.prototype._keydownHandler=function(t){this._keyHandler(t,Tn)},Pn.prototype._keyupHandler=function(t){this._keyHandler(t,"keyboard.keyup")},Pn.prototype._keyHandler=function(t,e){if(!this._isEventIgnored(t)){var n={keyEvent:t};this._eventBus.fire(e||Tn,n)&&t.preventDefault()}},Pn.prototype._isEventIgnored=function(t){return!!t.defaultPrevented||(e=t.target)&&(Q(e,"input, textarea")||"true"===e.contentEditable)&&this._isModifiedKeyIgnored(t);var e},Pn.prototype._isModifiedKeyIgnored=function(t){return!Mn(t)||-1===this._getAllowedModifiers(t.target).indexOf(t.key)},Pn.prototype._getAllowedModifiers=function(t){var e=X(t,"["+Bn+"]",!0);return!e||this._node&&!this._node.contains(e)?[]:e.getAttribute(Bn).split(",")},Pn.prototype.bind=function(t){this.unbind(),this._node=t,J.bind(t,"keydown",this._keydownHandler),J.bind(t,"keyup",this._keyupHandler),this._fire("bind")},Pn.prototype.getBinding=function(){return this._node},Pn.prototype.unbind=function(){var t=this._node;t&&(this._fire("unbind"),J.unbind(t,"keydown",this._keydownHandler),J.unbind(t,"keyup",this._keyupHandler)),this._node=null},Pn.prototype._fire=function(t){this._eventBus.fire("keyboard."+t,{node:this._node})},Pn.prototype.addListener=function(t,e,n){M(t)&&(n=e,e=t,t=1e3),this._eventBus.on(n||Tn,t,e)},Pn.prototype.removeListener=function(t,e){this._eventBus.off(e||Tn,t)},Pn.prototype.hasModifier=function(t){return t.ctrlKey||t.metaKey||t.shiftKey||t.altKey},Pn.prototype.isCmd=Mn,Pn.prototype.isShift=Rn,Pn.prototype.isKey=jn;function Ln(t,e){var n=this;t.on("editorActions.init",500,(function(t){var o=t.editorActions;n.registerBindings(e,o)}))}Ln.$inject=["eventBus","keyboard"],Ln.prototype.registerBindings=function(t,e){function n(n,o){e.isRegistered(n)&&t.addListener(o)}n("undo",(function(t){if(function(t){return Mn(t)&&!Rn(t)&&jn(kn,t)}(t.keyEvent))return e.trigger("undo"),!0})),n("redo",(function(t){if(function(t){return Mn(t)&&(jn(Cn,t)||jn(kn,t)&&Rn(t))}(t.keyEvent))return e.trigger("redo"),!0})),n("copy",(function(t){if(function(t){return Mn(t)&&jn(bn,t)}(t.keyEvent))return e.trigger("copy"),!0})),n("paste",(function(t){if(function(t){return Mn(t)&&jn(Sn,t)}(t.keyEvent))return e.trigger("paste"),!0})),n("stepZoom",(function(t){var n=t.keyEvent;if(jn(["+","Add","="],n)&&Mn(n))return e.trigger("stepZoom",{value:1}),!0})),n("stepZoom",(function(t){var n=t.keyEvent;if(jn(["-","Subtract"],n)&&Mn(n))return e.trigger("stepZoom",{value:-1}),!0})),n("zoom",(function(t){var n=t.keyEvent;if(jn("0",n)&&Mn(n))return e.trigger("zoom",{value:1}),!0})),n("removeSelection",(function(t){if(jn(["Backspace","Delete","Del"],t.keyEvent))return e.trigger("removeSelection"),!0}))};const On={__init__:["keyboard","keyboardBindings"],keyboard:["type",Pn],keyboardBindings:["type",Ln]};var $n={moveSpeed:50,moveSpeedAccelerated:200};function An(t,e,n){var o=this;this._config=_({},$n,t||{}),e.addListener((function(t){var n=t.keyEvent,i=o._config;if(!e.isCmd(n))return;if(e.isKey(["ArrowLeft","Left","ArrowUp","Up","ArrowDown","Down","ArrowRight","Right"],n)){var r,a=e.isShift(n)?i.moveSpeedAccelerated:i.moveSpeed;switch(n.key){case"ArrowLeft":case"Left":r="left";break;case"ArrowUp":case"Up":r="up";break;case"ArrowRight":case"Right":r="right";break;case"ArrowDown":case"Down":r="down"}return o.moveCanvas({speed:a,direction:r}),!0}})),this.moveCanvas=function(t){var e=0,o=0,i=t.speed/Math.min(Math.sqrt(n.viewbox().scale),1);switch(t.direction){case"left":e=i;break;case"up":o=i;break;case"right":e=-i;break;case"down":o=-i}n.scroll({dx:e,dy:o})}}An.$inject=["config.keyboardMove","keyboard","canvas"];const zn={__depends__:[On],__init__:["keyboardMove"],keyboardMove:["type",An]};var In=/^djs-cursor-.*$/;function Dn(t){var e=Z(document.body);e.removeMatching(In),t&&e.add("djs-cursor-"+t)}function Hn(){Dn(null)}var Gn=5e3;function Nn(t,e){function n(){return!1}return e=e||"element.click",t.once(e,Gn,n),function(){t.off(e,n)}}function Vn(t){return{x:t.x+t.width/2,y:t.y+t.height/2}}function Un(t,e){return{x:t.x-e.x,y:t.y-e.y}}function Fn(t,e){var n;function o(o){var i,r=n.start,a=n.button,s=Ne(o),c=Un(s,r);(!n.dragging&&(i=c,Math.sqrt(Math.pow(i.x,2)+Math.pow(i.y,2))>15)&&(n.dragging=!0,0===a&&Nn(t),Dn("grab")),n.dragging)&&(c=Un(s,n.last||n.start),e.scroll({dx:c.x,dy:c.y}),n.last=s);o.preventDefault()}function i(t){J.unbind(document,"mousemove",o),J.unbind(document,"mouseup",i),n=null,Hn()}t.on("element.mousedown",500,(function(t){return function(t){if(X(t.target,".djs-draggable"))return;var e=t.button;if(e>=2||t.ctrlKey||t.shiftKey||t.altKey)return;return n={button:e,start:Ne(t)},J.bind(document,"mousemove",o),J.bind(document,"mouseup",i),!0}(t.originalEvent)})),this.isActive=function(){return!!n}}Fn.$inject=["eventBus","canvas"];const Wn={__init__:["moveCanvas"],moveCanvas:["type",Fn]};function Kn(t){return Math.log(t)/Math.log(10)}function qn(t,e){var n=Kn(t.min),o=Kn(t.max);return(Math.abs(n)+Math.abs(o))/e}var Yn=Math.sign||function(t){return t>=0?1:-1},Zn={min:.2,max:4};function Xn(t,e,n){t=t||{},this._enabled=!1,this._canvas=n,this._container=n._container,this._handleWheel=k(this._handleWheel,this),this._totalDelta=0,this._scale=t.scale||.75;var o=this;e.on("canvas.init",(function(e){o._init(!1!==t.enabled)}))}Xn.$inject=["config.zoomScroll","eventBus","canvas"],Xn.prototype.scroll=function(t){this._canvas.scroll(t)},Xn.prototype.reset=function(){this._canvas.zoom("fit-viewport")},Xn.prototype.zoom=function(t,e){var n=qn(Zn,20);this._totalDelta+=t,Math.abs(this._totalDelta)>.1&&(this._zoom(t,e,n),this._totalDelta=0)},Xn.prototype._handleWheel=function(t){if(!X(t.target,".djs-scrollable",!0)){var e=this._container;t.preventDefault();var n,o=t.ctrlKey,i=t.shiftKey,r=-1*this._scale;if(r*=o?0===t.deltaMode?.02:.32:0===t.deltaMode?1:16,o){var a=e.getBoundingClientRect(),s={x:t.clientX-a.left,y:t.clientY-a.top};n=Math.sqrt(Math.pow(t.deltaY,2)+Math.pow(t.deltaX,2))*Yn(t.deltaY)*r,this.zoom(n,s)}else n=i?{dx:r*t.deltaY,dy:0}:{dx:r*t.deltaX,dy:r*t.deltaY},this.scroll(n)}},Xn.prototype.stepZoom=function(t,e){var n=qn(Zn,10);this._zoom(t,e,n)},Xn.prototype._zoom=function(t,e,n){var o=this._canvas,i=t>0?1:-1,r=Kn(o.zoom()),a=Math.round(r/n)*n;a+=n*i;var s,c,u=Math.pow(10,a);o.zoom((s=Zn,c=u,Math.max(s.min,Math.min(s.max,c))),e)},Xn.prototype.toggle=function(t){var e=this._container,n=this._handleWheel,o=this._enabled;return void 0===t&&(t=!o),o!==t&&J[t?"bind":"unbind"](e,"wheel",n,!1),this._enabled=t,t},Xn.prototype._init=function(t){this.toggle(t)};const Jn={__init__:["zoomScroll"],zoomScroll:["type",Xn]};var Qn=["mousedown","mouseup","mouseover","mouseout","click","dblclick"];function to(t,e){return e.get(t,!1)}function eo(t){t.preventDefault(),"function"==typeof t.stopPropagation?t.stopPropagation():t.srcEvent&&"function"==typeof t.srcEvent.stopPropagation&&t.srcEvent.stopPropagation(),"function"==typeof t.stopImmediatePropagation&&t.stopImmediatePropagation()}function no(t){function e(e){setTimeout((function(){f(Qn,(function(e){J.unbind(t,e,eo,!0)}))}),500)}J.bind(t,"touchstart",(function(e){f(Qn,(function(e){J.bind(t,e,eo,!0)}))}),!0),J.bind(t,"touchend",e,!0),J.bind(t,"touchcancel",e,!0);var n=new tt.Manager(t,{inputClass:tt.TouchInput,recognizers:[],domEvents:!0}),o=new tt.Tap,i=new tt.Pan({threshold:10}),r=new tt.Press,a=new tt.Pinch,s=new tt.Tap({event:"doubletap",taps:2});return a.requireFailure(i),a.requireFailure(r),n.add([i,r,a,s,o]),n.reset=function(t){var e=this.recognizers,o=this.session;o.stopped||(n.stop(t),setTimeout((function(){var t,n;for(t=0;n=e[t];t++)n.reset(),n.state=8;o.curRecognizer=null}),0))},n.on("hammer.input",(function(t){t.srcEvent.defaultPrevented&&n.reset(!0)})),n}function oo(t,e,n,o,i){var r,a=to("dragging",t),s=to("move",t),c=to("contextPad",t),u=to("palette",t);function h(t,e){return function(n){var r=l(n.target),a=r&&o.get(r);return e&&(n.srcEvent.button=e),i.fire(t,n,a)}}function l(t){return X(t,"svg, .djs-element",!0)}function p(t){function n(t){var n=l(t.target),i=n&&o.get(n);if(s&&e.getRootElement()!==i)return s.start(t,i,!0);!function(t){var n=0,o=0;function i(t){var i=t.deltaX-n,r=t.deltaY-o;e.scroll({dx:i,dy:r}),n=t.deltaX,o=t.deltaY}function a(t){r.off("panmove",i),r.off("panend",a),r.off("pancancel",a)}r.on("panmove",i),r.on("panend",a),r.on("pancancel",a)}()}(r=no(t)).on("tap",h("element.click")),r.on("doubletap",h("element.dblclick",1)),r.on("panstart",n),r.on("press",n),r.on("pinchstart",(function(t){var n=e.zoom(),o=t.center;function i(t){var i=1-(1-t.scale)/1.5,r=Math.max(.2,Math.min(4,i*n));e.zoom(r,o),eo(t)}function a(t){r.off("pinchmove",i),r.off("pinchend",a),r.off("pinchcancel",a),r.reset(!0)}r.on("pinchmove",i),r.on("pinchend",a),r.on("pinchcancel",a)}))}a&&n.on("drag.move",(function(t){var e=t.originalEvent;if(e&&!(e instanceof MouseEvent)){var n=Ne(e),i=l(document.elementFromPoint(n.x,n.y)),r=i&&o.get(i);r!==t.hover&&(t.hover&&a.out(t),r&&(a.hover({element:r,gfx:i}),t.hover=r,t.hoverGfx=i))}})),c&&n.on("contextPad.create",(function(t){var e=no(t.pad.html);e.on("panstart",(function(t){c.trigger("dragstart",t,!0)})),e.on("press",(function(t){c.trigger("dragstart",t,!0)})),e.on("tap",(function(t){c.trigger("click",t)}))})),u&&n.on("palette.create",(function(t){var e=no(t.container);e.on("panstart",(function(t){u.trigger("dragstart",t,!0)})),e.on("press",(function(t){u.trigger("dragstart",t,!0)})),e.on("tap",(function(t){u.trigger("click",t)}))})),n.on("canvas.init",(function(t){p(t.svg)}))}function io(t){var e=this;t.on("canvas.init",(function(t){e.addBBoxMarker(t.svg)}))}oo.$inject=["injector","canvas","eventBus","elementRegistry","interactionEvents","touchFix"],io.$inject=["eventBus"],io.prototype.addBBoxMarker=function(t){var e={fill:"none",class:"outer-bound-marker"},r=n("rect");o(r,{x:-1e4,y:1e4,width:10,height:10}),o(r,e),i(t,r);var a=n("rect");o(a,{x:1e4,y:1e4,width:10,height:10}),o(a,e),i(t,a)};const ro={__depends__:[{__depends__:[Ze],__init__:["touchInteractionEvents"],touchInteractionEvents:["type",oo],touchFix:["type",io]}]};function ao(t){return t&&t[t.length-1]}function so(t){return t.y}function co(t){return t.x}var uo={left:co,center:co,right:function(t){return t.x+t.width},top:so,middle:so,bottom:function(t){return t.y+t.height}};function ho(t,e){this._modeling=t,this._rules=e}ho.$inject=["modeling","rules"],ho.prototype._getOrientationDetails=function(t){var e="x",n="width";return-1!==["top","bottom","middle"].indexOf(t)&&(e="y",n="height"),{axis:e,dimension:n}},ho.prototype._isType=function(t,e){return-1!==e.indexOf(t)},ho.prototype._alignmentPosition=function(t,e){var n,o,i,r,a,s=this._getOrientationDetails(t),c=s.axis,u=s.dimension,h={},l={},p=!1;if(this._isType(t,["left","top"]))h[t]=e[0][c];else if(this._isType(t,["right","bottom"]))i=ao(e),h[t]=i[c]+i[u];else if(this._isType(t,["center","middle"])){if(f(e,(function(t){var e=t[c]+Math.round(t[u]/2);l[e]?l[e].elements.push(t):l[e]={elements:[t],center:e}})),n=S(l,(function(t){return t.elements.length>1&&(p=!0),t.elements.length})),p)return h[t]=ao(n).center,h;o=e[0],i=ao(e=S(e,(function(t){return t[c]+t[u]}))),h[t]=(r=o,a=i,Math.round((r[c]+a[c]+a[u])/2))}return h},ho.prototype.trigger=function(t,e){var n,o=this._modeling,i=v(t,(function(t){return!(t.waypoints||t.host||t.labelTarget)}));if(n=this._rules.allowed("elements.align",{elements:i}),d(n)&&(i=n),!(i.length<2)&&n){var r=S(i,uo[e]),a=this._alignmentPosition(e,r);o.alignElements(r,a)}};const lo={__init__:["alignElements"],alignElements:["type",ho]};var po=".entry";function fo(t,e,n,o){this._canvas=t,this._eventBus=n,this._overlays=o;var i=T(e&&e.scale)?e.scale:{min:1,max:1.5};this._overlaysConfig={scale:i},this._current=null,this._init()}function vo(t,e){return-1!==t.indexOf(e)}fo.$inject=["canvas","config.contextPad","eventBus","overlays"],fo.prototype._init=function(){var t=this;this._eventBus.on("selection.changed",(function(e){var n=e.newSelection,o=n.length?1===n.length?n[0]:n:null;o?t.open(o,!0):t.close()})),this._eventBus.on("elements.changed",(function(e){var n=e.elements,o=t._current;if(o){var i=o.target;B(d(i)?i:[i],(function(t){return vo(n,t)}))&&t.open(i,!0)}}))},fo.prototype.registerProvider=function(t,e){e||(e=t,t=1e3),this._eventBus.on("contextPad.getProviders",t,(function(t){t.providers.push(e)}))},fo.prototype.getEntries=function(t){var e=this._getProviders(),n=d(t)?"getMultiElementContextPadEntries":"getContextPadEntries",o={};return f(e,(function(e){if(M(e[n])){var i=e[n](t);M(i)?o=i(o):f(i,(function(t,e){o[e]=t}))}})),o},fo.prototype.trigger=function(t,e,n){var o,i,r=e.delegateTarget||e.target;return r?(o=q(r,"data-action"),i=e.originalEvent||e,this.triggerEntry(o,t,i,n)):e.preventDefault()},fo.prototype.triggerEntry=function(t,e,n,o){if(this.isShown()){var i=this._current.target,r=this._current.entries[t];if(r){var a=r.action;if(!1!==this._eventBus.fire("contextPad.trigger",{entry:r,event:n})){if(M(a)){if("click"===e)return a(n,i,o)}else if(a[e])return a[e](n,i,o);n.preventDefault()}}}},fo.prototype.open=function(t,e){!e&&this.isOpen(t)||(this.close(),this._updateAndOpen(t))},fo.prototype._getProviders=function(){var t=this._eventBus.createEvent({type:"contextPad.getProviders",providers:[]});return this._eventBus.fire(t),t.providers},fo.prototype._updateAndOpen=function(t){var e,n=this.getEntries(t),o=this.getPad(t),i=o.html;f(n,(function(t,n){var o,r,a,s,c=t.group||"default",u=Y(t.html||'<div class="entry" draggable="true"></div>');q(u,"data-action",n),(o=F("[data-group="+xn(c)+"]",i))||(o=Y('<div class="group"></div>'),q(o,"data-group",c),i.appendChild(o)),o.appendChild(u),t.className&&(r=u,a=t.className,s=Z(r),(a=d(a)?a:a.split(/\s+/g)).forEach((function(t){s.add(t)}))),t.title&&q(u,"title",t.title),t.imageUrl&&(e=Y("<img>"),q(e,"src",t.imageUrl),e.style.width="100%",e.style.height="100%",u.appendChild(e))})),Z(i).add("open"),this._current={target:t,entries:n,pad:o},this._eventBus.fire("contextPad.open",{current:this._current})},fo.prototype.getPad=function(t){if(this.isOpen())return this._current.pad;var e=this,n=this._overlays,o=Y('<div class="djs-context-pad"></div>'),i=this._getPosition(t),r=_({html:o},this._overlaysConfig,i);W.bind(o,po,"click",(function(t){e.trigger("click",t)})),W.bind(o,po,"dragstart",(function(t){e.trigger("dragstart",t)})),J.bind(o,"mousedown",(function(t){t.stopPropagation()}));var a=this._canvas.getRootElement();this._overlayId=n.add(a,"context-pad",r);var s=n.get(this._overlayId);return this._eventBus.fire("contextPad.create",{target:t,pad:s}),s},fo.prototype.close=function(){this.isOpen()&&(this._overlays.remove(this._overlayId),this._overlayId=null,this._eventBus.fire("contextPad.close",{current:this._current}),this._current=null)},fo.prototype.isOpen=function(t){var e=this._current;if(!e)return!1;if(!t)return!0;var n=e.target;return d(t)===d(n)&&(d(t)?t.length===n.length&&E(t,(function(t){return vo(n,t)})):n===t)},fo.prototype.isShown=function(){return this.isOpen()&&this._overlays.isShown()},fo.prototype._getPosition=function(t){var e=kt(d(t)?t:[t]);return{position:{left:e.x+e.width+12,top:e.y-6}}};const go={__depends__:[Ze,dn],contextPad:["type",fo]};function yo(t){const{entry:e,selected:n,onMouseEnter:o,onMouseLeave:i,onAction:r}=t;return nt`
    <li
      class=${et("entry",{selected:n})}
      data-id=${e.id}
      title=${e.title||e.label}
      onClick=${r}
      onMouseEnter=${o}
      onMouseLeave=${i}
      onDragStart=${t=>r(t,e,"dragstart")}
      draggable=${!0}
    >
      <div class="djs-popup-entry-content">
        <span
          class=${et("djs-popup-entry-name",e.className)}
        >
          ${e.imageUrl&&nt`<img class="djs-popup-entry-icon" src=${e.imageUrl} alt="" />`||e.imageHtml&&nt`<div class="djs-popup-entry-icon" dangerouslySetInnerHTML=${{__html:e.imageHtml}} />`}

          ${e.label?nt`
            <span class="djs-popup-label">
              ${e.label}
            </span>
          `:null}
        </span>
        ${e.description&&nt`
          <span
            class="djs-popup-entry-description"
            title=${e.description}
          >
            ${e.description}
          </span>
        `}
      </div>
      ${e.documentationRef&&nt`
        <div class="djs-popup-entry-docs">
          <a
            href="${e.documentationRef}"
            onClick=${t=>t.stopPropagation()}
            title="Open element documentation"
            target="_blank"
            rel="noopener"
          >
            <svg width="12" height="12" viewBox="0 0 12 12" fill="none" xmlns="http://www.w3.org/2000/svg">
              <path fill-rule="evenodd" clip-rule="evenodd" d="M10.6368 10.6375V5.91761H11.9995V10.6382C11.9995 10.9973 11.8623 11.3141 11.5878 11.5885C11.3134 11.863 10.9966 12.0002 10.6375 12.0002H1.36266C0.982345 12.0002 0.660159 11.8681 0.396102 11.6041C0.132044 11.34 1.52588e-05 11.0178 1.52588e-05 10.6375V1.36267C1.52588e-05 0.98236 0.132044 0.660173 0.396102 0.396116C0.660159 0.132058 0.982345 2.95639e-05 1.36266 2.95639e-05H5.91624V1.36267H1.36266V10.6375H10.6368ZM12 0H7.2794L7.27873 1.36197H9.68701L3.06507 7.98391L4.01541 8.93425L10.6373 2.31231V4.72059H12V0Z" fill="#818798"/>
            </svg>
          </a>
        </div>
      `}
    </li>
  `}function mo(t){const{selectedEntry:e,setSelectedEntry:n,entries:o,...i}=t,r=ot(),a=it((()=>function(t){const e=[],n=t=>e.find((e=>t.id===e.id)),o=t=>!!n(t),i=t=>"string"==typeof t?{id:t}:t;return t.forEach((t=>{const r=t.group?i(t.group):{id:"default"};o(r)?n(r).entries.push(t):e.push({...r,entries:[t]})})),e}(o)),[o]);return rt((()=>{const t=r.current;if(!t)return;const e=t.querySelector(".selected");var n;e&&("function"==typeof(n=e).scrollIntoViewIfNeeded?n.scrollIntoViewIfNeeded():n.scrollIntoView({scrollMode:"if-needed",block:"nearest"}))}),[e]),nt`
    <div class="djs-popup-results" ref=${r}>
      ${a.map((t=>nt`
        ${t.name&&nt`
          <div key=${t.id} class="entry-header" title=${t.name}>
            ${t.name}
          </div>
        `}
        <ul class="djs-popup-group" data-group=${t.id}>
          ${t.entries.map((t=>nt`
            <${yo}
              key=${t.id}
              entry=${t}
              selected=${t===e}
              onMouseEnter=${()=>n(t)}
              onMouseLeave=${()=>n(null)}
              ...${i}
            />
          `))}
        </ul>
      `))}
    </div>
  `}function _o(t){const{onClose:e,onSelect:n,className:o,headerEntries:i,position:r,title:a,width:s,scale:c,search:u,entries:h,onOpened:l,onClosed:p}=t,d=it((()=>!!T(u)&&h.length>5),[u,h]),f=ot(),[v,g]=at(""),y=st(((t,e)=>{if(!d)return t;return t.filter((t=>{if(!e)return(t.rank||0)>=0;const n=[t.description||"",t.label||"",t.search||""].join("---").toLowerCase();return e.toLowerCase().split(/\s/g).every((t=>n.includes(t)))}))}),[d]),[m,_]=at(y(h,v)),[x,w]=at(m[0]),E=st((t=>{x&&t.includes(x)||w(t[0]),_(t)}),[x,_,w]);ct((()=>{E(y(h,v))}),[v,h]),ct((()=>{const t=t=>{if("Escape"===t.key)return t.preventDefault(),e()};return document.documentElement.addEventListener("keydown",t),()=>{document.documentElement.removeEventListener("keydown",t)}}),[]),rt((()=>{f.current&&f.current.focus()}),[]);const b=st((t=>{let e=m.indexOf(x)+t;e<0&&(e=m.length-1),e>=m.length&&(e=0),w(m[e])}),[m,x,w]),S=st((t=>"Enter"===t.key&&x?n(t,x):"ArrowUp"===t.key||"Tab"===t.key&&t.shiftKey?(b(-1),t.preventDefault()):"ArrowDown"===t.key||"Tab"===t.key?(b(1),t.preventDefault()):void 0),[n,e,x,b]),C=st((t=>{Q(t.target,"input")&&g((()=>t.target.value))}),[g]);ct((()=>(l(),()=>{p()})),[]);const k=it((()=>a||i.length>0),[a,i]);return nt`
    <${xo}
      onClose=${e}
      onKeyup=${C}
      onKeydown=${S}
      className=${o}
      position=${r}
      width=${s}
      scale=${c}
    >
      ${k&&nt`
        <div class="djs-popup-header">
          <h3 class="djs-popup-title" title=${a}>${a}</h3>
          ${i.map((t=>nt`
            <span
              class=${function(t,e){return et("entry",t.className,t.active?"active":"",t.disabled?"disabled":"",e?"selected":"")}(t,t===x)}
              onClick=${e=>n(e,t)}
              title=${t.title||t.label}
              data-id=${t.id}
              onMouseEnter=${()=>w(t)}
              onMouseLeave=${()=>w(null)}
            >
              ${t.imageUrl?nt`
                <img class="djs-popup-entry-icon" src=${t.imageUrl} alt="" />
              `:null}

              ${t.label?nt`
                <span class="djs-popup-label">${t.label}</span>
              `:null}
            </span>
          `))}
        </div>
      `}
      ${h.length>0&&nt`
        <div class="djs-popup-body">

          ${d&&nt`
          <div class="djs-popup-search">
            <svg class="djs-popup-search-icon" width="14" height="14" viewBox="0 0 14 14" fill="none" xmlns="http://www.w3.org/2000/svg">
              <path fill-rule="evenodd" clip-rule="evenodd" d="M9.0325 8.5H9.625L13.3675 12.25L12.25 13.3675L8.5 9.625V9.0325L8.2975 8.8225C7.4425 9.5575 6.3325 10 5.125 10C2.4325 10 0.25 7.8175 0.25 5.125C0.25 2.4325 2.4325 0.25 5.125 0.25C7.8175 0.25 10 2.4325 10 5.125C10 6.3325 9.5575 7.4425 8.8225 8.2975L9.0325 8.5ZM1.75 5.125C1.75 6.9925 3.2575 8.5 5.125 8.5C6.9925 8.5 8.5 6.9925 8.5 5.125C8.5 3.2575 6.9925 1.75 5.125 1.75C3.2575 1.75 1.75 3.2575 1.75 5.125Z" fill="#22242A"/>
            </svg>
            <input
                ref=${f}
                type="text"
              />
          </div>
          `}

          <${mo}
            entries=${m}
            selectedEntry=${x}
            setSelectedEntry=${w}
            onAction=${n}
          />
        </div>
        ${0===m.length&&nt`
          <div class="djs-popup-no-results">No matching entries found.</div>
        `}
      `}
    </${xo}>
  `}function xo(t){const{onClose:e,onKeydown:n,onKeyup:o,className:i,children:r,position:a}=t,s=ot(),c=st((t=>{X(t.target,".djs-popup",!0)||e()}),[e]);return rt((()=>{if("function"!=typeof a)return;const t=s.current,e=a(t);t.style.left=`${e.x}px`,t.style.top=`${e.y}px`}),[s.current,a]),rt((()=>{s.current&&s.current.focus()}),[]),nt`
    <div
      class="djs-popup-backdrop"
      onClick=${c}
    >
      <div
        class=${et("djs-popup",i)}
        style=${function(t){return{transform:`scale(${t.scale})`,width:`${t.width}px`}}(t)}
        onKeydown=${n}
        onKeyup=${o}
        ref=${s}
        tabIndex="-1"
      >
        ${r}
      </div>
    </div>
  `}var wo=["contextPad.close","canvas.viewbox.changing","commandStack.changed"];function Eo(t,e,n){this._eventBus=e,this._canvas=n,this._current=null;var o=T(t&&t.scale)?t.scale:{min:1,max:1.5};this._config={scale:o},e.on("diagram.destroy",(()=>{this.close()})),e.on("element.changed",(t=>{const e=this.isOpen()&&this._current.target;t.element===e&&this._render()}))}Eo.$inject=["config.popupMenu","eventBus","canvas"],Eo.prototype._render=function(){const{position:t,className:e,entries:n,headerEntries:o,options:i}=this._current,r=Object.entries(n).map((([t,e])=>({id:t,...e}))),a=Object.entries(o).map((([t,e])=>({id:t,...e}))),s=t&&(e=>this._ensureVisible(e,t)),c=this._updateScale(this._current.container);ut(nt`
      <${_o}
        onClose=${t=>this.close(t)}
        onSelect=${(t,e,n)=>this.trigger(t,e,n)}
        position=${s}
        className=${e}
        entries=${r}
        headerEntries=${a}
        scale=${c}
        onOpened=${this._onOpened.bind(this)}
        onClosed=${this._onClosed.bind(this)}
        ...${{...i}}
      />
    `,this._current.container)},Eo.prototype.open=function(t,e,n,o){if(!t)throw new Error("target is missing");if(!e)throw new Error("providers for <"+e+"> not found");if(!n)throw new Error("position is missing");this.isOpen()&&this.close();const{entries:i,headerEntries:r}=this._getContext(t,e);this._current={position:n,className:e,target:t,entries:i,headerEntries:r,container:this._createContainer({provider:e}),options:o},this._emit("open"),this._bindAutoClose(),this._render()},Eo.prototype._getContext=function(t,e){const n=this._getProviders(e);if(!n||!n.length)throw new Error("provider for <"+e+"> not found");const o=this._getEntries(t,n),i=this._getHeaderEntries(t,n);return{entries:o,headerEntries:i,empty:!(Object.keys(o).length||Object.keys(i).length)}},Eo.prototype.close=function(){this.isOpen()&&(this._emit("close"),this.reset(),this._current=null)},Eo.prototype.reset=function(){const t=this._current.container;ut(null,t),K(t)},Eo.prototype._emit=function(t,e){this._eventBus.fire(`popupMenu.${t}`,e)},Eo.prototype._onOpened=function(){this._emit("opened")},Eo.prototype._onClosed=function(){this._emit("closed")},Eo.prototype._createContainer=function(t){var e=this._canvas.getContainer();const n=Y(`<div class="djs-popup-parent djs-scrollable" data-popup=${t.provider}></div>`);return e.appendChild(n),n},Eo.prototype._bindAutoClose=function(){this._eventBus.once(wo,this.close,this)},Eo.prototype._unbindAutoClose=function(){this._eventBus.off(wo,this.close,this)},Eo.prototype._updateScale=function(){var t,e,n=this._canvas.zoom(),o=this._config.scale,i=n;return!0!==o&&(!1===o?(t=1,e=1):(t=o.min,e=o.max),T(t)&&n<t&&(i=t),T(e)&&n>e&&(i=e)),i},Eo.prototype._ensureVisible=function(t,e){var n=document.documentElement.getBoundingClientRect(),o=t.getBoundingClientRect(),i={},r=e.x,a=e.y;return e.x+o.width>n.width&&(i.x=!0),e.y+o.height>n.height&&(i.y=!0),i.x&&i.y?(r=e.x-o.width,a=e.y-o.height):i.x?(r=e.x-o.width,a=e.y):i.y&&e.y<o.height?(r=e.x,a=10):i.y&&(r=e.x,a=e.y-o.height),{x:r,y:a}},Eo.prototype.isEmpty=function(t,e){if(!t)throw new Error("target is missing");if(!e)throw new Error("provider ID is missing");const n=this._getProviders(e);return!n||!n.length||this._getContext(t,e).empty},Eo.prototype.registerProvider=function(t,e,n){n||(n=e,e=1e3),this._eventBus.on("popupMenu.getProviders."+t,e,(function(t){t.providers.push(n)}))},Eo.prototype._getProviders=function(t){var e=this._eventBus.createEvent({type:"popupMenu.getProviders."+t,providers:[]});return this._eventBus.fire(e),e.providers},Eo.prototype._getEntries=function(t,e){var n={};return f(e,(function(e){if(e.getPopupMenuEntries){var o=e.getPopupMenuEntries(t);M(o)?n=o(n):f(o,(function(t,e){n[e]=t}))}else f(e.getEntries(t),(function(t){var e=t.id;if(!e)throw new Error("entry ID is missing");n[e]=P(t,["id"])}))})),n},Eo.prototype._getHeaderEntries=function(t,e){var n={};return f(e,(function(e){if(e.getPopupMenuHeaderEntries){var o=e.getPopupMenuHeaderEntries(t);M(o)?n=o(n):f(o,(function(t,e){n[e]=t}))}else{if(!e.getHeaderEntries)return;f(e.getHeaderEntries(t),(function(t){var e=t.id;if(!e)throw new Error("entry ID is missing");n[e]=P(t,["id"])}))}})),n},Eo.prototype.isOpen=function(){return!!this._current},Eo.prototype.trigger=function(t,e,n="click"){if(t.preventDefault(),!e){let n=X(t.delegateTarget||t.target,".entry",!0),o=q(n,"data-id");e={id:o,...this._getEntry(o)}}const o=e.action;if(!1!==this._emit("trigger",{entry:e,event:t}))if(M(o)){if("click"===n)return o(t,e)}else if(o[n])return o[n](t,e)},Eo.prototype._getEntry=function(t){var e=this._current.entries[t]||this._current.headerEntries[t];if(!e)throw new Error("entry not found");return e};const bo={__init__:["popupMenu"],popupMenu:["type",Eo]};function So(t){gn.call(this,t),this.init()}So.$inject=["eventBus"],e(So,gn),So.prototype.addRule=function(t,e,n){var o=this;"string"==typeof t&&(t=[t]),t.forEach((function(t){o.canExecute(t,e,(function(t,e,o){return n(t)}),!0)}))},So.prototype.init=function(){};var Co=10,ko=50;function Mo(t,e,n,o){for(var i;i=Ro(t,n,e);)n=o(e,n,i);return n}function jo(t){return function(e,n,o){var i={x:n.x,y:n.y};return["x","y"].forEach((function(r){var a=t[r];if(a){var s="x"===r?"width":"height",c=a.margin,u=a.minDistance;i[r]=c<0?Math.min(o[r]+c-e[s]/2,n[r]-u+c):Math.max(o[r]+o[s]+c+e[s]/2,n[r]+u+c)}})),i}}function Ro(t,e,n){var o={x:e.x-n.width/2,y:e.y-n.height/2,width:n.width,height:n.height},i=function(t){var e=Bo(t);t.host&&(e=e.concat(Bo(t.host)));t.attachers&&(e=e.concat(t.attachers.reduce((function(t,e){return t.concat(Bo(e))}),[])));return e}(t);return g(i,(function(t){return t!==n&&"intersect"===Zt(t,o,Co)}))}function To(t,e){e||(e={});var n=e.defaultDistance||ko,o=e.direction||"e",i=e.filter,r=e.getWeight||function(e){return e.source===t?1:-1},a=e.maxDistance||250,s=e.reference||"start";function c(t,e){return"n"===o?"start"===s?Wt(t).top-Wt(e).bottom:"center"===s?Wt(t).top-Yt(e).y:Wt(t).top-Wt(e).top:"w"===o?"start"===s?Wt(t).left-Wt(e).right:"center"===s?Wt(t).left-Yt(e).x:Wt(t).left-Wt(e).left:"s"===o?"start"===s?Wt(e).top-Wt(t).bottom:"center"===s?Yt(e).y-Wt(t).bottom:Wt(e).bottom-Wt(t).bottom:"start"===s?Wt(e).left-Wt(t).right:"center"===s?Yt(e).x-Wt(t).right:Wt(e).right-Wt(t).right}i||(i=Po);var u=t.incoming.filter(i).map((function(e){var n=r(e),o=n<0?c(e.source,t):c(t,e.source);return{id:e.source.id,distance:o,weight:n}})),h=t.outgoing.filter(i).map((function(e){var n=r(e),o=n>0?c(t,e.target):c(e.target,t);return{id:e.target.id,distance:o,weight:n}})),l=u.concat(h).reduce((function(t,e){return t[e.id+"__weight_"+e.weight]=e,t}),{});return w(l,(function(t,e){var n=e.distance,o=e.weight;return n<0||n>a||(t[String(n)]||(t[String(n)]=0),t[String(n)]+=1*o,(!t.distance||t[t.distance]<t[String(n)])&&(t.distance=n)),t}),{}).distance||n}function Bo(t){return(e=t,e.outgoing.map((function(t){return t.target}))).concat(function(t){return t.incoming.map((function(t){return t.source}))}(t));var e}function Po(){return!0}function Lo(t,e,n){t.on("autoPlace",100,(function(t){var e=t.shape;return function(t,e,n){n||(n={});var o=n.defaultDistance||ko,i=Yt(t),r=Wt(t);return{x:r.right+o+e.width/2,y:i.y}}(t.source,e)})),t.on("autoPlace.end",(function(t){n.scrollToElement(t.shape)})),this.append=function(n,o,i){t.fire("autoPlace.start",{source:n,shape:o});var r=t.fire("autoPlace",{source:n,shape:o}),a=e.appendShape(n,o,r,n.parent,i);return t.fire("autoPlace.end",{source:n,shape:a}),a}}function Oo(t,e){t.on("autoPlace.end",500,(function(t){e.select(t.shape)}))}Lo.$inject=["eventBus","modeling","canvas"],Oo.$inject=["eventBus","selection"];const $o={__init__:["autoPlaceSelectionBehavior"],autoPlace:["type",Lo],autoPlaceSelectionBehavior:["type",Oo]};function Ao(t,e,n,o){gn.call(this,t),this._elementRegistry=e,this._modeling=n,this._rules=o;var i=this;this.postExecuted(["shape.create"],(function(t){var e=t.context,n=e.hints||{},o=e.shape,r=e.parent||e.newParent;!1!==n.autoResize&&i._expand([o],r)})),this.postExecuted(["elements.move"],(function(t){var e=t.context,n=L(O(e.closure.topLevel)),o=e.hints,r=!o||o.autoResize;if(!1!==r){var a=m(n,(function(t){return t.parent.id}));f(a,(function(t,e){d(r)&&(t=t.filter((function(t){return g(r,R({id:t.id}))}))),i._expand(t,e)}))}})),this.postExecuted(["shape.toggleCollapse"],(function(t){var e=t.context,n=e.hints,o=e.shape;n&&!1===n.autoResize||o.collapsed||i._expand(o.children||[],o)})),this.postExecuted(["shape.resize"],(function(t){var e=t.context,n=e.hints,o=e.shape,r=o.parent;n&&!1===n.autoResize||r&&i._expand([o],r)}))}function zo(t){So.call(this,t);var e=this;this.addRule("element.autoResize",(function(t){return e.canResize(t.elements,t.target)}))}Ao.$inject=["eventBus","elementRegistry","modeling","rules"],e(Ao,gn),Ao.prototype._getOptimalBounds=function(t,e){var n=this.getOffset(e),o=this.getPadding(e),i=Wt(kt(t)),r=Wt(e),a={};return i.top-r.top<o.top&&(a.top=i.top-n.top),i.left-r.left<o.left&&(a.left=i.left-n.left),r.right-i.right<o.right&&(a.right=i.right+n.right),r.bottom-i.bottom<o.bottom&&(a.bottom=i.bottom+n.bottom),Kt(_({},r,a))},Ao.prototype._expand=function(t,e){if("string"==typeof e&&(e=this._elementRegistry.get(e)),this._rules.allowed("element.autoResize",{elements:t,target:e})){var n=this._getOptimalBounds(t,e);if(function(t,e){return t.x!==e.x||t.y!==e.y||t.width!==e.width||t.height!==e.height}(n,e)){var o=function(t,e){var n="";t=Wt(t),e=Wt(e),t.top>e.top&&(n=n.concat("n"));t.right<e.right&&(n=n.concat("w"));t.bottom<e.bottom&&(n=n.concat("s"));t.left>e.left&&(n=n.concat("e"));return n}($(e,["x","y","width","height"]),n);this.resize(e,n,{autoResize:o});var i=e.parent;i&&this._expand([e],i)}}},Ao.prototype.getOffset=function(t){return{top:60,bottom:60,left:100,right:100}},Ao.prototype.getPadding=function(t){return{top:2,bottom:2,left:15,right:15}},Ao.prototype.resize=function(t,e,n){this._modeling.resizeShape(t,e,null,n)},zo.$inject=["eventBus"],e(zo,So),zo.prototype.canResize=function(t,e){return!1};function Io(t,e,n){var o,i,r=this,a=n.get("dragging",!1);a&&e.on("drag.start",(function(n){e.once("drag.move",1500,(function(e){!function(e){if(!e.hover){var n=e.originalEvent,o=r._findTargetGfx(n),i=o&&t.get(o);o&&i&&(e.stopPropagation(),a.hover({element:i,gfx:o}),a.move(n))}}(e)}))})),e.on("element.hover",(function(t){o=t.gfx,i=t.element})),e.on("element.hover",1500,(function(t){i&&e.fire("element.out",{element:i,gfx:o})})),e.on("element.out",(function(){o=null,i=null})),this._findTargetGfx=function(t){var e;if(t instanceof MouseEvent)return e=Ne(t),function(t){return X(t,"svg, .djs-element",!0)}(document.elementFromPoint(e.x,e.y))}}Io.$inject=["elementRegistry","eventBus","injector"];const Do={__init__:["hoverFix"],hoverFix:["type",Io]};var Ho=Math.round,Go="djs-drag-active";function No(t){t.preventDefault()}function Vo(t,e,n,o){var i,r={threshold:5,trapClick:!0};function a(t){var n=e.viewbox(),o=e._container.getBoundingClientRect();return{x:n.x+(t.x-o.left)/n.scale,y:n.y+(t.y-o.top)/n.scale}}function s(e,n){n=n||i;var o=t.createEvent(_({},n.payload,n.data,{isTouch:n.isTouch}));return!1!==t.fire("drag."+e,o)&&t.fire(n.prefix+"."+e,o)}function c(t,o){var r,c=i.payload,u=i.displacement,h=i.globalStart,l=Ne(t),p=Un(l,h),d=i.localStart,f=a(l),g=Un(f,d);if(!i.active&&(o||(r=p,Math.sqrt(Math.pow(r.x,2)+Math.pow(r.y,2))>i.threshold))){if(_(c,{x:Ho(d.x+u.x),y:Ho(d.y+u.y),dx:0,dy:0},{originalEvent:t}),!1===s("start"))return v();i.active=!0,i.keepSelection||(c.previousSelection=n.get(),n.select(null)),i.cursor&&Dn(i.cursor),e.addMarker(e.getRootElement(),Go)}Ge(t),i.active&&(_(c,{x:Ho(f.x+u.x),y:Ho(f.y+u.y),dx:Ho(g.x),dy:Ho(g.y)},{originalEvent:t}),s("move"))}function u(t){var e=!0;i.active&&(t&&(i.payload.originalEvent=t,Ge(t)),e=s("end")),!1===e&&s("rejected"),s("ended",g(!0!==e))}function h(t){jn("Escape",t)&&(No(t),v())}function l(e){var n;i.active&&(n=Nn(t),setTimeout(n,400),No(e)),u(e)}function p(t){c(t)}function d(t){var e=i.payload;e.hoverGfx=t.gfx,e.hover=t.element,s("hover")}function f(t){s("out");var e=i.payload;e.hoverGfx=null,e.hover=null}function v(t){var e;if(i){var n=i.active;n&&s("cancel"),e=g(t),n&&s("canceled",e)}}function g(r){var a,g;s("cleanup"),Hn(),g=i.trapClick?l:u,J.unbind(document,"mousemove",c),J.unbind(document,"dragstart",No),J.unbind(document,"selectstart",No),J.unbind(document,"mousedown",g,!0),J.unbind(document,"mouseup",g,!0),J.unbind(document,"keyup",h),J.unbind(document,"touchstart",p,!0),J.unbind(document,"touchcancel",v,!0),J.unbind(document,"touchmove",c,!0),J.unbind(document,"touchend",u,!0),t.off("element.hover",d),t.off("element.out",f),e.removeMarker(e.getRootElement(),Go);var y=i.payload.previousSelection;return!1!==r&&y&&!n.get().length&&function(t){var e=t.filter((function(t){return o.get(t.id)}));e.length&&n.select(e)}(y),a=i,i=null,a}t.on("diagram.destroy",v),this.init=function(e,n,o,g){i&&v(!1),"string"==typeof n&&(g=o,o=n,n=null);var y,m,x,w,E,b,S=(g=_({},r,g||{})).data||{};w=g.trapClick?l:u,e?(y=He(e)||e,m=Ne(e),Ge(e),"dragstart"===y.type&&No(y)):(y=null,m={x:0,y:0}),x=a(m),n||(n=x),b=y,E="undefined"!=typeof TouchEvent&&b instanceof TouchEvent,i=_({prefix:o,data:S,payload:{},globalStart:m,displacement:Un(n,x),localStart:x,isTouch:E},g),g.manual||(E?(J.bind(document,"touchstart",p,!0),J.bind(document,"touchcancel",v,!0),J.bind(document,"touchmove",c,!0),J.bind(document,"touchend",u,!0)):(J.bind(document,"mousemove",c),J.bind(document,"dragstart",No),J.bind(document,"selectstart",No),J.bind(document,"mousedown",w,!0),J.bind(document,"mouseup",w,!0)),J.bind(document,"keyup",h),t.on("element.hover",d),t.on("element.out",f)),s("init"),g.autoActivate&&c(e,!0)},this.move=c,this.hover=d,this.out=f,this.end=u,this.cancel=v,this.context=function(){return i},this.setOptions=function(t){_(r,t)}}Vo.$inject=["eventBus","canvas","selection","elementRegistry"];const Uo={__depends__:[Do,an],dragging:["type",Vo]};function Fo(t,e,n){this._canvas=n,this._opts=_({scrollThresholdIn:[20,20,20,20],scrollThresholdOut:[0,0,0,0],scrollRepeatTimeout:15,scrollStep:10},t);var o=this;e.on("drag.move",(function(t){var e=o._toBorderPoint(t);o.startScroll(e)})),e.on(["drag.cleanup"],(function(){o.stopScroll()}))}function Wo(t,e,n){return e<t&&t<n}Fo.$inject=["config.autoScroll","eventBus","canvas"],Fo.prototype.startScroll=function(t){var e=this._canvas,n=this._opts,o=this,i=e.getContainer().getBoundingClientRect(),r=[t.x,t.y,i.width-t.x,i.height-t.y];this.stopScroll();for(var a=0,s=0,c=0;c<4;c++)Wo(r[c],n.scrollThresholdOut[c],n.scrollThresholdIn[c])&&(0===c?a=n.scrollStep:1==c?s=n.scrollStep:2==c?a=-n.scrollStep:3==c&&(s=-n.scrollStep));0===a&&0===s||(e.scroll({dx:a,dy:s}),this._scrolling=setTimeout((function(){o.startScroll(t)}),n.scrollRepeatTimeout))},Fo.prototype.stopScroll=function(){clearTimeout(this._scrolling)},Fo.prototype.setOptions=function(t){this._opts=_({},this._opts,t)},Fo.prototype._toBorderPoint=function(t){var e=this._canvas._container.getBoundingClientRect(),n=Ne(t.originalEvent);return{x:n.x-e.left,y:n.y-e.top}};const Ko={__depends__:[Uo],__init__:["autoScroll"],autoScroll:["type",Fo]};function qo(t){this._commandStack=t.get("commandStack",!1)}qo.$inject=["injector"],qo.prototype.allowed=function(t,e){var n=!0,o=this._commandStack;return o&&(n=o.canExecute(t,e)),void 0===n||n};const Yo={__init__:["rules"],rules:["type",qo]};var Zo=Math.round,Xo=Math.max;var Jo=10;function Qo(t,e){return function(t,e){var n,o;for(n=0;o=t[n];n++)if($t(o,e)<=Jo)return{point:t[n],bendpoint:!0,index:n};return null}(t,e)||function(t,e){var n,o,i,r,a=ht((i=Jo,[["M",(o=e).x,o.y],["m",0,-i],["a",i,i,0,1,1,0,2*i],["a",i,i,0,1,1,0,-2*i],["z"]]),(n=[],t.forEach((function(t,e){n.push([0===e?"M":"L",t.x,t.y])})),n)),s=a[0],c=a[a.length-1];return s?s!==c?s.segment2!==c.segment2?{point:t[r=Xo(s.segment2,c.segment2)-1],bendpoint:!0,index:r}:{point:{x:Zo(s.x+c.x)/2,y:Zo(s.y+c.y)/2},index:s.segment2}:{point:{x:Zo(s.x),y:Zo(s.y)},index:s.segment2}:null}(t,e)}function ti(t){return Math.sqrt(Math.pow(t.x,2)+Math.pow(t.y,2))}function ei(t){return Math.atan((t[1].y-t[0].y)/(t[1].x-t[0].x))}function ni(t,e){return e?{x:Math.cos(e)*t.x-Math.sin(e)*t.y,y:Math.sin(e)*t.x+Math.cos(e)*t.y}:t}function oi(t,e){var n=e[0],o=e[1],i={x:o.x-n.x,y:o.y-n.y},r=function(t,e,n){var o=[{n:t[0]-n[0],lambda:e[0]},{n:t[1]-n[1],lambda:e[1]}];return-(o[0].n*e[0]+o[1].n*e[1])/(o[0].lambda*e[0]+o[1].lambda*e[1])}([n.x,n.y],[i.x,i.y],[t.x,t.y]);return{x:n.x+r*i.x,y:n.y+r*i.y}}function ii(t,e){var n=oi(t,e);return ti({x:n.x-t.x,y:n.y-t.y})}function ri(t,e){return ti({x:t.x-e.x,y:t.y-e.y})}var ai="djs-bendpoint",si="djs-segment-dragger";function ci(t,e,n){var o=function(t,e){var n,o=Ne(e),i=t._container.getBoundingClientRect();n={x:i.left,y:i.top};var r=t.viewbox();return{x:r.x+(o.x-n.x)/r.scale,y:r.y+(o.y-n.y)/r.scale}}(t,n);return Qo(e,o)}function ui(t,e){var r=n("g");a(r).add(ai),i(t,r);var s=n("circle");o(s,{cx:0,cy:0,r:4}),a(s).add("djs-visual"),i(r,s);var c=n("circle");return o(c,{cx:0,cy:0,r:10}),a(c).add("djs-hit"),i(r,c),e&&a(r).add(e),r}function hi(t,e,r,s){var c=n("g");i(t,c);var u=function(t,e,n){var o=e.x-t.x,i=e.y-t.y;return pi("h"===n?o:i)}(e,r,s),h=n("rect");o(h,{x:-9,y:-3,width:18,height:6}),a(h).add("djs-visual"),i(c,h);var l=n("rect");return o(l,{x:-u/2,y:-8.5,width:u,height:17}),a(l).add("djs-hit"),i(c,l),Ce(c,"v"===s?90:0),c}function li(t,e,o){var r=n("g"),s=Gt(e,o),c=It(e,o);return i(t,r),hi(r,e,o,c),a(r).add(si),a(r).add("h"===c?"horizontal":"vertical"),Se(r,s.x,s.y),r}function pi(t){return Math.abs(Math.round(2*t/3))}function di(t,e){var n=function(t,e){for(var n,o=e.waypoints,i=1/0,r=0;r<o.length-1;r++){var a=ii(t,[o[r],o[r+1]]);a<i&&(i=a,n=r)}return[o[n],o[n+1]]}(t,e);return oi(t,n)}function fi(t,e,s,c,u){function h(t,n){var o,i=n.waypoints,r=ci(e,i,t);if(r)return o=function(t,e){var n,o,i=t.waypoints;return e.index<=0||e.bendpoint?null:(o=It((n={start:i[e.index-1],end:i[e.index]}).start,n.end))?pi("h"===o?n.end.x-n.start.x:n.end.y-n.start.y)/2:null}(n,r),!function(t,e,n){var o,i,r,a,s,c,u=t.index,h=t.point;return!(u<=0||t.bendpoint)&&(r=Gt(o=e[u-1],i=e[u]),a=It(o,i),s=Math.abs(h.x-r.x),c=Math.abs(h.y-r.y),a&&s<=n&&c<=n)}(r,i,o)?c.start(t,n,r.index,!r.bendpoint):u.start(t,n,r.index),!0}function l(t,e,n){J.bind(t,e,(function(t){s.triggerMouseEvent(e,t,n),t.stopPropagation()}))}function p(t,r){var s=e.getLayer("overlays"),c=F('.djs-bendpoints[data-element-id="'+xn(t.id)+'"]',s);return!c&&r&&(c=n("g"),o(c,{"data-element-id":t.id}),a(c).add("djs-bendpoints"),i(s,c),l(c,"mousedown",t),l(c,"click",t),l(c,"dblclick",t)),c}function d(t,e){return F('.djs-segment-dragger[data-segment-idx="'+t+'"]',e)}function v(t,e){e.waypoints.forEach((function(e,n){var o=ui(t);i(t,o),Se(o,e.x,e.y)})),ui(t,"floating")}function g(t,e){for(var n,i,r,a=e.waypoints,s=1;s<a.length;s++)It(n=a[s-1],i=a[s])&&(r=li(t,n,i),o(r,{"data-segment-idx":s}),l(r,"mousemove",e))}function y(t){var e=p(t);return e||(v(e=p(t,!0),t),g(e,t)),e}function m(t){var e=p(t);e&&(!function(t){f(U("."+si,t),(function(t){r(t)}))}(e),function(t){f(U("."+ai,t),(function(t){r(t)}))}(e),g(e,t),v(e,t))}function _(t,e,n){var o,i,r=d(e.index,t),a=n[e.index-1],s=n[e.index],c=e.point,u=Gt(a,s),h=It(a,s);r&&(o=function(t){return F(".djs-visual",t)}(r),i={x:c.x-u.x,y:c.y-u.y},"v"===h&&(i={x:i.y,y:i.x}),Se(o,i.x,i.y))}t.on("connection.changed",(function(t){m(t.element)})),t.on("connection.remove",(function(t){var e=p(t.element);e&&r(e)})),t.on("element.marker.update",(function(t){var e,n=t.element;n.waypoints&&(e=y(n),t.add?a(e).add(t.marker):a(e).remove(t.marker))})),t.on("element.mousemove",(function(t){var n,o,i=t.element,r=i.waypoints;if(r){if(n=p(i,!0),!(o=ci(e,r,t.originalEvent)))return;!function(t,e){var n=F(".floating",t),o=e.point;n&&Se(n,o.x,o.y)}(n,o),o.bendpoint||_(n,o,r)}})),t.on("element.mousedown",(function(t){if(Ue(t)){var e=t.originalEvent,n=t.element;if(n.waypoints)return h(e,n)}})),t.on("selection.changed",(function(t){var e=t.newSelection[0];e&&e.waypoints&&y(e)})),t.on("element.hover",(function(t){var e=t.element;e.waypoints&&(y(e),s.registerEvent(t.gfx,"mousemove","element.mousemove"))})),t.on("element.out",(function(t){s.unregisterEvent(t.gfx,"mousemove","element.mousemove")})),t.on("element.updateId",(function(t){var e=t.element,n=t.newId;if(e.waypoints){var i=p(e);i&&o(i,{"data-element-id":n})}})),this.addHandles=y,this.updateHandles=m,this.getBendpointsContainer=p,this.getSegmentDragger=d}fi.$inject=["eventBus","canvas","interactionEvents","bendpointMove","connectionSegmentMove"];var vi=Math.round,gi="reconnectStart",yi="reconnectEnd",mi="updateWaypoints";function _i(t,e,n,o,i,r){this._injector=t,this.start=function(t,e,r,a){var s,c=n.getGraphics(e),u=e.source,h=e.target,l=e.waypoints,p=(s=a||0!==r?a||r!==l.length-1?mi:yi:gi)===mi?"connection.updateWaypoints":"connection.reconnect",d=i.allowed(p,{connection:e,source:u,target:h});!1===d&&(d=i.allowed(p,{connection:e,source:h,target:u})),!1!==d&&o.init(t,"bendpoint.move",{data:{connection:e,connectionGfx:c,context:{allowed:d,bendpointIndex:r,connection:e,source:u,target:h,insert:a,type:s}}})},e.on("bendpoint.move.hover",(function(t){var e,n=t.context,o=n.connection,r=o.source,a=o.target,s=t.hover,c=n.type;if(n.hover=s,s){var u=c===mi?"connection.updateWaypoints":"connection.reconnect";if(e=n.allowed=i.allowed(u,{connection:o,source:c===gi?s:r,target:c===yi?s:a}))return n.source=c===gi?s:r,void(n.target=c===yi?s:a);!1===e&&(e=n.allowed=i.allowed(u,{connection:o,source:c===yi?s:a,target:c===gi?s:r})),e&&(n.source=c===yi?s:a,n.target=c===gi?s:r)}})),e.on(["bendpoint.move.out","bendpoint.move.cleanup"],(function(t){var e=t.context,n=e.type;e.hover=null,e.source=null,e.target=null,n!==mi&&(e.allowed=!1)})),e.on("bendpoint.move.end",(function(t){var e=t.context,n=e.allowed,o=e.bendpointIndex,i=e.connection,a=e.insert,s=i.waypoints.slice(),c=e.source,u=e.target,h=e.type,l=e.hints||{},p={x:vi(t.x),y:vi(t.y)};if(!n)return!1;h===mi?(a?s.splice(o,0,p):s[o]=p,l.bendpointMove={insert:a,bendpointIndex:o},s=this.cropWaypoints(i,s),r.updateWaypoints(i,function(t){t=t.slice();for(var e,n,o,i=0;t[i];)e=t[i],n=t[i-1],0===$t(e,o=t[i+1])||At(n,o,e)?t.splice(i,1):i++;return t}(s),l)):(h===gi?(l.docking="source",xi(e)&&(l.docking="target",l.newWaypoints=s.reverse())):h===yi&&(l.docking="target",xi(e)&&(l.docking="source",l.newWaypoints=s.reverse())),r.reconnect(i,c,u,p,l))}),this)}function xi(t){var e=t.hover,n=t.source,o=t.target,i=t.type;return i===gi?e&&o&&e===o&&n!==o:i===yi?e&&n&&e===n&&n!==o:void 0}_i.$inject=["injector","eventBus","canvas","dragging","rules","modeling"],_i.prototype.cropWaypoints=function(t,e){var n=this._injector.get("connectionDocking",!1);if(!n)return e;var o=t.waypoints;return t.waypoints=e,t.waypoints=n.getCroppedWaypoints(t),e=t.waypoints,t.waypoints=o,e};var wi="updateWaypoints",Ei="connect-ok",bi="connect-not-ok",Si="connect-hover",Ci="djs-updating",ki="djs-element-hidden";function Mi(t,e,n,o){this._injector=e;var i=e.get("connectionPreview",!1);n.on("bendpoint.move.start",(function(t){var e=t.context,n=e.bendpointIndex,i=e.connection,r=e.insert,s=i.waypoints,c=s.slice();e.waypoints=s,r&&c.splice(n,0,{x:t.x,y:t.y}),i.waypoints=c;var u=e.draggerGfx=ui(o.getLayer("overlays"));a(u).add("djs-dragging"),o.addMarker(i,ki),o.addMarker(i,Ci)})),n.on("bendpoint.move.hover",(function(t){var e=t.context,n=e.allowed,i=e.hover,r=e.type;if(i){if(o.addMarker(i,Si),r===wi)return;n?(o.removeMarker(i,bi),o.addMarker(i,Ei)):!1===n&&(o.removeMarker(i,Ei),o.addMarker(i,bi))}})),n.on(["bendpoint.move.out","bendpoint.move.cleanup"],1100,(function(t){var e=t.context,n=e.hover,i=e.target;n&&(o.removeMarker(n,Si),o.removeMarker(n,i?Ei:bi))})),n.on("bendpoint.move.move",(function(e){var n=e.context,o=n.allowed,r=n.bendpointIndex,a=n.draggerGfx,s=n.hover,c=n.type,u=n.connection,h=u.source,l=u.target,p=u.waypoints.slice(),d={x:e.x,y:e.y},f=n.hints||{},v={};i&&(f.connectionStart&&(v.connectionStart=f.connectionStart),f.connectionEnd&&(v.connectionEnd=f.connectionEnd),"reconnectStart"===c?xi(n)?(v.connectionEnd=v.connectionEnd||d,v.source=l,v.target=s||h,p=p.reverse()):(v.connectionStart=v.connectionStart||d,v.source=s||h,v.target=l):"reconnectEnd"===c?xi(n)?(v.connectionStart=v.connectionStart||d,v.source=s||l,v.target=h,p=p.reverse()):(v.connectionEnd=v.connectionEnd||d,v.source=h,v.target=s||l):(v.noCropping=!0,v.noLayout=!0,p[r]=d),c===wi&&(p=t.cropWaypoints(u,p)),v.waypoints=p,i.drawPreview(n,o,v)),Se(a,e.x,e.y)}),this),n.on(["bendpoint.move.end","bendpoint.move.cancel"],1100,(function(t){var e=t.context,n=e.connection,a=e.draggerGfx,s=e.hover,c=e.target,u=e.waypoints;n.waypoints=u,r(a),o.removeMarker(n,Ci),o.removeMarker(n,ki),s&&(o.removeMarker(s,Ei),o.removeMarker(s,c?Ei:bi)),i&&i.cleanUp(e)}))}Mi.$inject=["bendpointMove","injector","eventBus","canvas"];var ji="connect-hover",Ri="djs-updating";function Ti(t,e,n){return Bi(t,e,t[e]+n)}function Bi(t,e,n){return{x:"x"===e?n:t.x,y:"y"===e?n:t.y}}function Pi(t){return"x"===t?"y":"x"}function Li(t,e,n){var o,i;return t.original?t.original:(o=Yt(e),Bi(t,i=Pi(n),o[i]))}function Oi(t,e,n,o,i,s){var c=t.get("connectionDocking",!1);function u(t,e){if(!c)return e;var n,o=t.waypoints;return t.waypoints=e,n=c.getCroppedWaypoints(t),t.waypoints=o,n}function h(t){i.update("connection",t.connection,t.connectionGfx)}function l(t,e,n){var o=t.newWaypoints,i=function(t,e,n,o){var i=Math.max(e[o],n[o]),r=Math.min(e[o],n[o]);return Bi(e,o,Math.min(Math.max(r+20,t[o]),i-20))}(n,o[t.segmentStartIndex+e],o[t.segmentEndIndex+e],Pi(t.axis));Se(t.draggerGfx,i.x,i.y)}this.start=function(t,e,i){var r,a,s,c,u=n.getGraphics(e),h=i-1,l=i,p=e.waypoints,d=p[h],f=p[l],v=ci(n,p,t);(a=It(d,f))&&(s="v"===a?"x":"y",0===h&&(d=Li(d,e.source,s)),l===p.length-1&&(f=Li(f,e.target,s)),r={connection:e,segmentStartIndex:h,segmentEndIndex:l,segmentStart:d,segmentEnd:f,axis:s,dragPosition:c=v?v.point:{x:(d.x+f.x)/2,y:(d.y+f.y)/2}},o.init(t,c,"connectionSegment.move",{cursor:"x"===s?"resize-ew":"resize-ns",data:{connection:e,connectionGfx:u,context:r}}))},e.on("connectionSegment.move.start",(function(t){var e=t.context,o=t.connection,i=n.getLayer("overlays");e.originalWaypoints=o.waypoints.slice(),e.draggerGfx=li(i,e.segmentStart,e.segmentEnd),a(e.draggerGfx).add("djs-dragging"),n.addMarker(o,Ri)})),e.on("connectionSegment.move.move",(function(t){var e,n,o=t.context,i=o.connection,r=o.segmentStartIndex,a=o.segmentEndIndex,s=o.segmentStart,c=o.segmentEnd,p=o.axis,d=o.originalWaypoints.slice(),f=Ti(s,p,t["d"+p]),v=Ti(c,p,t["d"+p]),g=d.length,y=0;d[r]=f,d[a]=v,r<2&&(e=Zt(i.source,f),1===r?"intersect"===e&&(d.shift(),d[0]=f,y--):"intersect"!==e&&(d.unshift(s),y++)),a>g-3&&(n=Zt(i.target,v),a===g-2?"intersect"===n&&(d.pop(),d[d.length-1]=v):"intersect"!==n&&d.push(c)),o.newWaypoints=i.waypoints=u(i,d),l(o,y,t),o.newSegmentStartIndex=r+y,h(t)})),e.on("connectionSegment.move.hover",(function(t){t.context.hover=t.hover,n.addMarker(t.hover,ji)})),e.on(["connectionSegment.move.out","connectionSegment.move.cleanup"],(function(t){var e=t.context.hover;e&&n.removeMarker(e,ji)})),e.on("connectionSegment.move.cleanup",(function(t){var e=t.context,o=e.connection;e.draggerGfx&&r(e.draggerGfx),n.removeMarker(o,Ri)})),e.on(["connectionSegment.move.cancel","connectionSegment.move.end"],(function(t){var e=t.context;e.connection.waypoints=e.originalWaypoints,h(t)})),e.on("connectionSegment.move.end",(function(t){var e=t.context,n=e.connection,o=e.newWaypoints,i=e.newSegmentStartIndex,r=function(t,e){var n=0;return{waypoints:t.filter((function(o,i){return!At(t[i-1],t[i+1],o)||(n=i<=e?n-1:n,!1)})),segmentOffset:n}}(o=o.map((function(t){return{original:t.original,x:Math.round(t.x),y:Math.round(t.y)}})),i),a=u(n,r.waypoints),c=r.segmentOffset,h={segmentMove:{segmentStartIndex:e.segmentStartIndex,newSegmentStartIndex:i+c}};s.updateWaypoints(n,a,h)}))}Oi.$inject=["injector","eventBus","canvas","dragging","graphicsFactory","modeling"];var $i=Math.abs,Ai=Math.round;function zi(t){return{x:t.x,y:t.y}}function Ii(t){return{x:t.x+t.width,y:t.y+t.height}}function Di(t,e){return!t||isNaN(t.x)||isNaN(t.y)?e:{x:Ai(t.x+t.width/2),y:Ai(t.y+t.height/2)}}function Hi(t,e){var n=t.snapped;return!!n&&("string"==typeof e?n[e]:n.x&&n.y)}function Gi(t,e,n){if("string"!=typeof e)throw new Error("axis must be in [x, y]");if("number"!=typeof n&&!1!==n)throw new Error("value must be Number or false");var o,i=t[e],r=t.snapped=t.snapped||{};return!1===n?r[e]=!1:(r[e]=!0,o=n-i,t[e]+=o,t["d"+e]+=o),i}function Ni(t){return t.children||[]}var Vi=Math.abs,Ui=Math.round;function Fi(t){function e(t,e){if(d(t)){for(var n=t.length;n--;)if(Vi(t[n]-e)<=10)return t[n]}else{var o=e%(t=+t);if(o<10)return e-o;if(o>t-10)return e-o+t}return e}function n(t,e){return t.waypoints?di(e,t):t.width?{x:Ui(t.width/2+t.x),y:Ui(t.height/2+t.y)}:void 0}t.on("connectionSegment.move.move",1500,(function(t){var o,i,r=function(t){var e=t.context,o=e.snapPoints,i=e.connection,r=i.waypoints,a=e.segmentStart,s=e.segmentStartIndex,c=e.segmentEnd,u=e.segmentEndIndex,h=e.axis;if(o)return o;var l=[r[s-1],a,c,r[u+1]];return s<2&&l.unshift(n(i.source,t)),u>r.length-3&&l.unshift(n(i.target,t)),e.snapPoints=o={horizontal:[],vertical:[]},f(l,(function(t){t&&(t=t.original||t,"y"===h&&o.horizontal.push(t.y),"x"===h&&o.vertical.push(t.x))})),o}(t),a=t.x,s=t.y;if(r){var c=a-(o=e(r.vertical,a)),u=s-(i=e(r.horizontal,s));_(t,{dx:t.dx-c,dy:t.dy-u,x:o,y:i}),(c||-1!==r.vertical.indexOf(a))&&Gi(t,"x",o),(u||-1!==r.horizontal.indexOf(s))&&Gi(t,"y",i)}})),t.on(["connect.hover","connect.move","connect.end"],1500,(function(t){var e=t.context.hover,o=e&&n(e,t);Nt(e)&&o&&o.x&&o.y&&(Gi(t,"x",o.x),Gi(t,"y",o.y))})),t.on(["bendpoint.move.move","bendpoint.move.end"],1500,(function(t){var o,i,r=t.context,a=function(t){var e=t.snapPoints,n=t.connection.waypoints,o=t.bendpointIndex;if(e)return e;var i=[n[o-1],n[o+1]];return t.snapPoints=e={horizontal:[],vertical:[]},f(i,(function(t){t&&(t=t.original||t,e.horizontal.push(t.y),e.vertical.push(t.x))})),e}(r),s=r.hover,c=s&&n(s,t),u=t.x,h=t.y;if(a){var l=u-(o=e(c?a.vertical.concat([c.x]):a.vertical,u)),p=h-(i=e(c?a.horizontal.concat([c.y]):a.horizontal,h));_(t,{dx:t.dx-l,dy:t.dy-p,x:t.x-l,y:t.y-p}),(l||-1!==a.vertical.indexOf(u))&&Gi(t,"x",o),(p||-1!==a.horizontal.indexOf(h))&&Gi(t,"y",i)}}))}Fi.$inject=["eventBus"];const Wi={__depends__:[Uo,Yo],__init__:["bendpoints","bendpointSnapping","bendpointMovePreview"],bendpoints:["type",fi],bendpointMove:["type",_i],bendpointMovePreview:["type",Mi],connectionSegmentMove:["type",Oi],bendpointSnapping:["type",Fi]};function Ki(t,e,n,o){function i(t,e){return o.allowed("connection.create",{source:t,target:e})}t.on("connect.hover",(function(t){var e,n=t.context,o=n.start,r=t.hover;if(n.hover=r,e=n.canExecute=i(o,r),!A(e)){if(!1!==e)return n.source=o,void(n.target=r);e=n.canExecute=i(r,o),A(e)||!1!==e&&(n.source=r,n.target=o)}})),t.on(["connect.out","connect.cleanup"],(function(t){var e=t.context;e.hover=null,e.source=null,e.target=null,e.canExecute=!1})),t.on("connect.end",(function(t){var e=t.context,o=e.canExecute,i=e.connectionStart,r={x:t.x,y:t.y},a=e.source,s=e.target;if(!o)return!1;var c=null,u={connectionStart:qi(e)?r:i,connectionEnd:qi(e)?i:r};y(o)&&(c=o),e.connection=n.connect(a,s,c,u)})),this.start=function(t,n,o,i){y(o)||(i=o,o=Yt(n)),e.init(t,"connect",{autoActivate:i,data:{shape:n,context:{start:n,connectionStart:o}}})}}function qi(t){var e=t.hover,n=t.source,o=t.target;return e&&n&&e===n&&n!==o}Ki.$inject=["eventBus","dragging","modeling","rules"];var Yi="connect-ok",Zi="connect-not-ok";function Xi(t,e,n){var o=t.get("connectionPreview",!1);o&&e.on("connect.move",(function(t){var e=t.context,n=e.canExecute,i=e.hover,r=e.source,a=e.start,s=e.startPosition,c=e.target,u=e.connectionStart||s,h=e.connectionEnd||{x:t.x,y:t.y},l=u,p=h;qi(e)&&(l=h,p=u),o.drawPreview(e,n,{source:r||a,target:c||i,connectionStart:l,connectionEnd:p})})),e.on("connect.hover",900,(function(t){var e=t.context,o=t.hover,i=e.canExecute;null!==i&&n.addMarker(o,i?Yi:Zi)})),e.on(["connect.out","connect.cleanup"],1100,(function(t){var e=t.hover;e&&(n.removeMarker(e,Yi),n.removeMarker(e,Zi))})),o&&e.on("connect.cleanup",(function(t){o.cleanUp(t.context)}))}Xi.$inject=["injector","eventBus","canvas"];const Ji={__depends__:[an,Yo,Uo],__init__:["connectPreview"],connect:["type",Ki],connectPreview:["type",Xi]};function Qi(t,e,n,o){this._canvas=e,this._graphicsFactory=n,this._elementFactory=o,this._connectionDocking=t.get("connectionDocking",!1),this._layouter=t.get("layouter",!1)}Qi.$inject=["injector","canvas","graphicsFactory","elementFactory"],Qi.prototype.drawPreview=function(t,e,n){n=n||{};var o,i,r,a=t.connectionPreviewGfx,s=t.getConnection,c=n.source,u=n.target,l=n.waypoints,p=n.connectionStart,d=n.connectionEnd,f=n.noLayout,v=n.noCropping,g=n.noNoop,y=this;a||(a=t.connectionPreviewGfx=this.createConnectionPreviewGfx()),h(a),s||(s=t.getConnection=(i=function(t,e,n){return y.getConnection(t,e,n)},r={},function(t){var e=JSON.stringify(t),n=r[e];return n||(n=r[e]=i.apply(null,arguments)),n})),e&&(o=s(e,c,u)),o?(o.waypoints=l||[],this._layouter&&!f&&(o.waypoints=this._layouter.layoutConnection(o,{source:c,target:u,connectionStart:p,connectionEnd:d,waypoints:n.waypoints||o.waypoints})),o.waypoints&&o.waypoints.length||(o.waypoints=[c?Yt(c):p,u?Yt(u):d]),this._connectionDocking&&(c||u)&&!v&&(o.waypoints=this._connectionDocking.getCroppedWaypoints(o,c,u)),this._graphicsFactory.drawConnection(a,o)):!g&&this.drawNoopPreview(a,n)},Qi.prototype.drawNoopPreview=function(t,e){var n=e.source,o=e.target,r=e.connectionStart||Yt(n),a=e.connectionEnd||Yt(o),s=this.cropWaypoints(r,a,n,o),c=this.createNoopConnection(s[0],s[1]);i(t,c)},Qi.prototype.cropWaypoints=function(t,e,n,o){var i=this._graphicsFactory,r=n&&i.getShapePath(n),a=o&&i.getShapePath(o),s=i.getConnectionPath({waypoints:[t,e]});return[t=n&&Xt(r,s,!0)||t,e=o&&Xt(a,s,!1)||e]},Qi.prototype.cleanUp=function(t){t&&t.connectionPreviewGfx&&r(t.connectionPreviewGfx)},Qi.prototype.getConnection=function(t){var e=function(t){return y(t)?t:{}}(t);return this._elementFactory.createConnection(e)},Qi.prototype.createConnectionPreviewGfx=function(){var t=n("g");return o(t,{pointerEvents:"none"}),a(t).add("djs-connection-preview"),i(this._canvas.getActiveLayer(),t),t},Qi.prototype.createNoopConnection=function(t,e){return _t([t,e],{stroke:"#333",strokeDasharray:[1],strokeWidth:2,"pointer-events":"none"})};const tr={__init__:["connectionPreview"],connectionPreview:["type",Qi]};var er=["marker-start","marker-mid","marker-end"],nr=["circle","ellipse","line","path","polygon","polyline","path","rect"];function or(t,e,n,o){this._elementRegistry=t,this._canvas=n,this._styles=o,this._clonedMarkers={};var i=this;e.on("drag.cleanup",(function(){f(i._clonedMarkers,(function(t){r(t)})),i._clonedMarkers={}}))}or.$inject=["elementRegistry","eventBus","canvas","styles"],or.prototype.getGfx=function(t){return this._elementRegistry.getGraphics(t)},or.prototype.addDragger=function(t,e,n){n=n||this.getGfx(t);var r=l(n),a=n.getBoundingClientRect();return this._cloneMarkers(Ee(r)),o(r,this._styles.cls("djs-dragger",[],{x:a.top,y:a.left})),i(e,r),r},or.prototype.addFrame=function(t,e){var o=n("rect",{class:"djs-resize-overlay",width:t.width,height:t.height,x:t.x,y:t.y});return i(e,o),o},or.prototype._cloneMarkers=function(t){var e,n=this;if(t.childNodes)for(var i=0;i<t.childNodes.length;i++)n._cloneMarkers(t.childNodes[i]);(e=t,-1!==nr.indexOf(e.nodeName))&&er.forEach((function(e){if(o(t,e)){var i=function(t,e,n){var i=(r=o(t,e),r.match(/url\(['"]?#([^'"]*)['"]?\)/)[1]);var r;return F("marker#"+i,n||document)}(t,e,n._canvas.getContainer());n._cloneMarker(t,i,e)}}))},or.prototype._cloneMarker=function(t,e,r){var s=e.id,c=this._clonedMarkers[s];if(!c){var u=s+"-clone";(c=l(e)).id=u,a(c).add("djs-dragger").add("djs-dragger-marker"),this._clonedMarkers[s]=c;var h=F("defs",this._canvas._svg);h||(h=n("defs"),i(this._canvas._svg,h)),i(h,c)}var p="url(#"+this._clonedMarkers[s].id+")";o(t,r,p)};const ir={__init__:["previewSupport"],previewSupport:["type",or]};var rr="drop-ok",ar="drop-not-ok",sr="attach-ok",cr="new-parent",ur="create";function hr(t,e,n,o,i){function r(e,n){[sr,rr,ar,cr].forEach((function(o){o===n?t.addMarker(e,o):t.removeMarker(e,o)}))}function a(){var t=e.context();t&&t.prefix===ur&&e.cancel()}n.on(["create.move","create.hover"],(function(t){var e=t.context,n=e.elements,o=t.hover,a=e.source,s=e.hints||{};if(!o)return e.canExecute=!1,void(e.target=null);lr(t);var c={x:t.x,y:t.y},u=e.canExecute=o&&function(t,e,n,o,r){if(!e)return!1;t=v(t,(function(e){var n=e.labelTarget;return!(e.parent||Vt(e)&&-1!==t.indexOf(n))}));var a=g(t,(function(t){return!Nt(t)})),s=!1,c=!1,u=!1;pr(t)&&(s=i.allowed("shape.attach",{position:n,shape:a,target:e})),s||(u=pr(t)?i.allowed("shape.create",{position:n,shape:a,source:o,target:e}):i.allowed("elements.create",{elements:t,position:n,target:e}));var h=r.connectionTarget;return u||s?(a&&o&&(c=i.allowed("connection.create",{source:h===o?a:o,target:h===o?o:a,hints:{targetParent:e,targetAttach:s}})),{attach:s,connect:c}):(null===u||null===s)&&null}(n,o,c,a,s);o&&null!==u&&(e.target=o,u&&u.attach?r(o,sr):r(o,u?cr:ar))})),n.on(["create.end","create.out","create.cleanup"],(function(t){var e=t.hover;e&&r(e,null)})),n.on("create.end",(function(t){var e=t.context,n=e.source,i=e.shape,r=e.elements,a=e.target,s=e.canExecute,c=s&&s.attach,u=s&&s.connect,h=e.hints||{};if(!1===s||!a)return!1;lr(t);var l={x:t.x,y:t.y};u?i=o.appendShape(n,i,l,a,{attach:c,connection:!0===u?{}:u,connectionTarget:h.connectionTarget}):(r=o.createElements(r,l,a,_({},h,{attach:c})),i=g(r,(function(t){return!Nt(t)}))),_(e,{elements:r,shape:i}),_(t,{elements:r,shape:i})})),n.on("create.init",(function(){n.on("elements.changed",a),n.once(["create.cancel","create.end"],2e3,(function(){n.off("elements.changed",a)}))})),this.start=function(t,n,o){d(n)||(n=[n]);var i=g(n,(function(t){return!Nt(t)}));if(i){o=_({elements:n,hints:{},shape:i},o||{}),f(n,(function(t){p(t.x)||(t.x=0),p(t.y)||(t.y=0)}));var r=kt(v(n,(function(t){return!t.hidden})));f(n,(function(t){Nt(t)&&(t.waypoints=z(t.waypoints,(function(t){return{x:t.x-r.x-r.width/2,y:t.y-r.y-r.height/2}}))),_(t,{x:t.x-r.x-r.width/2,y:t.y-r.y-r.height/2})})),e.init(t,ur,{cursor:"grabbing",autoActivate:!0,data:{shape:i,elements:n,context:o}})}}}function lr(t){var e=t.context.createConstraints;e&&(e.left&&(t.x=Math.max(t.x,e.left)),e.right&&(t.x=Math.min(t.x,e.right)),e.top&&(t.y=Math.max(t.y,e.top)),e.bottom&&(t.y=Math.min(t.y,e.bottom)))}function pr(t){return t&&1===t.length&&!Nt(t[0])}hr.$inject=["canvas","dragging","eventBus","modeling","rules"];function dr(t,e,a,s,c){e.on("create.move",750,(function(e){var u,h=e.hover,l=e.context,p=l.elements,d=l.dragGroup;d||(d=l.dragGroup=function(t){var e=n("g");o(e,c.cls("djs-drag-group",["no-events"]));var i=n("g");return t.forEach((function(t){var n;t.hidden||(t.waypoints?(n=a._createContainer("connection",i),a.drawConnection(Ee(n),t)):(n=a._createContainer("shape",i),a.drawShape(Ee(n),t),Se(n,t.x,t.y)),s.addDragger(t,e,n))})),e}(p)),h?(d.parentNode||(u=t.getActiveLayer(),i(u,d)),Se(d,e.x,e.y)):r(d)})),e.on("create.cleanup",(function(t){var e=t.context.dragGroup;e&&r(e)}))}dr.$inject=["canvas","eventBus","graphicsFactory","previewSupport","styles"];const fr={__depends__:[Uo,ir,Yo,an],__init__:["create","createPreview"],create:["type",hr],createPreview:["type",dr]};function vr(){}vr.prototype.get=function(){return this._data},vr.prototype.set=function(t){this._data=t},vr.prototype.clear=function(){var t=this._data;return delete this._data,t},vr.prototype.isEmpty=function(){return!this._data};const gr={clipboard:["type",vr]};function yr(t){var e=this;function n(t){e._lastMoveEvent=t}this._lastMoveEvent=null,t.on("canvas.init",(function(t){(e._svg=t.svg).addEventListener("mousemove",n)})),t.on("canvas.destroy",(function(){e._lastMouseEvent=null,e._svg.removeEventListener("mousemove",n)}))}yr.$inject=["eventBus"],yr.prototype.getLastMoveEvent=function(){return this._lastMoveEvent||function(t,e){var n=document.createEvent("MouseEvent"),o=t,i=e,r=t,a=e;n.initMouseEvent&&n.initMouseEvent("mousemove",!0,!0,window,0,o,i,r,a,!1,!1,!1,!1,0,null);return n}(0,0)};const mr={__init__:["mouse"],mouse:["type",yr]};function _r(t,e,n,o,i,r,a,s){this._canvas=t,this._create=e,this._clipboard=n,this._elementFactory=o,this._eventBus=i,this._modeling=r,this._mouse=a,this._rules=s,i.on("copyPaste.copyElement",(function(t){var e=t.descriptor,n=t.element,o=t.elements;e.priority=1,e.id=n.id,g(o,(function(t){return t===n.parent}))&&(e.parent=n.parent.id),function(t){return!!t.host}(n)&&(e.priority=2,e.host=n.host.id),Nt(n)&&(e.priority=3,e.source=n.source.id,e.target=n.target.id,e.waypoints=function(t){return z(t.waypoints,(function(t){return(t=xr(t)).original&&(t.original=xr(t.original)),t}))}(n)),Vt(n)&&(e.priority=4,e.labelTarget=n.labelTarget.id),f(["x","y","width","height"],(function(t){p(n[t])&&(e[t]=n[t])})),e.hidden=n.hidden,e.collapsed=n.collapsed})),i.on("copyPaste.pasteElements",(function(t){var e=t.hints;_(e,{createElementsBehavior:!1})}))}function xr(t){return _({},t)}function wr(t,e){var n=e.indexOf(t);return-1===n?e:e.splice(n,1)}_r.$inject=["canvas","create","clipboard","elementFactory","eventBus","modeling","mouse","rules"],_r.prototype.copy=function(t){var e,n;return d(t)||(t=t?[t]:[]),n=!1===(e=this._eventBus.fire("copyPaste.canCopyElements",{elements:t}))?{}:this.createTree(d(e)?e:t),this._clipboard.set(n),this._eventBus.fire("copyPaste.elementsCopied",{elements:t,tree:n}),n},_r.prototype.paste=function(t){var e=this._clipboard.get();if(!this._clipboard.isEmpty()){var n=t&&t.hints||{};this._eventBus.fire("copyPaste.pasteElements",{hints:n});var o=this._createElements(e);if(t&&t.element&&t.point)return this._paste(o,t.element,t.point,n);this._create.start(this._mouse.getLastMoveEvent(),o,{hints:n||{}})}},_r.prototype._paste=function(t,e,n,o){f(t,(function(t){p(t.x)||(t.x=0),p(t.y)||(t.y=0)}));var i=kt(t);return f(t,(function(t){Nt(t)&&(t.waypoints=z(t.waypoints,(function(t){return{x:t.x-i.x-i.width/2,y:t.y-i.y-i.height/2}}))),_(t,{x:t.x-i.x-i.width/2,y:t.y-i.y-i.height/2})})),this._modeling.createElements(t,n,e,_({},o))},_r.prototype._createElements=function(t){var e=this,n=this._eventBus,o={},i=[];return f(t,(function(t,r){t=S(t,"priority"),f(t,(function(t){var r,a=_({},P(t,["priority"]));return o[t.parent]?a.parent=o[t.parent]:delete a.parent,n.fire("copyPaste.pasteElement",{cache:o,descriptor:a}),Nt(a)?(a.source=o[t.source],a.target=o[t.target],r=o[t.id]=e.createConnection(a),void i.push(r)):Vt(a)?(a.labelTarget=o[a.labelTarget],r=o[t.id]=e.createLabel(a),void i.push(r)):(a.host&&(a.host=o[a.host]),r=o[t.id]=e.createShape(a),void i.push(r))}))})),i},_r.prototype.createConnection=function(t){return this._elementFactory.createConnection(P(t,["id"]))},_r.prototype.createLabel=function(t){return this._elementFactory.createLabel(P(t,["id"]))},_r.prototype.createShape=function(t){return this._elementFactory.createShape(P(t,["id"]))},_r.prototype.hasRelations=function(t,e){var n,o;return!(Nt(t)&&(n=g(e,R({id:t.source.id})),o=g(e,R({id:t.target.id})),!n||!o))&&!(Vt(t)&&!g(e,R({id:t.labelTarget.id})))},_r.prototype.createTree=function(t){var e=this._rules,n=this,o={},i=[];function r(t,e){var n=g(i,(function(e){return t===e.element}));n?n.depth<e&&(i=function(t,e){var n=e.indexOf(t);-1!==n&&e.splice(n,1);return e}(n,i)).push({element:n.element,depth:e}):i.push({element:t,depth:e})}return St(wt(t),(function(t,e,o){if(!Vt(t)){f(t.labels,(function(t){r(t,o)})),f([t.attachers,t.incoming,t.outgoing],(function(t){t&&t.length&&f(t,(function(t){f(t.labels,(function(t){r(t,o)})),r(t,o)}))})),r(t,o);var i=[];return t.children&&(i=t.children.slice()),n._eventBus.fire("copyPaste.createTree",{element:t,children:i}),i}})),t=z(i,(function(t){return t.element})),i=z(i,(function(e){return e.descriptor={},n._eventBus.fire("copyPaste.copyElement",{descriptor:e.descriptor,element:e.element,elements:t}),e})),i=S(i,(function(t){return t.descriptor.priority})),t=z(i,(function(t){return t.element})),f(i,(function(i){var r,a,s=i.depth;n.hasRelations(i.element,t)?(r=i.element,a=t,e.allowed("element.copy",{element:r,elements:a})?(o[s]||(o[s]=[]),o[s].push(i.descriptor)):wr(i.element,t)):wr(i.element,t)})),o};const Er={__depends__:[gr,fr,mr,Yo],__init__:["copyPaste"],copyPaste:["type",_r]};var br=Math.round;function Sr(t,e){this._modeling=t,this._eventBus=e}function Cr(t,e){e.on("replace.end",500,(function(e){const{newElement:n,hints:o={}}=e;!1!==o.select&&t.select(n)}))}Sr.$inject=["modeling","eventBus"],Sr.prototype.replaceElement=function(t,e,n){if(t.waypoints)return null;var o=this._modeling,i=this._eventBus;i.fire("replace.start",{element:t,attrs:e,hints:n});var r=e.width||t.width,a=e.height||t.height,s=e.x||t.x,c=e.y||t.y,u=br(s+r/2),h=br(c+a/2),l=o.replaceShape(t,_({},e,{x:u,y:h,width:r,height:a}),n);return i.fire("replace.end",{element:t,newElement:l,hints:n}),l},Cr.$inject=["selection","eventBus"];const kr={__init__:["replace","replaceSelectionBehavior"],replaceSelectionBehavior:["type",Cr],replace:["type",Sr]};var Mr=Math.max,jr=Math.min,Rr=20;function Tr(t,e){return{top:t.top-e.top,right:t.right-e.right,bottom:t.bottom-e.bottom,left:t.left-e.left}}function Br(t,e){return{x:t.x+(e.left||0),y:t.y+(e.top||0),width:t.width-(e.left||0)+(e.right||0),height:t.height-(e.top||0)+(e.bottom||0)}}function Pr(t,e,n){var o=e[t],i=n.min&&n.min[t],r=n.max&&n.max[t];return p(i)&&(o=(/top|left/.test(t)?jr:Mr)(o,i)),p(r)&&(o=(/top|left/.test(t)?Mr:jr)(o,r)),o}function Lr(t,e){return void 0!==t?t:Rr}function Or(t){return!t.waypoints&&"label"!==t.type}function $r(t,e){var n;if((n=void 0===t.length?v(t.children,Or):t).length)return function(t,e){var n,o,i,r;return"object"==typeof e?(n=Lr(e.left),o=Lr(e.right),i=Lr(e.top),r=Lr(e.bottom)):n=o=i=r=Lr(e),{x:t.x-n,y:t.y-i,width:t.width+n+o,height:t.height+i+r}}(kt(n),e)}var Ar={horizontal:["x","width"],vertical:["y","height"]};function zr(t,e){this._modeling=t,this._filters=[],this.registerFilter((function(t){var n=e.allowed("elements.distribute",{elements:t});return d(n)?n:n?t:[]}))}zr.$inject=["modeling","rules"],zr.prototype.registerFilter=function(t){if("function"!=typeof t)throw new Error("the filter has to be a function");this._filters.push(t)},zr.prototype.trigger=function(t,e){var n,o,i=this._modeling;if(!(t.length<3||(this._setOrientation(e),o=this._filterElements(t),(n=this._createGroups(o)).length<=2)))return i.distributeElements(n,this._axis,this._dimension),n},zr.prototype._filterElements=function(t){var e=this._filters,n=this._axis,o=this._dimension,i=[].concat(t);return e.length?(f(e,(function(t){i=t(i,n,o)})),i):t},zr.prototype._createGroups=function(t){var e=[],n=this,o=this._axis,i=this._dimension;if(!o)throw new Error('must have a defined "axis" and "dimension"');var r=S(t,o);return f(r,(function(t,r){var a,s=n._findRange(t,o,i),c=e[e.length-1];c&&n._hasIntersection(c.range,s)?e[e.length-1].elements.push(t):(a={range:s,elements:[t]},e.push(a))})),e},zr.prototype._setOrientation=function(t){var e=Ar[t];this._axis=e[0],this._dimension=e[1]},zr.prototype._hasIntersection=function(t,e){return Math.max(t.min,t.max)>=Math.min(e.min,e.max)&&Math.min(t.min,t.max)<=Math.max(e.min,e.max)},zr.prototype._findRange=function(t){var e=t[this._axis];return{min:e+5,max:e+t[this._dimension]-5}};const Ir={__init__:["distributeElements"],distributeElements:["type",zr]};var Dr="is not a registered action";function Hr(t,e){this._actions={};var n=this;t.on("diagram.init",(function(){n._registerDefaultActions(e),t.fire("editorActions.init",{editorActions:n})}))}function Gr(t,e){return new Error(t+" "+e)}Hr.$inject=["eventBus","injector"],Hr.prototype._registerDefaultActions=function(t){var e=t.get("commandStack",!1),n=t.get("modeling",!1),o=t.get("selection",!1),i=t.get("zoomScroll",!1),r=t.get("copyPaste",!1),a=t.get("canvas",!1),s=t.get("rules",!1),c=t.get("keyboardMove",!1),u=t.get("keyboardMoveSelection",!1);e&&(this.register("undo",(function(){e.undo()})),this.register("redo",(function(){e.redo()}))),r&&o&&this.register("copy",(function(){var t=o.get();if(t.length)return r.copy(t)})),r&&this.register("paste",(function(){r.paste()})),i&&this.register("stepZoom",(function(t){i.stepZoom(t.value)})),a&&this.register("zoom",(function(t){a.zoom(t.value)})),n&&o&&s&&this.register("removeSelection",(function(){var t=o.get();if(t.length){var e,i=s.allowed("elements.delete",{elements:t});!1!==i&&(e=d(i)?i:t).length&&n.removeElements(e.slice())}})),c&&this.register("moveCanvas",(function(t){c.moveCanvas(t)})),u&&this.register("moveSelection",(function(t){u.moveSelection(t.direction,t.accelerated)}))},Hr.prototype.trigger=function(t,e){if(!this._actions[t])throw Gr(t,Dr);return this._actions[t](e)},Hr.prototype.register=function(t,e){var n=this;if("string"==typeof t)return this._registerAction(t,e);f(t,(function(t,e){n._registerAction(e,t)}))},Hr.prototype._registerAction=function(t,e){if(this.isRegistered(t))throw Gr(t,"is already registered");this._actions[t]=e},Hr.prototype.unregister=function(t){if(!this.isRegistered(t))throw Gr(t,Dr);this._actions[t]=void 0},Hr.prototype.getActions=function(){return Object.keys(this._actions)},Hr.prototype.isRegistered=function(t){return!!this._actions[t]};const Nr={__init__:["editorActions"],editorActions:["type",Hr]};function Vr(t,e,n){return n||(n="round"),Math[n](t/e)*e}function Ur(t,e,n){var o=!n||!1!==n.active;this._eventBus=e;var i=this;e.on("diagram.init",800,(function(){i.setActive(o)})),e.on(["create.move","create.end","bendpoint.move.move","bendpoint.move.end","connect.move","connect.end","connectionSegment.move.move","connectionSegment.move.end","resize.move","resize.end","shape.move.move","shape.move.end"],1200,(function(e){var n=e.originalEvent;if(!(!i.active||n&&Mn(n))){var o=e.context,r=o.gridSnappingContext;r||(r=o.gridSnappingContext={}),["x","y"].forEach((function(n){var o={},r=function(t,e,n){var o=t.context,i=t.shape,r=o.gridSnappingContext,a=r.snapLocation,s=r.snapOffset;if(s&&p(s[e]))return s[e];s||(s=r.snapOffset={});p(s[e])||(s[e]=0);if(!i)return s[e];n.get(i.id)||(Fr(e)?s[e]+=i[e]+i.width/2:s[e]+=i[e]+i.height/2);if(!a)return s[e];"x"===e?/left/.test(a)?s[e]-=i.width/2:/right/.test(a)&&(s[e]+=i.width/2):/top/.test(a)?s[e]-=i.height/2:/bottom/.test(a)&&(s[e]+=i.height/2);return s[e]}(e,n,t);r&&(o.offset=r);var a=function(t,e){var n=t.context,o=n.createConstraints,i=n.resizeConstraints||{},r=n.gridSnappingContext,a=r.snapConstraints;if(a&&a[e])return a[e];a||(a=r.snapConstraints={});a[e]||(a[e]={});var s=n.direction;o&&(Fr(e)?(a.x.min=o.left,a.x.max=o.right):(a.y.min=o.top,a.y.max=o.bottom));var c=i.min,u=i.max;c&&(Fr(e)?Kr(s)?a.x.max=c.left:a.x.min=c.right:Wr(s)?a.y.max=c.top:a.y.min=c.bottom);u&&(Fr(e)?Kr(s)?a.x.min=u.left:a.x.max=u.right:Wr(s)?a.y.min=u.top:a.y.max=u.bottom);return a[e]}(e,n);a&&_(o,a),Hi(e,n)||i.snapEvent(e,n,o)}))}}))}function Fr(t){return"x"===t}function Wr(t){return-1!==t.indexOf("n")}function Kr(t){return-1!==t.indexOf("w")}function qr(t,e){gn.call(this,t),this._gridSnapping=e;var n=this;this.preExecute("shape.resize",(function(t){var e=t.context,o=(e.hints||{}).autoResize;if(o){var i=e.shape,r=e.newBounds;j(o)?e.newBounds=n.snapComplex(r,o):e.newBounds=n.snapSimple(i,r)}}))}Ur.prototype.snapEvent=function(t,e,n){Gi(t,e,this.snapValue(t[e],n))},Ur.prototype.getGridSpacing=function(){return 10},Ur.prototype.snapValue=function(t,e){var n,o,i=0;return e&&e.offset&&(i=e.offset),t=Vr(t+=i,10),e&&e.min&&(n=e.min,p(n)&&(n=Vr(n+i,10,"ceil"),t=Math.max(t,n))),e&&e.max&&(o=e.max,p(o)&&(o=Vr(o+i,10,"floor"),t=Math.min(t,o))),t-=i},Ur.prototype.isActive=function(){return this.active},Ur.prototype.setActive=function(t){this.active=t,this._eventBus.fire("gridSnapping.toggle",{active:t})},Ur.prototype.toggleActive=function(){this.setActive(!this.active)},Ur.$inject=["elementRegistry","eventBus","config.gridSnapping"],qr.$inject=["eventBus","gridSnapping","modeling"],e(qr,gn),qr.prototype.snapSimple=function(t,e){var n=this._gridSnapping;return e.width=n.snapValue(e.width,{min:e.width}),e.height=n.snapValue(e.height,{min:e.height}),e.x=t.x+t.width/2-e.width/2,e.y=t.y+t.height/2-e.height/2,e},qr.prototype.snapComplex=function(t,e){return/w|e/.test(e)&&(t=this.snapHorizontally(t,e)),/n|s/.test(e)&&(t=this.snapVertically(t,e)),t},qr.prototype.snapHorizontally=function(t,e){var n=this._gridSnapping,o=/w/.test(e),i=/e/.test(e),r={};return r.width=n.snapValue(t.width,{min:t.width}),i&&(o?(r.x=n.snapValue(t.x,{max:t.x}),r.width+=n.snapValue(t.x-r.x,{min:t.x-r.x})):t.x=t.x+t.width-r.width),_(t,r),t},qr.prototype.snapVertically=function(t,e){var n=this._gridSnapping,o=/n/.test(e),i=/s/.test(e),r={};return r.height=n.snapValue(t.height,{min:t.height}),o&&(i?(r.y=n.snapValue(t.y,{max:t.y}),r.height+=n.snapValue(t.y-r.y,{min:t.y-r.y})):t.y=t.y+t.height-r.height),_(t,r),t};function Yr(t,e){t.on(["spaceTool.move","spaceTool.end"],2e3,(function(t){var n,o=t.context;o.initialized&&("x"===o.axis?(n=e.snapValue(t.dx),t.x=t.x+n-t.dx,t.dx=n):(n=e.snapValue(t.dy),t.y=t.y+n-t.dy,t.dy=n))}))}Yr.$inject=["eventBus","gridSnapping"];const Zr={__depends__:[{__init__:["gridSnappingResizeBehavior","gridSnappingSpaceToolBehavior"],gridSnappingResizeBehavior:["type",qr],gridSnappingSpaceToolBehavior:["type",Yr]}],__init__:["gridSnapping"],gridSnapping:["type",Ur]};var Xr={moveSpeed:1,moveSpeedAccelerated:10},Jr="left",Qr="right",ta="down",ea={ArrowLeft:Jr,Left:Jr,ArrowUp:"up",Up:"up",ArrowRight:Qr,Right:Qr,ArrowDown:ta,Down:ta},na={left:function(t){return{x:-t,y:0}},up:function(t){return{x:0,y:-t}},right:function(t){return{x:t,y:0}},down:function(t){return{x:0,y:t}}};function oa(t,e,n,o,i){var r=this;this._config=_({},Xr,t||{}),e.addListener(1500,(function(t){var n=t.keyEvent,o=ea[n.key];if(o&&!e.isCmd(n)){var i=e.isShift(n);return r.moveSelection(o,i),!0}})),this.moveSelection=function(t,e){var r=i.get();if(r.length){var a=this._config[e?"moveSpeedAccelerated":"moveSpeed"],s=na[t](a);o.allowed("elements.move",{shapes:r})&&n.moveElements(r,s)}}}oa.$inject=["config.keyboardMoveSelection","keyboard","modeling","rules","selection"];const ia={__depends__:[On,an],__init__:["keyboardMoveSelection"],keyboardMoveSelection:["type",oa]};function ra(t,e,n,o){this._dragging=o,this._rules=e;var i=this;function r(t,e){var n,o=t.shape,r=t.direction,a=t.resizeConstraints;t.delta=e,n=function(t,e,n){var o=n.x,i=n.y,r={x:t.x,y:t.y,width:t.width,height:t.height};return-1!==e.indexOf("n")?(r.y=t.y+i,r.height=t.height-i):-1!==e.indexOf("s")&&(r.height=t.height+i),-1!==e.indexOf("e")?r.width=t.width+o:-1!==e.indexOf("w")&&(r.x=t.x+o,r.width=t.width-o),r}(o,r,e),t.newBounds=function(t,e){if(!e)return t;var n=Wt(t);return Kt({top:Pr("top",n,e),right:Pr("right",n,e),bottom:Pr("bottom",n,e),left:Pr("left",n,e)})}(n,a),t.canExecute=i.canResize(t)}t.on("resize.start",(function(t){var e,n,o;e=t.context,n=e.resizeConstraints,o=e.minBounds,void 0===n&&(void 0===o&&(o=i.computeMinResizeBox(e)),e.resizeConstraints={min:Wt(o)})})),t.on("resize.move",(function(t){var e={x:t.dx,y:t.dy};r(t.context,e)})),t.on("resize.end",(function(t){!function(t){var e=t.shape,o=t.canExecute,i=t.newBounds;if(o){if(!function(t,e){return t.x!==e.x||t.y!==e.y||t.width!==e.width||t.height!==e.height}(e,i=Ut(i)))return;n.resizeShape(e,i)}}(t.context)}))}function aa(t,e){var n=Yt(t),o=Wt(t),i={x:n.x,y:n.y};return-1!==e.indexOf("n")?i.y=o.top:-1!==e.indexOf("s")&&(i.y=o.bottom),-1!==e.indexOf("e")?i.x=o.right:-1!==e.indexOf("w")&&(i.x=o.left),i}function sa(t){var e="resize-";return"n"===t||"s"===t?e+"ns":"e"===t||"w"===t?e+"ew":"nw"===t||"se"===t?e+"nwse":e+"nesw"}ra.prototype.canResize=function(t){var e=this._rules,n=$(t,["newBounds","shape","delta","direction"]);return e.allowed("shape.resize",n)},ra.prototype.activate=function(t,e,n){var o,i,r=this._dragging;if("string"==typeof n&&(n={direction:n}),!(i=(o=_({shape:e},n)).direction))throw new Error("must provide a direction (n|w|s|e|nw|se|ne|sw)");r.init(t,aa(e,i),"resize",{autoActivate:!0,cursor:sa(i),data:{shape:e,context:o}})},ra.prototype.computeMinResizeBox=function(t){var e=t.shape;return function(t,e,n,o){var i=Wt(e),r={top:/n/.test(t)?i.bottom-n.height:i.top,left:/w/.test(t)?i.right-n.width:i.left,bottom:/s/.test(t)?i.top+n.height:i.bottom,right:/e/.test(t)?i.left+n.width:i.right},a=o?Wt(o):r;return Kt({top:jr(r.top,a.top),left:jr(r.left,a.left),bottom:Mr(r.bottom,a.bottom),right:Mr(r.right,a.right)})}(t.direction,e,t.minDimensions||{width:10,height:10},$r(e,t.childrenBoxPadding))},ra.$inject=["eventBus","rules","modeling","dragging"];var ca="djs-resizing",ua="resize-not-ok";function ha(t,e,n){t.on("resize.move",500,(function(t){var i,r,s,c;i=t.context,r=i.shape,s=i.newBounds,(c=i.frame)||(c=i.frame=n.addFrame(r,e.getActiveLayer()),e.addMarker(r,ca)),s.width>5&&o(c,{x:s.x,width:s.width}),s.height>5&&o(c,{y:s.y,height:s.height}),i.canExecute?a(c).remove(ua):a(c).add(ua)})),t.on("resize.cleanup",(function(t){var n,o;n=t.context,o=n.shape,n.frame&&r(n.frame),e.removeMarker(o,ca)}))}ha.$inject=["eventBus","canvas","previewSupport"];var la=-6,pa="djs-resizer",da=["n","w","s","e","nw","ne","se","sw"];function fa(t,e,n,o){this._resize=o,this._canvas=e;var i=this;t.on("selection.changed",(function(t){var e=t.newSelection;i.removeResizers(),1===e.length&&f(e,k(i.addResizer,i))})),t.on("shape.changed",(function(t){var e=t.element;n.isSelected(e)&&(i.removeResizers(),i.addResizer(e))}))}fa.prototype.makeDraggable=function(t,e,n){var o=this._resize;function i(e){Ue(e)&&o.activate(e,t,n)}J.bind(e,"mousedown",i),J.bind(e,"touchstart",i)},fa.prototype._createResizer=function(t,e,r,s){var c=this._getResizersParent(),u=function(t){var e={x:0,y:0};-1!==t.indexOf("e")?e.x=6:-1!==t.indexOf("w")&&(e.x=la);-1!==t.indexOf("s")?e.y=6:-1!==t.indexOf("n")&&(e.y=la);return e}(s),h=n("g");a(h).add(pa),a(h).add(pa+"-"+t.id),a(h).add(pa+"-"+s),i(c,h);var l=n("rect");o(l,{x:-4+u.x,y:-4+u.y,width:8,height:8}),a(l).add(pa+"-visual"),i(h,l);var p=n("rect");return o(p,{x:-10+u.x,y:-10+u.y,width:20,height:20}),a(p).add(pa+"-hit"),i(h,p),be(h,e,r),h},fa.prototype.createResizer=function(t,e){var n=aa(t,e),o=this._createResizer(t,n.x,n.y,e);this.makeDraggable(t,o,e)},fa.prototype.addResizer=function(t){var e=this;!Nt(t)&&this._resize.canResize({shape:t})&&f(da,(function(n){e.createResizer(t,n)}))},fa.prototype.removeResizers=function(){var t=this._getResizersParent();h(t)},fa.prototype._getResizersParent=function(){return this._canvas.getLayer("resizers")},fa.$inject=["eventBus","canvas","selection","resize"];const va={__depends__:[Yo,Uo,ir],__init__:["resize","resizePreview","resizeHandles"],resize:["type",ra],resizePreview:["type",ha],resizeHandles:["type",fa]};function ga(t,e,n){var o=Vn(e),i=Vn(n),r=Un(t,o),a=r.x*(n.width/e.width),s=r.y*(n.height/e.height);return Ft({x:i.x+a,y:i.y+s})}function ya(t,e,n){var o=Vn(t),i=Vn(e),r=Vn(n),a=Un(t,o),s=Un(o,i),c=function(t,e,n){var o=Wt(e),i=Wt(n);if(function(t,e){return function(t,e){return t.right!==e.right&&t.left!==e.left}(t,e)||function(t,e){return t.top!==e.top&&t.bottom!==e.bottom}(t,e)}(o,i))return null;var r,a,s,c=Zt(e,t);if("top"===c)r={x:0,y:i.bottom-o.bottom};else if("bottom"===c)r={x:0,y:i.top-o.top};else if("right"===c)r={x:i.left-o.left,y:0};else{if("left"!==c)return null;r={x:i.right-o.right,y:0}}if(a={x:t.x+r.x,y:t.y+r.y},s=Zt(n,a),s!==c)return null;return r}(o,e,n);if(c)return c;var u=s.x*(n.width/e.width),h=s.y*(n.height/e.height),l=r.x+u,p=r.y+h;return Ft({x:l+a.x-t.x,y:p+a.y-t.y})}function ma(t,e,n){var o=ba(t),i=Sa(o,e),r=o[0];return i.length?i[i.length-1]:ga(r.original||r,n,e)}function _a(t,e,n){var o=ba(t),i=Sa(o,e),r=o[o.length-1];return i.length?i[0]:ga(r.original||r,n,e)}function xa(t,e,n){var o=ba(t),i=Ea(e,n),r=o[0];return ga(r.original||r,i,e)}function wa(t,e,n){var o=ba(t),i=Ea(e,n),r=o[o.length-1];return ga(r.original||r,i,e)}function Ea(t,e){return{x:t.x-e.x,y:t.y-e.y,width:t.width,height:t.height}}function ba(t){var e=t.waypoints;if(!e.length)throw new Error("connection#"+t.id+": no waypoints");return e}function Sa(t,e){var n=z(t,Ca);return v(n,(function(t){return function(t,e){return"intersect"===Zt(e,t,1)}(t,e)}))}function Ca(t){return t.original||t}function ka(t){gn.call(this,t);var e=this;this.preExecute(["shape.create","connection.create"],(function(t){var n=t.context,o=n.shape||n.connection,i=n.parent,r=e.getOrdering(o,i);r&&(void 0!==r.parent&&(n.parent=r.parent),n.parentIndex=r.index)})),this.preExecute(["shape.move","connection.move"],(function(t){var n=t.context,o=n.shape||n.connection,i=n.newParent||o.parent,r=e.getOrdering(o,i);r&&(void 0!==r.parent&&(n.newParent=r.parent),n.newParentIndex=r.index)}))}ka.prototype.getOrdering=function(t,e){return null},e(ka,gn);function Ma(t,e){this._eventBus=t,this._dragging=e,this._tools=[],this._active=null}Ma.$inject=["eventBus","dragging"],Ma.prototype.registerTool=function(t,e){var n=this._tools;if(!e)throw new Error('A tool has to be registered with it\'s "events"');n.push(t),this.bindEvents(t,e)},Ma.prototype.isActive=function(t){return t&&this._active===t},Ma.prototype.length=function(t){return this._tools.length},Ma.prototype.setActive=function(t){var e=this._eventBus;this._active!==t&&(this._active=t,e.fire("tool-manager.update",{tool:t}))},Ma.prototype.bindEvents=function(t,e){var n=this._eventBus,o=this._dragging,i=[];n.on(e.tool+".init",(function(e){if(!e.context.reactivate&&this.isActive(t))return this.setActive(null),void o.cancel();this.setActive(t)}),this),f(e,(function(t){i.push(t+".ended"),i.push(t+".canceled")})),n.on(i,250,(function(t){this._active&&(function(t){var e=t.originalEvent&&t.originalEvent.target;return e&&X(e,'.group[data-group="tools"]')}(t)||this.setActive(null))}),this)};const ja={__depends__:[Uo],__init__:["toolManager"],toolManager:["type",Ma]};function Ra(t,e){return-1!==t.indexOf(e)}var Ta=Math.abs,Ba=Math.round,Pa={x:"width",y:"height"},La="crosshair",Oa={n:"top",w:"left",s:"bottom",e:"right"},$a={n:"s",w:"e",s:"n",e:"w"},Aa=20;function za(t,e,n,o,i,r,a){this._canvas=t,this._dragging=e,this._eventBus=n,this._modeling=o,this._rules=i,this._toolManager=r,this._mouse=a;var s=this;r.registerTool("space",{tool:"spaceTool.selection",dragging:"spaceTool"}),n.on("spaceTool.selection.end",(function(t){n.once("spaceTool.selection.ended",(function(){s.activateMakeSpace(t.originalEvent)}))})),n.on("spaceTool.move",1500,(function(t){var e=t.context,n=e.initialized;n||(n=e.initialized=s.init(t,e)),n&&Da(t)})),n.on("spaceTool.end",(function(t){var e=t.context,o=e.axis,i=e.direction,r=e.movingShapes,a=e.resizingShapes,c=e.start;if(e.initialized){Da(t);var u={x:0,y:0};u[o]=Ba(t["d"+o]),s.makeSpace(r,a,u,i,c),n.once("spaceTool.ended",(function(t){s.activateSelection(t.originalEvent,!0,!0)}))}}))}function Ia(t){return{top:t.top-Aa,right:t.right+Aa,bottom:t.bottom+Aa,left:t.left-Aa}}function Da(t){var e,n,o=t.context.spaceToolConstraints;o&&(p(o.left)&&(e=Math.max(t.x,o.left),t.dx=t.dx+e-t.x,t.x=e),p(o.right)&&(e=Math.min(t.x,o.right),t.dx=t.dx+e-t.x,t.x=e),p(o.top)&&(n=Math.max(t.y,o.top),t.dy=t.dy+n-t.y,t.y=n),p(o.bottom)&&(n=Math.min(t.y,o.bottom),t.dy=t.dy+n-t.y,t.y=n))}function Ha(t,e){return-1!==t.indexOf(e)}za.$inject=["canvas","dragging","eventBus","modeling","rules","toolManager","mouse"],za.prototype.activateSelection=function(t,e,n){this._dragging.init(t,"spaceTool.selection",{autoActivate:e,cursor:La,data:{context:{reactivate:n}},trapClick:!1})},za.prototype.activateMakeSpace=function(t){this._dragging.init(t,"spaceTool",{autoActivate:!0,cursor:La,data:{context:{}}})},za.prototype.makeSpace=function(t,e,n,o,i){return this._modeling.createSpace(t,e,n,o,i)},za.prototype.init=function(t,e){var n=Ta(t.dx)>Ta(t.dy)?"x":"y",o=t["d"+n],i=t[n]-o;if(Ta(o)<5)return!1;o<0&&(o*=-1),Fe(t)&&(o*=-1);var r=function(t,e){if("x"===t){if(e>0)return"e";if(e<0)return"w"}if("y"===t){if(e>0)return"s";if(e<0)return"n"}return null}(n,o),a=Ct(this._canvas.getRootElement(),!0),s=this.calculateAdjustments(a,n,o,i),c=function(t,e,n,o,i){var r=t.movingShapes,a=t.resizingShapes;if(!a.length)return;var s,c,u={};return f(a,(function(t){var h,l,d,f,g,y,m=t.attachers,_=t.children,x=Wt(t),w=v(_,(function(t){return!(Nt(t)||Vt(t)||Ha(r,t)||Ha(a,t))})),E=v(_,(function(t){return!Nt(t)&&!Vt(t)&&Ha(r,t)})),b=[],S=[];w.length&&(l=Ia(Wt(kt(w))),h=o-x[Oa[n]]+l[Oa[n]],"n"===n?u.bottom=c=p(c)?Math.min(c,h):h:"w"===n?u.right=c=p(c)?Math.min(c,h):h:"s"===n?u.top=s=p(s)?Math.max(s,h):h:"e"===n&&(u.left=s=p(s)?Math.max(s,h):h)),E.length&&(d=Ia(Wt(kt(E))),h=o-d[Oa[$a[n]]]+x[Oa[$a[n]]],"n"===n?u.bottom=c=p(c)?Math.min(c,h):h:"w"===n?u.right=c=p(c)?Math.min(c,h):h:"s"===n?u.top=s=p(s)?Math.max(s,h):h:"e"===n&&(u.left=s=p(s)?Math.max(s,h):h)),m&&m.length&&(m.forEach((function(t){Ha(r,t)?b.push(t):S.push(t)})),b.length&&(f=Wt(kt(b.map(Yt))),g=x[Oa[$a[n]]]-(f[Oa[$a[n]]]-o)),S.length&&(y=Wt(kt(S.map(Yt)))[Oa[n]]-(x[Oa[n]]-o)),"n"===n?(h=Math.min(g||1/0,y||1/0),u.bottom=c=p(c)?Math.min(c,h):h):"w"===n?(h=Math.min(g||1/0,y||1/0),u.right=c=p(c)?Math.min(c,h):h):"s"===n?(h=Math.max(g||-1/0,y||-1/0),u.top=s=p(s)?Math.max(s,h):h):"e"===n&&(h=Math.max(g||-1/0,y||-1/0),u.left=s=p(s)?Math.max(s,h):h));var C=i&&i[t.id];C&&("n"===n?(h=o+t[Pa[e]]-C[Pa[e]],u.bottom=c=p(c)?Math.min(c,h):h):"w"===n?(h=o+t[Pa[e]]-C[Pa[e]],u.right=c=p(c)?Math.min(c,h):h):"s"===n?(h=o-t[Pa[e]]+C[Pa[e]],u.top=s=p(s)?Math.max(s,h):h):"e"===n&&(h=o-t[Pa[e]]+C[Pa[e]],u.left=s=p(s)?Math.max(s,h):h))})),u}(s,n,r,i,this._eventBus.fire("spaceTool.getMinDimensions",{axis:n,direction:r,shapes:s.resizingShapes,start:i}));return _(e,s,{axis:n,direction:r,spaceToolConstraints:c,start:i}),Dn("resize-"+("x"===n?"ew":"ns")),!0},za.prototype.calculateAdjustments=function(t,e,n,o){var i=this._rules,r=[],a=[],s=[],c=[];function u(t){r.includes(t)||r.push(t);var e=t.label;e&&!r.includes(e)&&r.push(e)}f(t,(function(t){if(t.parent&&!Vt(t))if(Nt(t))c.push(t);else{var r=t[e],h=r+t[Pa[e]];if(function(t){return!!t.host}(t)&&(n>0&&Yt(t)[e]>o||n<0&&Yt(t)[e]<o))s.push(t);else{var l;if(!(n>0&&r>o||n<0&&h<o))return r<o&&h>o&&i.allowed("shape.resize",{shape:t})?(l=t,void(a.includes(l)||a.push(l))):void 0;u(t)}}})),f(r,(function(t){var e=t.attachers;e&&f(e,(function(t){u(t)}))}));var h=r.concat(a);return f(s,(function(t){var e=t.host;Ha(h,e)&&u(t)})),h=r.concat(a),f(c,(function(t){var e=t.source,n=t.target,o=t.label;Ha(h,e)&&Ha(h,n)&&o&&u(o)})),{movingShapes:r,resizingShapes:a}},za.prototype.toggle=function(){if(this.isActive())return this._dragging.cancel();var t=this._mouse.getLastMoveEvent();this.activateSelection(t,!!t)},za.prototype.isActive=function(){var t=this._dragging.context();return!!t&&/^spaceTool/.test(t.prefix)};var Ga="djs-dragging",Na="djs-resizing",Va=Math.max;function Ua(t,e,s,c,u){function h(t,e){f(t,(function(t){u.addDragger(t,e),s.addMarker(t,Ga)}))}t.on("spaceTool.selection.start",(function(t){var e=s.getLayer("space"),r=t.context,u="M 0,-10000 L 0,10000",h="M -10000,0 L 10000,0",l=n("g");o(l,c.cls("djs-crosshair-group",["no-events"])),i(e,l);var p=n("path");o(p,"d",u),a(p).add("djs-crosshair"),i(l,p);var d=n("path");o(d,"d",h),a(d).add("djs-crosshair"),i(l,d),r.crosshairGroup=l})),t.on("spaceTool.selection.move",(function(t){Se(t.context.crosshairGroup,t.x,t.y)})),t.on("spaceTool.selection.cleanup",(function(t){var e=t.context.crosshairGroup;e&&r(e)})),t.on("spaceTool.move",250,(function(t){var r=t.context,l=r.line,p=r.axis,d=r.movingShapes,v=r.resizingShapes;if(r.initialized){if(!r.dragGroup){var g=s.getLayer("space");l=n("path"),o(l,"d","M0,0 L0,0"),a(l).add("djs-crosshair"),i(g,l),r.line=l;var y=n("g");o(y,c.cls("djs-drag-group",["no-events"])),i(s.getActiveLayer(),y),h(d,y),h(r.movingConnections=e.filter((function(t){var e=!1;f(d,(function(n){f(n.outgoing,(function(n){t===n&&(e=!0)}))}));var n=!1;f(d,(function(e){f(e.incoming,(function(e){t===e&&(n=!0)}))}));var o=!1;f(v,(function(e){f(e.outgoing,(function(e){t===e&&(o=!0)}))}));var i=!1;return f(v,(function(e){f(e.incoming,(function(e){t===e&&(i=!0)}))})),Nt(t)&&(e||o)&&(n||i)})),y),r.dragGroup=y}if(!r.frameGroup){var m=n("g");o(m,c.cls("djs-frame-group",["no-events"])),i(s.getActiveLayer(),m);var _=[];f(v,(function(t){var e=u.addFrame(t,m),n=e.getBBox();_.push({element:e,initialBounds:n}),s.addMarker(t,Na)})),r.frameGroup=m,r.frames=_}var x={x:"M"+t.x+", -10000 L"+t.x+", 10000",y:"M -10000, "+t.y+" L 10000, "+t.y};o(l,{d:x[p]});var w={x:t.dx,y:t.dy};w[{x:"y",y:"x"}[r.axis]]=0,Se(r.dragGroup,w.x,w.y),f(r.frames,(function(t){var e,n,i=t.element,a=t.initialBounds;"e"===r.direction?o(i,{width:Va(a.width+w.x,5)}):(e=Va(a.width-w.x,5),o(i,{width:e,x:a.x+a.width-e})),"s"===r.direction?o(i,{height:Va(a.height+w.y,5)}):(n=Va(a.height-w.y,5),o(i,{height:n,y:a.y+a.height-n}))}))}})),t.on("spaceTool.cleanup",(function(t){var e=t.context,n=e.movingShapes,o=e.movingConnections,i=e.resizingShapes,a=e.line,c=e.dragGroup,u=e.frameGroup;f(n,(function(t){s.removeMarker(t,Ga)})),f(o,(function(t){s.removeMarker(t,Ga)})),c&&(r(a),r(c)),f(i,(function(t){s.removeMarker(t,Na)})),u&&r(u)}))}Ua.$inject=["eventBus","elementRegistry","canvas","styles","previewSupport"];const Fa={__init__:["spaceToolPreview"],__depends__:[Uo,Yo,ja,ir,mr],spaceTool:["type",za],spaceToolPreview:["type",Ua]};function Wa(t,e){this._handlerMap={},this._stack=[],this._stackIdx=-1,this._currentExecution={actions:[],dirty:[],trigger:null},this._injector=e,this._eventBus=t,this._uid=1,t.on(["diagram.destroy","diagram.clear"],(function(){this.clear(!1)}),this)}Wa.$inject=["eventBus","injector"],Wa.prototype.execute=function(t,e){if(!t)throw new Error("command required");this._currentExecution.trigger="execute";const n={command:t,context:e};this._pushAction(n),this._internalExecute(n),this._popAction()},Wa.prototype.canExecute=function(t,e){const n={command:t,context:e},o=this._getHandler(t);let i=this._fire(t,"canExecute",n);if(void 0===i){if(!o)return!1;o.canExecute&&(i=o.canExecute(e))}return i},Wa.prototype.clear=function(t){this._stack.length=0,this._stackIdx=-1,!1!==t&&this._fire("changed",{trigger:"clear"})},Wa.prototype.undo=function(){let t,e=this._getUndoAction();if(e){for(this._currentExecution.trigger="undo",this._pushAction(e);e&&(this._internalUndo(e),t=this._getUndoAction(),t&&t.id===e.id);)e=t;this._popAction()}},Wa.prototype.redo=function(){let t,e=this._getRedoAction();if(e){for(this._currentExecution.trigger="redo",this._pushAction(e);e&&(this._internalExecute(e,!0),t=this._getRedoAction(),t&&t.id===e.id);)e=t;this._popAction()}},Wa.prototype.register=function(t,e){this._setHandler(t,e)},Wa.prototype.registerHandler=function(t,e){if(!t||!e)throw new Error("command and handlerCls must be defined");const n=this._injector.instantiate(e);this.register(t,n)},Wa.prototype.canUndo=function(){return!!this._getUndoAction()},Wa.prototype.canRedo=function(){return!!this._getRedoAction()},Wa.prototype._getRedoAction=function(){return this._stack[this._stackIdx+1]},Wa.prototype._getUndoAction=function(){return this._stack[this._stackIdx]},Wa.prototype._internalUndo=function(t){const e=t.command,n=t.context,o=this._getHandler(e);this._atomicDo((()=>{this._fire(e,"revert",t),o.revert&&this._markDirty(o.revert(n)),this._revertedAction(t),this._fire(e,"reverted",t)}))},Wa.prototype._fire=function(t,e,n){arguments.length<3&&(n=e,e=null);const o=e?[t+"."+e,e]:[t];let i;n=this._eventBus.createEvent(n);for(const r of o)if(i=this._eventBus.fire("commandStack."+r,n),n.cancelBubble)break;return i},Wa.prototype._createId=function(){return this._uid++},Wa.prototype._atomicDo=function(t){const e=this._currentExecution;e.atomic=!0;try{t()}finally{e.atomic=!1}},Wa.prototype._internalExecute=function(t,e){const n=t.command,o=t.context,i=this._getHandler(n);if(!i)throw new Error("no command handler registered for <"+n+">");this._pushAction(t),e||(this._fire(n,"preExecute",t),i.preExecute&&i.preExecute(o),this._fire(n,"preExecuted",t)),this._atomicDo((()=>{this._fire(n,"execute",t),i.execute&&this._markDirty(i.execute(o)),this._executedAction(t,e),this._fire(n,"executed",t)})),e||(this._fire(n,"postExecute",t),i.postExecute&&i.postExecute(o),this._fire(n,"postExecuted",t)),this._popAction()},Wa.prototype._pushAction=function(t){const e=this._currentExecution,n=e.actions,o=n[0];if(e.atomic)throw new Error("illegal invocation in <execute> or <revert> phase (action: "+t.command+")");t.id||(t.id=o&&o.id||this._createId()),n.push(t)},Wa.prototype._popAction=function(){const t=this._currentExecution,e=t.trigger,n=t.actions,o=t.dirty;n.pop(),n.length||(this._eventBus.fire("elements.changed",{elements:I("id",o.reverse())}),o.length=0,this._fire("changed",{trigger:e}),t.trigger=null)},Wa.prototype._markDirty=function(t){const e=this._currentExecution;t&&(t=d(t)?t:[t],e.dirty=e.dirty.concat(t))},Wa.prototype._executedAction=function(t,e){const n=++this._stackIdx;e||this._stack.splice(n,this._stack.length,t)},Wa.prototype._revertedAction=function(t){this._stackIdx--},Wa.prototype._getHandler=function(t){return this._handlerMap[t]},Wa.prototype._setHandler=function(t,e){if(!t||!e)throw new Error("command and handler required");if(this._handlerMap[t])throw new Error("overriding handler for command <"+t+">");this._handlerMap[t]=e};const Ka={commandStack:["type",Wa]};var qa=new sn("tt");function Ya(t,e){t.style.display=!1===e?"none":""}var Za="djs-tooltip",Xa="."+Za;function Ja(t,e){var n,o;this._eventBus=t,this._canvas=e,this._ids=qa,this._tooltipDefaults={show:{minZoom:.7,maxZoom:5}},this._tooltips={},this._tooltipRoot=(n=e.getContainer(),o=Y('<div class="djs-tooltip-container" />'),N(o,{position:"absolute",width:"0",height:"0"}),n.insertBefore(o,n.firstChild),o);var i=this;W.bind(this._tooltipRoot,Xa,"mousedown",(function(t){t.stopPropagation()})),W.bind(this._tooltipRoot,Xa,"mouseover",(function(t){i.trigger("mouseover",t)})),W.bind(this._tooltipRoot,Xa,"mouseout",(function(t){i.trigger("mouseout",t)})),this._init()}Ja.$inject=["eventBus","canvas"],Ja.prototype.add=function(t){if(!t.position)throw new Error("must specifiy tooltip position");if(!t.html)throw new Error("must specifiy tooltip html");var e=this._ids.next();return t=_({},this._tooltipDefaults,t,{id:e}),this._addTooltip(t),t.timeout&&this.setTimeout(t),e},Ja.prototype.trigger=function(t,e){var n=e.delegateTarget||e.target,o=this.get(q(n,"data-tooltip-id"));o&&("mouseover"===t&&o.timeout&&this.clearTimeout(o),"mouseout"===t&&o.timeout&&(o.timeout=1e3,this.setTimeout(o)))},Ja.prototype.get=function(t){return"string"!=typeof t&&(t=t.id),this._tooltips[t]},Ja.prototype.clearTimeout=function(t){if(t=this.get(t)){var e=t.removeTimer;e&&(clearTimeout(e),t.removeTimer=null)}},Ja.prototype.setTimeout=function(t){if(t=this.get(t)){this.clearTimeout(t);var e=this;t.removeTimer=setTimeout((function(){e.remove(t)}),t.timeout)}},Ja.prototype.remove=function(t){var e=this.get(t);e&&(K(e.html),K(e.htmlContainer),delete e.htmlContainer,delete this._tooltips[e.id])},Ja.prototype.show=function(){Ya(this._tooltipRoot)},Ja.prototype.hide=function(){Ya(this._tooltipRoot,!1)},Ja.prototype._updateRoot=function(t){var e=t.scale||1,n=t.scale||1,o="matrix("+e+",0,0,"+n+","+-1*t.x*e+","+-1*t.y*n+")";this._tooltipRoot.style.transform=o,this._tooltipRoot.style["-ms-transform"]=o},Ja.prototype._addTooltip=function(t){var e,n=t.id,o=t.html,i=this._tooltipRoot;o.get&&o.constructor.prototype.jquery&&(o=o.get(0)),j(o)&&(o=Y(o)),e=Y('<div data-tooltip-id="'+n+'" class="'+Za+'">'),N(e,{position:"absolute"}),e.appendChild(o),t.type&&Z(e).add("djs-tooltip-"+t.type),t.className&&Z(e).add(t.className),t.htmlContainer=e,i.appendChild(e),this._tooltips[n]=t,this._updateTooltip(t)},Ja.prototype._updateTooltip=function(t){var e,n,o,i=t.position,r=t.htmlContainer;e=r,n=i.x,o=i.y,N(e,{left:n+"px",top:o+"px"})},Ja.prototype._updateTooltipVisibilty=function(t){f(this._tooltips,(function(e){var n=e.show,o=e.htmlContainer,i=!0;n&&((n.minZoom>t.scale||n.maxZoom<t.scale)&&(i=!1),Ya(o,i))}))},Ja.prototype._init=function(){var t=this;this._eventBus.on("canvas.viewbox.changing",(function(e){t.hide()})),this._eventBus.on("canvas.viewbox.changed",(function(e){var n;n=e.viewbox,t._updateRoot(n),t._updateTooltipVisibilty(n),t.show()}))};const Qa={__init__:["tooltips"],tooltips:["type",Ja]};function ts(t,e){if("function"!=typeof e)throw new Error("removeFn iterator must be a function");if(t){for(var n;n=t[0];)e(n);return t}}function es(t,e,n){gn.call(this,e);var o=t.get("movePreview",!1);e.on("shape.move.start",1400,(function(t){var e=t.context,n=e.shapes,o=e.validatedShapes;e.shapes=ns(n),e.validatedShapes=ns(o)})),o&&e.on("shape.move.start",250,(function(t){var e=t.context,n=e.shapes,i=[];f(n,(function(t){f(t.labels,(function(n){n.hidden||-1!==e.shapes.indexOf(n)||i.push(n),t.labelTarget&&i.push(t)}))})),f(i,(function(t){o.makeDraggable(e,t,!0)}))})),this.preExecuted("elements.move",1400,(function(t){var e=t.context.closure,n=e.enclosedElements,o=[];f(n,(function(t){f(t.labels,(function(t){n[t.id]||o.push(t)}))})),e.addAll(o)})),this.preExecute(["connection.delete","shape.delete"],(function(t){var e=t.context;ts((e.connection||e.shape).labels,(function(t){n.removeShape(t,{nested:!0})}))})),this.execute("shape.delete",(function(t){var e=t.context,n=e.shape,o=n.labelTarget;o&&(e.labelTargetIndex=Ot(o.labels,n),e.labelTarget=o,n.labelTarget=null)})),this.revert("shape.delete",(function(t){var e=t.context,n=e.shape,o=e.labelTarget,i=e.labelTargetIndex;o&&(Lt(o.labels,n,i),n.labelTarget=o)}))}function ns(t){return v(t,(function(e){return-1===t.indexOf(e.labelTarget)}))}e(es,gn),es.$inject=["injector","eventBus","modeling"];const os={__init__:["labelSupport"],labelSupport:["type",es]};var is="attach-ok";function rs(t,e,n,o,i){gn.call(this,e);var r=t.get("movePreview",!1);e.on("shape.move.start",1401,(function(t){var e,n,o=t.context,i=o.shapes,r=o.validatedShapes;o.shapes=(n=as(e=i),D("id",e,n)),o.validatedShapes=function(t){var e=m(t,"id");return v(t,(function(t){for(;t;){if(t.host&&e[t.host.id])return!1;t=t.parent}return!0}))}(r)})),r&&e.on("shape.move.start",251,(function(t){var e=t.context,n=as(e.shapes);f(n,(function(t){r.makeDraggable(e,t,!0),f(t.labels,(function(t){r.makeDraggable(e,t,!0)}))}))})),r&&e.on("shape.move.start",(function(t){var o=t.context.shapes;if(1===o.length){var i=o[0].host;i&&(n.addMarker(i,is),e.once(["shape.move.out","shape.move.cleanup"],(function(){n.removeMarker(i,is)})))}})),this.preExecuted("elements.move",1401,(function(t){var e=t.context,n=e.closure,o=as(e.shapes);f(o,(function(t){n.add(t,n.topLevel[t.host.id])}))})),this.postExecuted("elements.move",(function(t){var e,n=t.context,o=n.shapes,r=n.newHost;r&&1!==o.length||(e=r?o:v(o,(function(t){var e,n=t.host;return function(t){return!!t.host}(t)&&(e=n,!(-1!==o.indexOf(e)))})),f(e,(function(t){i.updateAttachment(t,r)})))})),this.postExecuted("elements.move",(function(t){var e=t.context.shapes;f(e,(function(t){f(t.attachers,(function(t){f(t.outgoing.slice(),(function(t){o.allowed("connection.reconnect",{connection:t,source:t.source,target:t.target})||i.removeConnection(t)})),f(t.incoming.slice(),(function(t){o.allowed("connection.reconnect",{connection:t,source:t.source,target:t.target})||i.removeConnection(t)}))}))}))})),this.postExecute("shape.create",(function(t){var e=t.context,n=e.shape,o=e.host;o&&i.updateAttachment(n,o)})),this.postExecute("shape.replace",(function(t){var e=t.context,n=e.oldShape,r=e.newShape;ts(n.attachers,(function(t){"attach"===o.allowed("elements.move",{target:r,shapes:[t]})?i.updateAttachment(t,r):i.removeShape(t)})),r.attachers.length&&f(r.attachers,(function(t){var e=ya(t,n,r);i.moveShape(t,e,t.parent)}))})),this.postExecute("shape.resize",(function(t){var e=t.context,n=e.shape,o=e.oldBounds,r=e.newBounds,a=n.attachers;!1!==(e.hints||{}).attachSupport&&f(a,(function(t){var e=ya(t,o,r);i.moveShape(t,e,t.parent),f(t.labels,(function(t){i.moveShape(t,e,t.parent)}))}))})),this.preExecute("shape.delete",(function(t){var e=t.context.shape;ts(e.attachers,(function(t){i.removeShape(t)})),e.host&&i.updateAttachment(e,null)}))}function as(t){return L(z(t,(function(t){return t.attachers||[]})))}e(rs,gn),rs.$inject=["injector","eventBus","canvas","rules","modeling"];const ss={__depends__:[Yo],__init__:["attachSupport"],attachSupport:["type",rs]};function cs(t,e){this._modeling=t,this._canvas=e}function us(t){this._modeling=t}function hs(t,e){this._canvas=t,this._layouter=e}cs.$inject=["modeling","canvas"],cs.prototype.preExecute=function(t){var e=this._modeling,n=t.elements,o=t.alignment;f(n,(function(t){var n={x:0,y:0};T(o.left)?n.x=o.left-t.x:T(o.right)?n.x=o.right-t.width-t.x:T(o.center)?n.x=o.center-Math.round(t.width/2)-t.x:T(o.top)?n.y=o.top-t.y:T(o.bottom)?n.y=o.bottom-t.height-t.y:T(o.middle)&&(n.y=o.middle-Math.round(t.height/2)-t.y),e.moveElements([t],n,t.parent)}))},cs.prototype.postExecute=function(t){},us.$inject=["modeling"],us.prototype.preExecute=function(t){var e=t.source;if(!e)throw new Error("source required");var n=t.target||e.parent,o=t.shape,i=t.hints||{};o=t.shape=this._modeling.createShape(o,t.position,n,{attach:i.attach}),t.shape=o},us.prototype.postExecute=function(t){var e,n,o=t.hints||{};e=t.source,n=t.shape,B(e.outgoing,(function(t){return t.target===n}))||(o.connectionTarget===t.source?this._modeling.connect(t.shape,t.source,t.connection):this._modeling.connect(t.source,t.shape,t.connection))},hs.$inject=["canvas","layouter"],hs.prototype.execute=function(t){var e=t.connection,n=t.source,o=t.target,i=t.parent,r=t.parentIndex,a=t.hints;if(!n||!o)throw new Error("source and target required");if(!i)throw new Error("parent required");return e.source=n,e.target=o,e.waypoints||(e.waypoints=this._layouter.layoutConnection(e,a)),this._canvas.addConnection(e,i,r),e},hs.prototype.revert=function(t){var e=t.connection;return this._canvas.removeConnection(e),e.source=null,e.target=null,e};var ls=Math.round;function ps(t){this._modeling=t}ps.$inject=["modeling"],ps.prototype.preExecute=function(t){var e=t.elements,n=t.parent,o=t.parentIndex,i=t.position,r=t.hints,a=this._modeling;f(e,(function(t){p(t.x)||(t.x=0),p(t.y)||(t.y=0)}));var s=kt(v(e,(function(t){return!t.hidden})));f(e,(function(t){Nt(t)&&(t.waypoints=z(t.waypoints,(function(t){return{x:ls(t.x-s.x-s.width/2+i.x),y:ls(t.y-s.y-s.height/2+i.y)}}))),_(t,{x:ls(t.x-s.x-s.width/2+i.x),y:ls(t.y-s.y-s.height/2+i.y)})}));var c=wt(e),u={};f(e,(function(t){if(Nt(t))u[t.id]=p(o)?a.createConnection(u[t.source.id],u[t.target.id],o,t,t.parent||n,r):a.createConnection(u[t.source.id],u[t.target.id],t,t.parent||n,r);else{var e=_({},r);-1===c.indexOf(t)&&(e.autoResize=!1),Vt(t)&&(e=P(e,["attach"])),u[t.id]=p(o)?a.createShape(t,$(t,["x","y","width","height"]),t.parent||n,o,e):a.createShape(t,$(t,["x","y","width","height"]),t.parent||n,e)}})),t.elements=O(u)};var ds=Math.round;function fs(t){this._canvas=t}function vs(t){fs.call(this,t)}fs.$inject=["canvas"],fs.prototype.execute=function(t){var e=t.shape,n=t.position,o=t.parent,i=t.parentIndex;if(!o)throw new Error("parent required");if(!n)throw new Error("position required");return void 0!==n.width?_(e,n):_(e,{x:n.x-ds(e.width/2),y:n.y-ds(e.height/2)}),this._canvas.addShape(e,o,i),e},fs.prototype.revert=function(t){var e=t.shape;return this._canvas.removeShape(e),e},e(vs,fs),vs.$inject=["canvas"];var gs=fs.prototype.execute;vs.prototype.execute=function(t){var e=t.shape;return function(t){["width","height"].forEach((function(e){void 0===t[e]&&(t[e]=0)}))}(e),e.labelTarget=t.labelTarget,gs.call(this,t)};var ys=fs.prototype.revert;function ms(t,e){this._canvas=t,this._modeling=e}function _s(t,e){this._modeling=t,this._elementRegistry=e}function xs(t,e){this._canvas=t,this._modeling=e}function ws(t){this._modeling=t}vs.prototype.revert=function(t){return t.shape.labelTarget=null,ys.call(this,t)},ms.$inject=["canvas","modeling"],ms.prototype.preExecute=function(t){var e=this._modeling,n=t.connection;ts(n.incoming,(function(t){e.removeConnection(t,{nested:!0})})),ts(n.outgoing,(function(t){e.removeConnection(t,{nested:!0})}))},ms.prototype.execute=function(t){var e=t.connection,n=e.parent;return t.parent=n,t.parentIndex=Ot(n.children,e),t.source=e.source,t.target=e.target,this._canvas.removeConnection(e),e.source=null,e.target=null,e},ms.prototype.revert=function(t){var e=t.connection,n=t.parent,o=t.parentIndex;return e.source=t.source,e.target=t.target,Lt(n.children,e,o),this._canvas.addConnection(e,n),e},_s.$inject=["modeling","elementRegistry"],_s.prototype.postExecute=function(t){var e=this._modeling,n=this._elementRegistry,o=t.elements;f(o,(function(t){n.get(t.id)&&(t.waypoints?e.removeConnection(t):e.removeShape(t))}))},xs.$inject=["canvas","modeling"],xs.prototype.preExecute=function(t){var e=this._modeling,n=t.shape;ts(n.incoming,(function(t){e.removeConnection(t,{nested:!0})})),ts(n.outgoing,(function(t){e.removeConnection(t,{nested:!0})})),ts(n.children,(function(t){Nt(t)?e.removeConnection(t,{nested:!0}):e.removeShape(t,{nested:!0})}))},xs.prototype.execute=function(t){var e=this._canvas,n=t.shape,o=n.parent;return t.oldParent=o,t.oldParentIndex=Ot(o.children,n),e.removeShape(n),n},xs.prototype.revert=function(t){var e=this._canvas,n=t.shape,o=t.oldParent,i=t.oldParentIndex;return Lt(o.children,n,i),e.addShape(n,o),n},ws.$inject=["modeling"];var Es={x:"y",y:"x"};function bs(t,e){this._layouter=t,this._canvas=e}function Ss(){}function Cs(){this.allShapes={},this.allConnections={},this.enclosedElements={},this.enclosedConnections={},this.topLevel={}}function ks(t){this._modeling=t}function Ms(t){this._helper=new ks(t)}function js(t){this._modeling=t,this._helper=new ks(t)}function Rs(t){this._modeling=t}function Ts(t){return t.original||t}function Bs(t,e){this._modeling=t,this._rules=e}function Ps(t){this._modeling=t}function Ls(t){this._modeling=t}function Os(t){return _({},t)}function $s(t){switch(t){case"n":case"s":return"y";case"w":case"e":return"x"}}function As(t,e,n){var o=$s(n);return/e|s/.test(n)?t[o]>e:/n|w/.test(n)?t[o]<e:void 0}function zs(t,e){return-1!==t.indexOf(e)}function Is(t){this._modeling=t}function Ds(t){var e={};return f(t,(function(t){e[t.id]=t.hidden,t.children&&(e=_({},e,Ds(t.children)))})),e}function Hs(t,e){var n=[];return f(t,(function(t){t.hidden=e,n=n.concat(t),t.children&&(n=n.concat(Hs(t.children,t.collapsed||e)))})),n}function Gs(t,e){var n=[];return f(t,(function(t){t.hidden=e[t.id],n=n.concat(t),t.children&&(n=n.concat(Gs(t.children,e)))})),n}function Ns(t){this._modeling=t}function Vs(t,e){return Pt(t&&t.attachers,e)}function Us(t,e,n){if(t){var o=t.attachers;o||(t.attachers=o=[]),Lt(o,e,n)}}function Fs(){}function Ws(t,e,n){this._eventBus=t,this._elementFactory=e,this._commandStack=n;var o=this;t.on("diagram.init",(function(){o.registerHandlers(n)}))}function Ks(){}ws.prototype.preExecute=function(t){var e=this._modeling,n=t.groups,o=t.axis,i=t.dimension;function r(t,e){t.range.min=Math.min(e[o],t.range.min),t.range.max=Math.max(e[o]+e[i],t.range.max)}function a(t){return t[o]+t[i]/2}function s(t){return t.length-1}function c(t){return t.max-t.min}var u,h,l=n[0],p=s(n),d=n[p],v=0;f(n,(function(t,u){var h,l,d;t.elements.length<2?u&&u!==n.length-1&&(r(t,t.elements[0]),v+=c(t.range)):(l=(h=S(t.elements,o))[0],u===p&&(l=h[s(h)]),d=a(l),t.range=null,f(h,(function(n){!function(t,n){var i={y:0};i[o]=t-a(n),i[o]&&(i[Es[o]]=0,e.moveElements([n],i,n.parent))}(d,n),null!==t.range?r(t,n):t.range={min:n[o],max:n[o]+n[i]}})),u&&u!==n.length-1&&(v+=c(t.range)))})),h=Math.abs(d.range.min-l.range.max),(u=Math.round((h-v)/(n.length-1)))<n.length-1||f(n,(function(t,r){var a,s={};t!==l&&t!==d&&(a=n[r-1],t.range.max=0,f(t.elements,(function(n,r){s[Es[o]]=0,s[o]=a.range.max-n[o]+u,t.range.min!==n[o]&&(s[o]+=n[o]-t.range.min),s[o]&&e.moveElements([n],s,n.parent),t.range.max=Math.max(n[o]+n[i],r?t.range.max:0)})))}))},ws.prototype.postExecute=function(t){},bs.$inject=["layouter","canvas"],bs.prototype.execute=function(t){var e=t.connection,n=e.waypoints;return _(t,{oldWaypoints:n}),e.waypoints=this._layouter.layoutConnection(e,t.hints),e},bs.prototype.revert=function(t){var e=t.connection;return e.waypoints=t.oldWaypoints,e},Ss.prototype.execute=function(t){var e=t.connection,n=t.delta,o=t.newParent||e.parent,i=t.newParentIndex,r=e.parent;return t.oldParent=r,t.oldParentIndex=Pt(r.children,e),Lt(o.children,e,i),e.parent=o,f(e.waypoints,(function(t){t.x+=n.x,t.y+=n.y,t.original&&(t.original.x+=n.x,t.original.y+=n.y)})),e},Ss.prototype.revert=function(t){var e=t.connection,n=e.parent,o=t.oldParent,i=t.oldParentIndex,r=t.delta;return Pt(n.children,e),Lt(o.children,e,i),e.parent=o,f(e.waypoints,(function(t){t.x-=r.x,t.y-=r.y,t.original&&(t.original.x-=r.x,t.original.y-=r.y)})),e},Cs.prototype.add=function(t,e){return this.addAll([t],e)},Cs.prototype.addAll=function(t,e){var n=function(t,e,n){x(e)&&(e=!0),y(e)&&(n=e,e=!0);var o=Rt((n=n||{}).allShapes),i=Rt(n.allConnections),r=Rt(n.enclosedElements),a=Rt(n.enclosedConnections),s=Rt(n.topLevel,e&&m(t,(function(t){return t.id})));function c(t){s[t.source.id]&&s[t.target.id]&&(s[t.id]=[t]),o[t.source.id]&&o[t.target.id]&&(a[t.id]=r[t.id]=t),i[t.id]=t}return St(t,(function(t){if(r[t.id]=t,!t.waypoints)return o[t.id]=t,f(t.incoming,c),f(t.outgoing,c),t.children;a[t.id]=i[t.id]=t})),{allShapes:o,allConnections:i,topLevel:s,enclosedConnections:a,enclosedElements:r}}(t,!!e,this);return _(this,n),this},ks.prototype.moveRecursive=function(t,e,n){return t?this.moveClosure(this.getClosure(t),e,n):[]},ks.prototype.moveClosure=function(t,e,n,o,i){var r=this._modeling,a=t.allShapes,s=t.allConnections,c=t.enclosedConnections,u=t.topLevel,h=!1;i&&i.parent===n&&(h=!0),f(a,(function(t){r.moveShape(t,e,u[t.id]&&!h&&n,{recurse:!1,layout:!1})})),f(s,(function(t){var o=!!a[t.source.id],i=!!a[t.target.id];c[t.id]&&o&&i?r.moveConnection(t,e,u[t.id]&&!h&&n):r.layoutConnection(t,{connectionStart:o&&xa(t,t.source,e),connectionEnd:i&&wa(t,t.target,e)})}))},ks.prototype.getClosure=function(t){return(new Cs).addAll(t,!0)},Ms.$inject=["modeling"],Ms.prototype.preExecute=function(t){t.closure=this._helper.getClosure(t.shapes)},Ms.prototype.postExecute=function(t){var e,n=t.hints;n&&n.primaryShape&&(e=n.primaryShape,n.oldParent=e.parent),this._helper.moveClosure(t.closure,t.delta,t.newParent,t.newHost,e)},js.$inject=["modeling"],js.prototype.execute=function(t){var e=t.shape,n=t.delta,o=t.newParent||e.parent,i=t.newParentIndex,r=e.parent;return t.oldBounds=$(e,["x","y","width","height"]),t.oldParent=r,t.oldParentIndex=Pt(r.children,e),Lt(o.children,e,i),_(e,{parent:o,x:e.x+n.x,y:e.y+n.y}),e},js.prototype.postExecute=function(t){var e=t.shape,n=t.delta,o=t.hints,i=this._modeling;!1!==o.layout&&(f(e.incoming,(function(t){i.layoutConnection(t,{connectionEnd:wa(t,e,n)})})),f(e.outgoing,(function(t){i.layoutConnection(t,{connectionStart:xa(t,e,n)})}))),!1!==o.recurse&&this.moveChildren(t)},js.prototype.revert=function(t){var e=t.shape,n=t.oldParent,o=t.oldParentIndex,i=t.delta;return Lt(n.children,e,o),_(e,{parent:n,x:e.x-i.x,y:e.y-i.y}),e},js.prototype.moveChildren=function(t){var e=t.delta,n=t.shape;this._helper.moveRecursive(n.children,e,null)},js.prototype.getNewParent=function(t){return t.newParent||t.shape.parent},Rs.$inject=["modeling"],Rs.prototype.execute=function(t){var e=t.newSource,n=t.newTarget,o=t.connection,i=t.dockingOrPoints;if(!e&&!n)throw new Error("newSource or newTarget required");return d(i)&&(t.oldWaypoints=o.waypoints,o.waypoints=i),e&&(t.oldSource=o.source,o.source=e),n&&(t.oldTarget=o.target,o.target=n),o},Rs.prototype.postExecute=function(t){var e=t.connection,n=t.newSource,o=t.newTarget,i=t.dockingOrPoints,r=t.hints||{},a={};r.connectionStart&&(a.connectionStart=r.connectionStart),r.connectionEnd&&(a.connectionEnd=r.connectionEnd),!1!==r.layoutConnection&&(!n||o&&"source"!==r.docking||(a.connectionStart=a.connectionStart||Ts(d(i)?i[0]:i)),!o||n&&"target"!==r.docking||(a.connectionEnd=a.connectionEnd||Ts(d(i)?i[i.length-1]:i)),r.newWaypoints&&(a.waypoints=r.newWaypoints),this._modeling.layoutConnection(e,a))},Rs.prototype.revert=function(t){var e=t.oldSource,n=t.oldTarget,o=t.oldWaypoints,i=t.connection;return e&&(i.source=e),n&&(i.target=n),o&&(i.waypoints=o),i},Bs.$inject=["modeling","rules"],Bs.prototype.preExecute=function(t){var e,n=this,o=this._modeling,i=this._rules,r=t.oldShape,a=t.newData,s=t.hints||{};function c(t,e,n){return i.allowed("connection.reconnect",{connection:n,source:t,target:e})}var u,h={x:a.x,y:a.y},l={x:r.x,y:r.y,width:r.width,height:r.height};e=t.newShape=t.newShape||n.createShape(a,h,r.parent,s),r.host&&o.updateAttachment(e,r.host),!1!==s.moveChildren&&(u=r.children.slice(),o.moveElements(u,{x:0,y:0},e,s));var p=r.incoming.slice(),d=r.outgoing.slice();f(p,(function(t){c(t.source,e,t)&&n.reconnectEnd(t,e,_a(t,e,l),s)})),f(d,(function(t){var o=t.target;c(e,o,t)&&n.reconnectStart(t,e,ma(t,e,l),s)}))},Bs.prototype.postExecute=function(t){var e=t.oldShape;this._modeling.removeShape(e)},Bs.prototype.execute=function(t){},Bs.prototype.revert=function(t){},Bs.prototype.createShape=function(t,e,n,o){return this._modeling.createShape(t,e,n,o)},Bs.prototype.reconnectStart=function(t,e,n,o){this._modeling.reconnectStart(t,e,n,o)},Bs.prototype.reconnectEnd=function(t,e,n,o){this._modeling.reconnectEnd(t,e,n,o)},Ps.$inject=["modeling"],Ps.prototype.execute=function(t){var e=t.shape,n=t.newBounds,o=t.minBounds;if(void 0===n.x||void 0===n.y||void 0===n.width||void 0===n.height)throw new Error("newBounds must have {x, y, width, height} properties");if(o&&(n.width<o.width||n.height<o.height))throw new Error("width and height cannot be less than minimum height and width");if(!o&&n.width<10||n.height<10)throw new Error("width and height cannot be less than 10px");return t.oldBounds={width:e.width,height:e.height,x:e.x,y:e.y},_(e,{width:n.width,height:n.height,x:n.x,y:n.y}),e},Ps.prototype.postExecute=function(t){var e=this._modeling,n=t.shape,o=t.oldBounds;!1!==(t.hints||{}).layout&&(f(n.incoming,(function(t){e.layoutConnection(t,{connectionEnd:_a(t,n,o)})})),f(n.outgoing,(function(t){e.layoutConnection(t,{connectionStart:ma(t,n,o)})})))},Ps.prototype.revert=function(t){var e=t.shape,n=t.oldBounds;return _(e,{width:n.width,height:n.height,x:n.x,y:n.y}),e},Ls.$inject=["modeling"],Ls.prototype.preExecute=function(t){var e=t.delta,n=t.direction,o=t.movingShapes,i=t.resizingShapes,r=t.start,a={};this.moveShapes(o,e),f(i,(function(t){a[t.id]=function(t){return{x:t.x,y:t.y,height:t.height,width:t.width}}(t)})),this.resizeShapes(i,e,n),this.updateConnectionWaypoints(function(t,e){var n=[];return f(t.concat(e),(function(o){var i=o.incoming,r=o.outgoing;f(i.concat(r),(function(o){var i=o.source,r=o.target;(Ra(t,i)||Ra(t,r)||Ra(e,i)||Ra(e,r))&&(Ra(n,o)||n.push(o))}))})),n}(o,i),e,n,r,o,i,a)},Ls.prototype.execute=function(){},Ls.prototype.revert=function(){},Ls.prototype.moveShapes=function(t,e){var n=this;f(t,(function(t){n._modeling.moveShape(t,e,null,{autoResize:!1,layout:!1,recurse:!1})}))},Ls.prototype.resizeShapes=function(t,e,n){var o=this;f(t,(function(t){var i=function(t,e,n){var o=t.x,i=t.y,r=t.width,a=t.height,s=n.x,c=n.y;switch(e){case"n":return{x:o,y:i+c,width:r,height:a-c};case"s":return{x:o,y:i,width:r,height:a+c};case"w":return{x:o+s,y:i,width:r-s,height:a};case"e":return{x:o,y:i,width:r+s,height:a};default:throw new Error("unknown direction: "+e)}}(t,n,e);o._modeling.resizeShape(t,i,null,{attachSupport:!1,autoResize:!1,layout:!1})}))},Ls.prototype.updateConnectionWaypoints=function(t,e,n,o,i,r,a){var s=this,c=i.concat(r);f(t,(function(t){var u=t.source,h=t.target,l=function(t){return z(t.waypoints,(function(t){return(t=Os(t)).original&&(t.original=Os(t.original)),t}))}(t),p=$s(n),d={};zs(c,u)&&zs(c,h)?(l=z(l,(function(t){return As(t,o,n)&&(t[p]=t[p]+e[p]),t.original&&As(t.original,o,n)&&(t.original[p]=t.original[p]+e[p]),t})),s._modeling.updateWaypoints(t,l,{labelBehavior:!1})):(zs(c,u)||zs(c,h))&&(zs(i,u)?d.connectionStart=xa(t,u,e):zs(i,h)?d.connectionEnd=wa(t,h,e):zs(r,u)?d.connectionStart=ma(t,u,a[u.id]):zs(r,h)&&(d.connectionEnd=_a(t,h,a[h.id])),s._modeling.layoutConnection(t,d))}))},Is.$inject=["modeling"],Is.prototype.execute=function(t){var e=t.shape,n=e.children;t.oldChildrenVisibility=Ds(n),e.collapsed=!e.collapsed;var o=Hs(n,e.collapsed);return[e].concat(o)},Is.prototype.revert=function(t){var e=t.shape,n=t.oldChildrenVisibility,o=Gs(e.children,n);return e.collapsed=!e.collapsed,[e].concat(o)},Ns.$inject=["modeling"],Ns.prototype.execute=function(t){var e=t.shape,n=t.newHost,o=e.host;return t.oldHost=o,t.attacherIdx=Vs(o,e),Us(n,e),e.host=n,e},Ns.prototype.revert=function(t){var e=t.shape,n=t.newHost,o=t.oldHost,i=t.attacherIdx;return e.host=o,Vs(n,e),Us(o,e,i),e},Fs.prototype.execute=function(t){var e=t.connection,n=t.newWaypoints;return t.oldWaypoints=e.waypoints,e.waypoints=n,e},Fs.prototype.revert=function(t){var e=t.connection,n=t.oldWaypoints;return e.waypoints=n,e},Ws.$inject=["eventBus","elementFactory","commandStack"],Ws.prototype.getHandlers=function(){return{"shape.append":us,"shape.create":fs,"shape.delete":xs,"shape.move":js,"shape.resize":Ps,"shape.replace":Bs,"shape.toggleCollapse":Is,spaceTool:Ls,"label.create":vs,"connection.create":hs,"connection.delete":ms,"connection.move":Ss,"connection.layout":bs,"connection.updateWaypoints":Fs,"connection.reconnect":Rs,"elements.create":ps,"elements.move":Ms,"elements.delete":_s,"elements.distribute":ws,"elements.align":cs,"element.updateAttachment":Ns}},Ws.prototype.registerHandlers=function(t){f(this.getHandlers(),(function(e,n){t.registerHandler(n,e)}))},Ws.prototype.moveShape=function(t,e,n,o,i){"object"==typeof o&&(i=o,o=null);var r={shape:t,delta:e,newParent:n,newParentIndex:o,hints:i||{}};this._commandStack.execute("shape.move",r)},Ws.prototype.updateAttachment=function(t,e){var n={shape:t,newHost:e};this._commandStack.execute("element.updateAttachment",n)},Ws.prototype.moveElements=function(t,e,n,o){var i,r=(o=o||{}).attach,a=n;!0===r?(i=n,a=n.parent):!1===r&&(i=null);var s={shapes:t,delta:e,newParent:a,newHost:i,hints:o};this._commandStack.execute("elements.move",s)},Ws.prototype.moveConnection=function(t,e,n,o,i){"object"==typeof o&&(i=o,o=void 0);var r={connection:t,delta:e,newParent:n,newParentIndex:o,hints:i||{}};this._commandStack.execute("connection.move",r)},Ws.prototype.layoutConnection=function(t,e){var n={connection:t,hints:e||{}};this._commandStack.execute("connection.layout",n)},Ws.prototype.createConnection=function(t,e,n,o,i,r){"object"==typeof n&&(r=i,i=o,o=n,n=void 0);var a={source:t,target:e,parent:i,parentIndex:n,connection:o=this._create("connection",o),hints:r};return this._commandStack.execute("connection.create",a),a.connection},Ws.prototype.createShape=function(t,e,n,o,i){"number"!=typeof o&&(i=o,o=void 0);var r,a,s=(i=i||{}).attach;t=this._create("shape",t),s?(r=n.parent,a=n):r=n;var c={position:e,shape:t,parent:r,parentIndex:o,host:a,hints:i};return this._commandStack.execute("shape.create",c),c.shape},Ws.prototype.createElements=function(t,e,n,o,i){d(t)||(t=[t]),"number"!=typeof o&&(i=o,o=void 0);var r={position:e,elements:t,parent:n,parentIndex:o,hints:i=i||{}};return this._commandStack.execute("elements.create",r),r.elements},Ws.prototype.createLabel=function(t,e,n,o){n=this._create("label",n);var i={labelTarget:t,position:e,parent:o||t.parent,shape:n};return this._commandStack.execute("label.create",i),i.shape},Ws.prototype.appendShape=function(t,e,n,o,i){i=i||{};var r={source:t,position:n,target:o,shape:e=this._create("shape",e),connection:i.connection,connectionParent:i.connectionParent,hints:i};return this._commandStack.execute("shape.append",r),r.shape},Ws.prototype.removeElements=function(t){var e={elements:t};this._commandStack.execute("elements.delete",e)},Ws.prototype.distributeElements=function(t,e,n){var o={groups:t,axis:e,dimension:n};this._commandStack.execute("elements.distribute",o)},Ws.prototype.removeShape=function(t,e){var n={shape:t,hints:e||{}};this._commandStack.execute("shape.delete",n)},Ws.prototype.removeConnection=function(t,e){var n={connection:t,hints:e||{}};this._commandStack.execute("connection.delete",n)},Ws.prototype.replaceShape=function(t,e,n){var o={oldShape:t,newData:e,hints:n||{}};return this._commandStack.execute("shape.replace",o),o.newShape},Ws.prototype.alignElements=function(t,e){var n={elements:t,alignment:e};this._commandStack.execute("elements.align",n)},Ws.prototype.resizeShape=function(t,e,n,o){var i={shape:t,newBounds:e,minBounds:n,hints:o};this._commandStack.execute("shape.resize",i)},Ws.prototype.createSpace=function(t,e,n,o,i){var r={delta:n,direction:o,movingShapes:t,resizingShapes:e,start:i};this._commandStack.execute("spaceTool",r)},Ws.prototype.updateWaypoints=function(t,e,n){var o={connection:t,newWaypoints:e,hints:n||{}};this._commandStack.execute("connection.updateWaypoints",o)},Ws.prototype.reconnect=function(t,e,n,o,i){var r={connection:t,newSource:e,newTarget:n,dockingOrPoints:o,hints:i||{}};this._commandStack.execute("connection.reconnect",r)},Ws.prototype.reconnectStart=function(t,e,n,o){o||(o={}),this.reconnect(t,e,t.target,n,_(o,{docking:"source"}))},Ws.prototype.reconnectEnd=function(t,e,n,o){o||(o={}),this.reconnect(t,t.source,e,n,_(o,{docking:"target"}))},Ws.prototype.connect=function(t,e,n,o){return this.createConnection(t,e,n||{},t.parent,o)},Ws.prototype._create=function(t,e){return e instanceof le?e:this._elementFactory.create(t,e)},Ws.prototype.toggleCollapse=function(t,e){var n={shape:t,hints:e||{}};this._commandStack.execute("shape.toggleCollapse",n)},Ks.prototype.layoutConnection=function(t,e){return[(e=e||{}).connectionStart||Yt(e.source||t.source),e.connectionEnd||Yt(e.target||t.target)]};var qs=20,Ys=5,Zs=Math.round,Xs=20,Js={"h:h":20,"v:v":20,"h:v":-10,"v:h":-10};function Qs(t,e,n){var o,i,r,a=Zt(e,t,Ys),s=n.split(":")[0],c=Zs((e.x-t.x)/2+t.x),u=Zs((e.y-t.y)/2+t.y),h=(r=a,{t:/top/,r:/right/,b:/bottom/,l:/left/,h:/left|right/,v:/top|bottom/}[s].test(r)),l=/h|r|l/.test(s),p=!1,d=!1;return h?(o=l?{x:c,y:t.y}:{x:t.x,y:u},i=l?"h:h":"v:v"):(p=function(t,e){return!{t:/top/,r:/right/,b:/bottom/,l:/left/,h:/./,v:/./}[e].test(t)}(a,s),i=l?"h:v":"v:h",p?l?(d=u===t.y,o={x:t.x+qs*(/l/.test(s)?-1:1),y:d?u+qs:u}):o={x:(d=c===t.x)?c+qs:c,y:t.y+qs*(/t/.test(s)?-1:1)}:o={x:c,y:u}),{waypoints:ec(t,o,i).concat(o),directions:i,turnNextDirections:d}}function tc(t){return t.split(":").reverse().join(":")}function ec(t,e,n){if(!function(t){return t&&/^h|v|t|r|b|l:h|v|t|r|b|l$/.test(t)}(n=n||"h:h"))throw new Error("unknown directions: <"+n+">: must be specified as <start>:<end> with start/end in { h,v,t,r,b,l }");if(ac(n)){var o=function(t,e,n){return Qs(t,e,n)}(t,e,n),i=function(t,e,n){var o=Qs(e,t,tc(n));return{waypoints:o.waypoints.slice().reverse(),directions:tc(o.directions),turnNextDirections:o.turnNextDirections}}(t,e,n),r=function(t,e){var n=t.directions.split(":")[1],o=e.directions.split(":")[0];t.turnNextDirections&&(n="h"==n?"v":"h"),e.turnNextDirections&&(o="h"==o?"v":"h");var i=n+":"+o;return{waypoints:ec(t.waypoints[t.waypoints.length-1],e.waypoints[0],i),directions:i}}(o,i);return[].concat(o.waypoints,r.waypoints,i.waypoints)}return function(t,e,n){var o=Zs((e.x-t.x)/2+t.x),i=Zs((e.y-t.y)/2+t.y);if("h:v"===n)return[{x:e.x,y:t.y}];if("v:h"===n)return[{x:t.x,y:e.y}];if("h:h"===n)return[{x:o,y:t.y},{x:o,y:e.y}];if("v:v"===n)return[{x:t.x,y:i},{x:e.x,y:i}];throw new Error("invalid directions: can only handle varians of [hv]:[hv]")}(t,e,n)}function nc(t,e,n,o,i){var r=i&&i.preferredLayouts||[],a=H(r,"straight")[0]||"h:h",s=Zt(t,e,Js[a]||0),c=function(t,e){if(ac(e))return e;switch(t){case"intersect":return"t:t";case"top":case"bottom":return"v:v";case"left":case"right":return"h:h";default:return e}}(s,a);n=n||Yt(t),o=o||Yt(e);var u=c.split(":"),h=sc(n,t,u[0],function(t){return{top:"bottom",bottom:"top",left:"right",right:"left","top-left":"bottom-right","bottom-right":"top-left","top-right":"bottom-left","bottom-left":"top-right"}[t]}(s));return function(t,e,n){var o=ec(t,e,n);return o.unshift(t),o.push(e),cc(o)}(h,sc(o,e,u[1],s),c)}function oc(t,e,n,o,i,r){var a;return d(n)&&(i=n,r=o,n=Yt(t),o=Yt(e)),i=i||[],a=-1!==(r=_({preferredLayouts:[]},r)).preferredLayouts.indexOf("straight")&&function(t,e,n,o,i){var r,a,s={};if(a=Zt(t,e),!/^(top|bottom|left|right)$/.test(a))return null;/top|bottom/.test(a)&&(r="x");/left|right/.test(a)&&(r="y");return"target"===i.preserveDocking?ic(r,o,t)?(s[r]=o[r],[{x:void 0!==s.x?s.x:n.x,y:void 0!==s.y?s.y:n.y,original:{x:void 0!==s.x?s.x:n.x,y:void 0!==s.y?s.y:n.y}},{x:o.x,y:o.y}]):null:ic(r,n,e)?(s[r]=n[r],[{x:n.x,y:n.y},{x:void 0!==s.x?s.x:o.x,y:void 0!==s.y?s.y:o.y,original:{x:void 0!==s.x?s.x:o.x,y:void 0!==s.y?s.y:o.y}}]):null}(t,e,n,o,r),a||(a=r.connectionEnd&&function(t,e,n,o){var i=o.slice().reverse();return i=rc(t,e,n,i),i?i.reverse():null}(e,t,o,i),a||((a=r.connectionStart&&rc(t,e,n,i))||(!r.connectionStart&&!r.connectionEnd&&i&&i.length?i:nc(t,e,n,o,r))))}function ic(t,e,n){return function(t,e,n){return t>=e&&t<=n}(e[t],n[t],n[t]+n[{x:"width",y:"height"}[t]])}function rc(t,e,n,o){if((i=o).length<3||!(i.length>4)&&g(i,(function(t,e){var n=i[e-1];return n&&$t(t,n)<3})))return null;var i,r,a=o[0],s=o.slice();return s[0]=n,s[1]=function(t,e,n){switch(It(e,t)){case"v":return{x:n.x,y:t.y};case"h":return{x:t.x,y:n.y}}return{x:t.x,y:t.y}}(s[1],a,n),r=function(t,e,n){var o;for(o=t.length-2;0!==o;o--)if(Ht(t[o],e,Xs)||Ht(t[o],n,Xs))return t.slice(o);return t}(s,t,e),r!==s&&(s=rc(t,e,n,r)),s&&It(s)?null:s}function ac(t){return t&&/t|r|b|l/.test(t)}function sc(t,e,n,o){if("h"===n&&(n=/left/.test(o)?"l":"r"),"v"===n&&(n=/top/.test(o)?"t":"b"),"t"===n)return{original:t,x:t.x,y:e.y};if("r"===n)return{original:t,x:e.x+e.width,y:t.y};if("b"===n)return{original:t,x:t.x,y:e.y+e.height};if("l"===n)return{original:t,x:e.x,y:t.y};throw new Error("unexpected dockingDirection: <"+n+">")}function cc(t){return t.reduce((function(e,n,o){return At(e[e.length-1],t[o+1],n,0)||e.push(n),e}),[])}function uc(t){return _({original:t.point.original||t.point},t.actual)}function hc(t,e){this._elementRegistry=t,this._graphicsFactory=e}hc.$inject=["elementRegistry","graphicsFactory"],hc.prototype.getCroppedWaypoints=function(t,e,n){e=e||t.source,n=n||t.target;var o=this.getDockingPoint(t,e,!0),i=this.getDockingPoint(t,n),r=t.waypoints.slice(o.idx+1,i.idx);return r.unshift(uc(o)),r.push(uc(i)),r},hc.prototype.getDockingPoint=function(t,e,n){var o,i,r=t.waypoints;return{point:i=r[o=n?0:r.length-1],actual:this._getIntersection(e,t,n)||i,idx:o}},hc.prototype._getIntersection=function(t,e,n){return Xt(this._getShapePath(t),this._getConnectionPath(e),n)},hc.prototype._getConnectionPath=function(t){return this._graphicsFactory.getConnectionPath(t)},hc.prototype._getShapePath=function(t){return this._graphicsFactory.getShapePath(t)},hc.prototype._getGfx=function(t){return this._elementRegistry.getGraphics(t)};var lc=Math.round;function pc(t,e,n,o,i){function r(t,e,n,o){return i.allowed("elements.move",{shapes:t,delta:e,position:n,target:o})}function s(t,n,o,i){if(y(o)&&(i=o,o=!1),!n.waypoints&&n.parent&&!a(t.target).has("djs-hit-no-move")){var r=function(t){return{x:t.x+lc(t.width/2),y:t.y+lc(t.height/2)}}(n);return e.init(t,r,"shape.move",{cursor:"grabbing",autoActivate:o,data:{shape:n,context:i||{}}}),!0}}t.on("shape.move.start",1500,(function(t){var e,n,i=t.context,r=t.shape,a=o.get().slice();-1===a.indexOf(r)&&(a=[r]),n=m(e=a,"id"),a=v(e,(function(t){for(;t=t.parent;)if(n[t.id])return!1;return!0})),_(i,{shapes:a,validatedShapes:a,shape:r})})),t.on("shape.move.start",1250,(function(t){var e=t.context,n=e.validatedShapes;if(!(e.canExecute=r(n)))return!1})),t.on("shape.move.move",500,(function(t){var e,n=t.context,o=n.validatedShapes,i=t.hover,a={x:t.dx,y:t.dy};e=r(o,a,{x:t.x,y:t.y},i),n.delta=a,n.canExecute=e,n.target=null!==e?i:null})),t.on("shape.move.end",(function(t){var e=t.context,o=e.delta,i=e.canExecute,r="attach"===i,a=e.shapes;if(!1===i)return!1;o.x=lc(o.x),o.y=lc(o.y),0===o.x&&0===o.y||n.moveElements(a,o,e.target,{primaryShape:e.shape,attach:r})})),t.on("element.mousedown",(function(t){if(Ue(t)){var e=He(t);if(!e)throw new Error("must supply DOM mousedown event");return s(e,t.element)}})),this.start=s}pc.$inject=["eventBus","dragging","modeling","selection","rules"];var dc="djs-dragging",fc="drop-ok",vc="drop-not-ok",gc="new-parent",yc="attach-ok";function mc(t,e,a,s){function c(t){var e=function(t){var e=v(t,(function(e){return!Nt(e)||g(t,R({id:e.source.id}))&&g(t,R({id:e.target.id}))}));return e}(u(t));return e}function u(t){var e=Ct(t,!0),n=z(e,(function(t){return(t.incoming||[]).concat(t.outgoing||[])}));return L(e.concat(n))}function h(t,n){[yc,fc,vc,gc].forEach((function(o){o===n?e.addMarker(t,o):e.removeMarker(t,o)}))}t.on("shape.move.start",499,(function(t){var r=t.context,h=r.shapes,l=r.allDraggedElements,p=c(h);if(!r.dragGroup){var d=n("g");o(d,a.cls("djs-drag-group",["no-events"]));var v=e.getActiveLayer();i(v,d),r.dragGroup=d}p.forEach((function(t){s.addDragger(t,r.dragGroup)})),l=l?L([l,u(h)]):u(h),f(l,(function(t){e.addMarker(t,dc)})),r.allDraggedElements=l,r.differentParents=1!==G(m(h,(function(t){return t.parent&&t.parent.id})))})),t.on("shape.move.move",499,(function(t){var e=t.context,n=e.dragGroup,o=e.target,i=e.shape.parent,r=e.canExecute;o&&("attach"===r?h(o,yc):e.canExecute&&o&&o.id!==i.id?h(o,gc):h(o,e.canExecute?fc:vc)),Se(n,t.dx,t.dy)})),t.on(["shape.move.out","shape.move.cleanup"],(function(t){var e=t.context.target;e&&h(e,null)})),t.on("shape.move.cleanup",(function(t){var n=t.context,o=n.allDraggedElements,i=n.dragGroup;f(o,(function(t){e.removeMarker(t,dc)})),i&&r(i)})),this.makeDraggable=function(t,n,o){s.addDragger(n,t.dragGroup),o&&e.addMarker(n,dc),t.allDraggedElements?t.allDraggedElements.push(n):t.allDraggedElements=[n]}}mc.$inject=["eventBus","canvas","styles","previewSupport"];const _c={__depends__:[Ze,an,Je,Yo,Uo,ir],__init__:["move","movePreview"],move:["type",pc],movePreview:["type",mc]};var xc=".djs-palette-toggle",wc=".entry",Ec=xc+", "+wc,bc="djs-palette-",Sc="open",Cc="two-column";function kc(t,e){this._eventBus=t,this._canvas=e;var n=this;t.on("tool-manager.update",(function(t){var e=t.tool;n.updateToolHighlight(e)})),t.on("i18n.changed",(function(){n._update()})),t.on("diagram.init",(function(){n._diagramInitialized=!0,n._rebuild()}))}function Mc(t,e){var n=e.getPaletteEntries();return M(n)?n(t):(f(n,(function(e,n){t[n]=e})),t)}kc.$inject=["eventBus","canvas"],kc.prototype.registerProvider=function(t,e){e||(e=t,t=1e3),this._eventBus.on("palette.getProviders",t,(function(t){t.providers.push(e)})),this._rebuild()},kc.prototype.getEntries=function(){return this._getProviders().reduce(Mc,{})},kc.prototype._rebuild=function(){this._diagramInitialized&&(this._getProviders().length&&(this._container||this._init(),this._update()))},kc.prototype._init=function(){var t=this,e=this._eventBus,n=this._getParentContainer(),o=this._container=Y(kc.HTML_MARKUP);n.appendChild(o),Z(n).add(bc+"shown"),W.bind(o,Ec,"click",(function(e){var n=e.delegateTarget;if(Q(n,xc))return t.toggle();t.trigger("click",e)})),J.bind(o,"mousedown",(function(t){t.stopPropagation()})),W.bind(o,wc,"dragstart",(function(e){t.trigger("dragstart",e)})),e.on("canvas.resized",this._layoutChanged,this),e.fire("palette.create",{container:o})},kc.prototype._getProviders=function(t){var e=this._eventBus.createEvent({type:"palette.getProviders",providers:[]});return this._eventBus.fire(e),e.providers},kc.prototype._toggleState=function(t){t=t||{};var e,n=this._getParentContainer(),o=this._container,i=this._eventBus,r=Z(o),a=Z(n);e="twoColumn"in t?t.twoColumn:this._needsCollapse(n.clientHeight,this._entries||{}),r.toggle(Cc,e),a.toggle(bc+Cc,e),"open"in t&&(r.toggle(Sc,t.open),a.toggle(bc+Sc,t.open)),i.fire("palette.changed",{twoColumn:e,open:this.isOpen()})},kc.prototype._update=function(){var t=F(".djs-palette-entries",this._container),e=this._entries=this.getEntries();V(t),f(e,(function(e,n){var o=e.group||"default",i=F("[data-group="+xn(o)+"]",t);i||(i=Y('<div class="group"></div>'),q(i,"data-group",o),t.appendChild(i));var r,a,s,c=e.html||(e.separator?'<hr class="separator" />':'<div class="entry" draggable="true"></div>'),u=Y(c);if(i.appendChild(u),!e.separator&&(q(u,"data-action",n),e.title&&q(u,"title",e.title),e.className&&(r=u,a=e.className,s=Z(r),(d(a)?a:a.split(/\s+/g)).forEach((function(t){s.add(t)}))),e.imageUrl)){var h=Y("<img>");q(h,"src",e.imageUrl),u.appendChild(h)}})),this.open()},kc.prototype.trigger=function(t,e,n){var o,i,r=e.delegateTarget||e.target;return r?(o=q(r,"data-action"),i=e.originalEvent||e,this.triggerEntry(o,t,i,n)):e.preventDefault()},kc.prototype.triggerEntry=function(t,e,n,o){var i,r;if((i=this._entries[t])&&(r=i.action,!1!==this._eventBus.fire("palette.trigger",{entry:i,event:n}))){if(M(r)){if("click"===e)return r(n,o)}else if(r[e])return r[e](n,o);n.preventDefault()}},kc.prototype._layoutChanged=function(){this._toggleState({})},kc.prototype._needsCollapse=function(t,e){return t<46*Object.keys(e).length+50},kc.prototype.close=function(){this._toggleState({open:!1,twoColumn:!1})},kc.prototype.open=function(){this._toggleState({open:!0})},kc.prototype.toggle=function(){this.isOpen()?this.close():this.open()},kc.prototype.isActiveTool=function(t){return t&&this._activeTool===t},kc.prototype.updateToolHighlight=function(t){var e,n;this._toolsContainer||(e=F(".djs-palette-entries",this._container),this._toolsContainer=F("[data-group=tools]",e)),n=this._toolsContainer,f(n.children,(function(e){var n=e.getAttribute("data-action");if(n){var o=Z(e);n=n.replace("-tool",""),o.contains("entry")&&n===t?o.add("highlighted-entry"):o.remove("highlighted-entry")}}))},kc.prototype.isOpen=function(){return Z(this._container).has(Sc)},kc.prototype._getParentContainer=function(){return this._canvas.getContainer()},kc.HTML_MARKUP='<div class="djs-palette"><div class="djs-palette-entries"></div><div class="djs-palette-toggle"></div></div>';const jc={__init__:["palette"],palette:["type",kc]};var Rc="crosshair";function Tc(t,e,a,s,c,u,h){this._selection=c,this._dragging=a,this._mouse=h;var l=this,p=function(t){var r,a=e.getActiveLayer();r=t.frame=n("rect"),o(r,{class:"djs-lasso-overlay",width:1,height:1,x:0,y:0}),i(a,r)},d=function(t){var e=t.frame,n=t.bbox;o(e,{x:n.x,y:n.y,width:n.width,height:n.height})},f=function(t){t.frame&&r(t.frame)};u.registerTool("lasso",{tool:"lasso.selection",dragging:"lasso"}),t.on("lasso.selection.end",(function(e){var n=e.originalEvent.target;(e.hover||n instanceof SVGElement)&&t.once("lasso.selection.ended",(function(){l.activateLasso(e.originalEvent,!0)}))})),t.on("lasso.end",(function(t){var e=Bc(t),n=s.filter((function(t){return t}));l.select(n,e)})),t.on("lasso.start",(function(t){var e=t.context;e.bbox=Bc(t),p(e)})),t.on("lasso.move",(function(t){var e=t.context;e.bbox=Bc(t),d(e)})),t.on("lasso.cleanup",(function(t){var e=t.context;f(e)})),t.on("element.mousedown",1500,(function(t){if(We(t))return l.activateLasso(t.originalEvent),!0}))}function Bc(t){var e={x:t.x-t.dx,y:t.y-t.dy},n={x:t.x,y:t.y};return e.x<=n.x&&e.y<n.y||e.x<n.x&&e.y<=n.y?{x:e.x,y:e.y,width:n.x-e.x,height:n.y-e.y}:e.x>=n.x&&e.y<n.y||e.x>n.x&&e.y<=n.y?{x:n.x,y:e.y,width:e.x-n.x,height:n.y-e.y}:e.x<=n.x&&e.y>n.y||e.x<n.x&&e.y>=n.y?{x:e.x,y:n.y,width:n.x-e.x,height:e.y-n.y}:e.x>=n.x&&e.y>n.y||e.x>n.x&&e.y>=n.y?{x:n.x,y:n.y,width:e.x-n.x,height:e.y-n.y}:{x:n.x,y:n.y,width:0,height:0}}Tc.$inject=["eventBus","canvas","dragging","elementRegistry","selection","toolManager","mouse"],Tc.prototype.activateLasso=function(t,e){this._dragging.init(t,"lasso",{autoActivate:e,cursor:Rc,data:{context:{}}})},Tc.prototype.activateSelection=function(t,e){this._dragging.init(t,"lasso.selection",{trapClick:!1,autoActivate:e,cursor:Rc,data:{context:{}}})},Tc.prototype.select=function(t,e){var n=function(t,e){var n={};return f(t,(function(t){var o=t;o.waypoints&&(o=kt(o)),!p(e.y)&&o.x>e.x&&(n[t.id]=t),!p(e.x)&&o.y>e.y&&(n[t.id]=t),o.x>e.x&&o.y>e.y&&(p(e.width)&&p(e.height)&&o.width+o.x<e.width+e.x&&o.height+o.y<e.height+e.y?n[t.id]=t:p(e.width)&&p(e.height)||(n[t.id]=t))})),n}(t,e);this._selection.select(O(n))},Tc.prototype.toggle=function(){if(this.isActive())return this._dragging.cancel();var t=this._mouse.getLastMoveEvent();this.activateSelection(t,!!t)},Tc.prototype.isActive=function(){var t=this._dragging.context();return t&&/^lasso/.test(t.prefix)};const Pc={__depends__:[ja,mr],__init__:["lassoTool"],lassoTool:["type",Tc]};var Lc=1500,Oc="grab";function $c(t,e,n,o,i,r){this._dragging=n,this._mouse=r;var a=this,s=o.get("keyboard",!1);i.registerTool("hand",{tool:"hand",dragging:"hand.move"}),t.on("element.mousedown",Lc,(function(t){if(Fe(t))return a.activateMove(t.originalEvent,!0),!1})),s&&s.addListener(Lc,(function(t){if(Ac(t.keyEvent)&&!a.isActive()){var e=a._mouse.getLastMoveEvent();a.activateMove(e,!!e)}}),"keyboard.keydown"),s&&s.addListener(Lc,(function(t){Ac(t.keyEvent)&&a.isActive()&&a.toggle()}),"keyboard.keyup"),t.on("hand.end",(function(e){var n=e.originalEvent.target;if(!(e.hover||n instanceof SVGElement))return!1;t.once("hand.ended",(function(){a.activateMove(e.originalEvent,{reactivate:!0})}))})),t.on("hand.move.move",(function(t){var n=e.viewbox().scale;e.scroll({dx:t.dx*n,dy:t.dy*n})})),t.on("hand.move.end",(function(e){var n=e.context.reactivate;return!Fe(e)&&n&&t.once("hand.move.ended",(function(t){a.activateHand(t.originalEvent,!0,!0)})),!1}))}function Ac(t){return jn("Space",t)}$c.$inject=["eventBus","canvas","dragging","injector","toolManager","mouse"],$c.prototype.activateMove=function(t,e,n){"object"==typeof e&&(n=e,e=!1),this._dragging.init(t,"hand.move",{autoActivate:e,cursor:Oc,data:{context:n||{}}})},$c.prototype.activateHand=function(t,e,n){this._dragging.init(t,"hand",{trapClick:!1,autoActivate:e,cursor:Oc,data:{context:{reactivate:n}}})},$c.prototype.toggle=function(){if(this.isActive())return this._dragging.cancel();var t=this._mouse.getLastMoveEvent();this.activateHand(t,!!t)},$c.prototype.isActive=function(){var t=this._dragging.context();return!!t&&/^(hand|hand\.move)$/.test(t.prefix)};const zc={__depends__:[ja,mr],__init__:["handTool"],handTool:["type",$c]};var Ic="connect-ok",Dc="connect-not-ok";function Hc(t,e,n,o,i,r,a){var s=this;this._dragging=e,this._rules=r,this._mouse=a,i.registerTool("global-connect",{tool:"global-connect",dragging:"global-connect.drag"}),t.on("global-connect.hover",(function(t){var e=t.context,n=t.hover,i=e.canStartConnect=s.canStartConnect(n);null!==i&&(e.startTarget=n,o.addMarker(n,i?Ic:Dc))})),t.on(["global-connect.out","global-connect.cleanup"],(function(t){var e=t.context.startTarget,n=t.context.canStartConnect;e&&o.removeMarker(e,n?Ic:Dc)})),t.on(["global-connect.ended"],(function(e){var o=e.context.startTarget,i={x:e.x,y:e.y};if(s.canStartConnect(o))return t.once("element.out",(function(){t.once(["connect.ended","connect.canceled"],(function(){t.fire("global-connect.drag.ended")})),n.start(null,o,i)})),!1}))}Hc.$inject=["eventBus","dragging","connect","canvas","toolManager","rules","mouse"],Hc.prototype.start=function(t,e){this._dragging.init(t,"global-connect",{autoActivate:e,trapClick:!1,data:{context:{}}})},Hc.prototype.toggle=function(){if(this.isActive())return this._dragging.cancel();var t=this._mouse.getLastMoveEvent();return this.start(t,!!t)},Hc.prototype.isActive=function(){var t=this._dragging.context();return t&&/^global-connect/.test(t.prefix)},Hc.prototype.canStartConnect=function(t){return this._rules.allowed("connection.start",{source:t})};const Gc={__depends__:[Ji,Yo,Uo,ja,mr],globalConnect:["type",Hc]};function Nc(){this._targets={},this._snapOrigins={},this._snapLocations=[],this._defaultSnaps={}}function Vc(){this._snapValues={}}Nc.prototype.getSnapOrigin=function(t){return this._snapOrigins[t]},Nc.prototype.setSnapOrigin=function(t,e){this._snapOrigins[t]=e,-1===this._snapLocations.indexOf(t)&&this._snapLocations.push(t)},Nc.prototype.addDefaultSnap=function(t,e){var n=this._defaultSnaps[t];n||(n=this._defaultSnaps[t]=[]),n.push(e)},Nc.prototype.getSnapLocations=function(){return this._snapLocations},Nc.prototype.setSnapLocations=function(t){this._snapLocations=t},Nc.prototype.pointsForTarget=function(t){var e=t.id||t,n=this._targets[e];return n||(n=this._targets[e]=new Vc).initDefaults(this._defaultSnaps),n},Vc.prototype.add=function(t,e){var n=this._snapValues[t];n||(n=this._snapValues[t]={x:[],y:[]}),-1===n.x.indexOf(e.x)&&n.x.push(e.x),-1===n.y.indexOf(e.y)&&n.y.push(e.y)},Vc.prototype.snap=function(t,e,n,o){var i=this._snapValues[e];return i&&function(t,e,n){var o,i;for(n=void 0===n?10:n,o=0;o<e.length;o++)if(i=e[o],$i(i-t)<=n)return i}(t[n],i[n],o)},Vc.prototype.initDefaults=function(t){var e=this;f(t||{},(function(t,n){f(t,(function(t){e.add(n,t)}))}))};function Uc(t,e,n){var o=this;this._elementRegistry=t,e.on(["create.start","shape.move.start"],(function(t){o.initSnap(t)})),e.on(["create.move","create.end","shape.move.move","shape.move.end"],1250,(function(t){var e=t.context,i=e.shape,r=e.snapContext,a=e.target;if((!t.originalEvent||!Mn(t.originalEvent))&&!Hi(t)&&a){var s=r.pointsForTarget(a);s.initialized||((s=o.addSnapTargetPoints(s,i,a)).initialized=!0),n.snap(t,s)}})),e.on(["create.cleanup","shape.move.cleanup"],(function(){n.hide()}))}Uc.$inject=["elementRegistry","eventBus","snapping"],Uc.prototype.initSnap=function(t){var e,n=this._elementRegistry,o=t.context,i=o.shape,r=o.snapContext;r||(r=o.snapContext=new Nc);var a=(e=n.get(i.id)?Di(i,t):{x:t.x+Di(i).x,y:t.y+Di(i).y}).x-i.width/2,s=e.y-i.height/2,c=e.x+i.width/2,u=e.y+i.height/2;return r.setSnapOrigin("mid",{x:e.x-t.x,y:e.y-t.y}),Vt(i)||(r.setSnapOrigin("top-left",{x:a-t.x,y:s-t.y}),r.setSnapOrigin("bottom-right",{x:c-t.x,y:u-t.y})),r},Uc.prototype.addSnapTargetPoints=function(t,e,n){var o=this.getSnapTargets(e,n);return f(o,(function(n){if(Vt(n))Vt(e)&&t.add("mid",Di(n));else if(Nt(n)){if(n.waypoints.length<3)return;var o=n.waypoints.slice(1,-1);f(o,(function(e){t.add("mid",e)}))}else t.add("mid",Di(n))})),p(e.x)&&p(e.y)?(this._elementRegistry.get(e.id)&&t.add("mid",Di(e)),t):t},Uc.prototype.getSnapTargets=function(t,e){return Ni(e).filter((function(t){return!t.hidden}))};function Fc(t,e){var n=this;t.on(["resize.start"],(function(t){n.initSnap(t)})),t.on(["resize.move","resize.end"],1250,(function(t){var o=t.context,i=o.shape,r=i.parent,a=o.direction,s=o.snapContext;if(!(t.originalEvent&&Mn(t.originalEvent)||Hi(t))){var c=s.pointsForTarget(r);c.initialized||((c=n.addSnapTargetPoints(c,i,r,a)).initialized=!0),function(t){return"n"===t||"s"===t}(a)&&Gi(t,"x",t.x),function(t){return"e"===t||"w"===t}(a)&&Gi(t,"y",t.y),e.snap(t,c)}})),t.on(["resize.cleanup"],(function(){e.hide()}))}function Wc(t,e){var n=Yt(t),o=Wt(t),i={x:n.x,y:n.y};return-1!==e.indexOf("n")?i.y=o.top:-1!==e.indexOf("s")&&(i.y=o.bottom),-1!==e.indexOf("e")?i.x=o.right:-1!==e.indexOf("w")&&(i.x=o.left),i}Fc.prototype.initSnap=function(t){var e=t.context,n=e.shape,o=e.direction,i=e.snapContext;i||(i=e.snapContext=new Nc);var r=Wc(n,o);return i.setSnapOrigin("corner",{x:r.x-t.x,y:r.y-t.y}),i},Fc.prototype.addSnapTargetPoints=function(t,e,n,o){var i=this.getSnapTargets(e,n);return f(i,(function(e){t.add("corner",Ii(e)),t.add("corner",zi(e))})),t.add("corner",Wc(e,o)),t},Fc.$inject=["eventBus","snapping"],Fc.prototype.getSnapTargets=function(t,e){return Ni(e).filter((function(e){return!(n=e,o=t,n.host===o||Nt(e)||function(t){return!!t.hidden}(e)||Vt(e));var n,o}))};function Kc(t){this._canvas=t,this._asyncHide=C(k(this.hide,this),1e3)}Kc.$inject=["canvas"],Kc.prototype.snap=function(t,e){var n=t.context.snapContext,o=n.getSnapLocations(),i={x:Hi(t,"x"),y:Hi(t,"y")};f(o,(function(o){var r=n.getSnapOrigin(o),a={x:t.x+r.x,y:t.y+r.y};if(f(["x","y"],(function(t){var n;i[t]||void 0!==(n=e.snap(a,o,t,7))&&(i[t]={value:n,originValue:n-r[t]})})),i.x&&i.y)return!1})),this.showSnapLine("vertical",i.x&&i.x.value),this.showSnapLine("horizontal",i.y&&i.y.value),f(["x","y"],(function(e){var n=i[e];y(n)&&Gi(t,e,n.originValue)}))},Kc.prototype._createLine=function(t){var e=this._canvas.getLayer("snap"),r=n("path");return o(r,{d:"M0,0 L0,0"}),a(r).add("djs-snap-line"),i(e,r),{update:function(e){p(e)?o(r,"horizontal"===t?{d:"M-100000,"+e+" L+100000,"+e,display:""}:{d:"M "+e+",-100000 L "+e+", +100000",display:""}):o(r,{display:"none"})}}},Kc.prototype._createSnapLines=function(){this._snapLines={horizontal:this._createLine("horizontal"),vertical:this._createLine("vertical")}},Kc.prototype.showSnapLine=function(t,e){var n=this.getSnapLine(t);n&&n.update(e),this._asyncHide()},Kc.prototype.getSnapLine=function(t){return this._snapLines||this._createSnapLines(),this._snapLines[t]},Kc.prototype.hide=function(){f(this._snapLines,(function(t){t.update()}))};const qc={__init__:["createMoveSnapping","resizeSnapping","snapping"],createMoveSnapping:["type",Uc],resizeSnapping:["type",Fc],snapping:["type",Kc]};function Yc(t,e,n,o){this._open=!1,this._results=[],this._eventMaps=[],this._canvas=t,this._eventBus=e,this._overlays=n,this._selection=o,this._container=Y(Yc.BOX_HTML),this._searchInput=F(Yc.INPUT_SELECTOR,this._container),this._resultsContainer=F(Yc.RESULTS_CONTAINER_SELECTOR,this._container),this._canvas.getContainer().appendChild(this._container),e.on(["canvas.destroy","diagram.destroy"],this.close,this)}function Zc(t,e,n){var o=function(t){var e="";return t.forEach((function(t){t.matched?e+='<strong class="'+Yc.RESULT_HIGHLIGHT_CLASS+'">'+En(t.matched)+"</strong>":e+=En(t.normal)})),""!==e?e:null}(e),i=Y(n);i.innerHTML=o,t.appendChild(i)}Yc.$inject=["canvas","eventBus","overlays","selection"],Yc.prototype._bindEvents=function(){var t=this;function e(e,n,o,i){t._eventMaps.push({el:e,type:o,listener:W.bind(e,n,o,i)})}e(document,"html","click",(function(e){t.close()})),e(this._container,Yc.INPUT_SELECTOR,"click",(function(t){t.stopPropagation(),t.delegateTarget.focus()})),e(this._container,Yc.RESULT_SELECTOR,"mouseover",(function(e){e.stopPropagation(),t._scrollToNode(e.delegateTarget),t._preselect(e.delegateTarget)})),e(this._container,Yc.RESULT_SELECTOR,"click",(function(e){e.stopPropagation(),t._select(e.delegateTarget)})),e(this._container,Yc.INPUT_SELECTOR,"keydown",(function(t){jn("ArrowUp",t)&&t.preventDefault(),jn("ArrowDown",t)&&t.preventDefault()})),e(this._container,Yc.INPUT_SELECTOR,"keyup",(function(e){if(jn("Escape",e))return t.close();if(jn("Enter",e)){var n=t._getCurrentResult();return n?t._select(n):t.close()}return jn("ArrowUp",e)?t._scrollToDirection(!0):jn("ArrowDown",e)?t._scrollToDirection():void(jn(["ArrowLeft","ArrowRight"],e)||t._search(e.delegateTarget.value))}))},Yc.prototype._unbindEvents=function(){this._eventMaps.forEach((function(t){W.unbind(t.el,t.type,t.listener)}))},Yc.prototype._search=function(t){var e=this;if(this._clearResults(),t&&""!==t){var n=this._searchProvider.find(t);if(n.length){n.forEach((function(t){var n=t.element.id,o=e._createResultNode(t,n);e._results[n]={element:t.element,node:o}}));var o=F(Yc.RESULT_SELECTOR,this._resultsContainer);this._scrollToNode(o),this._preselect(o)}}},Yc.prototype._scrollToDirection=function(t){var e=this._getCurrentResult();if(e){var n=t?e.previousElementSibling:e.nextElementSibling;n&&(this._scrollToNode(n),this._preselect(n))}},Yc.prototype._scrollToNode=function(t){if(t&&t!==this._getCurrentResult()){var e=t.offsetTop,n=this._resultsContainer.scrollTop,o=e-this._resultsContainer.clientHeight+t.clientHeight;e<n?this._resultsContainer.scrollTop=e:n<o&&(this._resultsContainer.scrollTop=o)}},Yc.prototype._clearResults=function(){V(this._resultsContainer),this._results=[],this._resetOverlay(),this._eventBus.fire("searchPad.cleared")},Yc.prototype._getCurrentResult=function(){return F(Yc.RESULT_SELECTED_SELECTOR,this._resultsContainer)},Yc.prototype._createResultNode=function(t,e){var n=Y(Yc.RESULT_HTML);return t.primaryTokens.length>0&&Zc(n,t.primaryTokens,Yc.RESULT_PRIMARY_HTML),Zc(n,t.secondaryTokens,Yc.RESULT_SECONDARY_HTML),q(n,Yc.RESULT_ID_ATTRIBUTE,e),this._resultsContainer.appendChild(n),n},Yc.prototype.registerProvider=function(t){this._searchProvider=t},Yc.prototype.open=function(){if(!this._searchProvider)throw new Error("no search provider registered");this.isOpen()||(this._bindEvents(),this._open=!0,Z(this._container).add("open"),this._searchInput.focus(),this._eventBus.fire("searchPad.opened"))},Yc.prototype.close=function(){this.isOpen()&&(this._unbindEvents(),this._open=!1,Z(this._container).remove("open"),this._clearResults(),this._searchInput.value="",this._searchInput.blur(),this._resetOverlay(),this._eventBus.fire("searchPad.closed"))},Yc.prototype.toggle=function(){this.isOpen()?this.close():this.open()},Yc.prototype.isOpen=function(){return this._open},Yc.prototype._preselect=function(t){var e=this._getCurrentResult();if(t!==e){e&&Z(e).remove(Yc.RESULT_SELECTED_CLASS);var n=q(t,Yc.RESULT_ID_ATTRIBUTE),o=this._results[n].element;Z(t).add(Yc.RESULT_SELECTED_CLASS),this._resetOverlay(o),this._canvas.scrollToElement(o,{top:400}),this._selection.select(o),this._eventBus.fire("searchPad.preselected",o)}},Yc.prototype._select=function(t){var e=q(t,Yc.RESULT_ID_ATTRIBUTE),n=this._results[e].element;this.close(),this._resetOverlay(),this._canvas.scrollToElement(n,{top:400}),this._selection.select(n),this._eventBus.fire("searchPad.selected",n)},Yc.prototype._resetOverlay=function(t){if(this._overlayId&&this._overlays.remove(this._overlayId),t){var e=function(t){var e=6,n=t.width+2*e,o=t.height+2*e,i={width:n+"px",height:o+"px"},r=Y('<div class="'+Yc.OVERLAY_CLASS+'"></div>');return N(r,i),{position:{bottom:o-e,right:n-e},show:!0,html:r}}(kt(t));this._overlayId=this._overlays.add(t,e)}},Yc.CONTAINER_SELECTOR=".djs-search-container",Yc.INPUT_SELECTOR=".djs-search-input input",Yc.RESULTS_CONTAINER_SELECTOR=".djs-search-results",Yc.RESULT_SELECTOR=".djs-search-result",Yc.RESULT_SELECTED_CLASS="djs-search-result-selected",Yc.RESULT_SELECTED_SELECTOR="."+Yc.RESULT_SELECTED_CLASS,Yc.RESULT_ID_ATTRIBUTE="data-result-id",Yc.RESULT_HIGHLIGHT_CLASS="djs-search-highlight",Yc.OVERLAY_CLASS="djs-search-overlay",Yc.BOX_HTML='<div class="djs-search-container djs-draggable djs-scrollable"><div class="djs-search-input"><input type="text"/></div><div class="djs-search-results"></div></div>',Yc.RESULT_HTML='<div class="djs-search-result"></div>',Yc.RESULT_PRIMARY_HTML='<div class="djs-search-result-primary"></div>',Yc.RESULT_SECONDARY_HTML='<p class="djs-search-result-secondary"></p>';const Xc={__depends__:[dn,an],searchPad:["type",Yc]};export{Pt as $,lo as A,dt as B,gn as C,Te as D,Tr as E,Fe as F,Ji as G,fr as H,Ir as I,Hr as J,zn as K,kt as L,Wn as M,Nr as N,dn as O,bo as P,It as Q,_n as R,an as S,ze as T,Zr as U,Ln as V,On as W,va as X,Un as Y,Jn as Z,Lt as _,Se as a,St as a0,Qo as a1,ni as a2,Ft as a3,ei as a4,ri as a5,ga as a6,oi as a7,ii as a8,_a as a9,Gi as aA,Uc as aB,Hi as aC,zi as aD,Ii as aE,qc as aF,Xc as aG,ro as aH,Ko as aI,Wi as aJ,tr as aK,ia as aL,_c as aM,Ze as aN,Ee as aO,ma as aa,Ct as ab,Ut as ac,$r as ad,Yo as ae,ka as af,za as ag,Fa as ah,ye as ai,Ws as aj,Ks as ak,cc as al,oc as am,Ka as an,Qa as ao,os as ap,ss as aq,hc as ar,jc as as,Pc as at,zc as au,Gc as av,xn as aw,ir as ax,Mn as ay,Di as az,_t as b,ft as c,Ie as d,En as e,Wt as f,Yt as g,Kt as h,Vt as i,vn as j,So as k,wt as l,go as m,To as n,Zt as o,Mo as p,Nt as q,Ce as r,jo as s,be as t,$o as u,Ao as v,zo as w,Er as x,kr as y,Br as z};
