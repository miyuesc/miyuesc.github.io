var n=String.fromCharCode,e=Object.prototype.hasOwnProperty,r=/&#(\d+);|&#x([0-9a-f]+);|&(\w+);/gi,t={amp:"&",apos:"'",gt:">",lt:"<",quot:'"'};function i(r,i,s,u){return u?e.call(t,u)?t[u]:"&"+u+";":n(i||parseInt(s,16))}function s(n){return n.length>3&&-1!==n.indexOf("&")?n.replace(r,i):n}Object.keys(t).forEach((function(n){t[n.toUpperCase()]=t[n]}));var u="xsi:type",a="non-whitespace outside of root node";function f(n){return new Error(n)}function o(n){return"missing namespace for prefix <"+n+">"}function l(n){return{get:n,enumerable:!0}}function c(n){var e,r={};for(e in n)r[e]=n[e];return r}function g(n){return n+"$uri"}function d(){return{line:0,column:0}}function b(n){throw n}function h(n){if(!this)return new h(n);var e,r,t,i,m,x,p,O,v,C=n&&n.proxy,w=b,A=d,k=!1,q=!1,y=null,N=!1;function j(n){n instanceof Error||(n=f(n)),y=n,w(n,A)}function E(n){m&&(n instanceof Error||(n=f(n)),m(n,A))}this.on=function(n,s){if("function"!=typeof s)throw f("required args <name, cb>");switch(n){case"openTag":r=s;break;case"text":e=s;break;case"closeTag":t=s;break;case"error":w=s;break;case"warn":m=s;break;case"cdata":i=s;break;case"attention":O=s;break;case"question":p=s;break;case"comment":x=s;break;default:throw f("unsupported event: "+n)}return this},this.ns=function(n){if(void 0===n&&(n={}),"object"!=typeof n)throw f("required args <nsMap={}>");var e,r={};for(e in n)r[e]=n[e];return r["http://www.w3.org/2001/XMLSchema-instance"]="xsi",q=!0,v=r,this},this.parse=function(n){if("string"!=typeof n)throw f("required args <xml=string>");return y=null,function(n){var f,d,b,h,m,w,y,T,M,P,S,D=q?[]:null,I=q?function(n){var e,r,t={};for(e in n)t[r=n[e]]=r,t[g(r)]=e;return t}(v):null,L=[],U=0,X=!1,$=!1,z=0,B=0,F="",G=0;function H(){if(null!==S)return S;var n,e,r,t,i,a,f,l,d,b,h,m=q&&I.xmlns,x=q&&k?[]:null,p=G,O=F,C=O.length,w={},A={};n:for(;p<C;p++)if(d=!1,!(32===(b=O.charCodeAt(p))||b<14&&b>8)){for((b<65||b>122||b>90&&b<97)&&95!==b&&58!==b&&(E("illegal first char attribute name"),d=!0),h=p+1;h<C;h++)if(!((b=O.charCodeAt(h))>96&&b<123||b>64&&b<91||b>47&&b<59||46===b||45===b||95===b)){if(32===b||b<14&&b>8){E("missing attribute value"),p=h;continue n}if(61===b)break;E("illegal attribute name char"),d=!0}if("xmlns:xmlns"===(l=O.substring(p,h))&&(E("illegal declaration of xmlns"),d=!0),34===(b=O.charCodeAt(h+1)))-1===(h=O.indexOf('"',p=h+2))&&-1!==(h=O.indexOf("'",p))&&(E("attribute value quote missmatch"),d=!0);else if(39===b)-1===(h=O.indexOf("'",p=h+2))&&-1!==(h=O.indexOf('"',p))&&(E("attribute value quote missmatch"),d=!0);else for(E("missing attribute value quotes"),d=!0,h+=1;h<C&&!(32===(b=O.charCodeAt(h+1))||b<14&&b>8);h++);for(-1===h&&(E("missing closing quotes"),h=C,d=!0),d||(a=O.substring(p,h)),p=h;h+1<C&&!(32===(b=O.charCodeAt(h+1))||b<14&&b>8);h++)p===h&&(E("illegal character after attribute end"),d=!0);if(p=h+1,!d)if(l in A)E("attribute <"+l+"> already defined");else if(A[l]=!0,q)if(k){if(null!==(i="xmlns"===l?"xmlns":120===l.charCodeAt(0)&&"xmlns:"===l.substr(0,6)?l.substr(6):null)){if(n=s(a),e=g(i),!(f=v[n])){if("xmlns"===i||e in I&&I[e]!==n)do{f="ns"+U++}while(void 0!==I[f]);else f=i;v[n]=f}I[i]!==f&&(t||(I=c(I),t=!0),I[i]=f,"xmlns"===i&&(I[g(f)]=n,m=f),I[e]=n),w[l]=a;continue}x.push(l,a)}else-1!==(b=l.indexOf(":"))?(r=I[l.substring(0,b)])?((l=m===r?l.substr(b+1):r+l.substr(b))===u&&(-1!==(b=a.indexOf(":"))?(r=a.substring(0,b),a=(r=I[r]||r)+a.substring(b)):a=m+":"+a),w[l]=a):E(o(l.substring(0,b))):w[l]=a;else w[l]=a}if(k)for(p=0,C=x.length;p<C;p++){if(l=x[p++],a=x[p],-1!==(b=l.indexOf(":"))){if(!(r=I[l.substring(0,b)])){E(o(l.substring(0,b)));continue}(l=m===r?l.substr(b+1):r+l.substr(b))===u&&(-1!==(b=a.indexOf(":"))?(r=a.substring(0,b),a=(r=I[r]||r)+a.substring(b)):a=m+":"+a)}w[l]=a}return S=w}function J(){for(var e,r,t=/(\r\n|\r|\n)/g,i=0,s=0,u=0,a=B;z>=u&&(e=t.exec(n))&&!((a=e[0].length+e.index)>z);)i+=1,u=a;return-1==z?(s=a,r=n.substring(B)):0===B?r=n.substring(B,z):(s=z-u,r=-1==B?n.substring(z):n.substring(z,B+1)),{data:r,line:i,column:s}}A=J,C&&(P=Object.create({},{name:l((function(){return T})),originalName:l((function(){return M})),attrs:l(H),ns:l((function(){return I}))}));for(;-1!==B;){if(-1===(z=60===n.charCodeAt(B)?B:n.indexOf("<",B)))return L.length?j("unexpected end of file"):0===B?j("missing start tag"):void(B<n.length&&n.substring(B).trim()&&E(a));if(B!==z)if(L.length){if(e&&(e(n.substring(B,z),s,A),N))return}else if(n.substring(B,z).trim()&&(E(a),N))return;if(33===(m=n.charCodeAt(z+1))){if(91===(h=n.charCodeAt(z+2))&&"CDATA["===n.substr(z+3,6)){if(-1===(B=n.indexOf("]]>",z)))return j("unclosed cdata");if(i&&(i(n.substring(z+9,B),A),N))return;B+=3;continue}if(45===h&&45===n.charCodeAt(z+3)){if(-1===(B=n.indexOf("--\x3e",z)))return j("unclosed comment");if(x&&(x(n.substring(z+4,B),s,A),N))return;B+=3;continue}}if(63!==m){for(d=z+1;;d++){if(w=n.charCodeAt(d),isNaN(w))return B=-1,j("unclosed tag");if(34===w)d=-1!==(h=n.indexOf('"',d+1))?h:d;else if(39===w)d=-1!==(h=n.indexOf("'",d+1))?h:d;else if(62===w){B=d;break}}if(33!==m){if(S={},47===m){if(X=!1,$=!0,!L.length)return j("missing open tag");if(d=T=L.pop(),h=z+2+d.length,n.substring(z+2,h)!==d)return j("closing tag mismatch");for(;h<B;h++)if(!(32===(m=n.charCodeAt(h))||m>8&&m<14))return j("close tag")}else{if(47===n.charCodeAt(B-1)?(d=T=n.substring(z+1,B-1),X=!0,$=!0):(d=T=n.substring(z+1,B),X=!0,$=!1),!(m>96&&m<123||m>64&&m<91||95===m||58===m))return j("illegal first char nodeName");for(h=1,b=d.length;h<b;h++)if(!((m=d.charCodeAt(h))>96&&m<123||m>64&&m<91||m>47&&m<59||45===m||95===m||46==m)){if(32===m||m<14&&m>8){T=d.substring(0,h),S=null;break}return j("invalid nodeName")}$||L.push(T)}if(q){if(f=I,X&&($||D.push(f),null===S&&(k=-1!==d.indexOf("xmlns",h))&&(G=h,F=d,H(),k=!1)),M=T,-1!==(m=T.indexOf(":"))){if(!(y=I[T.substring(0,m)]))return j("missing namespace on <"+M+">");T=T.substr(m+1)}else y=I.xmlns;y&&(T=y+":"+T)}if(X&&(G=h,F=d,r&&(C?r(P,s,$,A):r(T,H,s,$,A),N)))return;if($){if(t&&(t(C?P:T,s,X,A),N))return;q&&(I=X?f:D.pop())}B+=1}else{if(O&&(O(n.substring(z,B+1),s,A),N))return;B+=1}}else{if(-1===(B=n.indexOf("?>",z)))return j("unclosed question");if(p&&(p(n.substring(z,B+2),A),N))return;B+=2}}}(n),A=d,N=!1,y},this.stop=function(){N=!0}}export{h as P};
