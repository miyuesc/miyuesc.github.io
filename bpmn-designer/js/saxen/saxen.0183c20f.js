var e=String.fromCharCode,n=Object.prototype.hasOwnProperty,r=/&#(\d+);|&#x([0-9a-f]+);|&(\w+);/gi,t={amp:"&",apos:"'",gt:">",lt:"<",quot:'"'};function i(r,i,s,u){return u?n.call(t,u)?t[u]:"&"+u+";":e(i||parseInt(s,16))}function s(e){return e.length>3&&-1!==e.indexOf("&")?e.replace(r,i):e}Object.keys(t).forEach((function(e){t[e.toUpperCase()]=t[e]}));var u="non-whitespace outside of root node";function a(e){return new Error(e)}function f(e){return"missing namespace for prefix <"+e+">"}function o(e){return{get:e,enumerable:!0}}function l(e){var n,r={};for(n in e)r[n]=e[n];return r}function c(e){return e+"$uri"}function g(){return{line:0,column:0}}function d(e){throw e}function b(e){if(!this)return new b(e);var n,r,t,i,h,m,x,p,O,v=e&&e.proxy,C=d,A=g,k=!1,w=!1,q=null,y=!1;function N(e){e instanceof Error||(e=a(e)),q=e,C(e,A)}function j(e){h&&(e instanceof Error||(e=a(e)),h(e,A))}this.on=function(e,s){if("function"!=typeof s)throw a("required args <name, cb>");switch(e){case"openTag":r=s;break;case"text":n=s;break;case"closeTag":t=s;break;case"error":C=s;break;case"warn":h=s;break;case"cdata":i=s;break;case"attention":p=s;break;case"question":x=s;break;case"comment":m=s;break;default:throw a("unsupported event: "+e)}return this},this.ns=function(e){if(void 0===e&&(e={}),"object"!=typeof e)throw a("required args <nsMap={}>");var n,r={};for(n in e)r[n]=e[n];return w=!0,O=r,this},this.parse=function(e){if("string"!=typeof e)throw a("required args <xml=string>");return q=null,function(e){var a,g,d,b,h,C,q,E,T,P,D,I=w?[]:null,M=w?function(e){var n,r,t={};for(n in e)t[r=e[n]]=r,t[c(r)]=n;return t}(O):null,S=[],U=0,$=!1,z=!1,B=0,F=0,G="",H=0;function J(){if(null!==D)return D;var e,n,r,t,i,u,a,o,g,d,b,h=w&&M.xmlns,m=w&&k?[]:null,x=H,p=G,v=p.length,C={},A={};e:for(;x<v;x++)if(g=!1,!(32===(d=p.charCodeAt(x))||d<14&&d>8)){for((d<65||d>122||d>90&&d<97)&&95!==d&&58!==d&&(j("illegal first char attribute name"),g=!0),b=x+1;b<v;b++)if(!((d=p.charCodeAt(b))>96&&d<123||d>64&&d<91||d>47&&d<59||46===d||45===d||95===d)){if(32===d||d<14&&d>8){j("missing attribute value"),x=b;continue e}if(61===d)break;j("illegal attribute name char"),g=!0}if("xmlns:xmlns"===(o=p.substring(x,b))&&(j("illegal declaration of xmlns"),g=!0),34===(d=p.charCodeAt(b+1)))-1===(b=p.indexOf('"',x=b+2))&&-1!==(b=p.indexOf("'",x))&&(j("attribute value quote missmatch"),g=!0);else if(39===d)-1===(b=p.indexOf("'",x=b+2))&&-1!==(b=p.indexOf('"',x))&&(j("attribute value quote missmatch"),g=!0);else for(j("missing attribute value quotes"),g=!0,b+=1;b<v&&!(32===(d=p.charCodeAt(b+1))||d<14&&d>8);b++);for(-1===b&&(j("missing closing quotes"),b=v,g=!0),g||(u=p.substring(x,b)),x=b;b+1<v&&!(32===(d=p.charCodeAt(b+1))||d<14&&d>8);b++)x===b&&(j("illegal character after attribute end"),g=!0);if(x=b+1,!g)if(o in A)j("attribute <"+o+"> already defined");else if(A[o]=!0,w)if(k){if(null!==(i="xmlns"===o?"xmlns":120===o.charCodeAt(0)&&"xmlns:"===o.substr(0,6)?o.substr(6):null)){if(e=s(u),n=c(i),!(a=O[e])){if("xmlns"===i||n in M&&M[n]!==e)do{a="ns"+U++}while(void 0!==M[a]);else a=i;O[e]=a}M[i]!==a&&(t||(M=l(M),t=!0),M[i]=a,"xmlns"===i&&(M[c(a)]=e,h=a),M[n]=e),C[o]=u;continue}m.push(o,u)}else-1!==(d=o.indexOf(":"))?(r=M[o.substring(0,d)])?C[o=h===r?o.substr(d+1):r+o.substr(d)]=u:j(f(o.substring(0,d))):C[o]=u;else C[o]=u}if(k)for(x=0,v=m.length;x<v;x++){if(o=m[x++],u=m[x],-1!==(d=o.indexOf(":"))){if(!(r=M[o.substring(0,d)])){j(f(o.substring(0,d)));continue}o=h===r?o.substr(d+1):r+o.substr(d)}C[o]=u}return D=C}function K(){for(var n,r,t=/(\r\n|\r|\n)/g,i=0,s=0,u=0,a=F;B>=u&&(n=t.exec(e))&&!((a=n[0].length+n.index)>B);)i+=1,u=a;return-1==B?(s=a,r=e.substring(F)):0===F?r=e.substring(F,B):(s=B-u,r=-1==F?e.substring(B):e.substring(B,F+1)),{data:r,line:i,column:s}}A=K,v&&(P=Object.create({},{name:o((function(){return E})),originalName:o((function(){return T})),attrs:o(J),ns:o((function(){return M}))}));for(;-1!==F;){if(-1===(B=60===e.charCodeAt(F)?F:e.indexOf("<",F)))return S.length?N("unexpected end of file"):0===F?N("missing start tag"):void(F<e.length&&e.substring(F).trim()&&j(u));if(F!==B)if(S.length){if(n&&(n(e.substring(F,B),s,A),y))return}else if(e.substring(F,B).trim()&&(j(u),y))return;if(33===(h=e.charCodeAt(B+1))){if(91===(b=e.charCodeAt(B+2))&&"CDATA["===e.substr(B+3,6)){if(-1===(F=e.indexOf("]]>",B)))return N("unclosed cdata");if(i&&(i(e.substring(B+9,F),A),y))return;F+=3;continue}if(45===b&&45===e.charCodeAt(B+3)){if(-1===(F=e.indexOf("--\x3e",B)))return N("unclosed comment");if(m&&(m(e.substring(B+4,F),s,A),y))return;F+=3;continue}}if(63!==h){for(g=B+1;;g++){if(C=e.charCodeAt(g),isNaN(C))return F=-1,N("unclosed tag");if(34===C)g=-1!==(b=e.indexOf('"',g+1))?b:g;else if(39===C)g=-1!==(b=e.indexOf("'",g+1))?b:g;else if(62===C){F=g;break}}if(33!==h){if(D={},47===h){if($=!1,z=!0,!S.length)return N("missing open tag");if(g=E=S.pop(),b=B+2+g.length,e.substring(B+2,b)!==g)return N("closing tag mismatch");for(;b<F;b++)if(!(32===(h=e.charCodeAt(b))||h>8&&h<14))return N("close tag")}else{if(47===e.charCodeAt(F-1)?(g=E=e.substring(B+1,F-1),$=!0,z=!0):(g=E=e.substring(B+1,F),$=!0,z=!1),!(h>96&&h<123||h>64&&h<91||95===h||58===h))return N("illegal first char nodeName");for(b=1,d=g.length;b<d;b++)if(!((h=g.charCodeAt(b))>96&&h<123||h>64&&h<91||h>47&&h<59||45===h||95===h||46==h)){if(32===h||h<14&&h>8){E=g.substring(0,b),D=null;break}return N("invalid nodeName")}z||S.push(E)}if(w){if(a=M,$&&(z||I.push(a),null===D&&(k=-1!==g.indexOf("xmlns",b))&&(H=b,G=g,J(),k=!1)),T=E,-1!==(h=E.indexOf(":"))){if(!(q=M[E.substring(0,h)]))return N("missing namespace on <"+T+">");E=E.substr(h+1)}else q=M.xmlns;q&&(E=q+":"+E)}if($&&(H=b,G=g,r&&(v?r(P,s,z,A):r(E,J,s,z,A),y)))return;if(z){if(t&&(t(v?P:E,s,$,A),y))return;w&&(M=$?a:I.pop())}F+=1}else{if(p&&(p(e.substring(B,F+1),s,A),y))return;F+=1}}else{if(-1===(F=e.indexOf("?>",B)))return N("unclosed question");if(x&&(x(e.substring(B,F+2),A),y))return;F+=2}}}(e),A=g,y=!1,q},this.stop=function(){y=!0}}export{b as P};
